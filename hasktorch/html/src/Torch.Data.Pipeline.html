<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.Data.Pipeline</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#takeBatch"><span class="hs-identifier">takeBatch</span></a></span><span>
</span><span id="line-15"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#readBatches"><span class="hs-identifier">readBatches</span></a></span><span>
</span><span id="line-16"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#readBatchesConcurrently"><span class="hs-identifier">readBatchesConcurrently</span></a></span><span>
</span><span id="line-17"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#makeFold%27"><span class="hs-identifier">makeFold'</span></a></span><span>
</span><span id="line-18"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#makeFoldWithTransform%27"><span class="hs-identifier">makeFoldWithTransform'</span></a></span><span>
</span><span id="line-19"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#makeConcurrentFold%27"><span class="hs-identifier">makeConcurrentFold'</span></a></span><span>
</span><span id="line-20"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#makeFold"><span class="hs-identifier">makeFold</span></a></span><span>
</span><span id="line-21"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#makeFoldWithTransform"><span class="hs-identifier">makeFoldWithTransform</span></a></span><span>
</span><span id="line-22"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#makeConcurrentFold"><span class="hs-identifier">makeConcurrentFold</span></a></span><span>
</span><span id="line-23"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#foldFromProducer"><span class="hs-identifier">foldFromProducer</span></a></span><span>
</span><span id="line-24"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier">L.FoldM</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier">Dataset</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#DatasetMock"><span class="hs-identifier">DatasetMock</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#ConcurrentDataset"><span class="hs-identifier">ConcurrentDataset</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>                           </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/lkjl0478aq1zapqxsh9kkh94wk9j49xm-lifted-async-lib-lifted-async-0.10.0.6-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier">Control.Concurrent.Async.Lifted</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier">Control.Foldl</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Alternative</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier">Pipes</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier">Pipes.Concurrent</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier">Pipes.Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/krlfg66f7hzbrjdgrmxkjyalsq7llyag-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/krlfg66f7hzbrjdgrmxkjyalsq7llyag-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">type</span><span> </span><span id="Iter"><span class="annot"><a href="Torch.Data.Pipeline.html#Iter"><span class="hs-identifier hs-var">Iter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">type</span><span> </span><span id="WorkerId"><span class="annot"><a href="Torch.Data.Pipeline.html#WorkerId"><span class="hs-identifier hs-var">WorkerId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">data</span><span> </span><span id="DatasetMock"><span class="annot"><a href="Torch.Data.Pipeline.html#DatasetMock"><span class="hs-identifier hs-var">DatasetMock</span></a></span></span><span> </span><span id="local-6989586621679866610"><span class="annot"><a href="#local-6989586621679866610"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679866609"><span class="annot"><a href="#local-6989586621679866609"><span class="hs-identifier hs-type">tensor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DatasetMock"><span class="annot"><a href="Torch.Data.Pipeline.html#DatasetMock"><span class="hs-identifier hs-var">DatasetMock</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getBatchMock"><span class="annot"><span class="annottext">DatasetMock m tensor -&gt; Int -&gt; m tensor
</span><a href="Torch.Data.Pipeline.html#getBatchMock"><span class="hs-identifier hs-var hs-var">getBatchMock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866610"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866609"><span class="hs-identifier hs-type">tensor</span></a></span><span>
</span><span id="line-46"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span id="numItersMock"><span class="annot"><span class="annottext">DatasetMock m tensor -&gt; Int
</span><a href="Torch.Data.Pipeline.html#numItersMock"><span class="hs-identifier hs-var hs-var">numItersMock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Iter"><span class="hs-identifier hs-type">Iter</span></a></span><span>
</span><span id="line-47"></span><span>                                        </span><span class="hs-special">}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679866742"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866742"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/krlfg66f7hzbrjdgrmxkjyalsq7llyag-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866742"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Dataset"><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-var">Dataset</span></a></span></span><span> </span><span id="local-6989586621679866742"><span class="annot"><a href="#local-6989586621679866742"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679866741"><span class="annot"><a href="#local-6989586621679866741"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679866740"><span class="annot"><a href="#local-6989586621679866740"><span class="hs-identifier hs-type">batch</span></a></span></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>  </span><span id="getBatch"><span class="annot"><a href="Torch.Data.Pipeline.html#getBatch"><span class="hs-identifier hs-type">getBatch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679866741"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Iter"><span class="hs-identifier hs-type">Iter</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866742"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866740"><span class="hs-identifier hs-type">batch</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span id="numIters"><span class="annot"><a href="Torch.Data.Pipeline.html#numIters"><span class="hs-identifier hs-type">numIters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679866741"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866738"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866737"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866736"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="ConcurrentDataset"><span class="annot"><a href="Torch.Data.Pipeline.html#ConcurrentDataset"><span class="hs-identifier hs-var">ConcurrentDataset</span></a></span></span><span> </span><span id="local-6989586621679866738"><span class="annot"><a href="#local-6989586621679866738"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679866737"><span class="annot"><a href="#local-6989586621679866737"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679866736"><span class="annot"><a href="#local-6989586621679866736"><span class="hs-identifier hs-type">batch</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>  </span><span id="getBatchConcurrently"><span class="annot"><a href="Torch.Data.Pipeline.html#getBatchConcurrently"><span class="hs-identifier hs-type">getBatchConcurrently</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#WorkerId"><span class="hs-identifier hs-type">WorkerId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866737"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Iter"><span class="hs-identifier hs-type">Iter</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866738"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866736"><span class="hs-identifier hs-type">batch</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621679866691"><span id="local-6989586621679866692"><span class="annot"><a href="Torch.Data.Pipeline.html#takeBatch"><span class="hs-identifier hs-type">takeBatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866692"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866691"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Producer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866691"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866692"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>  </span><span>
</span><span id="line-57"></span><span id="takeBatch"><span class="annot"><span class="annottext">takeBatch :: Input (Maybe batch) -&gt; Producer batch m ()
</span><a href="Torch.Data.Pipeline.html#takeBatch"><span class="hs-identifier hs-var hs-var">takeBatch</span></a></span></span><span> </span><span id="local-6989586621679866602"><span class="annot"><span class="annottext">input :: Input (Maybe batch)
</span><a href="#local-6989586621679866602"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch) -&gt; Producer' (Maybe batch) m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Input a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">fromInput</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch)
</span><a href="#local-6989586621679866602"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy X () () (Maybe batch) m ()
-&gt; Proxy () (Maybe batch) () (Maybe batch) m ()
-&gt; Proxy X () () (Maybe batch) m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe batch -&gt; Bool)
-&gt; Proxy () (Maybe batch) () (Maybe batch) m ()
forall (m :: * -&gt; *) a. Functor m =&gt; (a -&gt; Bool) -&gt; Pipe a a m ()
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">P.takeWhile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe batch -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Proxy X () () (Maybe batch) m ()
-&gt; Proxy () (Maybe batch) () batch m () -&gt; Producer batch m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy () (Maybe batch) () batch m ()
forall y b. Proxy () (Maybe y) () y m b
</span><a href="#local-6989586621679866598"><span class="hs-identifier hs-var">yieldMore</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679866598"><span class="annot"><span class="annottext">yieldMore :: Proxy () (Maybe y) () y m b
</span><a href="#local-6989586621679866598"><span class="hs-identifier hs-var hs-var">yieldMore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy () (Maybe y) () y m () -&gt; Proxy () (Maybe y) () y m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">(Proxy () (Maybe y) () y m () -&gt; Proxy () (Maybe y) () y m b)
-&gt; Proxy () (Maybe y) () y m () -&gt; Proxy () (Maybe y) () y m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy () (Maybe y) () y m (Maybe y)
forall (m :: * -&gt; *) a. Functor m =&gt; Consumer' a m a
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">await</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy () (Maybe y) () y m (Maybe y)
-&gt; (Maybe y -&gt; Proxy () (Maybe y) () y m ())
-&gt; Proxy () (Maybe y) () y m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-59"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679866595"><span class="annot"><span class="annottext">batch :: y
</span><a href="#local-6989586621679866595"><span class="hs-identifier hs-var">batch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">y -&gt; Producer' y m ()
forall (m :: * -&gt; *) a. Functor m =&gt; a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">yield</span></a></span><span> </span><span class="annot"><span class="annottext">y
</span><a href="#local-6989586621679866595"><span class="hs-identifier hs-var">batch</span></a></span><span>
</span><span id="line-60"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Proxy () (Maybe y) () y m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span id="local-6989586621679866743"><span id="local-6989586621679866744"><span class="annot"><a href="Torch.Data.Pipeline.html#readBatches%27"><span class="hs-identifier hs-type">readBatches'</span></a></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866744"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866743"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866743"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866744"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-67"></span><span id="readBatches%27"><span class="annot"><span class="annottext">readBatches' :: Int
-&gt; (Int -&gt; m (Maybe batch)) -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatches%27"><span class="hs-identifier hs-var hs-var">readBatches'</span></a></span></span><span> </span><span id="local-6989586621679866592"><span class="annot"><span class="annottext">numIters :: Int
</span><a href="#local-6989586621679866592"><span class="hs-identifier hs-var">numIters</span></a></span></span><span> </span><span id="local-6989586621679866591"><span class="annot"><span class="annottext">getBatch :: Int -&gt; m (Maybe batch)
</span><a href="#local-6989586621679866591"><span class="hs-identifier hs-var">getBatch</span></a></span></span><span> </span><span id="local-6989586621679866590"><span class="annot"><span class="annottext">outputBox :: Output (Maybe batch)
</span><a href="#local-6989586621679866590"><span class="hs-identifier hs-var">outputBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="annottext">Proxy X () () Int m () -&gt; (Int -&gt; Effect m ()) -&gt; Effect m ()
forall (m :: * -&gt; *) x' x b' b a' c' c.
Functor m =&gt;
Proxy x' x b' b m a'
-&gt; (b -&gt; Proxy x' x c' c m b') -&gt; Proxy x' x c' c m a'
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Producer' Int m ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
(Functor m, Foldable f) =&gt;
f a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">each</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866592"><span class="hs-identifier hs-var">numIters</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679866587"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866587"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Proxy X () () (Maybe batch) m ()
</span><a href="#local-6989586621679866586"><span class="hs-identifier hs-var">yieldBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866587"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy X () () (Maybe batch) m ()
-&gt; Proxy () (Maybe batch) () X m () -&gt; Effect m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch) -&gt; Consumer' (Maybe batch) m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Output a -&gt; Consumer' a m ()
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">toOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch)
</span><a href="#local-6989586621679866590"><span class="hs-identifier hs-var">outputBox</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679866586"><span class="annot"><span class="annottext">yieldBatch :: Int -&gt; Proxy X () () (Maybe batch) m ()
</span><a href="#local-6989586621679866586"><span class="hs-identifier hs-var hs-var">yieldBatch</span></a></span></span><span> </span><span id="local-6989586621679866584"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866584"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-70"></span><span>            </span><span class="hs-comment">-- this is a workaround to using MonadPlus in the Proxy monad, since</span><span>
</span><span id="line-71"></span><span>            </span><span class="hs-comment">-- it doesn't have an instance. Instead we implement failure with</span><span>
</span><span id="line-72"></span><span>            </span><span class="hs-comment">-- MonadPlus in the getBatch function, and have it yield Maybe values</span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-comment">-- which marks failure here</span><span>
</span><span id="line-74"></span><span>            </span><span id="local-6989586621679866583"><span class="annot"><span class="annottext">Maybe (Maybe batch)
</span><a href="#local-6989586621679866583"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (Maybe batch))
-&gt; Proxy X () () (Maybe batch) m (Maybe (Maybe batch))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (Maybe batch))
 -&gt; Proxy X () () (Maybe batch) m (Maybe (Maybe batch)))
-&gt; m (Maybe (Maybe batch))
-&gt; Proxy X () () (Maybe batch) m (Maybe (Maybe batch))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (Maybe (Maybe batch))
</span><a href="#local-6989586621679866581"><span class="hs-identifier hs-var">runBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866584"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-75"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe batch)
</span><a href="#local-6989586621679866583"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe batch -&gt; Producer' (Maybe batch) m ()
forall (m :: * -&gt; *) a. Functor m =&gt; a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">yield</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe batch
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-77"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679866580"><span class="annot"><span class="annottext">batch :: batch
</span><a href="#local-6989586621679866580"><span class="hs-identifier hs-var">batch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe batch -&gt; Producer' (Maybe batch) m ()
forall (m :: * -&gt; *) a. Functor m =&gt; a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">batch -&gt; Maybe batch
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">batch
</span><a href="#local-6989586621679866580"><span class="hs-identifier hs-var">batch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Proxy X () () (Maybe batch) m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>          </span><span id="local-6989586621679866581"><span class="annot"><span class="annottext">runBatch :: Int -&gt; m (Maybe (Maybe batch))
</span><a href="#local-6989586621679866581"><span class="hs-identifier hs-var hs-var">runBatch</span></a></span></span><span> </span><span id="local-6989586621679866579"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866579"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866592"><span class="hs-identifier hs-var">numIters</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866579"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-80"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe batch) -&gt; m (Maybe (Maybe batch))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe batch)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-81"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe batch -&gt; Maybe (Maybe batch)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Maybe batch -&gt; Maybe (Maybe batch))
-&gt; m (Maybe batch) -&gt; m (Maybe (Maybe batch))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (Maybe batch)
</span><a href="#local-6989586621679866591"><span class="hs-identifier hs-var">getBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866579"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Torch.Data.Pipeline.html#readBatchesConcurrently"><span class="hs-identifier hs-type">readBatchesConcurrently</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679866679"><span class="annot"><a href="#local-6989586621679866679"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679866678"><span class="annot"><a href="#local-6989586621679866678"><span class="hs-identifier hs-type">batch</span></a></span></span><span> </span><span id="local-6989586621679866681"><span class="annot"><a href="#local-6989586621679866681"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-operator">.</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679866681"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#ConcurrentDataset"><span class="hs-identifier hs-type">ConcurrentDataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866681"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866679"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866678"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866679"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866678"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866681"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-85"></span><span id="readBatchesConcurrently"><span class="annot"><span class="annottext">readBatchesConcurrently :: Int -&gt; dataset -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatchesConcurrently"><span class="hs-identifier hs-var hs-var">readBatchesConcurrently</span></a></span></span><span> </span><span id="local-6989586621679866577"><span class="annot"><span class="annottext">workerId :: Int
</span><a href="#local-6989586621679866577"><span class="hs-identifier hs-var">workerId</span></a></span></span><span> </span><span id="local-6989586621679866576"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679866576"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679866575"><span class="annot"><span class="annottext">outputBox :: Output (Maybe batch)
</span><a href="#local-6989586621679866575"><span class="hs-identifier hs-var">outputBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; m (Maybe batch)) -&gt; Output (Maybe batch) -&gt; Effect m ()
forall (m :: * -&gt; *) batch.
MonadIO m =&gt;
Int
-&gt; (Int -&gt; m (Maybe batch)) -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatches%27"><span class="hs-identifier hs-var">readBatches'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866574"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (Maybe batch)
</span><a href="#local-6989586621679866573"><span class="hs-identifier hs-var">getBatchOrFail</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch)
</span><a href="#local-6989586621679866575"><span class="hs-identifier hs-var">outputBox</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679866574"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866574"><span class="hs-identifier hs-var hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dataset -&gt; Int
forall (m :: * -&gt; *) dataset batch.
Dataset m dataset batch =&gt;
dataset -&gt; Int
</span><a href="Torch.Data.Pipeline.html#numIters"><span class="hs-identifier hs-var">numIters</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679866681"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679866679"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679866678"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866576"><span class="hs-identifier hs-var">dataset</span></a></span><span>
</span><span id="line-87"></span><span>        </span><span id="local-6989586621679866573"><span class="annot"><span class="annottext">getBatchOrFail :: Int -&gt; m (Maybe batch)
</span><a href="#local-6989586621679866573"><span class="hs-identifier hs-var hs-var">getBatchOrFail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679866572"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866572"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">batch -&gt; Maybe batch
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(batch -&gt; Maybe batch) -&gt; m batch -&gt; m (Maybe batch)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; dataset -&gt; Int -&gt; m batch
forall (m :: * -&gt; *) dataset batch.
ConcurrentDataset m dataset batch =&gt;
Int -&gt; dataset -&gt; Int -&gt; m batch
</span><a href="Torch.Data.Pipeline.html#getBatchConcurrently"><span class="hs-identifier hs-var">getBatchConcurrently</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866577"><span class="hs-identifier hs-var">workerId</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866576"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866572"><span class="hs-identifier hs-var">iter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe batch) -&gt; m (Maybe batch) -&gt; m (Maybe batch)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe batch -&gt; m (Maybe batch)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe batch
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><a href="Torch.Data.Pipeline.html#readBatches"><span class="hs-identifier hs-type">readBatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679866697"><span class="annot"><a href="#local-6989586621679866697"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679866696"><span class="annot"><a href="#local-6989586621679866696"><span class="hs-identifier hs-type">batch</span></a></span></span><span> </span><span id="local-6989586621679866698"><span class="annot"><a href="#local-6989586621679866698"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866698"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866697"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866696"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866697"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866696"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866698"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-91"></span><span id="readBatches"><span class="annot"><span class="annottext">readBatches :: dataset -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatches"><span class="hs-identifier hs-var hs-var">readBatches</span></a></span></span><span> </span><span id="local-6989586621679866571"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679866571"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679866570"><span class="annot"><span class="annottext">outputBox :: Output (Maybe batch)
</span><a href="#local-6989586621679866570"><span class="hs-identifier hs-var">outputBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; m (Maybe batch)) -&gt; Output (Maybe batch) -&gt; Effect m ()
forall (m :: * -&gt; *) batch.
MonadIO m =&gt;
Int
-&gt; (Int -&gt; m (Maybe batch)) -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatches%27"><span class="hs-identifier hs-var">readBatches'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866569"><span class="hs-identifier hs-var">iter</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (Maybe batch)
</span><a href="#local-6989586621679866568"><span class="hs-identifier hs-var">getBatchOrFail</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch)
</span><a href="#local-6989586621679866570"><span class="hs-identifier hs-var">outputBox</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679866569"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866569"><span class="hs-identifier hs-var hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dataset -&gt; Int
forall (m :: * -&gt; *) dataset batch.
Dataset m dataset batch =&gt;
dataset -&gt; Int
</span><a href="Torch.Data.Pipeline.html#numIters"><span class="hs-identifier hs-var">numIters</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679866698"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679866697"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679866696"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866571"><span class="hs-identifier hs-var">dataset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>        </span><span id="local-6989586621679866568"><span class="annot"><span class="annottext">getBatchOrFail :: Int -&gt; m (Maybe batch)
</span><a href="#local-6989586621679866568"><span class="hs-identifier hs-var hs-var">getBatchOrFail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679866567"><span class="annot"><span class="annottext">iter :: Int
</span><a href="#local-6989586621679866567"><span class="hs-identifier hs-var">iter</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">batch -&gt; Maybe batch
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(batch -&gt; Maybe batch) -&gt; m batch -&gt; m (Maybe batch)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; Int -&gt; m batch
forall (m :: * -&gt; *) dataset batch.
Dataset m dataset batch =&gt;
dataset -&gt; Int -&gt; m batch
</span><a href="Torch.Data.Pipeline.html#getBatch"><span class="hs-identifier hs-var">getBatch</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866571"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866567"><span class="hs-identifier hs-var">iter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe batch) -&gt; m (Maybe batch) -&gt; m (Maybe batch)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe batch -&gt; m (Maybe batch)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe batch
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621679866675"><span id="local-6989586621679866676"><span id="local-6989586621679866677"><span class="annot"><a href="Torch.Data.Pipeline.html#runTransforms"><span class="hs-identifier hs-type">runTransforms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866677"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679866676"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866675"><span class="hs-identifier hs-type">batch'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866676"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679866675"><span class="hs-identifier hs-type">batch'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866677"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-96"></span><span id="runTransforms"><span class="annot"><span class="annottext">runTransforms :: (batch -&gt; batch')
-&gt; Input (Maybe batch) -&gt; Output (Maybe batch') -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#runTransforms"><span class="hs-identifier hs-var hs-var">runTransforms</span></a></span></span><span> </span><span id="local-6989586621679866565"><span class="annot"><span class="annottext">transforms :: batch -&gt; batch'
</span><a href="#local-6989586621679866565"><span class="hs-identifier hs-var">transforms</span></a></span></span><span> </span><span id="local-6989586621679866564"><span class="annot"><span class="annottext">transformBox :: Input (Maybe batch)
</span><a href="#local-6989586621679866564"><span class="hs-identifier hs-var">transformBox</span></a></span></span><span> </span><span id="local-6989586621679866563"><span class="annot"><span class="annottext">trainBox :: Output (Maybe batch')
</span><a href="#local-6989586621679866563"><span class="hs-identifier hs-var">trainBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch) -&gt; Producer' (Maybe batch) m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Input a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">fromInput</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch)
</span><a href="#local-6989586621679866564"><span class="hs-identifier hs-var">transformBox</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy X () () (Maybe batch) m ()
-&gt; Proxy () (Maybe batch) () (Maybe batch') m ()
-&gt; Proxy X () () (Maybe batch') m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span>  </span><span class="annot"><span class="annottext">(Maybe batch -&gt; Maybe batch')
-&gt; Proxy () (Maybe batch) () (Maybe batch') m ()
forall (m :: * -&gt; *) a b r. Functor m =&gt; (a -&gt; b) -&gt; Pipe a b m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">P.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(batch -&gt; batch') -&gt; Maybe batch -&gt; Maybe batch'
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">batch -&gt; batch'
</span><a href="#local-6989586621679866565"><span class="hs-identifier hs-var">transforms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy X () () (Maybe batch') m ()
-&gt; Proxy () (Maybe batch') () X m () -&gt; Effect m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch') -&gt; Consumer' (Maybe batch') m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Output a -&gt; Consumer' a m ()
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">toOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch')
</span><a href="#local-6989586621679866563"><span class="hs-identifier hs-var">trainBox</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span id="local-6989586621679866657"><span id="local-6989586621679866658"><span id="local-6989586621679866659"><span id="local-6989586621679866660"><span class="annot"><a href="Torch.Data.Pipeline.html#makeFold%27"><span class="hs-identifier hs-type">makeFold'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866659"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866658"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866660"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866659"><span class="hs-identifier hs-type">dataset</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866658"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866657"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866657"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/9iwv5cqwbvyhmmvj5gd8m8142igl6y4l-async-lib-async-2.2.2-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-type">Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/krlfg66f7hzbrjdgrmxkjyalsq7llyag-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">StM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866660"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-101"></span><span id="makeFold%27"><span class="annot"><span class="annottext">makeFold' :: dataset -&gt; m (FoldM m batch b -&gt; m b, Async (StM m ()))
</span><a href="Torch.Data.Pipeline.html#makeFold%27"><span class="hs-identifier hs-var hs-var">makeFold'</span></a></span></span><span> </span><span id="local-6989586621679866561"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679866561"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679866560"><span class="annot"><span class="annottext">toBatches :: Output (Maybe batch)
</span><a href="#local-6989586621679866560"><span class="hs-identifier hs-var">toBatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866559"><span class="annot"><span class="annottext">fromBatches :: Input (Maybe batch)
</span><a href="#local-6989586621679866559"><span class="hs-identifier hs-var">fromBatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866558"><span class="annot"><span class="annottext">sealBatch :: STM ()
</span><a href="#local-6989586621679866558"><span class="hs-identifier hs-var">sealBatch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Output (Maybe batch), Input (Maybe batch), STM ())
-&gt; m (Output (Maybe batch), Input (Maybe batch), STM ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Output (Maybe batch), Input (Maybe batch), STM ())
 -&gt; m (Output (Maybe batch), Input (Maybe batch), STM ()))
-&gt; IO (Output (Maybe batch), Input (Maybe batch), STM ())
-&gt; m (Output (Maybe batch), Input (Maybe batch), STM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Buffer (Maybe batch)
-&gt; IO (Output (Maybe batch), Input (Maybe batch), STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Buffer (Maybe batch)
forall a. Int -&gt; Buffer a
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679866554"><span class="annot"><span class="annottext">Async (StM m ())
</span><a href="#local-6989586621679866554"><span class="hs-identifier hs-var">batchThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Async (StM m ()))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
m a -&gt; m (Async (StM m a))
</span><a href="../file:///nix/store/lkjl0478aq1zapqxsh9kkh94wk9j49xm-lifted-async-lib-lifted-async-0.10.0.6-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async (StM m ()))) -&gt; m () -&gt; m (Async (StM m ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Effect m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Effect m () -&gt; m ()) -&gt; Effect m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; Output (Maybe batch) -&gt; Effect m ()
forall dataset batch (m :: * -&gt; *).
Dataset m dataset batch =&gt;
dataset -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatches"><span class="hs-identifier hs-var">readBatches</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866561"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch)
</span><a href="#local-6989586621679866560"><span class="hs-identifier hs-var">toBatches</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">(FoldM m batch b -&gt; m b, Async (StM m ()))
-&gt; m (FoldM m batch b -&gt; m b, Async (StM m ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Producer batch m () -&gt; FoldM m batch b -&gt; m b
forall (m :: * -&gt; *) batch b.
Monad m =&gt;
Producer batch m () -&gt; FoldM m batch b -&gt; m b
</span><a href="Torch.Data.Pipeline.html#foldFromProducer"><span class="hs-identifier hs-var">foldFromProducer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input (Maybe batch) -&gt; Producer batch m ()
forall (m :: * -&gt; *) batch.
MonadIO m =&gt;
Input (Maybe batch) -&gt; Producer batch m ()
</span><a href="Torch.Data.Pipeline.html#takeBatch"><span class="hs-identifier hs-var">takeBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch)
</span><a href="#local-6989586621679866559"><span class="hs-identifier hs-var">fromBatches</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async (StM m ())
</span><a href="#local-6989586621679866554"><span class="hs-identifier hs-var">batchThread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span id="local-6989586621679866637"><span id="local-6989586621679866638"><span id="local-6989586621679866639"><span id="local-6989586621679866640"><span id="local-6989586621679866641"><span class="annot"><a href="Torch.Data.Pipeline.html#makeConcurrentFold%27"><span class="hs-identifier hs-type">makeConcurrentFold'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866641"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#ConcurrentDataset"><span class="hs-identifier hs-type">ConcurrentDataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866640"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866639"><span class="hs-identifier hs-type">batch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679866639"><span class="hs-identifier hs-type">batch'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866638"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866640"><span class="hs-identifier hs-type">dataset</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866638"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866637"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866637"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///nix/store/9iwv5cqwbvyhmmvj5gd8m8142igl6y4l-async-lib-async-2.2.2-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-type">Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/krlfg66f7hzbrjdgrmxkjyalsq7llyag-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">StM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-112"></span><span id="makeConcurrentFold%27"><span class="annot"><span class="annottext">makeConcurrentFold' :: (batch' -&gt; batch)
-&gt; dataset -&gt; Int -&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())])
</span><a href="Torch.Data.Pipeline.html#makeConcurrentFold%27"><span class="hs-identifier hs-var hs-var">makeConcurrentFold'</span></a></span></span><span> </span><span id="local-6989586621679866550"><span class="annot"><span class="annottext">transforms :: batch' -&gt; batch
</span><a href="#local-6989586621679866550"><span class="hs-identifier hs-var">transforms</span></a></span></span><span> </span><span id="local-6989586621679866549"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679866549"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679866548"><span class="annot"><span class="annottext">numWorkers :: Int
</span><a href="#local-6989586621679866548"><span class="hs-identifier hs-var">numWorkers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- Buffer size is equal to numWorkers so that each thread can yield a batch.</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-comment">-- This is not actually the enforced behaviour, one thread may fill the buffer with multiple batches,</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-comment">-- but it should be better than a buffer size of 1 in this multithreaded case.</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679866547"><span class="annot"><span class="annottext">toTransformBox :: Output (Maybe batch')
</span><a href="#local-6989586621679866547"><span class="hs-identifier hs-var">toTransformBox</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866546"><span class="annot"><span class="annottext">fromTransformBox :: Input (Maybe batch')
</span><a href="#local-6989586621679866546"><span class="hs-identifier hs-var">fromTransformBox</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866545"><span class="annot"><span class="annottext">sealTransform :: STM ()
</span><a href="#local-6989586621679866545"><span class="hs-identifier hs-var">sealTransform</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
-&gt; m (Output (Maybe batch'), Input (Maybe batch'), STM ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
 -&gt; m (Output (Maybe batch'), Input (Maybe batch'), STM ()))
-&gt; IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
-&gt; m (Output (Maybe batch'), Input (Maybe batch'), STM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Buffer (Maybe batch')
-&gt; IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Buffer (Maybe batch')
forall a. Int -&gt; Buffer a
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866548"><span class="hs-identifier hs-var">numWorkers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679866544"><span class="annot"><span class="annottext">toBatches :: Output (Maybe batch)
</span><a href="#local-6989586621679866544"><span class="hs-identifier hs-var">toBatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866543"><span class="annot"><span class="annottext">fromBatches :: Input (Maybe batch)
</span><a href="#local-6989586621679866543"><span class="hs-identifier hs-var">fromBatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866542"><span class="annot"><span class="annottext">sealBatch :: STM ()
</span><a href="#local-6989586621679866542"><span class="hs-identifier hs-var">sealBatch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Output (Maybe batch), Input (Maybe batch), STM ())
-&gt; m (Output (Maybe batch), Input (Maybe batch), STM ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Output (Maybe batch), Input (Maybe batch), STM ())
 -&gt; m (Output (Maybe batch), Input (Maybe batch), STM ()))
-&gt; IO (Output (Maybe batch), Input (Maybe batch), STM ())
-&gt; m (Output (Maybe batch), Input (Maybe batch), STM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Buffer (Maybe batch)
-&gt; IO (Output (Maybe batch), Input (Maybe batch), STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Buffer (Maybe batch)
forall a. Int -&gt; Buffer a
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866548"><span class="hs-identifier hs-var">numWorkers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621679866541"><span class="annot"><span class="annottext">[Async (StM m ())]
</span><a href="#local-6989586621679866541"><span class="hs-identifier hs-var">batchThreads</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; (Int -&gt; m (Async (StM m ()))) -&gt; m [Async (StM m ())]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866548"><span class="hs-identifier hs-var">numWorkers</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m (Async (StM m ()))) -&gt; m [Async (StM m ())])
-&gt; (Int -&gt; m (Async (StM m ()))) -&gt; m [Async (StM m ())]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679866539"><span class="annot"><span class="annottext">workerId :: Int
</span><a href="#local-6989586621679866539"><span class="hs-identifier hs-var">workerId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Async (StM m ()))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
m a -&gt; m (Async (StM m a))
</span><a href="../file:///nix/store/lkjl0478aq1zapqxsh9kkh94wk9j49xm-lifted-async-lib-lifted-async-0.10.0.6-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async (StM m ()))) -&gt; m () -&gt; m (Async (StM m ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Effect m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Effect m () -&gt; m ()) -&gt; Effect m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; dataset -&gt; Output (Maybe batch') -&gt; Effect m ()
forall dataset batch (m :: * -&gt; *).
(MonadPlus m, ConcurrentDataset m dataset batch) =&gt;
Int -&gt; dataset -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatchesConcurrently"><span class="hs-identifier hs-var">readBatchesConcurrently</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679866539"><span class="hs-identifier hs-var">workerId</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866549"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch')
</span><a href="#local-6989586621679866547"><span class="hs-identifier hs-var">toTransformBox</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m (Async (StM m ()))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
m a -&gt; m (Async (StM m a))
</span><a href="../file:///nix/store/lkjl0478aq1zapqxsh9kkh94wk9j49xm-lifted-async-lib-lifted-async-0.10.0.6-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async (StM m ()))) -&gt; m () -&gt; m (Async (StM m ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Effect m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Effect m () -&gt; m ()) -&gt; Effect m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(batch' -&gt; batch)
-&gt; Input (Maybe batch') -&gt; Output (Maybe batch) -&gt; Effect m ()
forall (m :: * -&gt; *) batch batch'.
MonadIO m =&gt;
(batch -&gt; batch')
-&gt; Input (Maybe batch) -&gt; Output (Maybe batch') -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#runTransforms"><span class="hs-identifier hs-var">runTransforms</span></a></span><span> </span><span class="annot"><span class="annottext">batch' -&gt; batch
</span><a href="#local-6989586621679866550"><span class="hs-identifier hs-var">transforms</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch')
</span><a href="#local-6989586621679866546"><span class="hs-identifier hs-var">fromTransformBox</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch)
</span><a href="#local-6989586621679866544"><span class="hs-identifier hs-var">toBatches</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="annottext">(FoldM m batch b -&gt; m b, [Async (StM m ())])
-&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>  </span><span class="annot"><span class="annottext">((FoldM m batch b -&gt; m b, [Async (StM m ())])
 -&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())]))
-&gt; (FoldM m batch b -&gt; m b, [Async (StM m ())])
-&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Producer batch m () -&gt; FoldM m batch b -&gt; m b
forall (m :: * -&gt; *) batch b.
Monad m =&gt;
Producer batch m () -&gt; FoldM m batch b -&gt; m b
</span><a href="Torch.Data.Pipeline.html#foldFromProducer"><span class="hs-identifier hs-var">foldFromProducer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input (Maybe batch) -&gt; Producer batch m ()
forall (m :: * -&gt; *) batch.
MonadIO m =&gt;
Input (Maybe batch) -&gt; Producer batch m ()
</span><a href="Torch.Data.Pipeline.html#takeBatch"><span class="hs-identifier hs-var">takeBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch)
</span><a href="#local-6989586621679866543"><span class="hs-identifier hs-var">fromBatches</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Async (StM m ())]
</span><a href="#local-6989586621679866541"><span class="hs-identifier hs-var">batchThreads</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>  </span><span>
</span><span id="line-123"></span><span id="local-6989586621679866647"><span id="local-6989586621679866648"><span id="local-6989586621679866649"><span id="local-6989586621679866650"><span id="local-6989586621679866651"><span class="annot"><a href="Torch.Data.Pipeline.html#makeFoldWithTransform%27"><span class="hs-identifier hs-type">makeFoldWithTransform'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866651"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866650"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866649"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>  </span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679866649"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866648"><span class="hs-identifier hs-type">batch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866650"><span class="hs-identifier hs-type">dataset</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866648"><span class="hs-identifier hs-type">batch'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866647"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866647"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/9iwv5cqwbvyhmmvj5gd8m8142igl6y4l-async-lib-async-2.2.2-haddock-doc/share/doc/async/html/src"><span class="hs-identifier hs-type">Async</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/krlfg66f7hzbrjdgrmxkjyalsq7llyag-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">StM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866651"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-127"></span><span id="makeFoldWithTransform%27"><span class="annot"><span class="annottext">makeFoldWithTransform' :: (batch -&gt; batch')
-&gt; dataset -&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ()))
</span><a href="Torch.Data.Pipeline.html#makeFoldWithTransform%27"><span class="hs-identifier hs-var hs-var">makeFoldWithTransform'</span></a></span></span><span> </span><span id="local-6989586621679866538"><span class="annot"><span class="annottext">transforms :: batch -&gt; batch'
</span><a href="#local-6989586621679866538"><span class="hs-identifier hs-var">transforms</span></a></span></span><span> </span><span id="local-6989586621679866537"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679866537"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>          </span><span class="hs-comment">-- TODO: we can allow different buffer sizes</span><span>
</span><span id="line-129"></span><span>          </span><span class="hs-comment">-- which would be necessary for data echoing</span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679866536"><span class="annot"><span class="annottext">toTransformBox :: Output (Maybe batch)
</span><a href="#local-6989586621679866536"><span class="hs-identifier hs-var">toTransformBox</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866535"><span class="annot"><span class="annottext">fromTransformBox :: Input (Maybe batch)
</span><a href="#local-6989586621679866535"><span class="hs-identifier hs-var">fromTransformBox</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866534"><span class="annot"><span class="annottext">sealTransform :: STM ()
</span><a href="#local-6989586621679866534"><span class="hs-identifier hs-var">sealTransform</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Output (Maybe batch), Input (Maybe batch), STM ())
-&gt; m (Output (Maybe batch), Input (Maybe batch), STM ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Output (Maybe batch), Input (Maybe batch), STM ())
 -&gt; m (Output (Maybe batch), Input (Maybe batch), STM ()))
-&gt; IO (Output (Maybe batch), Input (Maybe batch), STM ())
-&gt; m (Output (Maybe batch), Input (Maybe batch), STM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Buffer (Maybe batch)
-&gt; IO (Output (Maybe batch), Input (Maybe batch), STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Buffer (Maybe batch)
forall a. Int -&gt; Buffer a
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679866533"><span class="annot"><span class="annottext">toBatches :: Output (Maybe batch')
</span><a href="#local-6989586621679866533"><span class="hs-identifier hs-var">toBatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866532"><span class="annot"><span class="annottext">fromBatches :: Input (Maybe batch')
</span><a href="#local-6989586621679866532"><span class="hs-identifier hs-var">fromBatches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679866531"><span class="annot"><span class="annottext">sealBatch :: STM ()
</span><a href="#local-6989586621679866531"><span class="hs-identifier hs-var">sealBatch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
-&gt; m (Output (Maybe batch'), Input (Maybe batch'), STM ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
 -&gt; m (Output (Maybe batch'), Input (Maybe batch'), STM ()))
-&gt; IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
-&gt; m (Output (Maybe batch'), Input (Maybe batch'), STM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Buffer (Maybe batch')
-&gt; IO (Output (Maybe batch'), Input (Maybe batch'), STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Buffer (Maybe batch')
forall a. Int -&gt; Buffer a
</span><a href="../file:///nix/store/pfsjnbk5fdr0kfy1lp525iwmw5bkp3rz-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>            </span><span id="local-6989586621679866530"><span class="annot"><span class="annottext">Async (StM m ())
</span><a href="#local-6989586621679866530"><span class="hs-identifier hs-var">batchThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Async (StM m ()))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
m a -&gt; m (Async (StM m a))
</span><a href="../file:///nix/store/lkjl0478aq1zapqxsh9kkh94wk9j49xm-lifted-async-lib-lifted-async-0.10.0.6-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async (StM m ()))) -&gt; m () -&gt; m (Async (StM m ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m Any -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(m Any -&gt; m ()) -&gt; m Any -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Effect m Any -&gt; m Any
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Effect m Any -&gt; m Any) -&gt; Effect m Any -&gt; m Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy X () () X m () -&gt; Effect m Any
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">forever</span></span><span> </span><span class="annot"><span class="annottext">(Proxy X () () X m () -&gt; Effect m Any)
-&gt; Proxy X () () X m () -&gt; Effect m Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; Output (Maybe batch) -&gt; Proxy X () () X m ()
forall dataset batch (m :: * -&gt; *).
Dataset m dataset batch =&gt;
dataset -&gt; Output (Maybe batch) -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#readBatches"><span class="hs-identifier hs-var">readBatches</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866537"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch)
</span><a href="#local-6989586621679866536"><span class="hs-identifier hs-var">toTransformBox</span></a></span><span> </span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><span class="annottext">m () -&gt; m (Async (StM m ()))
forall (m :: * -&gt; *) a.
MonadBaseControl IO m =&gt;
m a -&gt; m (Async (StM m a))
</span><a href="../file:///nix/store/lkjl0478aq1zapqxsh9kkh94wk9j49xm-lifted-async-lib-lifted-async-0.10.0.6-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async (StM m ()))) -&gt; m () -&gt; m (Async (StM m ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proxy X () () X m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Proxy X () () X m () -&gt; m ()) -&gt; Proxy X () () X m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(batch -&gt; batch')
-&gt; Input (Maybe batch)
-&gt; Output (Maybe batch')
-&gt; Proxy X () () X m ()
forall (m :: * -&gt; *) batch batch'.
MonadIO m =&gt;
(batch -&gt; batch')
-&gt; Input (Maybe batch) -&gt; Output (Maybe batch') -&gt; Effect m ()
</span><a href="Torch.Data.Pipeline.html#runTransforms"><span class="hs-identifier hs-var">runTransforms</span></a></span><span> </span><span class="annot"><span class="annottext">batch -&gt; batch'
</span><a href="#local-6989586621679866538"><span class="hs-identifier hs-var">transforms</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch)
</span><a href="#local-6989586621679866535"><span class="hs-identifier hs-var">fromTransformBox</span></a></span><span> </span><span class="annot"><span class="annottext">Output (Maybe batch')
</span><a href="#local-6989586621679866533"><span class="hs-identifier hs-var">toBatches</span></a></span><span>
</span><span id="line-134"></span><span>            </span><span class="annot"><span class="annottext">(FoldM m batch' b -&gt; m b, Async (StM m ()))
-&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((FoldM m batch' b -&gt; m b, Async (StM m ()))
 -&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ())))
-&gt; (FoldM m batch' b -&gt; m b, Async (StM m ()))
-&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Producer batch' m () -&gt; FoldM m batch' b -&gt; m b
forall (m :: * -&gt; *) batch b.
Monad m =&gt;
Producer batch m () -&gt; FoldM m batch b -&gt; m b
</span><a href="Torch.Data.Pipeline.html#foldFromProducer"><span class="hs-identifier hs-var">foldFromProducer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input (Maybe batch') -&gt; Producer batch' m ()
forall (m :: * -&gt; *) batch.
MonadIO m =&gt;
Input (Maybe batch) -&gt; Producer batch m ()
</span><a href="Torch.Data.Pipeline.html#takeBatch"><span class="hs-identifier hs-var">takeBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Input (Maybe batch')
</span><a href="#local-6989586621679866532"><span class="hs-identifier hs-var">fromBatches</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async (StM m ())
</span><a href="#local-6989586621679866530"><span class="hs-identifier hs-var">batchThread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span id="local-6989586621679866526"><span id="local-6989586621679866527"><span id="local-6989586621679866528"><span id="local-6989586621679866529"><span class="annot"><a href="Torch.Data.Pipeline.html#makeFold"><span class="hs-identifier hs-type">makeFold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866529"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866528"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866527"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866529"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866528"><span class="hs-identifier hs-type">dataset</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866529"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866529"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866527"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866526"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866529"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866526"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-139"></span><span id="makeFold"><span class="annot"><span class="annottext">makeFold :: dataset -&gt; m (FoldM m batch b -&gt; m b)
</span><a href="Torch.Data.Pipeline.html#makeFold"><span class="hs-identifier hs-var hs-var">makeFold</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FoldM m batch b -&gt; m b, Async (StM m ()))
 -&gt; FoldM m batch b -&gt; m b)
-&gt; m (FoldM m batch b -&gt; m b, Async (StM m ()))
-&gt; m (FoldM m batch b -&gt; m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(FoldM m batch b -&gt; m b, Async (StM m ()))
-&gt; FoldM m batch b -&gt; m b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(m (FoldM m batch b -&gt; m b, Async (StM m ()))
 -&gt; m (FoldM m batch b -&gt; m b))
-&gt; (dataset -&gt; m (FoldM m batch b -&gt; m b, Async (StM m ())))
-&gt; dataset
-&gt; m (FoldM m batch b -&gt; m b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; m (FoldM m batch b -&gt; m b, Async (StM m ()))
forall (m :: * -&gt; *) dataset batch b.
(Dataset m dataset batch, MonadIO m) =&gt;
dataset -&gt; m (FoldM m batch b -&gt; m b, Async (StM m ()))
</span><a href="Torch.Data.Pipeline.html#makeFold%27"><span class="hs-identifier hs-var">makeFold'</span></a></span><span> </span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621679866520"><span id="local-6989586621679866521"><span id="local-6989586621679866522"><span id="local-6989586621679866523"><span id="local-6989586621679866524"><span class="annot"><a href="Torch.Data.Pipeline.html#makeFoldWithTransform"><span class="hs-identifier hs-type">makeFoldWithTransform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866524"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866523"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866522"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>  </span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679866522"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866521"><span class="hs-identifier hs-type">batch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866523"><span class="hs-identifier hs-type">dataset</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866521"><span class="hs-identifier hs-type">batch'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866520"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866524"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866520"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-145"></span><span id="makeFoldWithTransform"><span class="annot"><span class="annottext">makeFoldWithTransform :: (batch -&gt; batch') -&gt; dataset -&gt; m (FoldM m batch' b -&gt; m b)
</span><a href="Torch.Data.Pipeline.html#makeFoldWithTransform"><span class="hs-identifier hs-var hs-var">makeFoldWithTransform</span></a></span></span><span> </span><span id="local-6989586621679866519"><span class="annot"><span class="annottext">transf :: batch -&gt; batch'
</span><a href="#local-6989586621679866519"><span class="hs-identifier hs-var">transf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FoldM m batch' b -&gt; m b, Async (StM m ()))
 -&gt; FoldM m batch' b -&gt; m b)
-&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ()))
-&gt; m (FoldM m batch' b -&gt; m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(FoldM m batch' b -&gt; m b, Async (StM m ()))
-&gt; FoldM m batch' b -&gt; m b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(m (FoldM m batch' b -&gt; m b, Async (StM m ()))
 -&gt; m (FoldM m batch' b -&gt; m b))
-&gt; (dataset -&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ())))
-&gt; dataset
-&gt; m (FoldM m batch' b -&gt; m b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(batch -&gt; batch')
-&gt; dataset -&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ()))
forall (m :: * -&gt; *) dataset batch batch' b.
(MonadIO m, Dataset m dataset batch) =&gt;
(batch -&gt; batch')
-&gt; dataset -&gt; m (FoldM m batch' b -&gt; m b, Async (StM m ()))
</span><a href="Torch.Data.Pipeline.html#makeFoldWithTransform%27"><span class="hs-identifier hs-var">makeFoldWithTransform'</span></a></span><span> </span><span class="annot"><span class="annottext">batch -&gt; batch'
</span><a href="#local-6989586621679866519"><span class="hs-identifier hs-var">transf</span></a></span><span> </span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621679866514"><span id="local-6989586621679866515"><span id="local-6989586621679866516"><span id="local-6989586621679866517"><span id="local-6989586621679866518"><span class="annot"><a href="Torch.Data.Pipeline.html#makeConcurrentFold"><span class="hs-identifier hs-type">makeConcurrentFold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679866518"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Pipeline.html#ConcurrentDataset"><span class="hs-identifier hs-type">ConcurrentDataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866517"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866516"><span class="hs-identifier hs-type">batch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679866516"><span class="hs-identifier hs-type">batch'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866515"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866517"><span class="hs-identifier hs-type">dataset</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866515"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866514"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866514"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-152"></span><span id="makeConcurrentFold"><span class="annot"><span class="annottext">makeConcurrentFold :: (batch' -&gt; batch) -&gt; dataset -&gt; Int -&gt; m (FoldM m batch b -&gt; m b)
</span><a href="Torch.Data.Pipeline.html#makeConcurrentFold"><span class="hs-identifier hs-var hs-var">makeConcurrentFold</span></a></span></span><span> </span><span id="local-6989586621679866513"><span class="annot"><span class="annottext">transforms :: batch' -&gt; batch
</span><a href="#local-6989586621679866513"><span class="hs-identifier hs-var">transforms</span></a></span></span><span> </span><span id="local-6989586621679866512"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679866512"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FoldM m batch b -&gt; m b, [Async (StM m ())])
 -&gt; FoldM m batch b -&gt; m b)
-&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())])
-&gt; m (FoldM m batch b -&gt; m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(FoldM m batch b -&gt; m b, [Async (StM m ())])
-&gt; FoldM m batch b -&gt; m b
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(m (FoldM m batch b -&gt; m b, [Async (StM m ())])
 -&gt; m (FoldM m batch b -&gt; m b))
-&gt; (Int -&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())]))
-&gt; Int
-&gt; m (FoldM m batch b -&gt; m b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(batch' -&gt; batch)
-&gt; dataset -&gt; Int -&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())])
forall (m :: * -&gt; *) dataset batch' batch b.
(MonadIO m, ConcurrentDataset m dataset batch') =&gt;
(batch' -&gt; batch)
-&gt; dataset -&gt; Int -&gt; m (FoldM m batch b -&gt; m b, [Async (StM m ())])
</span><a href="Torch.Data.Pipeline.html#makeConcurrentFold%27"><span class="hs-identifier hs-var">makeConcurrentFold'</span></a></span><span> </span><span class="annot"><span class="annottext">batch' -&gt; batch
</span><a href="#local-6989586621679866513"><span class="hs-identifier hs-var">transforms</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679866512"><span class="hs-identifier hs-var">dataset</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span>
</span><span id="line-154"></span><span id="local-6989586621679866693"><span id="local-6989586621679866694"><span id="local-6989586621679866695"><span class="annot"><a href="Torch.Data.Pipeline.html#foldFromProducer"><span class="hs-identifier hs-type">foldFromProducer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679866695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Producer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866694"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">L.FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866694"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866693"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679866695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679866693"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-155"></span><span id="foldFromProducer"><span class="annot"><span class="annottext">foldFromProducer :: Producer batch m () -&gt; FoldM m batch b -&gt; m b
</span><a href="Torch.Data.Pipeline.html#foldFromProducer"><span class="hs-identifier hs-var hs-var">foldFromProducer</span></a></span></span><span> </span><span id="local-6989586621679866511"><span class="annot"><span class="annottext">prod :: Producer batch m ()
</span><a href="#local-6989586621679866511"><span class="hs-identifier hs-var">prod</span></a></span></span><span> </span><span id="local-6989586621679866510"><span class="annot"><span class="annottext">fold :: FoldM m batch b
</span><a href="#local-6989586621679866510"><span class="hs-identifier hs-var">fold</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 (x -&gt; batch -&gt; m x)
 -&gt; m x -&gt; (x -&gt; m b) -&gt; Producer batch m () -&gt; m b)
-&gt; FoldM m batch b -&gt; Producer batch m () -&gt; m b
forall a (m :: * -&gt; *) b r.
(forall x. (x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m b) -&gt; r)
-&gt; FoldM m a b -&gt; r
</span><a href="../file:///nix/store/fpn41m7ksncbqyvjcigck56dp990w7ds-foldl-lib-foldl-1.4.7-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.impurely</span></a></span><span> </span><span class="annot"><span class="annottext">forall x.
(x -&gt; batch -&gt; m x)
-&gt; m x -&gt; (x -&gt; m b) -&gt; Producer batch m () -&gt; m b
forall (m :: * -&gt; *) x a b.
Monad m =&gt;
(x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m b) -&gt; Producer a m () -&gt; m b
</span><a href="../file:///nix/store/fh4bf6vfk22cjbmy613hw3fs9npmaxml-pipes-lib-pipes-4.3.13-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">P.foldM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FoldM m batch b
</span><a href="#local-6989586621679866510"><span class="hs-identifier hs-var">fold</span></a></span><span> </span><span class="annot"><span class="annottext">Producer batch m ()
</span><a href="#local-6989586621679866511"><span class="hs-identifier hs-var">prod</span></a></span><span>
</span><span id="line-156"></span></pre></body></html>
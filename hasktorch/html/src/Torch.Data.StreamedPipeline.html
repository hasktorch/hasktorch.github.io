<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.Data.StreamedPipeline</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Defining a Datastream</span></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="hs-comment">-- $dataset</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Datastream</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#Datastream"><span class="hs-identifier">Datastream</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier">DatastreamOptions</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#datastreamOpts"><span class="hs-identifier">datastreamOpts</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Dataloading</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#streamFrom"><span class="hs-identifier">streamFrom</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#streamFrom%27"><span class="hs-identifier">streamFrom'</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Reexports</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/paz32w16pk70bana84g0rd3vd3clh6r4-transformers-base-lib-transformers-base-0.4.5.2-haddock-doc/share/doc/transformers-base/html/src"><span class="hs-identifier">MonadBase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kx8g6gw5xhwzmis9y4f83mdjhyci589v-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier">MonadBaseControl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/94ms40167xxa84970qr0smf09mjiqaw5-lifted-async-lib-lifted-async-0.10.1.2-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier">Control.Concurrent.Async.Lifted</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/8x0zq7g89542nqh8256q77riqg1aqj1r-stm-lib-stm-2.5.0.0-haddock-doc/share/doc/stm/html/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">atomically</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier">Control.Foldl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier">FoldM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier">Control.Foldl</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/paz32w16pk70bana84g0rd3vd3clh6r4-transformers-base-lib-transformers-base-0.4.5.2-haddock-doc/share/doc/transformers-base/html/src"><span class="hs-identifier">Control.Monad.Base</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/paz32w16pk70bana84g0rd3vd3clh6r4-transformers-base-lib-transformers-base-0.4.5.2-haddock-doc/share/doc/transformers-base/html/src"><span class="hs-identifier">MonadBase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/paz32w16pk70bana84g0rd3vd3clh6r4-transformers-base-lib-transformers-base-0.4.5.2-haddock-doc/share/doc/transformers-base/html/src"><span class="hs-identifier">liftBase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Cont</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ContT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/kx8g6gw5xhwzmis9y4f83mdjhyci589v-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/g34k2swssr2a5sh84k11lpyciwvmrz8b-vector-lib-vector-0.12.1.2-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier">Data.Vector</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier">Pipes</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier">Pipes.Concurrent</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">atomically</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier">Pipes.Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Torch.Data.Internal.html"><span class="hs-identifier">Torch.Data.Internal</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">{- $dataset
We will show how to retrieve the IMDB dataset as an example datastream.
The dataset used here can be found at https://ai.stanford.edu/~amaas/data/sentiment/

&gt; import Pipes
&gt; import qualified Pipes.Safe as Safe
&gt; import qualified Pipes.Prelude as P
&gt; import System.Directory 
&gt; 
&gt; newtype Imdb = Imdb { dataDir :: String }
&gt;
&gt; data Sentiment = Positive | Negative 
&gt;
&gt; instance (MonadBaseControl IO m, MonadSafe m) =&gt; Datastream m Sentiment Imdb (Text, Sentiment) where
&gt;   streamSamples Imdb{..} sent = Select $ do
&gt;     rawFilePaths &lt;- zip (repeat sent) &lt;$&gt; (liftIO $ listDirectory (dataDir &lt;/&gt; sentToPath sent))
&gt;     let filePaths = fmap (second $ mappend (dataDir &lt;/&gt; sentToPath sent)) rawFilePaths
&gt;     for (each filePaths) $ \(rev, fp) -&gt; Safe.withFile fp ReadMode $ \fh -&gt; 
&gt;       P.zip (PT.fromHandleLn fh) (yield rev)
&gt;         where sentToPath Pos = &quot;pos&quot; ++ pure pathSeparator 
&gt;               sentToPath Neg = &quot;neg&quot; ++ pure pathSeparator

This streams in movie reviews from each file in either the positive review directory or
the negative review directory, depending on the seed value used.

This highlights a use of seed values that is more interesting than just specifying the thread count, but also has some problems.
When running this datastream with either 'streamFrom' or 'streamFrom\'', you need to supply both 'Positive' and 'Negative' values as seeds
to retrieve the entire IMDB dataset, and in this case positive and negative reviews will be streamed in concurrently.
The problem with designing a datastream in this fashion is you limit the amount of concurrency (2 threads in this case) without
duplicating data. Ultimately though seeds should be quite flexible and allow you to design the concurrency how you see fit. Be careful
not to use duplicate seed values unless you want duplicate data.
-}</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | The base datastream class. A dataset returns a stream of samples</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- based on a seed value. </span><span>
</span><span id="line-86"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679801539"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Datastream"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#Datastream"><span class="hs-identifier hs-var">Datastream</span></a></span></span><span> </span><span id="local-6989586621679801539"><span class="annot"><a href="#local-6989586621679801539"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679801538"><span class="annot"><a href="#local-6989586621679801538"><span class="hs-identifier hs-type">seed</span></a></span></span><span> </span><span id="local-6989586621679801537"><span class="annot"><a href="#local-6989586621679801537"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679801536"><span class="annot"><a href="#local-6989586621679801536"><span class="hs-identifier hs-type">sample</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679801537"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679801536"><span class="hs-identifier hs-type">sample</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>  </span><span id="streamSamples"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#streamSamples"><span class="hs-identifier hs-type">streamSamples</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679801537"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679801538"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">ListT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801539"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801536"><span class="hs-identifier hs-type">sample</span></a></span><span> </span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Datastream options used when looding datastreams. Currently only buffer size is configurable,</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- since thread count is controlled by the number of seeds (see @'streamFrom'@ functions). </span><span>
</span><span id="line-91"></span><span class="hs-keyword">newtype</span><span> </span><span id="DatastreamOptions"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-var">DatastreamOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DatastreamOptions"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-var">DatastreamOptions</span></a></span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="bufferSize"><span class="annot"><span class="annottext">DatastreamOptions -&gt; Int
</span><a href="Torch.Data.StreamedPipeline.html#bufferSize"><span class="hs-identifier hs-var hs-var">bufferSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- ^ Max number of samples stored in each buffer at a given time.</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Default dataloader options, you should override the fields in this record.</span><span>
</span><span id="line-95"></span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#datastreamOpts"><span class="hs-identifier hs-type">datastreamOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-type">DatastreamOptions</span></a></span><span>
</span><span id="line-96"></span><span id="datastreamOpts"><span class="annot"><span class="annottext">datastreamOpts :: DatastreamOptions
</span><a href="Torch.Data.StreamedPipeline.html#datastreamOpts"><span class="hs-identifier hs-var hs-var">datastreamOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatastreamOptions :: Int -&gt; DatastreamOptions
</span><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-type hs-type">DatastreamOptions</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bufferSize :: Int
</span><a href="Torch.Data.StreamedPipeline.html#bufferSize"><span class="hs-identifier hs-var">bufferSize</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-comment">-- 4 is relatively arbitrary</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Return a stream of samples from the given dataset as a continuation.</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- A stream of samples is generated for every seed in the given stream of seeds, and all of these streams are merged</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- into the output stream in a non-deterministic order (if you need determinism see 'streamFrom\'').</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- Every stream created for each seed value is made in its own thread.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#streamFrom"><span class="hs-identifier hs-type">streamFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679801475"><span class="annot"><a href="#local-6989586621679801475"><span class="hs-identifier hs-type">sample</span></a></span></span><span> </span><span id="local-6989586621679801474"><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679801473"><span class="annot"><a href="#local-6989586621679801473"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679801472"><span class="annot"><a href="#local-6989586621679801472"><span class="hs-identifier hs-type">seed</span></a></span></span><span> </span><span id="local-6989586621679801471"><span class="annot"><a href="#local-6989586621679801471"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#Datastream"><span class="hs-identifier hs-type">Datastream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801472"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801473"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801475"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kx8g6gw5xhwzmis9y4f83mdjhyci589v-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/paz32w16pk70bana84g0rd3vd3clh6r4-transformers-base-lib-transformers-base-0.4.5.2-haddock-doc/share/doc/transformers-base/html/src"><span class="hs-identifier hs-type">MonadBase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-type">DatastreamOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="#local-6989586621679801473"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">ListT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801472"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ContT</span></span><span> </span><span class="annot"><a href="#local-6989586621679801471"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">ListT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801474"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801475"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span id="streamFrom"><span class="annot"><span class="annottext">streamFrom :: DatastreamOptions
-&gt; dataset -&gt; ListT m seed -&gt; ContT b m (ListT m sample)
</span><a href="Torch.Data.StreamedPipeline.html#streamFrom"><span class="hs-identifier hs-var hs-var">streamFrom</span></a></span></span><span> </span><span id="local-6989586621679801470"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-type">DatastreamOptions</span></a></span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span></span><span> </span><span id="local-6989586621679801469"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679801469"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679801468"><span class="annot"><span class="annottext">seeds :: ListT m seed
</span><a href="#local-6989586621679801468"><span class="hs-identifier hs-var">seeds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Output sample -&gt; m ()) -&gt; ContT b m (ListT m sample)
forall a (m :: * -&gt; *) b.
MonadBaseControl IO m =&gt;
Int -&gt; (Output a -&gt; m ()) -&gt; ContT b m (ListT m a)
</span><a href="Torch.Data.Internal.html#runWithBuffer"><span class="hs-identifier hs-var">runWithBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679801470"><span class="hs-identifier hs-var">bufferSize</span></a></span><span> </span><span class="annot"><span class="annottext">((Output sample -&gt; m ()) -&gt; ContT b m (ListT m sample))
-&gt; (Output sample -&gt; m ()) -&gt; ContT b m (ListT m sample)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; ListT m seed -&gt; Output sample -&gt; m ()
forall (m :: * -&gt; *) seed dataset sample.
(Datastream m seed dataset sample, MonadBaseControl IO m) =&gt;
dataset -&gt; ListT m seed -&gt; Output sample -&gt; m ()
</span><a href="Torch.Data.StreamedPipeline.html#readSamples"><span class="hs-identifier hs-var">readSamples</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679801469"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">ListT m seed
</span><a href="#local-6989586621679801468"><span class="hs-identifier hs-var">seeds</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- | This function is the same as 'streamFrom' except the seeds are specified as</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- a 'Foldable', and the stream returned has a deterministic ordering. The results</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- from each given seed are interspersed in the order defined by the @'Foldable'@ of seeds.</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#streamFrom%27"><span class="hs-identifier hs-type">streamFrom'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679801465"><span class="annot"><a href="#local-6989586621679801465"><span class="hs-identifier hs-type">sample</span></a></span></span><span> </span><span id="local-6989586621679801464"><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679801463"><span class="annot"><a href="#local-6989586621679801463"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679801462"><span class="annot"><a href="#local-6989586621679801462"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679801461"><span class="annot"><a href="#local-6989586621679801461"><span class="hs-identifier hs-type">seed</span></a></span></span><span> </span><span id="local-6989586621679801460"><span class="annot"><a href="#local-6989586621679801460"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679801465"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#Datastream"><span class="hs-identifier hs-type">Datastream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801461"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801462"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801465"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kx8g6gw5xhwzmis9y4f83mdjhyci589v-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/paz32w16pk70bana84g0rd3vd3clh6r4-transformers-base-lib-transformers-base-0.4.5.2-haddock-doc/share/doc/transformers-base/html/src"><span class="hs-identifier hs-type">MonadBase</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679801463"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-type">DatastreamOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="#local-6989586621679801462"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="#local-6989586621679801463"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801461"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ContT</span></span><span> </span><span class="annot"><a href="#local-6989586621679801460"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">ListT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801465"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span id="streamFrom%27"><span class="annot"><span class="annottext">streamFrom' :: DatastreamOptions
-&gt; dataset -&gt; f seed -&gt; ContT b m (ListT m sample)
</span><a href="Torch.Data.StreamedPipeline.html#streamFrom%27"><span class="hs-identifier hs-var hs-var">streamFrom'</span></a></span></span><span> </span><span id="local-6989586621679801459"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#DatastreamOptions"><span class="hs-identifier hs-type">DatastreamOptions</span></a></span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span></span><span> </span><span id="local-6989586621679801458"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679801458"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679801457"><span class="annot"><span class="annottext">seeds :: f seed
</span><a href="#local-6989586621679801457"><span class="hs-identifier hs-var">seeds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621679801456"><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679801456"><span class="hs-identifier hs-var">workerTracker</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (TVar Int) -&gt; ContT b m (TVar Int)
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (TVar Int) -&gt; ContT b m (TVar Int))
-&gt; STM (TVar Int) -&gt; ContT b m (TVar Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; STM (TVar Int)
forall a. a -&gt; STM (TVar a)
</span><span class="hs-identifier hs-var">newTVar</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-124"></span><span>      </span><span id="local-6989586621679801453"><span class="annot"><span class="annottext">consumeSeeds :: Vector (Output sample, Input sample, STM ())
-&gt; Output sample -&gt; Proxy X () () X m ()
</span><a href="#local-6989586621679801453"><span class="hs-identifier hs-var hs-var">consumeSeeds</span></a></span></span><span> </span><span id="local-6989586621679801452"><span class="annot"><span class="annottext">mailboxes :: Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801452"><span class="hs-identifier hs-var">mailboxes</span></a></span></span><span> </span><span id="local-6989586621679801451"><span class="annot"><span class="annottext">o :: Output sample
</span><a href="#local-6989586621679801451"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">Proxy X () () (Output sample, Input sample, STM ()) m ()
-&gt; ((Output sample, Input sample, STM ()) -&gt; Proxy X () () X m ())
-&gt; Proxy X () () X m ()
forall (m :: * -&gt; *) x' x b' b a' c' c.
Functor m =&gt;
Proxy x' x b' b m a'
-&gt; (b -&gt; Proxy x' x c' c m b') -&gt; Proxy x' x c' c m a'
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
-&gt; Producer' (Output sample, Input sample, STM ()) m ()
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
(Functor m, Foldable f) =&gt;
f a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">each</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801452"><span class="hs-identifier hs-var">mailboxes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Output sample, Input sample, STM ()) -&gt; Proxy X () () X m ())
 -&gt; Proxy X () () X m ())
-&gt; ((Output sample, Input sample, STM ()) -&gt; Proxy X () () X m ())
-&gt; Proxy X () () X m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679801448"><span class="annot"><span class="annottext">input :: Input sample
</span><a href="#local-6989586621679801448"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; Input sample -&gt; Producer sample m ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
TVar Int -&gt; Input a -&gt; Producer a m ()
</span><a href="Torch.Data.StreamedPipeline.html#fromInputOnce"><span class="hs-identifier hs-var">fromInputOnce</span></a></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679801456"><span class="hs-identifier hs-var">workerTracker</span></a></span><span> </span><span class="annot"><span class="annottext">Input sample
</span><a href="#local-6989586621679801448"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Producer sample m ()
-&gt; Proxy () sample () X m () -&gt; Proxy X () () X m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span>  </span><span class="annot"><span class="annottext">Output sample -&gt; Consumer' sample m ()
forall (m :: * -&gt; *) a.
MonadBase IO m =&gt;
Output a -&gt; Consumer' a m ()
</span><a href="Torch.Data.Internal.html#toOutput%27"><span class="hs-identifier hs-var">toOutput'</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample
</span><a href="#local-6989586621679801451"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621679801444"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679801444"><span class="hs-identifier hs-var">keepReading</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Bool -&gt; Proxy X () () X m Bool
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m Bool -&gt; Proxy X () () X m Bool)
-&gt; m Bool -&gt; Proxy X () () X m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM Bool -&gt; m Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM Bool -&gt; m Bool) -&gt; STM Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679801442"><span class="annot"><span class="annottext">x :: Int
</span><a href="#local-6989586621679801442"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679801442"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ()) -&gt; Int
forall a. Vector a -&gt; Int
</span><a href="../file:///nix/store/g34k2swssr2a5sh84k11lpyciwvmrz8b-vector-lib-vector-0.12.1.2-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.length</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801452"><span class="hs-identifier hs-var">mailboxes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; STM Int -&gt; STM Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; STM Int
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679801456"><span class="hs-identifier hs-var">workerTracker</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Proxy X () () X m () -&gt; Proxy X () () X m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679801444"><span class="hs-identifier hs-var">keepReading</span></a></span><span> </span><span class="annot"><span class="annottext">(Proxy X () () X m () -&gt; Proxy X () () X m ())
-&gt; Proxy X () () X m () -&gt; Proxy X () () X m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
-&gt; Output sample -&gt; Proxy X () () X m ()
</span><a href="#local-6989586621679801453"><span class="hs-identifier hs-var">consumeSeeds</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801452"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample
</span><a href="#local-6989586621679801451"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; (Output sample -&gt; m ()) -&gt; ContT b m (ListT m sample)
forall a (m :: * -&gt; *) b.
MonadBaseControl IO m =&gt;
Int -&gt; (Output a -&gt; m ()) -&gt; ContT b m (ListT m a)
</span><a href="Torch.Data.Internal.html#runWithBuffer"><span class="hs-identifier hs-var">runWithBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679801459"><span class="hs-identifier hs-var">bufferSize</span></a></span><span> </span><span class="annot"><span class="annottext">((Output sample -&gt; m ()) -&gt; ContT b m (ListT m sample))
-&gt; (Output sample -&gt; m ()) -&gt; ContT b m (ListT m sample)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679801436"><span class="annot"><span class="annottext">o :: Output sample
</span><a href="#local-6989586621679801436"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">m (Vector (seed, (Output sample, Input sample, STM ())))
-&gt; (Vector (seed, (Output sample, Input sample, STM ())) -&gt; m ())
-&gt; (Vector (seed, (Output sample, Input sample, STM ())) -&gt; m ())
-&gt; m ()
forall (m :: * -&gt; *) a b c.
MonadBaseControl IO m =&gt;
m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c
</span><a href="Torch.Data.Internal.html#liftedBracket"><span class="hs-identifier hs-var">liftedBracket</span></a></span><span> </span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FoldM m seed (Vector (seed, (Output sample, Input sample, STM ())))
-&gt; f seed
-&gt; m (Vector (seed, (Output sample, Input sample, STM ())))
forall (f :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable f, Monad m) =&gt;
FoldM m a b -&gt; f a -&gt; m b
</span><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.foldM</span></a></span><span> </span><span class="annot"><span class="annottext">FoldM m seed (Vector (seed, (Output sample, Input sample, STM ())))
forall (m :: * -&gt; *) seed a.
MonadIO m =&gt;
FoldM m seed (Vector (seed, (Output a, Input a, STM ())))
</span><a href="Torch.Data.StreamedPipeline.html#pairSeedWithBuffer"><span class="hs-identifier hs-var">pairSeedWithBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">f seed
</span><a href="#local-6989586621679801457"><span class="hs-identifier hs-var">seeds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((seed, (Output sample, Input sample, STM ())) -&gt; m ())
-&gt; Vector (seed, (Output sample, Input sample, STM ())) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STM () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; m ())
-&gt; ((seed, (Output sample, Input sample, STM ())) -&gt; STM ())
-&gt; (seed, (Output sample, Input sample, STM ()))
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Output sample, Input sample, STM ()) -&gt; STM ()
forall a b c. (a, b, c) -&gt; c
</span><a href="#local-6989586621679801430"><span class="hs-identifier hs-var">third</span></a></span><span> </span><span class="annot"><span class="annottext">((Output sample, Input sample, STM ()) -&gt; STM ())
-&gt; ((seed, (Output sample, Input sample, STM ()))
    -&gt; (Output sample, Input sample, STM ()))
-&gt; (seed, (Output sample, Input sample, STM ()))
-&gt; STM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(seed, (Output sample, Input sample, STM ()))
-&gt; (Output sample, Input sample, STM ())
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679801429"><span class="annot"><span class="annottext">a :: Vector (seed, (Output sample, Input sample, STM ()))
</span><a href="#local-6989586621679801429"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679801428"><span class="annot"><span class="annottext">mailboxes :: Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801428"><span class="hs-identifier hs-var hs-var">mailboxes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(seed, (Output sample, Input sample, STM ()))
-&gt; (Output sample, Input sample, STM ())
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((seed, (Output sample, Input sample, STM ()))
 -&gt; (Output sample, Input sample, STM ()))
-&gt; Vector (seed, (Output sample, Input sample, STM ()))
-&gt; Vector (Output sample, Input sample, STM ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector (seed, (Output sample, Input sample, STM ()))
</span><a href="#local-6989586621679801429"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-134"></span><span>             </span><span id="local-6989586621679801427"><span class="annot"><span class="annottext">seedAndOutput :: Vector (seed, Output sample)
</span><a href="#local-6989586621679801427"><span class="hs-identifier hs-var hs-var">seedAndOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Output sample, Input sample, STM ()) -&gt; Output sample)
-&gt; (seed, (Output sample, Input sample, STM ()))
-&gt; (seed, Output sample)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">(Output sample, Input sample, STM ()) -&gt; Output sample
forall a b c. (a, b, c) -&gt; a
</span><a href="#local-6989586621679801426"><span class="hs-identifier hs-var">fst3</span></a></span><span> </span><span class="annot"><span class="annottext">((seed, (Output sample, Input sample, STM ()))
 -&gt; (seed, Output sample))
-&gt; Vector (seed, (Output sample, Input sample, STM ()))
-&gt; Vector (seed, Output sample)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector (seed, (Output sample, Input sample, STM ()))
</span><a href="#local-6989586621679801429"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-135"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; m b -&gt; m ()
</span><a href="../file:///nix/store/94ms40167xxa84970qr0smf09mjiqaw5-lifted-async-lib-lifted-async-0.10.1.2-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">concurrently_</span></a></span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">dataset -&gt; Vector (seed, Output sample) -&gt; m ()
forall (m :: * -&gt; *) seed (f :: * -&gt; *) dataset sample.
(Datastream m seed dataset sample, MonadBaseControl IO m,
 MonadIO m, Foldable f) =&gt;
dataset -&gt; f (seed, Output sample) -&gt; m ()
</span><a href="Torch.Data.StreamedPipeline.html#readSamplesDeterministic"><span class="hs-identifier hs-var">readSamplesDeterministic</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679801458"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (seed, Output sample)
</span><a href="#local-6989586621679801427"><span class="hs-identifier hs-var">seedAndOutput</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; m b -&gt; m a
</span><a href="Torch.Data.Internal.html#liftedFinally"><span class="hs-operator hs-var">`liftedFinally`</span></a></span><span> </span><span class="annot"><span class="annottext">((Output sample, Input sample, STM ()) -&gt; m ())
-&gt; Vector (Output sample, Input sample, STM ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STM () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; m ())
-&gt; ((Output sample, Input sample, STM ()) -&gt; STM ())
-&gt; (Output sample, Input sample, STM ())
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Output sample, Input sample, STM ()) -&gt; STM ()
forall a b c. (a, b, c) -&gt; c
</span><a href="#local-6989586621679801430"><span class="hs-identifier hs-var">third</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801428"><span class="hs-identifier hs-var">mailboxes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy X () () X m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
-&gt; Output sample -&gt; Proxy X () () X m ()
</span><a href="#local-6989586621679801453"><span class="hs-identifier hs-var">consumeSeeds</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801428"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample
</span><a href="#local-6989586621679801436"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; m b -&gt; m a
</span><a href="Torch.Data.Internal.html#liftedFinally"><span class="hs-operator hs-var">`liftedFinally`</span></a></span><span> </span><span class="annot"><span class="annottext">((Output sample, Input sample, STM ()) -&gt; m ())
-&gt; Vector (Output sample, Input sample, STM ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STM () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; m ())
-&gt; ((Output sample, Input sample, STM ()) -&gt; STM ())
-&gt; (Output sample, Input sample, STM ())
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Output sample, Input sample, STM ()) -&gt; STM ()
forall a b c. (a, b, c) -&gt; c
</span><a href="#local-6989586621679801430"><span class="hs-identifier hs-var">third</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (Output sample, Input sample, STM ())
</span><a href="#local-6989586621679801428"><span class="hs-identifier hs-var">mailboxes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679801426"><span class="annot"><span class="annottext">fst3 :: (a, b, c) -&gt; a
</span><a href="#local-6989586621679801426"><span class="hs-identifier hs-var hs-var">fst3</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679801421"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679801421"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679801421"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679801430"><span class="annot"><span class="annottext">third :: (a, b, c) -&gt; c
</span><a href="#local-6989586621679801430"><span class="hs-identifier hs-var hs-var">third</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span id="local-6989586621679801420"><span class="annot"><span class="annottext">c :: c
</span><a href="#local-6989586621679801420"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679801420"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#readSamples"><span class="hs-identifier hs-type">readSamples</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679801656"><span class="annot"><a href="#local-6989586621679801656"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679801655"><span class="annot"><a href="#local-6989586621679801655"><span class="hs-identifier hs-type">seed</span></a></span></span><span> </span><span id="local-6989586621679801654"><span class="annot"><a href="#local-6989586621679801654"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679801653"><span class="annot"><a href="#local-6989586621679801653"><span class="hs-identifier hs-type">sample</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#Datastream"><span class="hs-identifier hs-type">Datastream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801656"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801655"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801654"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801653"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kx8g6gw5xhwzmis9y4f83mdjhyci589v-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801656"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="#local-6989586621679801654"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">ListT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801656"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801655"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801653"><span class="hs-identifier hs-type">sample</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="#local-6989586621679801656"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span id="readSamples"><span class="annot"><span class="annottext">readSamples :: dataset -&gt; ListT m seed -&gt; Output sample -&gt; m ()
</span><a href="Torch.Data.StreamedPipeline.html#readSamples"><span class="hs-identifier hs-var hs-var">readSamples</span></a></span></span><span> </span><span id="local-6989586621679801419"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679801419"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679801418"><span class="annot"><span class="annottext">seeds :: ListT m seed
</span><a href="#local-6989586621679801418"><span class="hs-identifier hs-var">seeds</span></a></span></span><span> </span><span id="local-6989586621679801417"><span class="annot"><span class="annottext">outputBox :: Output sample
</span><a href="#local-6989586621679801417"><span class="hs-identifier hs-var">outputBox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679801416"><span class="annot"><span class="annottext">this :: Concurrently m () -&gt; seed -&gt; Concurrently m ()
</span><a href="#local-6989586621679801416"><span class="hs-identifier hs-var hs-var">this</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(seed -&gt; Concurrently m () -&gt; Concurrently m ())
-&gt; Concurrently m () -&gt; seed -&gt; Concurrently m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((seed -&gt; Concurrently m () -&gt; Concurrently m ())
 -&gt; Concurrently m () -&gt; seed -&gt; Concurrently m ())
-&gt; (seed -&gt; Concurrently m () -&gt; Concurrently m ())
-&gt; Concurrently m ()
-&gt; seed
-&gt; Concurrently m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Concurrently m () -&gt; Concurrently m () -&gt; Concurrently m ()
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">(Concurrently m () -&gt; Concurrently m () -&gt; Concurrently m ())
-&gt; (seed -&gt; Concurrently m ())
-&gt; seed
-&gt; Concurrently m ()
-&gt; Concurrently m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; Concurrently m ()
forall (m :: * -&gt; *) a. m a -&gt; Concurrently m a
</span><a href="../file:///nix/store/94ms40167xxa84970qr0smf09mjiqaw5-lifted-async-lib-lifted-async-0.10.1.2-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">Concurrently</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; Concurrently m ())
-&gt; (seed -&gt; m ()) -&gt; seed -&gt; Concurrently m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Effect m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Effect m () -&gt; m ()) -&gt; (seed -&gt; Effect m ()) -&gt; seed -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy X () () sample m ()
-&gt; Proxy () sample () X m () -&gt; Effect m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample -&gt; Consumer' sample m ()
forall (m :: * -&gt; *) a.
MonadBase IO m =&gt;
Output a -&gt; Consumer' a m ()
</span><a href="Torch.Data.Internal.html#toOutput%27"><span class="hs-identifier hs-var">toOutput'</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample
</span><a href="#local-6989586621679801417"><span class="hs-identifier hs-var">outputBox</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Proxy X () () sample m () -&gt; Effect m ())
-&gt; (seed -&gt; Proxy X () () sample m ()) -&gt; seed -&gt; Effect m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ListT m sample -&gt; Proxy X () () sample m ()
forall (m :: * -&gt; *) a. ListT m a -&gt; Producer a m ()
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var hs-var">enumerate</span></a></span><span> </span><span class="annot"><span class="annottext">(ListT m sample -&gt; Proxy X () () sample m ())
-&gt; (seed -&gt; ListT m sample) -&gt; seed -&gt; Proxy X () () sample m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; seed -&gt; ListT m sample
forall (m :: * -&gt; *) seed dataset sample.
Datastream m seed dataset sample =&gt;
dataset -&gt; seed -&gt; ListT m sample
</span><a href="Torch.Data.StreamedPipeline.html#streamSamples"><span class="hs-identifier hs-var">streamSamples</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801656"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801655"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801654"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801653"><span class="hs-identifier hs-type">sample</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679801419"><span class="hs-identifier hs-var">dataset</span></a></span><span>
</span><span id="line-152"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">m (m ()) -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(m (m ()) -&gt; m ())
-&gt; (Producer seed m () -&gt; m (m ())) -&gt; Producer seed m () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Concurrently m () -&gt; seed -&gt; Concurrently m ())
-&gt; Concurrently m ()
-&gt; (Concurrently m () -&gt; m ())
-&gt; Producer seed m ()
-&gt; m (m ())
forall (m :: * -&gt; *) x a b.
Monad m =&gt;
(x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Producer a m () -&gt; m b
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">P.fold</span></a></span><span> </span><span class="annot"><span class="annottext">Concurrently m () -&gt; seed -&gt; Concurrently m ()
</span><a href="#local-6989586621679801416"><span class="hs-identifier hs-var">this</span></a></span><span> </span><span class="annot"><span class="annottext">Concurrently m ()
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Concurrently m () -&gt; m ()
forall (m :: * -&gt; *) a. Concurrently m a -&gt; m a
</span><a href="../file:///nix/store/94ms40167xxa84970qr0smf09mjiqaw5-lifted-async-lib-lifted-async-0.10.1.2-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var hs-var">runConcurrently</span></a></span><span> </span><span class="annot"><span class="annottext">(Producer seed m () -&gt; m ()) -&gt; Producer seed m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ListT m seed -&gt; Producer seed m ()
forall (m :: * -&gt; *) a. ListT m a -&gt; Producer a m ()
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var hs-var">enumerate</span></a></span><span> </span><span class="annot"><span class="annottext">ListT m seed
</span><a href="#local-6989586621679801418"><span class="hs-identifier hs-var">seeds</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#readSamplesDeterministic"><span class="hs-identifier hs-type">readSamplesDeterministic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679801563"><span class="annot"><a href="#local-6989586621679801563"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679801562"><span class="annot"><a href="#local-6989586621679801562"><span class="hs-identifier hs-type">seed</span></a></span></span><span> </span><span id="local-6989586621679801559"><span class="annot"><a href="#local-6989586621679801559"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679801561"><span class="annot"><a href="#local-6989586621679801561"><span class="hs-identifier hs-type">dataset</span></a></span></span><span> </span><span id="local-6989586621679801560"><span class="annot"><a href="#local-6989586621679801560"><span class="hs-identifier hs-type">sample</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.StreamedPipeline.html#Datastream"><span class="hs-identifier hs-type">Datastream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801563"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801562"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801561"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801560"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/kx8g6gw5xhwzmis9y4f83mdjhyci589v-monad-control-lib-monad-control-1.0.2.3-haddock-doc/share/doc/monad-control/html/src"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801563"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801563"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679801559"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="#local-6989586621679801561"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="#local-6989586621679801559"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679801562"><span class="hs-identifier hs-type">seed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801560"><span class="hs-identifier hs-type">sample</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><a href="#local-6989586621679801563"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span id="readSamplesDeterministic"><span class="annot"><span class="annottext">readSamplesDeterministic :: dataset -&gt; f (seed, Output sample) -&gt; m ()
</span><a href="Torch.Data.StreamedPipeline.html#readSamplesDeterministic"><span class="hs-identifier hs-var hs-var">readSamplesDeterministic</span></a></span></span><span> </span><span id="local-6989586621679801410"><span class="annot"><span class="annottext">dataset :: dataset
</span><a href="#local-6989586621679801410"><span class="hs-identifier hs-var">dataset</span></a></span></span><span> </span><span id="local-6989586621679801409"><span class="annot"><span class="annottext">seeds :: f (seed, Output sample)
</span><a href="#local-6989586621679801409"><span class="hs-identifier hs-var">seeds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679801408"><span class="annot"><span class="annottext">this :: Concurrently m () -&gt; (seed, Output sample) -&gt; Concurrently m ()
</span><a href="#local-6989586621679801408"><span class="hs-identifier hs-var hs-var">this</span></a></span></span><span> </span><span id="local-6989586621679801407"><span class="annot"><span class="annottext">c :: Concurrently m ()
</span><a href="#local-6989586621679801407"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679801406"><span class="annot"><span class="annottext">seed :: seed
</span><a href="#local-6989586621679801406"><span class="hs-identifier hs-var">seed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679801405"><span class="annot"><span class="annottext">outputBox :: Output sample
</span><a href="#local-6989586621679801405"><span class="hs-identifier hs-var">outputBox</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">Concurrently m () -&gt; Concurrently m () -&gt; Concurrently m ()
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">Concurrently m ()
</span><a href="#local-6989586621679801407"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Concurrently m () -&gt; Concurrently m ())
-&gt; (ListT m sample -&gt; Concurrently m ())
-&gt; ListT m sample
-&gt; Concurrently m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; Concurrently m ()
forall (m :: * -&gt; *) a. m a -&gt; Concurrently m a
</span><a href="../file:///nix/store/94ms40167xxa84970qr0smf09mjiqaw5-lifted-async-lib-lifted-async-0.10.1.2-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var">Concurrently</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; Concurrently m ())
-&gt; (ListT m sample -&gt; m ()) -&gt; ListT m sample -&gt; Concurrently m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Effect m () -&gt; m ()
forall (m :: * -&gt; *) r. Monad m =&gt; Effect m r -&gt; m r
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">runEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(Effect m () -&gt; m ())
-&gt; (ListT m sample -&gt; Effect m ()) -&gt; ListT m sample -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy X () () sample m ()
-&gt; Proxy () sample () X m () -&gt; Effect m ()
forall (m :: * -&gt; *) a' a b r c' c.
Functor m =&gt;
Proxy a' a () b m r -&gt; Proxy () b c' c m r -&gt; Proxy a' a c' c m r
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-operator hs-var">&gt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample -&gt; Consumer' sample m ()
forall (m :: * -&gt; *) a.
MonadBase IO m =&gt;
Output a -&gt; Consumer' a m ()
</span><a href="Torch.Data.Internal.html#toOutput%27"><span class="hs-identifier hs-var">toOutput'</span></a></span><span> </span><span class="annot"><span class="annottext">Output sample
</span><a href="#local-6989586621679801405"><span class="hs-identifier hs-var">outputBox</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Proxy X () () sample m () -&gt; Effect m ())
-&gt; (ListT m sample -&gt; Proxy X () () sample m ())
-&gt; ListT m sample
-&gt; Effect m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ListT m sample -&gt; Proxy X () () sample m ()
forall (m :: * -&gt; *) a. ListT m a -&gt; Producer a m ()
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var hs-var">enumerate</span></a></span><span> </span><span class="annot"><span class="annottext">(ListT m sample -&gt; Concurrently m ())
-&gt; ListT m sample -&gt; Concurrently m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">dataset -&gt; seed -&gt; ListT m sample
forall (m :: * -&gt; *) seed dataset sample.
Datastream m seed dataset sample =&gt;
dataset -&gt; seed -&gt; ListT m sample
</span><a href="Torch.Data.StreamedPipeline.html#streamSamples"><span class="hs-identifier hs-var">streamSamples</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801563"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801562"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801561"><span class="hs-identifier hs-type">dataset</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679801560"><span class="hs-identifier hs-type">sample</span></a></span><span> </span><span class="annot"><span class="annottext">dataset
</span><a href="#local-6989586621679801410"><span class="hs-identifier hs-var">dataset</span></a></span><span> </span><span class="annot"><span class="annottext">seed
</span><a href="#local-6989586621679801406"><span class="hs-identifier hs-var">seed</span></a></span><span>
</span><span id="line-164"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Fold (seed, Output sample) (m ())
-&gt; f (seed, Output sample) -&gt; m ()
forall (f :: * -&gt; *) a b. Foldable f =&gt; Fold a b -&gt; f a -&gt; b
</span><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.fold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Concurrently m () -&gt; (seed, Output sample) -&gt; Concurrently m ())
-&gt; Concurrently m ()
-&gt; (Concurrently m () -&gt; m ())
-&gt; Fold (seed, Output sample) (m ())
forall a b x. (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b
</span><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.Fold</span></a></span><span> </span><span class="annot"><span class="annottext">Concurrently m () -&gt; (seed, Output sample) -&gt; Concurrently m ()
</span><a href="#local-6989586621679801408"><span class="hs-identifier hs-var">this</span></a></span><span> </span><span class="annot"><span class="annottext">Concurrently m ()
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Concurrently m () -&gt; m ()
forall (m :: * -&gt; *) a. Concurrently m a -&gt; m a
</span><a href="../file:///nix/store/94ms40167xxa84970qr0smf09mjiqaw5-lifted-async-lib-lifted-async-0.10.1.2-haddock-doc/share/doc/lifted-async/html/src"><span class="hs-identifier hs-var hs-var">runConcurrently</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (seed, Output sample)
</span><a href="#local-6989586621679801409"><span class="hs-identifier hs-var">seeds</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span id="local-6989586621679801587"><span id="local-6989586621679801588"><span id="local-6989586621679801589"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#pairSeedWithBuffer"><span class="hs-identifier hs-type">pairSeedWithBuffer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801589"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-type">FoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801589"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801588"><span class="hs-identifier hs-type">seed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/g34k2swssr2a5sh84k11lpyciwvmrz8b-vector-lib-vector-0.12.1.2-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-type">V.Vector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679801588"><span class="hs-identifier hs-type">seed</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801587"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801587"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span></span></span></span><span> </span><span>
</span><span id="line-168"></span><span id="pairSeedWithBuffer"><span class="annot"><span class="annottext">pairSeedWithBuffer :: FoldM m seed (Vector (seed, (Output a, Input a, STM ())))
</span><a href="Torch.Data.StreamedPipeline.html#pairSeedWithBuffer"><span class="hs-identifier hs-var hs-var">pairSeedWithBuffer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(seed -&gt; m (seed, (Output a, Input a, STM ())))
-&gt; FoldM
     m
     (seed, (Output a, Input a, STM ()))
     (Vector (seed, (Output a, Input a, STM ())))
-&gt; FoldM m seed (Vector (seed, (Output a, Input a, STM ())))
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; m b) -&gt; FoldM m b r -&gt; FoldM m a r
</span><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.premapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679801401"><span class="annot"><span class="annottext">a :: seed
</span><a href="#local-6989586621679801401"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">seed
</span><a href="#local-6989586621679801401"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Output a, Input a, STM ())
 -&gt; (seed, (Output a, Input a, STM ())))
-&gt; m (Output a, Input a, STM ())
-&gt; m (seed, (Output a, Input a, STM ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (Output a, Input a, STM ())
forall a. m (Output a, Input a, STM ())
</span><a href="#local-6989586621679801400"><span class="hs-identifier hs-var">makeMailbox</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FoldM
   m
   (seed, (Output a, Input a, STM ()))
   (Vector (seed, (Output a, Input a, STM ())))
 -&gt; FoldM m seed (Vector (seed, (Output a, Input a, STM ()))))
-&gt; FoldM
     m
     (seed, (Output a, Input a, STM ()))
     (Vector (seed, (Output a, Input a, STM ())))
-&gt; FoldM m seed (Vector (seed, (Output a, Input a, STM ())))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Fold
  (seed, (Output a, Input a, STM ()))
  (Vector (seed, (Output a, Input a, STM ())))
-&gt; FoldM
     m
     (seed, (Output a, Input a, STM ()))
     (Vector (seed, (Output a, Input a, STM ())))
forall (m :: * -&gt; *) a b. Monad m =&gt; Fold a b -&gt; FoldM m a b
</span><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.generalize</span></a></span><span> </span><span class="annot"><span class="annottext">Fold
  (seed, (Output a, Input a, STM ()))
  (Vector (seed, (Output a, Input a, STM ())))
forall (v :: * -&gt; *) a. Vector v a =&gt; Fold a (v a)
</span><a href="../file:///nix/store/8v48nmq3masx8qffd9hxsnq7x5s8fzi4-foldl-lib-foldl-1.4.8-haddock-doc/share/doc/foldl/html/src"><span class="hs-identifier hs-var">L.vector</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679801400"><span class="annot"><span class="annottext">makeMailbox :: m (Output a, Input a, STM ())
</span><a href="#local-6989586621679801400"><span class="hs-identifier hs-var hs-var">makeMailbox</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Output a, Input a, STM ()) -&gt; m (Output a, Input a, STM ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Output a, Input a, STM ()) -&gt; m (Output a, Input a, STM ()))
-&gt; IO (Output a, Input a, STM ()) -&gt; m (Output a, Input a, STM ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Buffer a -&gt; IO (Output a, Input a, STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Buffer a
forall a. Int -&gt; Buffer a
</span><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span id="local-6989586621679801621"><span id="local-6989586621679801622"><span class="annot"><a href="Torch.Data.StreamedPipeline.html#fromInputOnce"><span class="hs-identifier hs-type">fromInputOnce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679801622"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801621"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-type">Producer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801621"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679801622"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-172"></span><span id="fromInputOnce"><span class="annot"><span class="annottext">fromInputOnce :: TVar Int -&gt; Input a -&gt; Producer a m ()
</span><a href="Torch.Data.StreamedPipeline.html#fromInputOnce"><span class="hs-identifier hs-var hs-var">fromInputOnce</span></a></span></span><span> </span><span id="local-6989586621679801394"><span class="annot"><span class="annottext">workerTracker :: TVar Int
</span><a href="#local-6989586621679801394"><span class="hs-identifier hs-var">workerTracker</span></a></span></span><span> </span><span id="local-6989586621679801393"><span class="annot"><span class="annottext">input :: Input a
</span><a href="#local-6989586621679801393"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679801392"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679801392"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; Proxy X () () a m (Maybe a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe a) -&gt; Proxy X () () a m (Maybe a))
-&gt; STM (Maybe a) -&gt; Proxy X () () a m (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="../file:///nix/store/153ydbc70a9z4gjkfjpvwr5bwzmb9sk1-pipes-concurrency-lib-pipes-concurrency-2.0.12-haddock-doc/share/doc/pipes-concurrency/html/src"><span class="hs-identifier hs-var hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679801393"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679801392"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><span class="annottext">STM () -&gt; Producer a m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; STM a -&gt; m a
</span><a href="Torch.Data.Internal.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; Producer a m ()) -&gt; STM () -&gt; Producer a m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; STM Int
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679801394"><span class="hs-identifier hs-var">workerTracker</span></a></span><span> </span><span class="annot"><span class="annottext">STM Int -&gt; (Int -&gt; STM ()) -&gt; STM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; Int -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679801394"><span class="hs-identifier hs-var">workerTracker</span></a></span><span class="annot"><span class="annottext">(Int -&gt; STM ()) -&gt; (Int -&gt; Int) -&gt; Int -&gt; STM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-177"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; Producer a m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679801388"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679801388"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; Producer' a m ()
forall (m :: * -&gt; *) a. Functor m =&gt; a -&gt; Producer' a m ()
</span><a href="../file:///nix/store/qkh4h1d3hw0hs5cxc4j1x3qbr9p1q8p8-pipes-lib-pipes-4.3.14-haddock-doc/share/doc/pipes/html/src"><span class="hs-identifier hs-var">yield</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679801388"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">() -&gt; Producer a m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span></pre></body></html>
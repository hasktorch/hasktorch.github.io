<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# OPTIONS_GHC -v2 -Wall #-}</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Pegasus.Common</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">MonadThrow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Control.Monad.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">ireturn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&gt;&gt;&gt;=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">Control.Monad.Indexed.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">IxStateT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Control.Monad.Indexed.Trans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">IxMonadTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">ilift</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Data.Functor.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&lt;&lt;$&gt;&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&lt;&lt;*&gt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SingI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons.TypeLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SNat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DType"><span class="hs-identifier">DType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier">DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDType"><span class="hs-identifier">SDType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier">SDataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html"><span class="hs-identifier">Torch.GraduallyTyped.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier">DeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier">SDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html"><span class="hs-identifier">Torch.GraduallyTyped.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier">Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#LayoutType"><span class="hs-identifier">LayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier">ModelSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.SequenceToSequence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier">SequenceToSequenceTransformer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerGenerationInput"><span class="hs-identifier">SequenceToSequenceTransformerGenerationInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier">SequenceToSequenceTransformerInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerSpec"><span class="hs-identifier">SequenceToSequenceTransformerSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkPosC"><span class="hs-identifier">MkPosC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerAttentionMaskC"><span class="hs-identifier">MkTransformerAttentionMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerCrossAttentionMaskC"><span class="hs-identifier">MkTransformerCrossAttentionMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerDecoderAttentionMaskC"><span class="hs-identifier">MkTransformerDecoderAttentionMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier">MkTransformerPaddingMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerHead"><span class="hs-identifier">STransformerHead</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier">STransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier">SPegasus</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier">ShiftRight</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier">TransformerHead</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier">TransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#Pegasus"><span class="hs-identifier">Pegasus</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkPos"><span class="hs-identifier">mkPos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerAttentionMask"><span class="hs-identifier">mkTransformerAttentionMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerCrossAttentionMask"><span class="hs-identifier">mkTransformerCrossAttentionMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerDecoderAttentionMask"><span class="hs-identifier">mkTransformerDecoderAttentionMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerInput"><span class="hs-identifier">mkTransformerInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerPaddingMask"><span class="hs-identifier">mkTransformerPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html"><span class="hs-identifier">Torch.GraduallyTyped.Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Seq"><span class="hs-identifier">Seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html"><span class="hs-identifier">Torch.GraduallyTyped.RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier">Gradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier">RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier">SGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier">SDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier">Size</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetDim"><span class="hs-identifier">SGetDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier">Tensor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier">sShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html"><span class="hs-identifier">Torch.GraduallyTyped.Unify</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- | Pegasus dType.</span><span>
</span><span id="line-45"></span><span class="hs-keyword">type</span><span> </span><span id="PegasusDType"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDType"><span class="hs-identifier hs-var">PegasusDType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#Float"><span class="hs-identifier hs-type">Float</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- | Pegasus dType singleton.</span><span>
</span><span id="line-48"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDType"><span class="hs-identifier hs-type">pegasusDType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDType"><span class="hs-identifier hs-type">SDType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDType"><span class="hs-identifier hs-type">PegasusDType</span></a></span><span>
</span><span id="line-49"></span><span id="pegasusDType"><span class="annot"><span class="annottext">pegasusDType :: SDType PegasusDType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDType"><span class="hs-identifier hs-var hs-var">pegasusDType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI PegasusDType =&gt; Sing PegasusDType
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDType"><span class="hs-identifier hs-type">PegasusDType</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Pegasus data type.</span><span>
</span><span id="line-52"></span><span class="hs-keyword">type</span><span> </span><span id="PegasusDataType"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-var">PegasusDataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDType"><span class="hs-identifier hs-type">PegasusDType</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | Pegasus data type singleton.</span><span>
</span><span id="line-55"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-type">pegasusDataType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span>
</span><span id="line-56"></span><span id="pegasusDataType"><span class="annot"><span class="annottext">pegasusDataType :: SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var hs-var">pegasusDataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI PegasusDataType =&gt; Sing PegasusDataType
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">-- | Pegasus dropout rate.</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- 'dropout_rate = 0.1'</span><span>
</span><span id="line-60"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDropoutP"><span class="hs-identifier hs-type">pegasusDropoutP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-61"></span><span id="pegasusDropoutP"><span class="annot"><span class="annottext">pegasusDropoutP :: Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDropoutP"><span class="hs-identifier hs-var hs-var">pegasusDropoutP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- | Pegasus positional encoding dimension.</span><span>
</span><span id="line-64"></span><span class="hs-keyword">type</span><span> </span><span id="PegasusPosEncDim"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-var">PegasusPosEncDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-number">512</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | Pegasus positional encoding dimension singleton.</span><span>
</span><span id="line-67"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPosEncDim"><span class="hs-identifier hs-type">pegasusPosEncDim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-type">PegasusPosEncDim</span></a></span><span>
</span><span id="line-68"></span><span id="pegasusPosEncDim"><span class="annot"><span class="annottext">pegasusPosEncDim :: SDim PegasusPosEncDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPosEncDim"><span class="hs-identifier hs-var hs-var">pegasusPosEncDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI PegasusPosEncDim =&gt; Sing PegasusPosEncDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-type">PegasusPosEncDim</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Pegasus layer-norm epsilon.</span><span>
</span><span id="line-71"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusEps"><span class="hs-identifier hs-type">pegasusEps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-72"></span><span id="pegasusEps"><span class="annot"><span class="annottext">pegasusEps :: Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusEps"><span class="hs-identifier hs-var hs-var">pegasusEps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-5</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Pegasus maximum number of position embeddings.</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- 'max_position_embeddings = 512'</span><span>
</span><span id="line-76"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusMaxPositionEmbeddings"><span class="hs-identifier hs-type">pegasusMaxPositionEmbeddings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-77"></span><span id="pegasusMaxPositionEmbeddings"><span class="annot"><span class="annottext">pegasusMaxPositionEmbeddings :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusMaxPositionEmbeddings"><span class="hs-identifier hs-var hs-var">pegasusMaxPositionEmbeddings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">512</span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | Pegasus padding token id.</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- 'pad_token_id = 0'</span><span>
</span><span id="line-81"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPadTokenId"><span class="hs-identifier hs-type">pegasusPadTokenId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-82"></span><span id="pegasusPadTokenId"><span class="annot"><span class="annottext">pegasusPadTokenId :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPadTokenId"><span class="hs-identifier hs-var hs-var">pegasusPadTokenId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-comment">-- | Pegasus begin-of-sentence token id.</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- 'bos_token_id = 0'</span><span>
</span><span id="line-86"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusBOSTokenId"><span class="hs-identifier hs-type">pegasusBOSTokenId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-87"></span><span id="pegasusBOSTokenId"><span class="annot"><span class="annottext">pegasusBOSTokenId :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusBOSTokenId"><span class="hs-identifier hs-var hs-var">pegasusBOSTokenId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPadTokenId"><span class="hs-identifier hs-var">pegasusPadTokenId</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | Pegasus end-of-sentence token id.</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- 'eos_token_id = 0'</span><span>
</span><span id="line-91"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusEOSTokenId"><span class="hs-identifier hs-type">pegasusEOSTokenId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-92"></span><span id="pegasusEOSTokenId"><span class="annot"><span class="annottext">pegasusEOSTokenId :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusEOSTokenId"><span class="hs-identifier hs-var hs-var">pegasusEOSTokenId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Pegasus attention mask bias</span><span>
</span><span id="line-95"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-type">pegasusAttentionMaskBias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-96"></span><span id="pegasusAttentionMaskBias"><span class="annot"><span class="annottext">pegasusAttentionMaskBias :: Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-var hs-var">pegasusAttentionMaskBias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">data</span><span>
</span><span id="line-99"></span><span>  </span><span id="GPegasusModel"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-var">GPegasusModel</span></a></span></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815644"><span class="annot"><a href="#local-6989586621679815644"><span class="hs-identifier hs-type">pegasusModel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>  </span><span id="GPegasusModel"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-var">GPegasusModel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679816024"><span class="annot"><a href="#local-6989586621679816024"><span class="hs-identifier hs-type">pegasusModel</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pegasusModel"><span class="annot"><span class="annottext">GPegasusModel pegasusModel -&gt; pegasusModel
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusModel"><span class="hs-identifier hs-var hs-var">pegasusModel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679816024"><span class="hs-identifier hs-type">pegasusModel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>      </span><span id="pegasusShiftRightDecoderInput"><span class="annot"><span class="annottext">GPegasusModel pegasusModel -&gt; ShiftRight Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusShiftRightDecoderInput"><span class="hs-identifier hs-var hs-var">pegasusShiftRightDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>      </span><span id="pegasusShiftRightPaddingMask"><span class="annot"><span class="annottext">GPegasusModel pegasusModel -&gt; ShiftRight Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusShiftRightPaddingMask"><span class="hs-identifier hs-var hs-var">pegasusShiftRightPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-type">GPegasusModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816024"><span class="hs-identifier hs-type">pegasusModel</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Pegasus model.</span><span>
</span><span id="line-111"></span><span id="local-6989586621679815638"><span id="local-6989586621679815639"></span></span><span class="hs-keyword">data</span><span>
</span><span id="line-112"></span><span>  </span><span id="PegasusModel"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-var">PegasusModel</span></a></span></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815637"><span class="annot"><a href="#local-6989586621679815637"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier hs-type">TransformerHead</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815636"><span class="annot"><a href="#local-6989586621679815636"><span class="hs-identifier hs-type">numLayers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815635"><span class="annot"><a href="#local-6989586621679815635"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815634"><span class="annot"><a href="#local-6989586621679815634"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815633"><span class="annot"><a href="#local-6989586621679815633"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815632"><span class="annot"><a href="#local-6989586621679815632"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815631"><span class="annot"><a href="#local-6989586621679815631"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815630"><span class="annot"><a href="#local-6989586621679815630"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815629"><span class="annot"><a href="#local-6989586621679815629"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815628"><span class="annot"><a href="#local-6989586621679815628"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>  </span><span id="PegasusModel"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-var">PegasusModel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679816037"><span class="annot"><a href="#local-6989586621679816037"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679816036"><span class="annot"><a href="#local-6989586621679816036"><span class="hs-identifier hs-type">numLayers</span></a></span></span><span> </span><span id="local-6989586621679816035"><span class="annot"><a href="#local-6989586621679816035"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679816034"><span class="annot"><a href="#local-6989586621679816034"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679816033"><span class="annot"><a href="#local-6989586621679816033"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679816032"><span class="annot"><a href="#local-6989586621679816032"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679816031"><span class="annot"><a href="#local-6989586621679816031"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679816030"><span class="annot"><a href="#local-6989586621679816030"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679816029"><span class="annot"><a href="#local-6989586621679816029"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679816028"><span class="annot"><a href="#local-6989586621679816028"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-type">GPegasusModel</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#Pegasus"><span class="hs-identifier hs-type">Pegasus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816037"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816036"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816036"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816035"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816034"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816033"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816032"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816031"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816030"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816029"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-type">PegasusPosEncDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816028"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816037"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816036"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816035"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816034"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816033"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816032"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816031"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816030"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816029"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679816028"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 PegasusModel
   transformerHead
   numLayers
   gradient
   device
   headDim
   headEmbedDim
   embedDim
   inputEmbedDim
   ffnDim
   vocabDim
 -&gt; Rep
      (PegasusModel
         transformerHead
         numLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim)
      x)
-&gt; (forall x.
    Rep
      (PegasusModel
         transformerHead
         numLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim)
      x
    -&gt; PegasusModel
         transformerHead
         numLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim)
-&gt; Generic
     (PegasusModel
        transformerHead
        numLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
forall x.
Rep
  (PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
  x
-&gt; PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
forall x.
PegasusModel
  transformerHead
  numLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; Rep
     (PegasusModel
        transformerHead
        numLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
     x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (transformerHead :: TransformerHead) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
Rep
  (PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
  x
-&gt; PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
forall (transformerHead :: TransformerHead) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
PegasusModel
  transformerHead
  numLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; Rep
     (PegasusModel
        transformerHead
        numLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
     x
$cto :: forall (transformerHead :: TransformerHead) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
Rep
  (PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
  x
-&gt; PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
$cfrom :: forall (transformerHead :: TransformerHead) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
PegasusModel
  transformerHead
  numLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; Rep
     (PegasusModel
        transformerHead
        numLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
     x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-keyword">data</span><span>
</span><span id="line-132"></span><span>  </span><span id="PegasusModelSpec"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModelSpec"><span class="hs-identifier hs-var">PegasusModelSpec</span></a></span></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815622"><span class="annot"><a href="#local-6989586621679815622"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier hs-type">TransformerHead</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815621"><span class="annot"><a href="#local-6989586621679815621"><span class="hs-identifier hs-type">numLayers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815620"><span class="annot"><a href="#local-6989586621679815620"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815619"><span class="annot"><a href="#local-6989586621679815619"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815618"><span class="annot"><a href="#local-6989586621679815618"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815617"><span class="annot"><a href="#local-6989586621679815617"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815616"><span class="annot"><a href="#local-6989586621679815616"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815615"><span class="annot"><a href="#local-6989586621679815615"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815614"><span class="annot"><a href="#local-6989586621679815614"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679815613"><span class="annot"><a href="#local-6989586621679815613"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-144"></span><span>  </span><span id="PegasusModelSpec"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModelSpec"><span class="hs-identifier hs-var">PegasusModelSpec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679815611"><span class="annot"><a href="#local-6989586621679815611"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679815610"><span class="annot"><a href="#local-6989586621679815610"><span class="hs-identifier hs-type">numLayers</span></a></span></span><span> </span><span id="local-6989586621679815609"><span class="annot"><a href="#local-6989586621679815609"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679815608"><span class="annot"><a href="#local-6989586621679815608"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679815607"><span class="annot"><a href="#local-6989586621679815607"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679815606"><span class="annot"><a href="#local-6989586621679815606"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679815605"><span class="annot"><a href="#local-6989586621679815605"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679815604"><span class="annot"><a href="#local-6989586621679815604"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679815603"><span class="annot"><a href="#local-6989586621679815603"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679815602"><span class="annot"><a href="#local-6989586621679815602"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerHead"><span class="hs-identifier hs-type">STransformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815611"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SNat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815610"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815609"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815608"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModelSpec"><span class="hs-identifier hs-type">PegasusModelSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815611"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815610"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815609"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815608"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815607"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815606"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815605"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815604"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815603"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815602"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="ModelSpec"><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-var">ModelSpec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span id="local-6989586621679815601"><span class="annot"><a href="#local-6989586621679815601"><span class="hs-identifier hs-type hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679815600"><span class="annot"><a href="#local-6989586621679815600"><span class="hs-identifier hs-type hs-type">numLayers</span></a></span></span><span> </span><span id="local-6989586621679815599"><span class="annot"><a href="#local-6989586621679815599"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679815598"><span class="annot"><a href="#local-6989586621679815598"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679815597"><span class="annot"><a href="#local-6989586621679815597"><span class="hs-identifier hs-type hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679815596"><span class="annot"><a href="#local-6989586621679815596"><span class="hs-identifier hs-type hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679815595"><span class="annot"><a href="#local-6989586621679815595"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679815594"><span class="annot"><a href="#local-6989586621679815594"><span class="hs-identifier hs-type hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679815593"><span class="annot"><a href="#local-6989586621679815593"><span class="hs-identifier hs-type hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679815592"><span class="annot"><a href="#local-6989586621679815592"><span class="hs-identifier hs-type hs-type">vocabDim</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModelSpec"><span class="hs-identifier hs-type">PegasusModelSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815601"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815600"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815599"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815598"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815597"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815596"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815595"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815594"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815593"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815592"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span id="local-6989586621679815582"><span id="local-6989586621679815583"><span id="local-6989586621679815584"><span id="local-6989586621679815585"><span id="local-6989586621679815586"><span id="local-6989586621679815587"><span id="local-6989586621679815588"><span id="local-6989586621679815589"><span id="local-6989586621679815590"><span id="local-6989586621679815591"><span class="hs-keyword">instance</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815591"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815590"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815589"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815588"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815587"><span class="hs-identifier hs-type">ffnDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815586"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#Pegasus"><span class="hs-identifier hs-type">Pegasus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815585"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815584"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815584"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815583"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815582"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815591"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815590"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815589"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815588"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815587"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-type">PegasusPosEncDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815586"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815585"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815584"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815583"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815582"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815591"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815590"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815589"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815588"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815587"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815586"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621679815578"><span class="annot"><span class="annottext">fromStateDict :: ModelSpec
  (PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
-&gt; StateDictKey
-&gt; m (PegasusModel
        transformerHead
        numLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromStateDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModelSpec"><span class="hs-identifier hs-type">PegasusModelSpec</span></a></span><span> </span><span id="local-6989586621679815576"><span class="annot"><a href="#local-6989586621679815576"><span class="hs-identifier hs-var">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679815575"><span class="annot"><a href="#local-6989586621679815575"><span class="hs-identifier hs-var">numLayers</span></a></span></span><span> </span><span id="local-6989586621679815574"><span class="annot"><a href="#local-6989586621679815574"><span class="hs-identifier hs-var">gradient</span></a></span></span><span> </span><span id="local-6989586621679815573"><span class="annot"><a href="#local-6989586621679815573"><span class="hs-identifier hs-var">device</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679815572"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815572"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679815571"><span class="annot"><span class="annottext">headDim :: Sing headDim
</span><a href="#local-6989586621679815571"><span class="hs-identifier hs-var hs-var">headDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI headDim =&gt; Sing headDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679815591"><span class="hs-identifier hs-type">headDim</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span id="local-6989586621679815570"><span class="annot"><span class="annottext">headEmbedDim :: Sing headEmbedDim
</span><a href="#local-6989586621679815570"><span class="hs-identifier hs-var hs-var">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI headEmbedDim =&gt; Sing headEmbedDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679815590"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621679815569"><span class="annot"><span class="annottext">embedDim :: Sing embedDim
</span><a href="#local-6989586621679815569"><span class="hs-identifier hs-var hs-var">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI embedDim =&gt; Sing embedDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679815589"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span id="local-6989586621679815568"><span class="annot"><span class="annottext">inputEmbedDim :: Sing inputEmbedDim
</span><a href="#local-6989586621679815568"><span class="hs-identifier hs-var hs-var">inputEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI inputEmbedDim =&gt; Sing inputEmbedDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679815588"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span id="local-6989586621679815567"><span class="annot"><span class="annottext">ffnDim :: Sing ffnDim
</span><a href="#local-6989586621679815567"><span class="hs-identifier hs-var hs-var">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI ffnDim =&gt; Sing ffnDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679815587"><span class="hs-identifier hs-type">ffnDim</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span id="local-6989586621679815566"><span class="annot"><span class="annottext">vocabDim :: Sing vocabDim
</span><a href="#local-6989586621679815566"><span class="hs-identifier hs-var hs-var">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI vocabDim =&gt; Sing vocabDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679815586"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-174"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GPegasusModel
  (SequenceToSequenceTransformer
     'Pegasus
     transformerHead
     numLayers
     numLayers
     gradient
     device
     PegasusDataType
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     PegasusPosEncDim
     vocabDim)
-&gt; PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
forall (transformerHead :: TransformerHead) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)).
GPegasusModel
  (SequenceToSequenceTransformer
     'Pegasus
     transformerHead
     numLayers
     numLayers
     gradient
     device
     PegasusDataType
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     PegasusPosEncDim
     vocabDim)
-&gt; PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-var">PegasusModel</span></a></span><span>
</span><span id="line-175"></span><span>          </span><span class="annot"><span class="annottext">(GPegasusModel
   (SequenceToSequenceTransformer
      'Pegasus
      transformerHead
      numLayers
      numLayers
      gradient
      device
      PegasusDataType
      headDim
      headEmbedDim
      embedDim
      inputEmbedDim
      ffnDim
      PegasusPosEncDim
      vocabDim)
 -&gt; PegasusModel
      transformerHead
      numLayers
      gradient
      device
      headDim
      headEmbedDim
      embedDim
      inputEmbedDim
      ffnDim
      vocabDim)
-&gt; m (GPegasusModel
        (SequenceToSequenceTransformer
           'Pegasus
           transformerHead
           numLayers
           numLayers
           gradient
           device
           PegasusDataType
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           PegasusPosEncDim
           vocabDim))
-&gt; m (PegasusModel
        transformerHead
        numLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
-&gt; ShiftRight Int
-&gt; ShiftRight Int
-&gt; GPegasusModel
     (SequenceToSequenceTransformer
        'Pegasus
        transformerHead
        numLayers
        numLayers
        gradient
        device
        PegasusDataType
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        PegasusPosEncDim
        vocabDim)
forall pegasusModel.
pegasusModel
-&gt; ShiftRight Int -&gt; ShiftRight Int -&gt; GPegasusModel pegasusModel
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-var">GPegasusModel</span></a></span><span>
</span><span id="line-176"></span><span>                  </span><span class="annot"><span class="annottext">(SequenceToSequenceTransformer
   'Pegasus
   transformerHead
   numLayers
   numLayers
   gradient
   device
   PegasusDataType
   headDim
   headEmbedDim
   embedDim
   inputEmbedDim
   ffnDim
   PegasusPosEncDim
   vocabDim
 -&gt; ShiftRight Int
 -&gt; ShiftRight Int
 -&gt; GPegasusModel
      (SequenceToSequenceTransformer
         'Pegasus
         transformerHead
         numLayers
         numLayers
         gradient
         device
         PegasusDataType
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         PegasusPosEncDim
         vocabDim))
-&gt; m (SequenceToSequenceTransformer
        'Pegasus
        transformerHead
        numLayers
        numLayers
        gradient
        device
        PegasusDataType
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        PegasusPosEncDim
        vocabDim)
-&gt; m (ShiftRight Int
      -&gt; ShiftRight Int
      -&gt; GPegasusModel
           (SequenceToSequenceTransformer
              'Pegasus
              transformerHead
              numLayers
              numLayers
              gradient
              device
              PegasusDataType
              headDim
              headEmbedDim
              embedDim
              inputEmbedDim
              ffnDim
              PegasusPosEncDim
              vocabDim))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (SequenceToSequenceTransformer
     'Pegasus
     transformerHead
     numLayers
     numLayers
     gradient
     device
     PegasusDataType
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     PegasusPosEncDim
     vocabDim)
-&gt; StateDictKey
-&gt; m (SequenceToSequenceTransformer
        'Pegasus
        transformerHead
        numLayers
        numLayers
        gradient
        device
        PegasusDataType
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        PegasusPosEncDim
        vocabDim)
forall model (m :: * -&gt; *).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
-&gt; STransformerHead transformerHead
-&gt; SNat numLayers
-&gt; SNat numLayers
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType PegasusDataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim inputEmbedDim
-&gt; SDim ffnDim
-&gt; SDim PegasusPosEncDim
-&gt; SDim vocabDim
-&gt; Double
-&gt; Double
-&gt; SequenceToSequenceTransformerSpec
     'Pegasus
     transformerHead
     numLayers
     numLayers
     gradient
     device
     PegasusDataType
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     PegasusPosEncDim
     vocabDim
forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (posEncDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)).
STransformerStyle style
-&gt; STransformerHead transformerHead
-&gt; SNat numEncoderLayers
-&gt; SNat numDecoderLayers
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim inputEmbedDim
-&gt; SDim ffnDim
-&gt; SDim posEncDim
-&gt; SDim vocabDim
-&gt; Double
-&gt; Double
-&gt; SequenceToSequenceTransformerSpec
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     posEncDim
     vocabDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerSpec"><span class="hs-identifier hs-var">SequenceToSequenceTransformerSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerHead transformerHead
</span><a href="#local-6989586621679815576"><span class="hs-identifier hs-var">transformerHead</span></a></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="#local-6989586621679815575"><span class="hs-identifier hs-var">numLayers</span></a></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="#local-6989586621679815575"><span class="hs-identifier hs-var">numLayers</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679815574"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679815573"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var">pegasusDataType</span></a></span><span> </span><span class="annot"><span class="annottext">Sing headDim
SDim headDim
</span><a href="#local-6989586621679815571"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">Sing headEmbedDim
SDim headEmbedDim
</span><a href="#local-6989586621679815570"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">Sing embedDim
SDim embedDim
</span><a href="#local-6989586621679815569"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">Sing inputEmbedDim
SDim inputEmbedDim
</span><a href="#local-6989586621679815568"><span class="hs-identifier hs-var">inputEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">Sing ffnDim
SDim ffnDim
</span><a href="#local-6989586621679815567"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim PegasusPosEncDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPosEncDim"><span class="hs-identifier hs-var">pegasusPosEncDim</span></a></span><span> </span><span class="annot"><span class="annottext">Sing vocabDim
SDim vocabDim
</span><a href="#local-6989586621679815566"><span class="hs-identifier hs-var">vocabDim</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDropoutP"><span class="hs-identifier hs-var">pegasusDropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusEps"><span class="hs-identifier hs-var">pegasusEps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815572"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;model.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>                  </span><span class="annot"><span class="annottext">m (ShiftRight Int
   -&gt; ShiftRight Int
   -&gt; GPegasusModel
        (SequenceToSequenceTransformer
           'Pegasus
           transformerHead
           numLayers
           numLayers
           gradient
           device
           PegasusDataType
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           PegasusPosEncDim
           vocabDim))
-&gt; m (ShiftRight Int)
-&gt; m (ShiftRight Int
      -&gt; GPegasusModel
           (SequenceToSequenceTransformer
              'Pegasus
              transformerHead
              numLayers
              numLayers
              gradient
              device
              PegasusDataType
              headDim
              headEmbedDim
              embedDim
              inputEmbedDim
              ffnDim
              PegasusPosEncDim
              vocabDim))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModelSpec (ShiftRight Int) -&gt; StateDictKey -&gt; m (ShiftRight Int)
forall model (m :: * -&gt; *).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ShiftRight Int
forall fillValue. fillValue -&gt; ShiftRight fillValue
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-var">ShiftRight</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusBOSTokenId"><span class="hs-identifier hs-var">pegasusBOSTokenId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815572"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-178"></span><span>                  </span><span class="annot"><span class="annottext">m (ShiftRight Int
   -&gt; GPegasusModel
        (SequenceToSequenceTransformer
           'Pegasus
           transformerHead
           numLayers
           numLayers
           gradient
           device
           PegasusDataType
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           PegasusPosEncDim
           vocabDim))
-&gt; m (ShiftRight Int)
-&gt; m (GPegasusModel
        (SequenceToSequenceTransformer
           'Pegasus
           transformerHead
           numLayers
           numLayers
           gradient
           device
           PegasusDataType
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           PegasusPosEncDim
           vocabDim))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModelSpec (ShiftRight Int) -&gt; StateDictKey -&gt; m (ShiftRight Int)
forall model (m :: * -&gt; *).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ShiftRight Int
forall fillValue. fillValue -&gt; ShiftRight fillValue
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-var">ShiftRight</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815572"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-179"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621679815562"><span class="annot"><span class="annottext">toStateDict :: StateDictKey
-&gt; PegasusModel
     transformerHead
     numLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
-&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">toStateDict</span></a></span></span><span> </span><span id="local-6989586621679815560"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815560"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-type">GPegasusModel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679815557"><span id="local-6989586621679815558"><span id="local-6989586621679815559"><span class="annot"><span class="annottext">ShiftRight Int
SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
pegasusShiftRightPaddingMask :: ShiftRight Int
pegasusShiftRightDecoderInput :: ShiftRight Int
pegasusModel :: SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
pegasusShiftRightPaddingMask :: forall pegasusModel. GPegasusModel pegasusModel -&gt; ShiftRight Int
pegasusShiftRightDecoderInput :: forall pegasusModel. GPegasusModel pegasusModel -&gt; ShiftRight Int
pegasusModel :: forall pegasusModel. GPegasusModel pegasusModel -&gt; pegasusModel
</span><a href="#local-6989586621679815557"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey
-&gt; SequenceToSequenceTransformer
     'Pegasus
     transformerHead
     numLayers
     numLayers
     gradient
     device
     PegasusDataType
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     PegasusPosEncDim
     vocabDim
-&gt; m ()
forall model (m :: * -&gt; *).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815560"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;model.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
</span><a href="#local-6989586621679815559"><span class="hs-identifier hs-var">pegasusModel</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey -&gt; ShiftRight Int -&gt; m ()
forall model (m :: * -&gt; *).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815560"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679815558"><span class="hs-identifier hs-var">pegasusShiftRightDecoderInput</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey -&gt; ShiftRight Int -&gt; m ()
forall model (m :: * -&gt; *).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679815560"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679815557"><span class="hs-identifier hs-var">pegasusShiftRightPaddingMask</span></a></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusInput"><span class="hs-identifier hs-type">mkPegasusInput</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679815555"><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span></span><span> </span><span id="local-6989586621679815554"><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span></span><span> </span><span id="local-6989586621679815553"><span class="annot"><a href="#local-6989586621679815553"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679815552"><span class="annot"><a href="#local-6989586621679815552"><span class="hs-identifier hs-type">output</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815553"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetDim"><span class="hs-identifier hs-type">SGetDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetDim"><span class="hs-identifier hs-type">SGetDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span>
</span><span id="line-193"></span><span>              </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedSize"><span class="hs-identifier hs-type">UncheckedSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>                 </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedSize"><span class="hs-identifier hs-type">UncheckedSize</span></a></span><span>
</span><span id="line-195"></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>              </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-197"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621679815552"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-201"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithoutGradient"><span class="hs-identifier hs-type">WithoutGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815555"><span class="hs-identifier hs-type">batchDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815554"><span class="hs-identifier hs-type">seqDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="#local-6989586621679815553"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815552"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-211"></span><span id="mkPegasusInput"><span class="annot"><span class="annottext">mkPegasusInput :: SDim batchDim -&gt; SDim seqDim -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusInput"><span class="hs-identifier hs-var hs-var">mkPegasusInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDim batchDim -&gt; SDim seqDim -&gt; [[Int]] -&gt; m output
forall (batchDim :: Dim (Name Symbol) (Size Nat))
       (seqDim :: Dim (Name Symbol) (Size Nat)) (m :: * -&gt; *) output.
(MonadThrow m, SGetDim batchDim, SGetDim seqDim,
 'Shape '[batchDim, seqDim]
 ~ Seq
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) 'UncheckedSize,
           'Dim ('Name &quot;*&quot;) 'UncheckedSize]
      &lt;+&gt; 'Shape '[batchDim, seqDim])
     ('Shape '[batchDim, seqDim]),
 output
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape '[batchDim, seqDim])) =&gt;
Int -&gt; SDim batchDim -&gt; SDim seqDim -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerInput"><span class="hs-identifier hs-var">mkTransformerInput</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPadTokenId"><span class="hs-identifier hs-var">pegasusPadTokenId</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusPaddingMask"><span class="hs-identifier hs-type">mkPegasusPaddingMask</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679815842"><span class="annot"><a href="#local-6989586621679815842"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679815847"><span class="annot"><a href="#local-6989586621679815847"><span class="hs-identifier hs-type">layout</span></a></span></span><span> </span><span id="local-6989586621679815846"><span class="annot"><a href="#local-6989586621679815846"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679815845"><span class="annot"><a href="#local-6989586621679815845"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679815844"><span class="annot"><a href="#local-6989586621679815844"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span id="local-6989586621679815843"><span class="annot"><a href="#local-6989586621679815843"><span class="hs-identifier hs-type">output</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815847"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815846"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815845"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815844"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815843"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815842"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815847"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815846"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815845"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815844"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="#local-6989586621679815843"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-218"></span><span id="mkPegasusPaddingMask"><span class="annot"><span class="annottext">mkPegasusPaddingMask :: Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusPaddingMask"><span class="hs-identifier hs-var hs-var">mkPegasusPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Tensor gradient layout device dataType shape -&gt; output
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Int -&gt; Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerPaddingMask"><span class="hs-identifier hs-var">mkTransformerPaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusPadTokenId"><span class="hs-identifier hs-var">pegasusPadTokenId</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-keyword">data</span><span> </span><span id="PegasusInput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusInput"><span class="hs-identifier hs-var">PegasusInput</span></a></span></span><span> </span><span id="local-6989586621679815550"><span class="annot"><a href="#local-6989586621679815550"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679815549"><span class="annot"><a href="#local-6989586621679815549"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-221"></span><span>  </span><span id="PegasusInput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusInput"><span class="hs-identifier hs-var">PegasusInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679815849"><span class="annot"><a href="#local-6989586621679815849"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679815848"><span class="annot"><a href="#local-6989586621679815848"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pegasusInput"><span class="annot"><span class="annottext">PegasusInput input decoderInput -&gt; input
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusInput"><span class="hs-identifier hs-var hs-var">pegasusInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815849"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-224"></span><span>      </span><span id="pegasusDecoderInput"><span class="annot"><span class="annottext">PegasusInput input decoderInput -&gt; decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDecoderInput"><span class="hs-identifier hs-var hs-var">pegasusDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815848"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusInput"><span class="hs-identifier hs-type">PegasusInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815849"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815848"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span id="local-6989586621679815538"><span id="local-6989586621679815540"><span id="local-6989586621679815542"><span id="local-6989586621679815544"><span id="local-6989586621679815545"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815545"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815544"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusInput"><span class="hs-identifier hs-type">PegasusInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815545"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815544"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-keyword">data</span><span> </span><span id="PegasusOutput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-var">PegasusOutput</span></a></span></span><span> </span><span id="local-6989586621679815536"><span class="annot"><a href="#local-6989586621679815536"><span class="hs-identifier hs-type">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815535"><span class="annot"><a href="#local-6989586621679815535"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815534"><span class="annot"><a href="#local-6989586621679815534"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>  </span><span id="PegasusOutput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-var">PegasusOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679815730"><span class="annot"><a href="#local-6989586621679815730"><span class="hs-identifier hs-type">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815729"><span class="annot"><a href="#local-6989586621679815729"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815728"><span class="annot"><a href="#local-6989586621679815728"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pegasusDecoderOutput"><span class="annot"><span class="annottext">PegasusOutput decoderOutput encoderOutput inputPaddingMask
-&gt; decoderOutput
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDecoderOutput"><span class="hs-identifier hs-var hs-var">pegasusDecoderOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815730"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>      </span><span id="pegasusEncoderOutput"><span class="annot"><span class="annottext">PegasusOutput decoderOutput encoderOutput inputPaddingMask
-&gt; encoderOutput
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusEncoderOutput"><span class="hs-identifier hs-var hs-var">pegasusEncoderOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815729"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>      </span><span id="pegasusInputPaddingMask"><span class="annot"><span class="annottext">PegasusOutput decoderOutput encoderOutput inputPaddingMask
-&gt; inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusInputPaddingMask"><span class="hs-identifier hs-var hs-var">pegasusInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815728"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-type">PegasusOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815730"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815729"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815728"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span id="local-6989586621679815521"><span id="local-6989586621679815523"><span id="local-6989586621679815525"><span id="local-6989586621679815527"><span id="local-6989586621679815528"><span id="local-6989586621679815529"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815529"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815528"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815527"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-type">PegasusOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815529"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815528"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815527"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-keyword">data</span><span> </span><span id="PegasusGenerationInput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusGenerationInput"><span class="hs-identifier hs-var">PegasusGenerationInput</span></a></span></span><span> </span><span id="local-6989586621679815520"><span class="annot"><a href="#local-6989586621679815520"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span id="local-6989586621679815519"><span class="annot"><a href="#local-6989586621679815519"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815518"><span class="annot"><a href="#local-6989586621679815518"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>  </span><span id="PegasusGenerationInput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusGenerationInput"><span class="hs-identifier hs-var">PegasusGenerationInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679815677"><span class="annot"><a href="#local-6989586621679815677"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span id="local-6989586621679815676"><span class="annot"><a href="#local-6989586621679815676"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815675"><span class="annot"><a href="#local-6989586621679815675"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="pegasusGenerationDecoderInput"><span class="annot"><span class="annottext">PegasusGenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusGenerationDecoderInput"><span class="hs-identifier hs-var hs-var">pegasusGenerationDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815677"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-254"></span><span>      </span><span id="pegasusGenerationEncoderOutput"><span class="annot"><span class="annottext">PegasusGenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; encoderOutput
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusGenerationEncoderOutput"><span class="hs-identifier hs-var hs-var">pegasusGenerationEncoderOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815676"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-255"></span><span>      </span><span id="pegasusGenerationInputPaddingMask"><span class="annot"><span class="annottext">PegasusGenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusGenerationInputPaddingMask"><span class="hs-identifier hs-var hs-var">pegasusGenerationInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679815675"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusGenerationInput"><span class="hs-identifier hs-type">PegasusGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815677"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815676"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815675"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span id="local-6989586621679815505"><span id="local-6989586621679815507"><span id="local-6989586621679815509"><span id="local-6989586621679815511"><span id="local-6989586621679815512"><span id="local-6989586621679815513"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815513"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815512"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679815511"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusGenerationInput"><span class="hs-identifier hs-type">PegasusGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815513"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815512"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815511"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | 'HasForward' instance for Pegasus models.</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">-- Note that this instance always shifts decoder inputs to the right</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- by adding a BOS token at the beginning.</span><span>
</span><span id="line-270"></span><span id="local-6989586621679815447"><span id="local-6989586621679815448"><span id="local-6989586621679815449"><span id="local-6989586621679815450"><span id="local-6989586621679815451"><span id="local-6989586621679815452"><span id="local-6989586621679815453"><span id="local-6989586621679815454"><span id="local-6989586621679815455"><span id="local-6989586621679815456"><span id="local-6989586621679815457"><span id="local-6989586621679815458"><span id="local-6989586621679815459"><span id="local-6989586621679815460"><span id="local-6989586621679815461"><span id="local-6989586621679815462"><span id="local-6989586621679815463"><span id="local-6989586621679815464"><span id="local-6989586621679815465"><span id="local-6989586621679815466"><span id="local-6989586621679815467"><span id="local-6989586621679815468"><span id="local-6989586621679815469"><span id="local-6989586621679815470"><span id="local-6989586621679815471"><span id="local-6989586621679815472"><span id="local-6989586621679815473"><span id="local-6989586621679815474"><span id="local-6989586621679815475"><span id="local-6989586621679815476"><span id="local-6989586621679815477"><span id="local-6989586621679815478"><span id="local-6989586621679815479"><span id="local-6989586621679815480"><span id="local-6989586621679815481"><span id="local-6989586621679815482"><span id="local-6989586621679815483"><span id="local-6989586621679815484"><span id="local-6989586621679815485"><span id="local-6989586621679815486"><span id="local-6989586621679815487"><span id="local-6989586621679815488"><span id="local-6989586621679815489"><span id="local-6989586621679815490"><span id="local-6989586621679815491"><span id="local-6989586621679815492"><span id="local-6989586621679815493"><span id="local-6989586621679815494"><span id="local-6989586621679815495"><span id="local-6989586621679815496"><span id="local-6989586621679815497"><span id="local-6989586621679815498"><span id="local-6989586621679815499"><span id="local-6989586621679815500"><span id="local-6989586621679815501"><span id="local-6989586621679815502"><span id="local-6989586621679815503"><span id="local-6989586621679815504"><span class="hs-keyword">instance</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679815504"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815503"><span class="hs-identifier hs-type">inputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815502"><span class="hs-identifier hs-type">inputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815501"><span class="hs-identifier hs-type">inputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815500"><span class="hs-identifier hs-type">inputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815499"><span class="hs-identifier hs-type">inputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkPosC"><span class="hs-identifier hs-type">MkPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815501"><span class="hs-identifier hs-type">inputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815499"><span class="hs-identifier hs-type">inputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815498"><span class="hs-identifier hs-type">inputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815497"><span class="hs-identifier hs-type">inputSeqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815496"><span class="hs-identifier hs-type">inputSeqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815495"><span class="hs-identifier hs-type">pos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815502"><span class="hs-identifier hs-type">inputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815501"><span class="hs-identifier hs-type">inputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815500"><span class="hs-identifier hs-type">inputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815499"><span class="hs-identifier hs-type">inputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815494"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><a href="#local-6989586621679815494"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815493"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815492"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815491"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815490"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815489"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="#local-6989586621679815488"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815487"><span class="hs-identifier hs-type">decoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815486"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815485"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815484"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815483"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="#local-6989586621679815482"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815481"><span class="hs-identifier hs-type">rightShiftedDecoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815480"><span class="hs-identifier hs-type">rightShiftedDecoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815479"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815478"><span class="hs-identifier hs-type">rightShiftedDecoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815477"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkPosC"><span class="hs-identifier hs-type">MkPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815479"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815477"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815476"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815475"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815474"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815473"><span class="hs-identifier hs-type">decoderPos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815486"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815485"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815484"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815483"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815472"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><a href="#local-6989586621679815471"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815470"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815469"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815468"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815467"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815466"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815493"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815492"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815491"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815490"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815489"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815465"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815464"><span class="hs-identifier hs-type">attentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerCrossAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerCrossAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815477"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815476"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815493"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815492"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815491"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815490"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815489"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815465"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815463"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerDecoderAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerDecoderAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815469"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815468"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815466"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815462"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815461"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679815488"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815460"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815482"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815460"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679815472"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815460"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815471"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815460"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#Pegasus"><span class="hs-identifier hs-type">Pegasus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815459"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815458"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815458"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815457"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815456"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815455"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815454"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815453"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815452"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815451"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-type">PegasusPosEncDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815450"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815504"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815482"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815495"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815473"><span class="hs-identifier hs-type">decoderPos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815464"><span class="hs-identifier hs-type">attentionMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815461"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815463"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><a href="#local-6989586621679815460"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815449"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815448"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><a href="#local-6989586621679815447"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815459"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815458"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815457"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815456"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815455"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815454"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815453"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815452"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815451"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815450"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusInput"><span class="hs-identifier hs-type">PegasusInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815504"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815488"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><a href="#local-6989586621679815460"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-type">PegasusOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815449"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815448"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815494"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><a href="#local-6989586621679815447"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>  </span><span id="local-6989586621679815444"><span class="annot"><span class="annottext">forward :: PegasusModel
  transformerHead
  numLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; PegasusInput input decoderInput
-&gt; Generator generatorDevice
-&gt; m (PegasusOutput decoderOutput encoderOutput inputPaddingMask,
      Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-type">GPegasusModel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679815440"><span id="local-6989586621679815441"><span id="local-6989586621679815442"><span class="annot"><span class="annottext">ShiftRight Int
SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
pegasusShiftRightPaddingMask :: ShiftRight Int
pegasusShiftRightDecoderInput :: ShiftRight Int
pegasusModel :: SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
pegasusShiftRightPaddingMask :: forall pegasusModel. GPegasusModel pegasusModel -&gt; ShiftRight Int
pegasusShiftRightDecoderInput :: forall pegasusModel. GPegasusModel pegasusModel -&gt; ShiftRight Int
pegasusModel :: forall pegasusModel. GPegasusModel pegasusModel -&gt; pegasusModel
</span><a href="#local-6989586621679815440"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusInput"><span class="hs-identifier hs-type">PegasusInput</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679815438"><span id="local-6989586621679815439"><span class="annot"><span class="annottext">input
decoderInput
pegasusDecoderInput :: decoderInput
pegasusInput :: input
pegasusDecoderInput :: forall input decoderInput.
PegasusInput input decoderInput -&gt; decoderInput
pegasusInput :: forall input decoderInput. PegasusInput input decoderInput -&gt; input
</span><a href="#local-6989586621679815438"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679815437"><span class="annot"><span class="annottext">inputPaddingMask :: Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679815437"><span class="hs-identifier hs-var hs-var">inputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusPaddingMask"><span class="hs-identifier hs-var">mkPegasusPaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">input
Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
</span><a href="#local-6989586621679815439"><span class="hs-identifier hs-var">pegasusInput</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span id="local-6989586621679815436"><span class="annot"><span class="annottext">attentionMask :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815436"><span class="hs-identifier hs-var hs-var">attentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         PegasusDataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
               inputPaddingMaskSeqDim])))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                  inputPaddingMaskSeqDim]))))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDataType PegasusDataType
-&gt; Double
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerAttentionMaskC
   transformerDataType
   gradient
   layout
   device
   dataType
   shape
   seqDim
   output) =&gt;
SDataType transformerDataType
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerAttentionMask"><span class="hs-identifier hs-var">mkTransformerAttentionMask</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var">pegasusDataType</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-var">pegasusAttentionMaskBias</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679815437"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span id="local-6989586621679815435"><span class="annot"><span class="annottext">pos :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
</span><a href="#local-6989586621679815435"><span class="hs-identifier hs-var hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      inputDevice
      ('DataType 'Int64)
      ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         inputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
forall (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) (seqName :: Name Symbol)
       (seqSize :: Size Nat) output.
(MonadThrow m,
 MkPosC device shape seqDim seqName seqSize output) =&gt;
Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkPos"><span class="hs-identifier hs-var">mkPos</span></a></span><span> </span><span class="annot"><span class="annottext">input
Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
</span><a href="#local-6989586621679815439"><span class="hs-identifier hs-var">pegasusInput</span></a></span><span>
</span><span id="line-303"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorOutputDevice)
  (PegasusOutput
     decoderOutput
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        inputPaddingMaskLayout
        inputPaddingMaskDevice
        inputPaddingMaskDataType
        inputPaddingMaskShape))
-&gt; Generator generatorDevice
-&gt; m (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape),
      Generator generatorOutputDevice)
forall (m :: * -&gt; *) i j a. IxStateT m i j a -&gt; i -&gt; m (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">(IxStateT
   m
   (Generator generatorDevice)
   (Generator generatorOutputDevice)
   (PegasusOutput
      decoderOutput
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         inputPaddingMaskLayout
         inputPaddingMaskDevice
         inputPaddingMaskDataType
         inputPaddingMaskShape))
 -&gt; Generator generatorDevice
 -&gt; m (PegasusOutput
         decoderOutput
         encoderOutput
         (Tensor
            ('Gradient 'WithoutGradient)
            inputPaddingMaskLayout
            inputPaddingMaskDevice
            inputPaddingMaskDataType
            inputPaddingMaskShape),
       Generator generatorOutputDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
-&gt; Generator generatorDevice
-&gt; m (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape),
      Generator generatorOutputDevice)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">decoderInput
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     decoderInput
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679815438"><span class="hs-identifier hs-var">pegasusDecoderInput</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  decoderInput
-&gt; (decoderInput
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorDevice)
         (Tensor
            rightShiftedDecoderInputGradient
            rightShiftedDecoderInputLayout
            rightShiftedDecoderInputDevice
            rightShiftedDecoderInputDataType
            rightShiftedDecoderInputShape))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape,
       Generator generatorDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (Tensor
          rightShiftedDecoderInputGradient
          rightShiftedDecoderInputLayout
          rightShiftedDecoderInputDevice
          rightShiftedDecoderInputDataType
          rightShiftedDecoderInputShape,
        Generator generatorDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape))
-&gt; (decoderInput
    -&gt; Generator generatorDevice
    -&gt; m (Tensor
            rightShiftedDecoderInputGradient
            rightShiftedDecoderInputLayout
            rightShiftedDecoderInputDevice
            rightShiftedDecoderInputDataType
            rightShiftedDecoderInputShape,
          Generator generatorDevice))
-&gt; decoderInput
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; decoderInput
-&gt; Generator generatorDevice
-&gt; m (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape,
      Generator generatorDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679815441"><span class="hs-identifier hs-var">pegasusShiftRightDecoderInput</span></a></span><span>
</span><span id="line-306"></span><span>            </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape)
-&gt; (Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorOutputDevice)
         (PegasusOutput
            decoderOutput
            encoderOutput
            (Tensor
               ('Gradient 'WithoutGradient)
               inputPaddingMaskLayout
               inputPaddingMaskDevice
               inputPaddingMaskDataType
               inputPaddingMaskShape)))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679815431"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815431"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-307"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679815430"><span class="annot"><span class="annottext">decoderPos :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
</span><a href="#local-6989586621679815430"><span class="hs-identifier hs-var hs-var">decoderPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>                           </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) (seqName :: Name Symbol)
       (seqSize :: Size Nat) output.
(MonadThrow m,
 MkPosC device shape seqDim seqName seqSize output) =&gt;
Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkPos"><span class="hs-identifier hs-var">mkPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815431"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span>
</span><span id="line-309"></span><span>                         </span><span id="local-6989586621679815429"><span class="annot"><span class="annottext">crossAttentionMask :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815429"><span class="hs-identifier hs-var hs-var">crossAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>                           </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         PegasusDataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim])))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim]))))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-311"></span><span>                             </span><span class="annot"><span class="annottext">SDataType PegasusDataType
-&gt; SShape rightShiftedDecoderInputShape
-&gt; Double
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (decoderInputShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (decoderInputSeqDim :: Dim (Name Symbol) (Size Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerCrossAttentionMaskC
   transformerDataType
   decoderInputShape
   decoderInputSeqDim
   gradient
   layout
   device
   dataType
   shape
   seqDim
   output) =&gt;
SDataType transformerDataType
-&gt; SShape decoderInputShape
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerCrossAttentionMask"><span class="hs-identifier hs-var">mkTransformerCrossAttentionMask</span></a></span><span>
</span><span id="line-312"></span><span>                               </span><span class="annot"><span class="annottext">SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var">pegasusDataType</span></a></span><span>
</span><span id="line-313"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; SShape rightShiftedDecoderInputShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815431"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>                               </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-var">pegasusAttentionMaskBias</span></a></span><span>
</span><span id="line-315"></span><span>                               </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679815437"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span>
</span><span id="line-316"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
  (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
  (Seq
     (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
     ('DataType 'Bool))
  (BroadcastShapesF
     decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
        (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
        (Seq
           (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
           ('DataType 'Bool))
        (BroadcastShapesF
           decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusPaddingMask"><span class="hs-identifier hs-var">mkPegasusPaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
</span><a href="#local-6989586621679815438"><span class="hs-identifier hs-var">pegasusDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>                           </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorDevice)
         (Tensor
            rightShiftedDecoderInputPaddingMaskGradient
            rightShiftedDecoderInputPaddingMaskLayout
            rightShiftedDecoderInputPaddingMaskDevice
            rightShiftedDecoderInputPaddingMaskDataType
            rightShiftedDecoderInputPaddingMaskShape))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (Tensor
         rightShiftedDecoderInputPaddingMaskGradient
         rightShiftedDecoderInputPaddingMaskLayout
         rightShiftedDecoderInputPaddingMaskDevice
         rightShiftedDecoderInputPaddingMaskDataType
         rightShiftedDecoderInputPaddingMaskShape,
       Generator generatorDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (Tensor
          rightShiftedDecoderInputPaddingMaskGradient
          rightShiftedDecoderInputPaddingMaskLayout
          rightShiftedDecoderInputPaddingMaskDevice
          rightShiftedDecoderInputPaddingMaskDataType
          rightShiftedDecoderInputPaddingMaskShape,
        Generator generatorDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         rightShiftedDecoderInputPaddingMaskGradient
         rightShiftedDecoderInputPaddingMaskLayout
         rightShiftedDecoderInputPaddingMaskDevice
         rightShiftedDecoderInputPaddingMaskDataType
         rightShiftedDecoderInputPaddingMaskShape))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; Generator generatorDevice
    -&gt; m (Tensor
            rightShiftedDecoderInputPaddingMaskGradient
            rightShiftedDecoderInputPaddingMaskLayout
            rightShiftedDecoderInputPaddingMaskDevice
            rightShiftedDecoderInputPaddingMaskDataType
            rightShiftedDecoderInputPaddingMaskShape,
          Generator generatorDevice))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; Generator generatorDevice
-&gt; m (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape,
      Generator generatorDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679815440"><span class="hs-identifier hs-var">pegasusShiftRightPaddingMask</span></a></span><span>
</span><span id="line-318"></span><span>                           </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape)
-&gt; (Tensor
      rightShiftedDecoderInputPaddingMaskGradient
      rightShiftedDecoderInputPaddingMaskLayout
      rightShiftedDecoderInputPaddingMaskDevice
      rightShiftedDecoderInputPaddingMaskDataType
      rightShiftedDecoderInputPaddingMaskShape
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorDevice)
         (SequenceToSequenceTransformerInput
            input
            (Tensor
               rightShiftedDecoderInputGradient
               rightShiftedDecoderInputLayout
               rightShiftedDecoderInputDevice
               rightShiftedDecoderInputDataType
               rightShiftedDecoderInputShape)
            (Tensor
               ('Gradient 'WithoutGradient)
               ('Layout 'Dense)
               inputDevice
               ('DataType 'Int64)
               ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
            (Tensor
               ('Gradient 'WithoutGradient)
               ('Layout 'Dense)
               rightShiftedDecoderInputDevice
               ('DataType 'Int64)
               ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
               inputPaddingMaskDevice
               (Seq
                  (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                  PegasusDataType)
               (BroadcastShapesF
                  (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                        inputPaddingMaskSeqDim])))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify
                  (Layout LayoutType)
                  rightShiftedDecoderInputPaddingMaskLayout
                  ('Layout 'Dense))
               rightShiftedDecoderInputPaddingMaskDevice
               PegasusDataType
               (BroadcastShapesF
                  (BroadcastShapesF
                     ('Shape
                        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                           rightShiftedDecoderInputPaddingMaskSeqDim,
                           rightShiftedDecoderInputPaddingMaskSeqDim])
                     (UnsqueezeF
                        ('SelectDim ('ByIndex 1))
                        rightShiftedDecoderInputPaddingMaskShape))
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        rightShiftedDecoderInputPaddingMaskSeqDim,
                        rightShiftedDecoderInputPaddingMaskSeqDim])))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
               inputPaddingMaskDevice
               (Seq
                  (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                  PegasusDataType)
               (BroadcastShapesF
                  (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        'Dim
                          rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                        inputPaddingMaskSeqDim])))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679815428"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679815428"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>                                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679815427"><span class="annot"><span class="annottext">decoderAttentionMask :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815427"><span class="hs-identifier hs-var hs-var">decoderAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>                                          </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      PegasusDataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim])))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim]))))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-321"></span><span>                                            </span><span class="annot"><span class="annottext">SDataType PegasusDataType
-&gt; Double
-&gt; Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerDecoderAttentionMaskC
   transformerDataType layout device shape seqDim output) =&gt;
SDataType transformerDataType
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerDecoderAttentionMask"><span class="hs-identifier hs-var">mkTransformerDecoderAttentionMask</span></a></span><span>
</span><span id="line-322"></span><span>                                              </span><span class="annot"><span class="annottext">SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var">pegasusDataType</span></a></span><span>
</span><span id="line-323"></span><span>                                              </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-var">pegasusAttentionMaskBias</span></a></span><span>
</span><span id="line-324"></span><span>                                              </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679815428"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span><span>
</span><span id="line-325"></span><span>                                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">input
-&gt; Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
-&gt; SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall input decoderInput pos decoderPos attentionMask
       decoderAttentionMask crossAttentionMask.
input
-&gt; decoderInput
-&gt; pos
-&gt; decoderPos
-&gt; attentionMask
-&gt; decoderAttentionMask
-&gt; crossAttentionMask
-&gt; SequenceToSequenceTransformerInput
     input
     decoderInput
     pos
     decoderPos
     attentionMask
     decoderAttentionMask
     crossAttentionMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier hs-var">SequenceToSequenceTransformerInput</span></a></span><span>
</span><span id="line-326"></span><span>                                          </span><span class="annot"><span class="annottext">(input
 -&gt; Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      inputDevice
      ('DataType 'Int64)
      ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         PegasusDataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
               inputPaddingMaskSeqDim]))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      PegasusDataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim]))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         PegasusDataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim]))
 -&gt; SequenceToSequenceTransformerInput
      input
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         inputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                  inputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m (Generator generatorDevice) (Generator generatorDevice) input
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerInput
           input
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              inputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                       inputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 k2 (f :: k1 -&gt; k2 -&gt; * -&gt; *) a b (j :: k1) (k3 :: k2).
IxFunctor f =&gt;
(a -&gt; b) -&gt; f j k3 a -&gt; f j k3 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">input
-&gt; IxStateT
     m (Generator generatorDevice) (Generator generatorDevice) input
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679815439"><span class="hs-identifier hs-var">pegasusInput</span></a></span><span>
</span><span id="line-327"></span><span>                                          </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerInput
           input
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              inputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                       inputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815431"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span>
</span><span id="line-328"></span><span>                                          </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerInput
           input
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              inputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                       inputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
</span><a href="#local-6989586621679815435"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-329"></span><span>                                          </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerInput
           input
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              inputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                       inputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
</span><a href="#local-6989586621679815430"><span class="hs-identifier hs-var">decoderPos</span></a></span><span>
</span><span id="line-330"></span><span>                                          </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerInput
           input
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              inputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                       inputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815436"><span class="hs-identifier hs-var">attentionMask</span></a></span><span>
</span><span id="line-331"></span><span>                                          </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerInput
           input
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              inputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                       inputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815427"><span class="hs-identifier hs-var">decoderAttentionMask</span></a></span><span>
</span><span id="line-332"></span><span>                                          </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815429"><span class="hs-identifier hs-var">crossAttentionMask</span></a></span><span>
</span><span id="line-333"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>                           </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))))
-&gt; (SequenceToSequenceTransformerInput
      input
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         inputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                  inputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorOutputDevice)
         (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (SequenceToSequenceTransformerOutput
         decoderOutput encoderOutput,
       Generator generatorOutputDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (SequenceToSequenceTransformerOutput
          decoderOutput encoderOutput,
        Generator generatorOutputDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorOutputDevice)
      (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; (SequenceToSequenceTransformerInput
      input
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         inputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                  inputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; Generator generatorDevice
    -&gt; m (SequenceToSequenceTransformerOutput
            decoderOutput encoderOutput,
          Generator generatorOutputDevice))
-&gt; SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
-&gt; SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; Generator generatorDevice
-&gt; m (SequenceToSequenceTransformerOutput
        decoderOutput encoderOutput,
      Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
</span><a href="#local-6989586621679815442"><span class="hs-identifier hs-var">pegasusModel</span></a></span><span>
</span><span id="line-335"></span><span>                           </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorOutputDevice)
  (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
-&gt; (SequenceToSequenceTransformerOutput decoderOutput encoderOutput
    -&gt; IxStateT
         m
         (Generator generatorOutputDevice)
         (Generator generatorOutputDevice)
         (PegasusOutput
            decoderOutput
            encoderOutput
            (Tensor
               ('Gradient 'WithoutGradient)
               inputPaddingMaskLayout
               inputPaddingMaskDevice
               inputPaddingMaskDataType
               inputPaddingMaskShape)))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span id="local-6989586621679815424"><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679815424"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815423"><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679815423"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-336"></span><span>                                    </span><span class="annot"><span class="annottext">PegasusOutput
  decoderOutput
  encoderOutput
  (Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape)
-&gt; IxStateT
     m
     (Generator generatorOutputDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(PegasusOutput
   decoderOutput
   encoderOutput
   (Tensor
      ('Gradient 'WithoutGradient)
      inputPaddingMaskLayout
      inputPaddingMaskDevice
      inputPaddingMaskDataType
      inputPaddingMaskShape)
 -&gt; IxStateT
      m
      (Generator generatorOutputDevice)
      (Generator generatorOutputDevice)
      (PegasusOutput
         decoderOutput
         encoderOutput
         (Tensor
            ('Gradient 'WithoutGradient)
            inputPaddingMaskLayout
            inputPaddingMaskDevice
            inputPaddingMaskDataType
            inputPaddingMaskShape)))
-&gt; PegasusOutput
     decoderOutput
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        inputPaddingMaskLayout
        inputPaddingMaskDevice
        inputPaddingMaskDataType
        inputPaddingMaskShape)
-&gt; IxStateT
     m
     (Generator generatorOutputDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">decoderOutput
-&gt; encoderOutput
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; PegasusOutput
     decoderOutput
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        inputPaddingMaskLayout
        inputPaddingMaskDevice
        inputPaddingMaskDataType
        inputPaddingMaskShape)
forall decoderOutput encoderOutput inputPaddingMask.
decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; PegasusOutput decoderOutput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-var">PegasusOutput</span></a></span><span> </span><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679815424"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679815423"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679815437"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span>
</span><span id="line-337"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                 </span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">-- | 'HasForward' instance for Pegasus models.</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- Use this instance for sequence generation once the encoder's output is available.</span><span>
</span><span id="line-342"></span><span class="hs-comment">--</span><span>
</span><span id="line-343"></span><span class="hs-comment">-- Note that this instance always shifts decoder inputs to the right</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- by adding a BOS token at the beginning.</span><span>
</span><span id="line-345"></span><span id="local-6989586621679815375"><span id="local-6989586621679815376"><span id="local-6989586621679815377"><span id="local-6989586621679815378"><span id="local-6989586621679815379"><span id="local-6989586621679815380"><span id="local-6989586621679815381"><span id="local-6989586621679815382"><span id="local-6989586621679815383"><span id="local-6989586621679815384"><span id="local-6989586621679815385"><span id="local-6989586621679815386"><span id="local-6989586621679815387"><span id="local-6989586621679815388"><span id="local-6989586621679815389"><span id="local-6989586621679815390"><span id="local-6989586621679815391"><span id="local-6989586621679815392"><span id="local-6989586621679815393"><span id="local-6989586621679815394"><span id="local-6989586621679815395"><span id="local-6989586621679815396"><span id="local-6989586621679815397"><span id="local-6989586621679815398"><span id="local-6989586621679815399"><span id="local-6989586621679815400"><span id="local-6989586621679815401"><span id="local-6989586621679815402"><span id="local-6989586621679815403"><span id="local-6989586621679815404"><span id="local-6989586621679815405"><span id="local-6989586621679815406"><span id="local-6989586621679815407"><span id="local-6989586621679815408"><span id="local-6989586621679815409"><span id="local-6989586621679815410"><span id="local-6989586621679815411"><span id="local-6989586621679815412"><span id="local-6989586621679815413"><span id="local-6989586621679815414"><span id="local-6989586621679815415"><span id="local-6989586621679815416"><span id="local-6989586621679815417"><span id="local-6989586621679815418"><span id="local-6989586621679815419"><span id="local-6989586621679815420"><span id="local-6989586621679815421"><span id="local-6989586621679815422"><span class="hs-keyword">instance</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679815422"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815421"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815420"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815419"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815418"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815417"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><a href="#local-6989586621679815416"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815415"><span class="hs-identifier hs-type">decoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815414"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815413"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815412"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815411"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><a href="#local-6989586621679815410"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815409"><span class="hs-identifier hs-type">rightShiftedDecoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815408"><span class="hs-identifier hs-type">rightShiftedDecoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815407"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815406"><span class="hs-identifier hs-type">rightShiftedDecoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815405"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkPosC"><span class="hs-identifier hs-type">MkPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815407"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815405"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815404"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815403"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815402"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815401"><span class="hs-identifier hs-type">decoderPos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815414"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815413"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815412"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815411"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815400"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><a href="#local-6989586621679815399"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815398"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815397"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815396"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815395"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815394"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815421"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815420"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815419"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815418"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815417"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815393"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815392"><span class="hs-identifier hs-type">attentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerCrossAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerCrossAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815405"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815404"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815421"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815420"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815419"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815418"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815417"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815393"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815391"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerDecoderAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerDecoderAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815397"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815396"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815394"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815390"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815389"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679815416"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815388"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815410"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815388"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679815400"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815388"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815399"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815388"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#Pegasus"><span class="hs-identifier hs-type">Pegasus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815387"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815386"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815386"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815385"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815384"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusDataType"><span class="hs-identifier hs-type">PegasusDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815383"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815382"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815381"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815380"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815379"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusPosEncDim"><span class="hs-identifier hs-type">PegasusPosEncDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815378"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerGenerationInput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815410"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815377"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815401"><span class="hs-identifier hs-type">decoderPos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815389"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815391"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><a href="#local-6989586621679815388"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815376"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815377"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><a href="#local-6989586621679815375"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815387"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815386"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815385"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815384"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815383"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815382"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815381"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815380"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815379"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815378"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusGenerationInput"><span class="hs-identifier hs-type">PegasusGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815416"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815377"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815422"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><a href="#local-6989586621679815388"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-type">PegasusOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815376"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815377"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679815422"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><a href="#local-6989586621679815375"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>  </span><span id="local-6989586621679815373"><span class="annot"><span class="annottext">forward :: PegasusModel
  transformerHead
  numLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; PegasusGenerationInput
     decoderInput encoderOutput inputPaddingMask
-&gt; Generator generatorDevice
-&gt; m (PegasusOutput decoderOutput encoderOutput inputPaddingMask,
      Generator generatorOutputDevice)
</span><a href="#local-6989586621679815373"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusModel"><span class="hs-identifier hs-type">PegasusModel</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#GPegasusModel"><span class="hs-identifier hs-type">GPegasusModel</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679815370"><span id="local-6989586621679815371"><span id="local-6989586621679815372"><span class="annot"><span class="annottext">ShiftRight Int
SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
pegasusShiftRightPaddingMask :: ShiftRight Int
pegasusShiftRightDecoderInput :: ShiftRight Int
pegasusModel :: SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
pegasusShiftRightPaddingMask :: forall pegasusModel. GPegasusModel pegasusModel -&gt; ShiftRight Int
pegasusShiftRightDecoderInput :: forall pegasusModel. GPegasusModel pegasusModel -&gt; ShiftRight Int
pegasusModel :: forall pegasusModel. GPegasusModel pegasusModel -&gt; pegasusModel
</span><a href="#local-6989586621679815370"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusGenerationInput"><span class="hs-identifier hs-type">PegasusGenerationInput</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679815367"><span id="local-6989586621679815368"><span id="local-6989586621679815369"><span class="annot"><span class="annottext">inputPaddingMask
decoderInput
encoderOutput
pegasusGenerationInputPaddingMask :: inputPaddingMask
pegasusGenerationEncoderOutput :: encoderOutput
pegasusGenerationDecoderInput :: decoderInput
pegasusGenerationInputPaddingMask :: forall decoderInput encoderOutput inputPaddingMask.
PegasusGenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; inputPaddingMask
pegasusGenerationEncoderOutput :: forall decoderInput encoderOutput inputPaddingMask.
PegasusGenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; encoderOutput
pegasusGenerationDecoderInput :: forall decoderInput encoderOutput inputPaddingMask.
PegasusGenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; decoderInput
</span><a href="#local-6989586621679815367"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorOutputDevice)
  (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
-&gt; Generator generatorDevice
-&gt; m (PegasusOutput decoderOutput encoderOutput inputPaddingMask,
      Generator generatorOutputDevice)
forall (m :: * -&gt; *) i j a. IxStateT m i j a -&gt; i -&gt; m (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">(IxStateT
   m
   (Generator generatorDevice)
   (Generator generatorOutputDevice)
   (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
 -&gt; Generator generatorDevice
 -&gt; m (PegasusOutput decoderOutput encoderOutput inputPaddingMask,
       Generator generatorOutputDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
-&gt; Generator generatorDevice
-&gt; m (PegasusOutput decoderOutput encoderOutput inputPaddingMask,
      Generator generatorOutputDevice)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="annottext">decoderInput
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     decoderInput
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679815369"><span class="hs-identifier hs-var">pegasusGenerationDecoderInput</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  decoderInput
-&gt; (decoderInput
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorDevice)
         (Tensor
            rightShiftedDecoderInputGradient
            rightShiftedDecoderInputLayout
            rightShiftedDecoderInputDevice
            rightShiftedDecoderInputDataType
            rightShiftedDecoderInputShape))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape,
       Generator generatorDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (Tensor
          rightShiftedDecoderInputGradient
          rightShiftedDecoderInputLayout
          rightShiftedDecoderInputDevice
          rightShiftedDecoderInputDataType
          rightShiftedDecoderInputShape,
        Generator generatorDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape))
-&gt; (decoderInput
    -&gt; Generator generatorDevice
    -&gt; m (Tensor
            rightShiftedDecoderInputGradient
            rightShiftedDecoderInputLayout
            rightShiftedDecoderInputDevice
            rightShiftedDecoderInputDataType
            rightShiftedDecoderInputShape,
          Generator generatorDevice))
-&gt; decoderInput
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; decoderInput
-&gt; Generator generatorDevice
-&gt; m (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape,
      Generator generatorDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679815371"><span class="hs-identifier hs-var">pegasusShiftRightDecoderInput</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape)
-&gt; (Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorOutputDevice)
         (PegasusOutput decoderOutput encoderOutput inputPaddingMask))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679815366"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815366"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-376"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679815365"><span class="annot"><span class="annottext">decoderPos :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
</span><a href="#local-6989586621679815365"><span class="hs-identifier hs-var hs-var">decoderPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>                       </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) (seqName :: Name Symbol)
       (seqSize :: Size Nat) output.
(MonadThrow m,
 MkPosC device shape seqDim seqName seqSize output) =&gt;
Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkPos"><span class="hs-identifier hs-var">mkPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815366"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span>
</span><span id="line-378"></span><span>                     </span><span id="local-6989586621679815364"><span class="annot"><span class="annottext">crossAttentionMask :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815364"><span class="hs-identifier hs-var hs-var">crossAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>                       </span><span class="annot"><span class="annottext">m (Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      (Seq
         (Unify
            (Gradient RequiresGradient)
            inputPaddingMaskGradient
            ('Gradient 'WithoutGradient))
         ('Gradient 'WithoutGradient))
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         PegasusDataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim])))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         (Seq
            (Unify
               (Gradient RequiresGradient)
               inputPaddingMaskGradient
               ('Gradient 'WithoutGradient))
            ('Gradient 'WithoutGradient))
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim]))))
-&gt; m (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-380"></span><span>                         </span><span class="annot"><span class="annottext">SDataType PegasusDataType
-&gt; SShape rightShiftedDecoderInputShape
-&gt; Double
-&gt; Tensor
     inputPaddingMaskGradient
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; m (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (decoderInputShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (decoderInputSeqDim :: Dim (Name Symbol) (Size Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerCrossAttentionMaskC
   transformerDataType
   decoderInputShape
   decoderInputSeqDim
   gradient
   layout
   device
   dataType
   shape
   seqDim
   output) =&gt;
SDataType transformerDataType
-&gt; SShape decoderInputShape
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerCrossAttentionMask"><span class="hs-identifier hs-var">mkTransformerCrossAttentionMask</span></a></span><span>
</span><span id="line-381"></span><span>                           </span><span class="annot"><span class="annottext">SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var">pegasusDataType</span></a></span><span>
</span><span id="line-382"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; SShape rightShiftedDecoderInputShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815366"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                           </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-var">pegasusAttentionMaskBias</span></a></span><span>
</span><span id="line-384"></span><span>                           </span><span class="annot"><span class="annottext">inputPaddingMask
Tensor
  inputPaddingMaskGradient
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679815367"><span class="hs-identifier hs-var">pegasusGenerationInputPaddingMask</span></a></span><span>
</span><span id="line-385"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
  (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
  (Seq
     (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
     ('DataType 'Bool))
  (BroadcastShapesF
     decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
        (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
        (Seq
           (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
           ('DataType 'Bool))
        (BroadcastShapesF
           decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#mkPegasusPaddingMask"><span class="hs-identifier hs-var">mkPegasusPaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
</span><a href="#local-6989586621679815369"><span class="hs-identifier hs-var">pegasusGenerationDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>                       </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorDevice)
         (Tensor
            rightShiftedDecoderInputPaddingMaskGradient
            rightShiftedDecoderInputPaddingMaskLayout
            rightShiftedDecoderInputPaddingMaskDevice
            rightShiftedDecoderInputPaddingMaskDataType
            rightShiftedDecoderInputPaddingMaskShape))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (Tensor
         rightShiftedDecoderInputPaddingMaskGradient
         rightShiftedDecoderInputPaddingMaskLayout
         rightShiftedDecoderInputPaddingMaskDevice
         rightShiftedDecoderInputPaddingMaskDataType
         rightShiftedDecoderInputPaddingMaskShape,
       Generator generatorDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (Tensor
          rightShiftedDecoderInputPaddingMaskGradient
          rightShiftedDecoderInputPaddingMaskLayout
          rightShiftedDecoderInputPaddingMaskDevice
          rightShiftedDecoderInputPaddingMaskDataType
          rightShiftedDecoderInputPaddingMaskShape,
        Generator generatorDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         rightShiftedDecoderInputPaddingMaskGradient
         rightShiftedDecoderInputPaddingMaskLayout
         rightShiftedDecoderInputPaddingMaskDevice
         rightShiftedDecoderInputPaddingMaskDataType
         rightShiftedDecoderInputPaddingMaskShape))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; Generator generatorDevice
    -&gt; m (Tensor
            rightShiftedDecoderInputPaddingMaskGradient
            rightShiftedDecoderInputPaddingMaskLayout
            rightShiftedDecoderInputPaddingMaskDevice
            rightShiftedDecoderInputPaddingMaskDataType
            rightShiftedDecoderInputPaddingMaskShape,
          Generator generatorDevice))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; Generator generatorDevice
-&gt; m (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape,
      Generator generatorDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679815370"><span class="hs-identifier hs-var">pegasusShiftRightPaddingMask</span></a></span><span>
</span><span id="line-387"></span><span>                       </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape)
-&gt; (Tensor
      rightShiftedDecoderInputPaddingMaskGradient
      rightShiftedDecoderInputPaddingMaskLayout
      rightShiftedDecoderInputPaddingMaskDevice
      rightShiftedDecoderInputPaddingMaskDataType
      rightShiftedDecoderInputPaddingMaskShape
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorDevice)
         (SequenceToSequenceTransformerGenerationInput
            (Tensor
               rightShiftedDecoderInputGradient
               rightShiftedDecoderInputLayout
               rightShiftedDecoderInputDevice
               rightShiftedDecoderInputDataType
               rightShiftedDecoderInputShape)
            encoderOutput
            (Tensor
               ('Gradient 'WithoutGradient)
               ('Layout 'Dense)
               rightShiftedDecoderInputDevice
               ('DataType 'Int64)
               ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify
                  (Layout LayoutType)
                  rightShiftedDecoderInputPaddingMaskLayout
                  ('Layout 'Dense))
               rightShiftedDecoderInputPaddingMaskDevice
               PegasusDataType
               (BroadcastShapesF
                  (BroadcastShapesF
                     ('Shape
                        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                           rightShiftedDecoderInputPaddingMaskSeqDim,
                           rightShiftedDecoderInputPaddingMaskSeqDim])
                     (UnsqueezeF
                        ('SelectDim ('ByIndex 1))
                        rightShiftedDecoderInputPaddingMaskShape))
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        rightShiftedDecoderInputPaddingMaskSeqDim,
                        rightShiftedDecoderInputPaddingMaskSeqDim])))
            (Tensor
               (Seq
                  (Unify
                     (Gradient RequiresGradient)
                     inputPaddingMaskGradient
                     ('Gradient 'WithoutGradient))
                  ('Gradient 'WithoutGradient))
               (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
               inputPaddingMaskDevice
               (Seq
                  (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                  PegasusDataType)
               (BroadcastShapesF
                  (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        'Dim
                          rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                        inputPaddingMaskSeqDim])))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679815363"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679815363"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679815362"><span class="annot"><span class="annottext">decoderAttentionMask :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815362"><span class="hs-identifier hs-var hs-var">decoderAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-389"></span><span>                                      </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall k (t :: (* -&gt; *) -&gt; k -&gt; k -&gt; * -&gt; *) (m :: * -&gt; *) a
       (i :: k).
(IxMonadTrans t, Monad m) =&gt;
m a -&gt; t m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ilift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      PegasusDataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim])))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim]))))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-390"></span><span>                                        </span><span class="annot"><span class="annottext">SDataType PegasusDataType
-&gt; Double
-&gt; Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerDecoderAttentionMaskC
   transformerDataType layout device shape seqDim output) =&gt;
SDataType transformerDataType
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerDecoderAttentionMask"><span class="hs-identifier hs-var">mkTransformerDecoderAttentionMask</span></a></span><span>
</span><span id="line-391"></span><span>                                          </span><span class="annot"><span class="annottext">SDataType PegasusDataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusDataType"><span class="hs-identifier hs-var">pegasusDataType</span></a></span><span>
</span><span id="line-392"></span><span>                                          </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#pegasusAttentionMaskBias"><span class="hs-identifier hs-var">pegasusAttentionMaskBias</span></a></span><span>
</span><span id="line-393"></span><span>                                          </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679815363"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span><span>
</span><span id="line-394"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; encoderOutput
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
-&gt; Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
-&gt; SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall decoderInput encoderOutput decoderPos decoderAttentionMask
       crossAttentionMask.
decoderInput
-&gt; encoderOutput
-&gt; decoderPos
-&gt; decoderAttentionMask
-&gt; crossAttentionMask
-&gt; SequenceToSequenceTransformerGenerationInput
     decoderInput
     encoderOutput
     decoderPos
     decoderAttentionMask
     crossAttentionMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerGenerationInput"><span class="hs-identifier hs-var">SequenceToSequenceTransformerGenerationInput</span></a></span><span>
</span><span id="line-395"></span><span>                                      </span><span class="annot"><span class="annottext">(Tensor
   rightShiftedDecoderInputGradient
   rightShiftedDecoderInputLayout
   rightShiftedDecoderInputDevice
   rightShiftedDecoderInputDataType
   rightShiftedDecoderInputShape
 -&gt; encoderOutput
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      PegasusDataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim]))
 -&gt; Tensor
      (Seq
         (Unify
            (Gradient RequiresGradient)
            inputPaddingMaskGradient
            ('Gradient 'WithoutGradient))
         ('Gradient 'WithoutGradient))
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         PegasusDataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim]))
 -&gt; SequenceToSequenceTransformerGenerationInput
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         (Seq
            (Unify
               (Gradient RequiresGradient)
               inputPaddingMaskGradient
               ('Gradient 'WithoutGradient))
            ('Gradient 'WithoutGradient))
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (encoderOutput
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerGenerationInput
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           encoderOutput
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              (Seq
                 (Unify
                    (Gradient RequiresGradient)
                    inputPaddingMaskGradient
                    ('Gradient 'WithoutGradient))
                 ('Gradient 'WithoutGradient))
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 k2 (f :: k1 -&gt; k2 -&gt; * -&gt; *) a b (j :: k1) (k3 :: k2).
IxFunctor f =&gt;
(a -&gt; b) -&gt; f j k3 a -&gt; f j k3 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679815366"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span>
</span><span id="line-396"></span><span>                                      </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (encoderOutput
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     encoderOutput
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
      -&gt; Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerGenerationInput
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           encoderOutput
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              (Seq
                 (Unify
                    (Gradient RequiresGradient)
                    inputPaddingMaskGradient
                    ('Gradient 'WithoutGradient))
                 ('Gradient 'WithoutGradient))
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     encoderOutput
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679815368"><span class="hs-identifier hs-var">pegasusGenerationEncoderOutput</span></a></span><span>
</span><span id="line-397"></span><span>                                      </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
   -&gt; Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim]))
      -&gt; Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerGenerationInput
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           encoderOutput
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              (Seq
                 (Unify
                    (Gradient RequiresGradient)
                    inputPaddingMaskGradient
                    ('Gradient 'WithoutGradient))
                 ('Gradient 'WithoutGradient))
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
</span><a href="#local-6989586621679815365"><span class="hs-identifier hs-var">decoderPos</span></a></span><span>
</span><span id="line-398"></span><span>                                      </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
   -&gt; Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))
      -&gt; SequenceToSequenceTransformerGenerationInput
           (Tensor
              rightShiftedDecoderInputGradient
              rightShiftedDecoderInputLayout
              rightShiftedDecoderInputDevice
              rightShiftedDecoderInputDataType
              rightShiftedDecoderInputShape)
           encoderOutput
           (Tensor
              ('Gradient 'WithoutGradient)
              ('Layout 'Dense)
              rightShiftedDecoderInputDevice
              ('DataType 'Int64)
              ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
           (Tensor
              ('Gradient 'WithoutGradient)
              (Unify
                 (Layout LayoutType)
                 rightShiftedDecoderInputPaddingMaskLayout
                 ('Layout 'Dense))
              rightShiftedDecoderInputPaddingMaskDevice
              PegasusDataType
              (BroadcastShapesF
                 (BroadcastShapesF
                    ('Shape
                       '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                          rightShiftedDecoderInputPaddingMaskSeqDim,
                          rightShiftedDecoderInputPaddingMaskSeqDim])
                    (UnsqueezeF
                       ('SelectDim ('ByIndex 1))
                       rightShiftedDecoderInputPaddingMaskShape))
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])))
           (Tensor
              (Seq
                 (Unify
                    (Gradient RequiresGradient)
                    inputPaddingMaskGradient
                    ('Gradient 'WithoutGradient))
                 ('Gradient 'WithoutGradient))
              (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
              inputPaddingMaskDevice
              (Seq
                 (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                 PegasusDataType)
              (BroadcastShapesF
                 (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       'Dim
                         rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                       inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     PegasusDataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815362"><span class="hs-identifier hs-var">decoderAttentionMask</span></a></span><span>
</span><span id="line-399"></span><span>                                      </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
   -&gt; SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           PegasusDataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              PegasusDataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k1 (f :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        PegasusDataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
</span><a href="#local-6989586621679815364"><span class="hs-identifier hs-var">crossAttentionMask</span></a></span><span>
</span><span id="line-400"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>                       </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))))
-&gt; (SequenceToSequenceTransformerGenerationInput
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         (Seq
            (Unify
               (Gradient RequiresGradient)
               inputPaddingMaskGradient
               ('Gradient 'WithoutGradient))
            ('Gradient 'WithoutGradient))
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; IxStateT
         m
         (Generator generatorDevice)
         (Generator generatorOutputDevice)
         (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (SequenceToSequenceTransformerOutput
         decoderOutput encoderOutput,
       Generator generatorOutputDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (SequenceToSequenceTransformerOutput
          decoderOutput encoderOutput,
        Generator generatorOutputDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorOutputDevice)
      (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; (SequenceToSequenceTransformerGenerationInput
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         PegasusDataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         (Seq
            (Unify
               (Gradient RequiresGradient)
               inputPaddingMaskGradient
               ('Gradient 'WithoutGradient))
            ('Gradient 'WithoutGradient))
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            PegasusDataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; Generator generatorDevice
    -&gt; m (SequenceToSequenceTransformerOutput
            decoderOutput encoderOutput,
          Generator generatorOutputDevice))
-&gt; SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
-&gt; SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape '[ 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        PegasusDataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           PegasusDataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; Generator generatorDevice
-&gt; m (SequenceToSequenceTransformerOutput
        decoderOutput encoderOutput,
      Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'Pegasus
  transformerHead
  numLayers
  numLayers
  gradient
  device
  PegasusDataType
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  PegasusPosEncDim
  vocabDim
</span><a href="#local-6989586621679815372"><span class="hs-identifier hs-var">pegasusModel</span></a></span><span>
</span><span id="line-402"></span><span>                       </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorOutputDevice)
  (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
-&gt; (SequenceToSequenceTransformerOutput decoderOutput encoderOutput
    -&gt; IxStateT
         m
         (Generator generatorOutputDevice)
         (Generator generatorOutputDevice)
         (PegasusOutput decoderOutput encoderOutput inputPaddingMask))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span id="local-6989586621679815360"><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679815360"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679815359"><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679815359"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>                                </span><span class="annot"><span class="annottext">PegasusOutput decoderOutput encoderOutput inputPaddingMask
-&gt; IxStateT
     m
     (Generator generatorOutputDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(PegasusOutput decoderOutput encoderOutput inputPaddingMask
 -&gt; IxStateT
      m
      (Generator generatorOutputDevice)
      (Generator generatorOutputDevice)
      (PegasusOutput decoderOutput encoderOutput inputPaddingMask))
-&gt; PegasusOutput decoderOutput encoderOutput inputPaddingMask
-&gt; IxStateT
     m
     (Generator generatorOutputDevice)
     (Generator generatorOutputDevice)
     (PegasusOutput decoderOutput encoderOutput inputPaddingMask)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; PegasusOutput decoderOutput encoderOutput inputPaddingMask
forall decoderOutput encoderOutput inputPaddingMask.
decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; PegasusOutput decoderOutput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.Pegasus.Common.html#PegasusOutput"><span class="hs-identifier hs-var">PegasusOutput</span></a></span><span> </span><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679815360"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679815359"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679815367"><span class="hs-identifier hs-var">pegasusGenerationInputPaddingMask</span></a></span><span>
</span><span id="line-404"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>             </span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-406"></span></pre></body></html>
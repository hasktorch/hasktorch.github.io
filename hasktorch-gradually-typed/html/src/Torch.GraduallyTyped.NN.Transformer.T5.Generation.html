<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_I7bnnp04tXT5jlRN0Xnxae"></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# OPTIONS_GHC -v2 -Wno-partial-type-signatures #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.T5.Generation</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Alternative</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadPlus</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">MonadThrow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/046mbhpbxs17y8f6rznrw22fzgsmw1rq-logict-lib-logict-0.7.0.3-haddock-doc/share/doc/logict/html/src"><span class="hs-identifier">Control.Monad.Logic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/046mbhpbxs17y8f6rznrw22fzgsmw1rq-logict-lib-logict-0.7.0.3-haddock-doc/share/doc/logict/html/src"><span class="hs-identifier">observe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadTrans</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier">Control.Monad.Trans.Free</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier">FreeF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier">FreeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier">runFreeT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">asum</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isInfixOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uncons</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">Text.Parser.Char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">CharParsing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">spaces</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">Text.Parser.Combinators</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">Parsing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">between</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">manyTill</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">Text.Parser.Token</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier">TokenParsing</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html"><span class="hs-identifier">Torch.Data.Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier">Parser</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#combine"><span class="hs-identifier">combine</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#isNotToken"><span class="hs-identifier">isNotToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier">isString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#isToken"><span class="hs-identifier">isToken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#parseString"><span class="hs-identifier">parseString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#recurse"><span class="hs-identifier">recurse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#satisfy"><span class="hs-identifier">satisfy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#scan"><span class="hs-identifier">scan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#token"><span class="hs-identifier">token</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DType"><span class="hs-identifier">DType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier">DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html"><span class="hs-identifier">Torch.GraduallyTyped.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier">DeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier">SDevice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDeviceType"><span class="hs-identifier">SDeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html"><span class="hs-identifier">Torch.GraduallyTyped.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier">Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#LayoutType"><span class="hs-identifier">LayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier">HasInitialize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier">fromStateDict</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#stateDictFromFile"><span class="hs-identifier">stateDictFromFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Functional.NonLinearActivation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#logSoftmax"><span class="hs-identifier">logSoftmax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.T5.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier">T5DataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5Input"><span class="hs-identifier">mkT5Input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5EOSTokenId"><span class="hs-identifier">t5EOSTokenId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Small.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.T5.Small</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Small.html#T5Small"><span class="hs-identifier">T5Small</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Small.html#t5SmallSpec"><span class="hs-identifier">t5SmallSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier">TransformerHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#WithLMHead"><span class="hs-identifier">WithLMHead</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerHead"><span class="hs-identifier">STransformerHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SWithLMHead"><span class="hs-identifier">SWithLMHead</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html"><span class="hs-identifier">Torch.GraduallyTyped.Random</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier">Generator</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier">sMkGenerator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html"><span class="hs-identifier">Torch.GraduallyTyped.RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier">Gradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier">RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier">SGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SRequiresGradient"><span class="hs-identifier">SRequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#BroadcastShapesF"><span class="hs-identifier">BroadcastShapesF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#By"><span class="hs-identifier">By</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#KnownShape"><span class="hs-identifier">KnownShape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SBy"><span class="hs-identifier">SBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier">SName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier">SSelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier">SShape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier">SSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier">Size</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator">(:&amp;:)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator">(:|:)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.IndexingSlicingJoining</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sExpand"><span class="hs-identifier">sExpand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.MathOperations.Comparison</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html#Order"><span class="hs-identifier">Order</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html#Sorted"><span class="hs-identifier">Sorted</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html#sort"><span class="hs-identifier">sort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier">SGetShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#getDims"><span class="hs-identifier">getDims</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier">Tensor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.Language.SpiderSQL.html"><span class="hs-identifier">Torch.Language.SpiderSQL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Language.SpiderSQL.html#SpiderSQL"><span class="hs-identifier">SpiderSQL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.Language.SpiderSQL.html#spiderSQL"><span class="hs-identifier">spiderSQL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">Torch.Tensor</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">words</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerInput"><span class="hs-identifier">SimplifiedEncoderDecoderTransformerInput</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerGenerationInput"><span class="hs-identifier">SimplifiedEncoderDecoderTransformerGenerationInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="IsFinished"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#IsFinished"><span class="hs-identifier hs-var">IsFinished</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Finished"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Finished"><span class="hs-identifier hs-var">Finished</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Unfinished"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-var">Unfinished</span></a></span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">data</span><span> </span><span id="Beams"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span></span><span> </span><span id="local-6989586621679587029"><span class="annot"><a href="#local-6989586621679587029"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587028"><span class="annot"><a href="#local-6989586621679587028"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>  </span><span id="Beams"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587483"><span class="annot"><a href="#local-6989586621679587483"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587482"><span class="annot"><a href="#local-6989586621679587482"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="finished"><span class="annot"><span class="annottext">Beams a b -&gt; [Hypothesis 'Finished a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finished"><span class="hs-identifier hs-var hs-var">finished</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587482"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>      </span><span id="unfinished"><span class="annot"><span class="annottext">Beams a b -&gt; [Hypothesis 'Unfinished a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#unfinished"><span class="hs-identifier hs-var hs-var">unfinished</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587482"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587482"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679587019"><span id="local-6989586621679587021"><span id="local-6989586621679587023"><span class="annot"><span class="annottext">Int -&gt; Beams a b -&gt; ShowS
[Beams a b] -&gt; ShowS
Beams a b -&gt; String
(Int -&gt; Beams a b -&gt; ShowS)
-&gt; (Beams a b -&gt; String)
-&gt; ([Beams a b] -&gt; ShowS)
-&gt; Show (Beams a b)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a b. (Show a, Show b) =&gt; Int -&gt; Beams a b -&gt; ShowS
forall a b. (Show a, Show b) =&gt; [Beams a b] -&gt; ShowS
forall a b. (Show a, Show b) =&gt; Beams a b -&gt; String
showList :: [Beams a b] -&gt; ShowS
$cshowList :: forall a b. (Show a, Show b) =&gt; [Beams a b] -&gt; ShowS
show :: Beams a b -&gt; String
$cshow :: forall a b. (Show a, Show b) =&gt; Beams a b -&gt; String
showsPrec :: Int -&gt; Beams a b -&gt; ShowS
$cshowsPrec :: forall a b. (Show a, Show b) =&gt; Int -&gt; Beams a b -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="Hypothesis"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-var">Hypothesis</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679587017"><span class="annot"><a href="#local-6989586621679587017"><span class="hs-identifier hs-type">isFinished</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#IsFinished"><span class="hs-identifier hs-type">IsFinished</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679587016"><span class="annot"><a href="#local-6989586621679587016"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587015"><span class="annot"><a href="#local-6989586621679587015"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-66"></span><span>  </span><span id="InitialHypothesis"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587480"><span class="annot"><a href="#local-6989586621679587480"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587479"><span class="annot"><a href="#local-6989586621679587479"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587480"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587479"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span id="UnfinishedHypothesis"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-var">UnfinishedHypothesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587455"><span class="annot"><a href="#local-6989586621679587455"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587454"><span class="annot"><a href="#local-6989586621679587454"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="currentToken"><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b -&gt; a
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#currentToken"><span class="hs-identifier hs-var hs-var">currentToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679587455"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>      </span><span id="currentScore"><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#currentScore"><span class="hs-identifier hs-var hs-var">currentScore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>      </span><span id="previousHypothesis"><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b -&gt; Hypothesis 'Unfinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#previousHypothesis"><span class="hs-identifier hs-var hs-var">previousHypothesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587454"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587454"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span id="FinishedHypothesis"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#FinishedHypothesis"><span class="hs-identifier hs-var">FinishedHypothesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587452"><span class="annot"><a href="#local-6989586621679587452"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587451"><span class="annot"><a href="#local-6989586621679587451"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="finalToken"><span class="annot"><span class="annottext">Hypothesis 'Finished a b -&gt; a
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finalToken"><span class="hs-identifier hs-var hs-var">finalToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679587452"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>      </span><span id="finalScore"><span class="annot"><span class="annottext">Hypothesis 'Finished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finalScore"><span class="hs-identifier hs-var hs-var">finalScore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>      </span><span id="penultimateHypothesis"><span class="annot"><span class="annottext">Hypothesis 'Finished a b -&gt; Hypothesis 'Unfinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#penultimateHypothesis"><span class="hs-identifier hs-var hs-var">penultimateHypothesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587452"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587451"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>      </span><span id="finalValue"><span class="annot"><span class="annottext">Hypothesis 'Finished a b -&gt; b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finalValue"><span class="hs-identifier hs-var hs-var">finalValue</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679587451"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587452"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587451"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span id="local-6989586621679586999"><span id="local-6989586621679587001"><span id="local-6989586621679587003"><span id="local-6989586621679587004"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679587004"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679587003"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587004"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587003"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621679586992"><span id="local-6989586621679586994"><span id="local-6989586621679586996"><span id="local-6989586621679586997"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679586997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679586996"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586997"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586996"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621679586975"><span id="local-6989586621679586977"><span id="local-6989586621679586979"><span id="local-6989586621679586981"><span id="local-6989586621679586983"><span id="local-6989586621679586985"><span id="local-6989586621679586987"><span id="local-6989586621679586990"><span id="local-6989586621679586991"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679586991"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679586990"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586991"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586990"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span id="local-6989586621679586957"><span id="local-6989586621679586959"><span id="local-6989586621679586961"><span id="local-6989586621679586963"><span id="local-6989586621679586965"><span id="local-6989586621679586967"><span id="local-6989586621679586969"><span id="local-6989586621679586972"><span id="local-6989586621679586973"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679586973"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679586972"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586973"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586972"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span id="local-6989586621679586949"><span id="local-6989586621679586951"><span id="local-6989586621679586953"><span id="local-6989586621679586955"><span id="local-6989586621679586956"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679586956"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679586955"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586956"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586955"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621679586941"><span id="local-6989586621679586943"><span id="local-6989586621679586945"><span id="local-6989586621679586947"><span id="local-6989586621679586948"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679586948"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679586947"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Finished"><span class="hs-identifier hs-type">Finished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586948"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586947"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getTokens"><span class="hs-identifier hs-type">getTokens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587491"><span class="annot"><a href="#local-6989586621679587491"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587490"><span class="annot"><a href="#local-6989586621679587490"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587491"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587490"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587491"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-98"></span><span id="getTokens"><span class="annot"><span class="annottext">getTokens :: Hypothesis 'Unfinished a b -&gt; [a]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getTokens"><span class="hs-identifier hs-var hs-var">getTokens</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getTokens"><span class="hs-identifier hs-var">getTokens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-type">UnfinishedHypothesis</span></a></span><span> </span><span id="local-6989586621679586939"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586939"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679586938"><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b
</span><a href="#local-6989586621679586938"><span class="hs-identifier hs-var">previousHypothesis</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586939"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b -&gt; [a]
forall a b. Hypothesis 'Unfinished a b -&gt; [a]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getTokens"><span class="hs-identifier hs-var">getTokens</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b
</span><a href="#local-6989586621679586938"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getScore"><span class="hs-identifier hs-type">getScore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679586936"><span class="annot"><a href="#local-6989586621679586936"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679586935"><span class="annot"><a href="#local-6989586621679586935"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586936"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586935"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-102"></span><span id="getScore"><span class="annot"><span class="annottext">getScore :: Hypothesis 'Unfinished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getScore"><span class="hs-identifier hs-var hs-var">getScore</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span>
</span><span id="line-103"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getScore"><span class="hs-identifier hs-var">getScore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-type">UnfinishedHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679586934"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586934"><span class="hs-identifier hs-var">previousScore</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586934"><span class="hs-identifier hs-var">previousScore</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-keyword">data</span><span> </span><span id="SomeHypothesis"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-var">SomeHypothesis</span></a></span></span><span> </span><span id="local-6989586621679587309"><span class="annot"><a href="#local-6989586621679587309"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587308"><span class="annot"><a href="#local-6989586621679587308"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587310"><span class="annot"><a href="#local-6989586621679587310"><span class="hs-identifier hs-type">isFinished</span></a></span></span><span class="hs-operator">.</span><span> </span><span id="SomeHypothesis"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-var">SomeHypothesis</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unSomeHypothesis"><span class="annot"><span class="annottext">()
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#unSomeHypothesis"><span class="hs-identifier hs-var hs-var">unSomeHypothesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587310"><span class="hs-identifier hs-type">isFinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587309"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587308"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#beamSearch"><span class="hs-identifier hs-type">beamSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587431"><span class="annot"><a href="#local-6989586621679587431"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587430"><span class="annot"><a href="#local-6989586621679587430"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679587432"><span class="annot"><a href="#local-6989586621679587432"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679587432"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587430"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679587432"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587430"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="#local-6989586621679587432"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587430"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span id="beamSearch"><span class="annot"><span class="annottext">beamSearch :: Int
-&gt; Int
-&gt; ([Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b])
-&gt; m [Beams a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#beamSearch"><span class="hs-identifier hs-var hs-var">beamSearch</span></a></span></span><span> </span><span id="local-6989586621679586930"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586930"><span class="hs-identifier hs-var">maxSteps</span></a></span></span><span> </span><span id="local-6989586621679586929"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586929"><span class="hs-identifier hs-var">beamSize</span></a></span></span><span> </span><span id="local-6989586621679586928"><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b]
</span><a href="#local-6989586621679586928"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Beams a b -&gt; m [Beams a b]
</span><a href="#local-6989586621679586927"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586930"><span class="hs-identifier hs-var">maxSteps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
forall a b.
[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Hypothesis 'Unfinished a b -&gt; [Hypothesis 'Unfinished a b]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586929"><span class="hs-identifier hs-var">beamSize</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b
forall a b. Hypothesis 'Unfinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679586927"><span class="annot"><span class="annottext">go :: Int -&gt; Beams a b -&gt; m [Beams a b]
</span><a href="#local-6989586621679586927"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Beams a b] -&gt; m [Beams a b]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="#local-6989586621679586927"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679586925"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586925"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679586924"><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586924"><span class="hs-identifier hs-var">beams</span></a></span></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586925"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Beams a b] -&gt; m [Beams a b]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679586922"><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586922"><span class="hs-identifier hs-var">beams'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b])
-&gt; Beams a b -&gt; m (Beams a b)
forall a b (m :: * -&gt; *).
Functor m =&gt;
([Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b])
-&gt; Beams a b -&gt; m (Beams a b)
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#beamSearchStep"><span class="hs-identifier hs-var">beamSearchStep</span></a></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b]
</span><a href="#local-6989586621679586928"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586924"><span class="hs-identifier hs-var">beams</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586922"><span class="hs-identifier hs-var">beams'</span></a></span><span> </span><span class="annot"><span class="annottext">Beams a b -&gt; [Beams a b] -&gt; [Beams a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Beams a b] -&gt; [Beams a b]) -&gt; m [Beams a b] -&gt; m [Beams a b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Beams a b -&gt; m [Beams a b]
</span><a href="#local-6989586621679586927"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586925"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586922"><span class="hs-identifier hs-var">beams'</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#beamSearchStep"><span class="hs-identifier hs-type">beamSearchStep</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587475"><span class="annot"><a href="#local-6989586621679587475"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679587474"><span class="annot"><a href="#local-6989586621679587474"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679587476"><span class="annot"><a href="#local-6989586621679587476"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679587476"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587474"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679587476"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587474"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587474"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="#local-6989586621679587476"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587475"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587474"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span id="beamSearchStep"><span class="annot"><span class="annottext">beamSearchStep :: ([Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b])
-&gt; Beams a b -&gt; m (Beams a b)
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#beamSearchStep"><span class="hs-identifier hs-var hs-var">beamSearchStep</span></a></span></span><span> </span><span id="local-6989586621679586919"><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b]
</span><a href="#local-6989586621679586919"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span id="local-6989586621679586918"><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586918"><span class="hs-identifier hs-var">beam</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586917"><span class="annot"><span class="annottext">someHypotheses :: m [SomeHypothesis a b]
</span><a href="#local-6989586621679586917"><span class="hs-identifier hs-var hs-var">someHypotheses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; [SomeHypothesis a b] -&gt; [SomeHypothesis a b]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Beams a b -&gt; [Hypothesis 'Unfinished a b]
forall a b. Beams a b -&gt; [Hypothesis 'Unfinished a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#unfinished"><span class="hs-identifier hs-var hs-var">unfinished</span></a></span><span> </span><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586918"><span class="hs-identifier hs-var">beam</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>          </span><span class="annot"><span class="annottext">([SomeHypothesis a b] -&gt; [SomeHypothesis a b])
-&gt; ([SomeHypothesis a b] -&gt; [SomeHypothesis a b])
-&gt; [SomeHypothesis a b]
-&gt; [SomeHypothesis a b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[SomeHypothesis a b] -&gt; [SomeHypothesis a b]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span>
</span><span id="line-133"></span><span>          </span><span class="annot"><span class="annottext">([SomeHypothesis a b] -&gt; [SomeHypothesis a b])
-&gt; ([SomeHypothesis a b] -&gt; [SomeHypothesis a b])
-&gt; [SomeHypothesis a b]
-&gt; [SomeHypothesis a b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SomeHypothesis a b -&gt; Float)
-&gt; [SomeHypothesis a b] -&gt; [SomeHypothesis a b]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-135"></span><span>                </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis isFinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span>
</span><span id="line-136"></span><span>                </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span id="local-6989586621679586912"><span class="annot"><span class="annottext">u :: Hypothesis isFinished a b
</span><a href="#local-6989586621679586912"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-type">UnfinishedHypothesis</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished a b -&gt; Float
forall a b. Hypothesis 'Unfinished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#currentScore"><span class="hs-identifier hs-var hs-var">currentScore</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis isFinished a b
Hypothesis 'Unfinished a b
</span><a href="#local-6989586621679586912"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-137"></span><span>                </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span id="local-6989586621679586911"><span class="annot"><span class="annottext">f :: Hypothesis isFinished a b
</span><a href="#local-6989586621679586911"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#FinishedHypothesis"><span class="hs-identifier hs-type">FinishedHypothesis</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Finished a b -&gt; Float
forall a b. Hypothesis 'Finished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finalScore"><span class="hs-identifier hs-var hs-var">finalScore</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis isFinished a b
Hypothesis 'Finished a b
</span><a href="#local-6989586621679586911"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><span class="annottext">([SomeHypothesis a b] -&gt; [SomeHypothesis a b])
-&gt; m [SomeHypothesis a b] -&gt; m [SomeHypothesis a b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b]
</span><a href="#local-6989586621679586919"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">([Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b])
-&gt; (Beams a b -&gt; [Hypothesis 'Unfinished a b])
-&gt; Beams a b
-&gt; m [SomeHypothesis a b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Beams a b -&gt; [Hypothesis 'Unfinished a b]
forall a b. Beams a b -&gt; [Hypothesis 'Unfinished a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#unfinished"><span class="hs-identifier hs-var hs-var">unfinished</span></a></span><span> </span><span class="annot"><span class="annottext">(Beams a b -&gt; m [SomeHypothesis a b])
-&gt; Beams a b -&gt; m [SomeHypothesis a b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586918"><span class="hs-identifier hs-var">beam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Beams a b -&gt; SomeHypothesis a b -&gt; Beams a b)
-&gt; Beams a b -&gt; [SomeHypothesis a b] -&gt; Beams a b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span id="local-6989586621679586909"><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
</span><a href="#local-6989586621679586909"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621679586908"><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b]
</span><a href="#local-6989586621679586908"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679586907"><span class="annot"><span class="annottext">SomeHypothesis a b
</span><a href="#local-6989586621679586907"><span class="hs-identifier hs-var">someHypothesis</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeHypothesis a b
</span><a href="#local-6989586621679586907"><span class="hs-identifier hs-var">someHypothesis</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>              </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span id="local-6989586621679586906"><span class="annot"><span class="annottext">u :: Hypothesis isFinished a b
</span><a href="#local-6989586621679586906"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Hypothesis isFinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
forall a b.
[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
</span><a href="#local-6989586621679586909"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hypothesis isFinished a b
</span><a href="#local-6989586621679586906"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis isFinished a b
-&gt; [Hypothesis isFinished a b] -&gt; [Hypothesis isFinished a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis isFinished a b]
[Hypothesis 'Unfinished a b]
</span><a href="#local-6989586621679586908"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>              </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span id="local-6989586621679586905"><span class="annot"><span class="annottext">u :: Hypothesis isFinished a b
</span><a href="#local-6989586621679586905"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-type">UnfinishedHypothesis</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
forall a b.
[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
</span><a href="#local-6989586621679586909"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hypothesis isFinished a b
</span><a href="#local-6989586621679586905"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis isFinished a b
-&gt; [Hypothesis isFinished a b] -&gt; [Hypothesis isFinished a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis isFinished a b]
[Hypothesis 'Unfinished a b]
</span><a href="#local-6989586621679586908"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>              </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span id="local-6989586621679586904"><span class="annot"><span class="annottext">f :: Hypothesis isFinished a b
</span><a href="#local-6989586621679586904"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#FinishedHypothesis"><span class="hs-identifier hs-type">FinishedHypothesis</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
forall a b.
[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hypothesis isFinished a b
</span><a href="#local-6989586621679586904"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis isFinished a b
-&gt; [Hypothesis isFinished a b] -&gt; [Hypothesis isFinished a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis isFinished a b]
[Hypothesis 'Finished a b]
</span><a href="#local-6989586621679586909"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished a b]
</span><a href="#local-6989586621679586908"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
forall a b.
[Hypothesis 'Finished a b]
-&gt; [Hypothesis 'Unfinished a b] -&gt; Beams a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-var">Beams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Beams a b -&gt; [Hypothesis 'Finished a b]
forall a b. Beams a b -&gt; [Hypothesis 'Finished a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finished"><span class="hs-identifier hs-var hs-var">finished</span></a></span><span> </span><span class="annot"><span class="annottext">Beams a b
</span><a href="#local-6989586621679586918"><span class="hs-identifier hs-var">beam</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">([SomeHypothesis a b] -&gt; Beams a b)
-&gt; m [SomeHypothesis a b] -&gt; m (Beams a b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m [SomeHypothesis a b]
</span><a href="#local-6989586621679586917"><span class="hs-identifier hs-var">someHypotheses</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#runBeamSearch"><span class="hs-identifier hs-type">runBeamSearch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587255"><span class="annot"><a href="#local-6989586621679587255"><span class="hs-identifier hs-type">model</span></a></span></span><span> </span><span id="local-6989586621679587254"><span class="annot"><a href="#local-6989586621679587254"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679587253"><span class="annot"><a href="#local-6989586621679587253"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span id="local-6989586621679587250"><span class="annot"><a href="#local-6989586621679587250"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679587248"><span class="annot"><a href="#local-6989586621679587248"><span class="hs-identifier hs-type">encoderOutputShape</span></a></span></span><span> </span><span id="local-6989586621679587246"><span class="annot"><a href="#local-6989586621679587246"><span class="hs-identifier hs-type">encoderOutput'</span></a></span></span><span> </span><span id="local-6989586621679587249"><span class="annot"><a href="#local-6989586621679587249"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span> </span><span id="local-6989586621679587251"><span class="annot"><a href="#local-6989586621679587251"><span class="hs-identifier hs-type">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679587252"><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-153"></span><span>      </span><span class="annot"><a href="#local-6989586621679587255"><span class="hs-identifier hs-type">model</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerInput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587254"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587253"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587251"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587250"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587249"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="#local-6989586621679587250"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithGradient"><span class="hs-identifier hs-type">WithGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>          </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><a href="#local-6989586621679587248"><span class="hs-identifier hs-type">encoderOutputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#BroadcastShapesF"><span class="hs-identifier hs-type">BroadcastShapesF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587248"><span class="hs-identifier hs-type">encoderOutputShape</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier hs-type">SGetShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587248"><span class="hs-identifier hs-type">encoderOutputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><a href="#local-6989586621679587255"><span class="hs-identifier hs-type">model</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerGenerationInput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587253"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587246"><span class="hs-identifier hs-type">encoderOutput'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587249"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587251"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587246"><span class="hs-identifier hs-type">encoderOutput'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587249"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><a href="#local-6989586621679587246"><span class="hs-identifier hs-type">encoderOutput'</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-175"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithGradient"><span class="hs-identifier hs-type">WithGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>          </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span>
</span><span id="line-179"></span><span>          </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="#local-6989586621679587253"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-182"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithoutGradient"><span class="hs-identifier hs-type">WithoutGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedSize"><span class="hs-identifier hs-type">UncheckedSize</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedSize"><span class="hs-identifier hs-type">UncheckedSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679587251"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-189"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithGradient"><span class="hs-identifier hs-type">WithGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>          </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="#local-6989586621679587255"><span class="hs-identifier hs-type">model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="#local-6989586621679587254"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-202"></span><span id="runBeamSearch"><span class="annot"><span class="annottext">runBeamSearch :: Int
-&gt; Int
-&gt; model
-&gt; input
-&gt; Generator generatorDevice
-&gt; IO [Beams Int [Int]]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#runBeamSearch"><span class="hs-identifier hs-var hs-var">runBeamSearch</span></a></span></span><span> </span><span id="local-6989586621679586902"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586902"><span class="hs-identifier hs-var">maxSteps</span></a></span></span><span> </span><span id="local-6989586621679586901"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586901"><span class="hs-identifier hs-var">beamSize</span></a></span></span><span> </span><span id="local-6989586621679586900"><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586900"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679586899"><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679586899"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679586898"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586898"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><span class="annottext">StateT
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
  IO
  [Beams Int [Int]]
-&gt; (Maybe (encoderOutput, inputPaddingMask),
    Generator generatorDevice)
-&gt; IO [Beams Int [Int]]
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; ([Hypothesis 'Unfinished Int [Int]]
    -&gt; StateT
         (Maybe (encoderOutput, inputPaddingMask),
          Generator generatorDevice)
         IO
         [SomeHypothesis Int [Int]])
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [Beams Int [Int]]
forall a b (m :: * -&gt; *).
Monad m =&gt;
Int
-&gt; Int
-&gt; ([Hypothesis 'Unfinished a b] -&gt; m [SomeHypothesis a b])
-&gt; m [Beams a b]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#beamSearch"><span class="hs-identifier hs-var">beamSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586902"><span class="hs-identifier hs-var">maxSteps</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586901"><span class="hs-identifier hs-var">beamSize</span></a></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [SomeHypothesis Int [Int]]
</span><a href="#local-6989586621679586897"><span class="hs-identifier hs-var">cont</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (encoderOutput, inputPaddingMask)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586898"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="#local-6989586621679586897"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679587250"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679587249"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679586897"><span class="annot"><span class="annottext">cont :: [Hypothesis 'Unfinished Int [Int]]
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [SomeHypothesis Int [Int]]
</span><a href="#local-6989586621679586897"><span class="hs-identifier hs-var hs-var">cont</span></a></span></span><span> </span><span id="local-6989586621679586896"><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586896"><span class="hs-identifier hs-var">previousHypotheses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586895"><span class="annot"><span class="annottext">previousHypotheses' :: [Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586895"><span class="hs-identifier hs-var hs-var">previousHypotheses'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
-&gt; [Hypothesis 'Unfinished Int [Int]]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586896"><span class="hs-identifier hs-var">previousHypotheses</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span id="local-6989586621679586894"><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586894"><span class="hs-identifier hs-var">decoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679587253"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586893"><span class="annot"><span class="annottext">tokens :: [[Int]]
</span><a href="#local-6989586621679586893"><span class="hs-identifier hs-var hs-var">tokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int])
-&gt; (Hypothesis 'Unfinished Int [Int] -&gt; [Int])
-&gt; Hypothesis 'Unfinished Int [Int]
-&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; [Int]
forall a b. Hypothesis 'Unfinished a b -&gt; [a]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getTokens"><span class="hs-identifier hs-var">getTokens</span></a></span><span> </span><span class="annot"><span class="annottext">(Hypothesis 'Unfinished Int [Int] -&gt; [Int])
-&gt; [Hypothesis 'Unfinished Int [Int]] -&gt; [[Int]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586895"><span class="hs-identifier hs-var">previousHypotheses'</span></a></span><span>
</span><span id="line-210"></span><span>            </span><span id="local-6989586621679586892"><span class="annot"><span class="annottext">batchSize :: Integer
</span><a href="#local-6989586621679586892"><span class="hs-identifier hs-var hs-var">batchSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586895"><span class="hs-identifier hs-var">previousHypotheses'</span></a></span><span>
</span><span id="line-211"></span><span>            </span><span id="local-6989586621679586891"><span class="annot"><span class="annottext">seqSize :: Integer
</span><a href="#local-6989586621679586891"><span class="hs-identifier hs-var hs-var">seqSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679586890"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-213"></span><span>                  </span><span id="local-6989586621679586890"><span class="annot"><span class="annottext">go :: Hypothesis 'Unfinished Int [Int] -&gt; Int
</span><a href="#local-6989586621679586890"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#InitialHypothesis"><span class="hs-identifier hs-var">InitialHypothesis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-214"></span><span>                  </span><span class="annot"><a href="#local-6989586621679586890"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-type">UnfinishedHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679586889"><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586889"><span class="hs-identifier hs-var">previousHypothesis'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; Int
</span><a href="#local-6989586621679586890"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586889"><span class="hs-identifier hs-var">previousHypothesis'</span></a></span><span>
</span><span id="line-215"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; ([Int] -&gt; Int) -&gt; [Int] -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Integer) -&gt; [Int] -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; Int
</span><a href="#local-6989586621679586890"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Hypothesis 'Unfinished Int [Int] -&gt; Int)
-&gt; [Hypothesis 'Unfinished Int [Int]] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586895"><span class="hs-identifier hs-var">previousHypotheses'</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-comment">-- liftIO . print $ ((t5Vocab Map.!) &lt;$&gt;) &lt;$&gt; tokens</span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) 'UncheckedSize)
-&gt; SDim ('Dim ('Name &quot;*&quot;) 'UncheckedSize)
-&gt; SDevice ('Device 'CPU)
-&gt; [[Int]]
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     decoderInput
forall (batchDim :: Dim (Name Symbol) (Size Nat))
       (seqDim :: Dim (Name Symbol) (Size Nat))
       (device :: Device (DeviceType Nat)) (m :: * -&gt; *) output.
(MonadThrow m, SGetDim batchDim, SGetDim seqDim,
 'Shape '[batchDim, seqDim]
 ~ Seq
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) 'UncheckedSize,
           'Dim ('Name &quot;*&quot;) 'UncheckedSize]
      &lt;+&gt; 'Shape '[batchDim, seqDim])
     ('Shape '[batchDim, seqDim]),
 output
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     ('Shape '[batchDim, seqDim])) =&gt;
SDim batchDim
-&gt; SDim seqDim -&gt; SDevice device -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5Input"><span class="hs-identifier hs-var">mkT5Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize 'UncheckedSize -&gt; SDim ('Dim ('Name &quot;*&quot;) 'UncheckedSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SSize 'UncheckedSize
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SUncheckedSize"><span class="hs-identifier hs-var">SUncheckedSize</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679586892"><span class="hs-identifier hs-var">batchSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize 'UncheckedSize -&gt; SDim ('Dim ('Name &quot;*&quot;) 'UncheckedSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SSize 'UncheckedSize
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SUncheckedSize"><span class="hs-identifier hs-var">SUncheckedSize</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679586891"><span class="hs-identifier hs-var">seqSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679586893"><span class="hs-identifier hs-var">tokens</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621679586882"><span class="annot"><span class="annottext">[[[Float]]]
</span><a href="#local-6989586621679586882"><span class="hs-identifier hs-var">logProbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">decoderInput
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [[[Float]]]
</span><a href="#local-6989586621679586881"><span class="hs-identifier hs-var">getLogProbs</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586894"><span class="hs-identifier hs-var">decoderInput</span></a></span><span>
</span><span id="line-219"></span><span>      </span><span class="annot"><span class="annottext">[SomeHypothesis Int [Int]]
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [SomeHypothesis Int [Int]]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([SomeHypothesis Int [Int]]
 -&gt; StateT
      (Maybe (encoderOutput, inputPaddingMask),
       Generator generatorDevice)
      IO
      [SomeHypothesis Int [Int]])
-&gt; [SomeHypothesis Int [Int]]
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [SomeHypothesis Int [Int]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
-&gt; [[[Float]]] -&gt; [(Hypothesis 'Unfinished Int [Int], [[Float]])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><a href="#local-6989586621679586895"><span class="hs-identifier hs-var">previousHypotheses'</span></a></span><span> </span><span class="annot"><span class="annottext">[[[Float]]]
</span><a href="#local-6989586621679586882"><span class="hs-identifier hs-var">logProbs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Hypothesis 'Unfinished Int [Int], [[Float]])]
-&gt; ((Hypothesis 'Unfinished Int [Int], [[Float]])
    -&gt; [SomeHypothesis Int [Int]])
-&gt; [SomeHypothesis Int [Int]]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(Hypothesis 'Unfinished Int [Int]
 -&gt; [[Float]] -&gt; [SomeHypothesis Int [Int]])
-&gt; (Hypothesis 'Unfinished Int [Int], [[Float]])
-&gt; [SomeHypothesis Int [Int]]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679586879"><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586879"><span class="hs-identifier hs-var">previousHypothesis</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Float -&gt; SomeHypothesis Int [Int])
-&gt; [Int] -&gt; [Float] -&gt; [SomeHypothesis Int [Int]]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
-&gt; Int -&gt; Float -&gt; SomeHypothesis Int [Int]
</span><a href="#local-6989586621679586877"><span class="hs-identifier hs-var">mkHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586879"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([Float] -&gt; [SomeHypothesis Int [Int]])
-&gt; ([[Float]] -&gt; [Float])
-&gt; [[Float]]
-&gt; [SomeHypothesis Int [Int]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Float]] -&gt; [Float]
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="#local-6989586621679586881"><span class="hs-identifier hs-type">getLogProbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679587253"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679587250"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679587249"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587252"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621679586881"><span class="annot"><span class="annottext">getLogProbs :: decoderInput
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [[[Float]]]
</span><a href="#local-6989586621679586881"><span class="hs-identifier hs-var hs-var">getLogProbs</span></a></span></span><span> </span><span id="local-6989586621679586875"><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586875"><span class="hs-identifier hs-var">decoderInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679586874"><span class="annot"><span class="annottext">Maybe
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     encoderOutputShape,
   inputPaddingMask)
</span><a href="#local-6989586621679586874"><span class="hs-identifier hs-var">maybeStuff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586873"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586873"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
  IO
  (Maybe
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        encoderOutputShape,
      inputPaddingMask),
   Generator ('Device 'CPU))
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span id="local-6989586621679586870"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586870"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679586869"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  encoderOutputShape
</span><a href="#local-6989586621679586869"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679586868"><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586868"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586867"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586867"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     encoderOutputShape,
   inputPaddingMask)
</span><a href="#local-6989586621679586874"><span class="hs-identifier hs-var">maybeStuff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">Maybe
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     encoderOutputShape,
   inputPaddingMask)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">model
-&gt; SimplifiedEncoderDecoderTransformerInput input decoderInput
-&gt; Generator ('Device 'CPU)
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     (SimplifiedEncoderDecoderTransformerOutput
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           'UncheckedShape)
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           encoderOutputShape)
        inputPaddingMask,
      Generator ('Device 'CPU))
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586900"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">input
-&gt; decoderInput
-&gt; SimplifiedEncoderDecoderTransformerInput input decoderInput
forall input decoderInput.
input
-&gt; decoderInput
-&gt; SimplifiedEncoderDecoderTransformerInput input decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerInput"><span class="hs-identifier hs-var">SimplifiedEncoderDecoderTransformerInput</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679586899"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586875"><span class="hs-identifier hs-var">decoderInput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586873"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679586864"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  encoderOutputShape
</span><a href="#local-6989586621679586864"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586863"><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586863"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>          </span><span class="hs-comment">-- decoderInputBatchDim : _ &lt;- dims decoderInput</span><span>
</span><span id="line-227"></span><span>          </span><span id="local-6989586621679586862"><span class="annot"><span class="annottext">Dim String Integer
</span><a href="#local-6989586621679586862"><span class="hs-identifier hs-var">decoderInputBatchDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
  IO
  (Dim String Integer)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-228"></span><span>          </span><span class="hs-comment">-- _encoderOutputBatchDim : encoderOutputDims &lt;- dims encoderOutput</span><span>
</span><span id="line-229"></span><span>          </span><span id="local-6989586621679586860"><span class="annot"><span class="annottext">[Dim String Integer]
</span><a href="#local-6989586621679586860"><span class="hs-identifier hs-var">encoderOutputDims</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
  IO
  [Dim String Integer]
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-230"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586859"><span class="annot"><span class="annottext">encoderOutput' :: Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  (BroadcastShapesF encoderOutputShape 'UncheckedShape)
</span><a href="#local-6989586621679586859"><span class="hs-identifier hs-var hs-var">encoderOutput'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SShape 'UncheckedShape
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     encoderOutputShape
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     (BroadcastShapesF encoderOutputShape 'UncheckedShape)
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) input output.
(input ~ Tensor gradient layout device dataType shape,
 output
 ~ Tensor
     gradient layout device dataType (BroadcastShapesF shape shape')) =&gt;
SShape shape' -&gt; input -&gt; output
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sExpand"><span class="hs-identifier hs-var">sExpand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dim String Integer] -&gt; SShape 'UncheckedShape
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SUncheckedShape"><span class="hs-identifier hs-var">SUncheckedShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim String Integer
</span><a href="#local-6989586621679586862"><span class="hs-identifier hs-var">decoderInputBatchDim</span></a></span><span> </span><span class="annot"><span class="annottext">Dim String Integer -&gt; [Dim String Integer] -&gt; [Dim String Integer]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Dim String Integer]
</span><a href="#local-6989586621679586860"><span class="hs-identifier hs-var">encoderOutputDims</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  encoderOutputShape
</span><a href="#local-6989586621679586864"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span id="local-6989586621679586857"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586857"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586856"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586856"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">model
-&gt; SimplifiedEncoderDecoderTransformerGenerationInput
     decoderInput
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        (BroadcastShapesF encoderOutputShape 'UncheckedShape))
     inputPaddingMask
-&gt; Generator ('Device 'CPU)
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     (SimplifiedEncoderDecoderTransformerOutput
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           'UncheckedShape)
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           'UncheckedShape)
        inputPaddingMask,
      Generator ('Device 'CPU))
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586900"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">decoderInput
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     (BroadcastShapesF encoderOutputShape 'UncheckedShape)
-&gt; inputPaddingMask
-&gt; SimplifiedEncoderDecoderTransformerGenerationInput
     decoderInput
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        (BroadcastShapesF encoderOutputShape 'UncheckedShape))
     inputPaddingMask
forall decoderInput encoderOutput inputPaddingMask.
decoderInput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; SimplifiedEncoderDecoderTransformerGenerationInput
     decoderInput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerGenerationInput"><span class="hs-identifier hs-var">SimplifiedEncoderDecoderTransformerGenerationInput</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586875"><span class="hs-identifier hs-var">decoderInput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  (BroadcastShapesF encoderOutputShape 'UncheckedShape)
</span><a href="#local-6989586621679586859"><span class="hs-identifier hs-var">encoderOutput'</span></a></span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586863"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586873"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-232"></span><span>          </span><span class="annot"><span class="annottext">(SimplifiedEncoderDecoderTransformerOutput
   (Tensor
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      T5DataType
      'UncheckedShape)
   (Tensor
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      T5DataType
      encoderOutputShape)
   inputPaddingMask,
 Generator ('Device 'CPU))
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     (SimplifiedEncoderDecoderTransformerOutput
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           'UncheckedShape)
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           encoderOutputShape)
        inputPaddingMask,
      Generator ('Device 'CPU))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     encoderOutputShape
-&gt; inputPaddingMask
-&gt; SimplifiedEncoderDecoderTransformerOutput
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        'UncheckedShape)
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        encoderOutputShape)
     inputPaddingMask
forall decoderOutput encoderOutput inputPaddingMask.
decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; SimplifiedEncoderDecoderTransformerOutput
     decoderOutput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-var">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586857"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  encoderOutputShape
</span><a href="#local-6989586621679586864"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586863"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586856"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">(Maybe
   (Tensor
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      T5DataType
      encoderOutputShape,
    inputPaddingMask),
 Generator ('Device 'CPU))
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tensor
   ('Gradient 'WithGradient)
   ('Layout 'Dense)
   ('Device 'CPU)
   T5DataType
   encoderOutputShape,
 inputPaddingMask)
-&gt; Maybe
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        encoderOutputShape,
      inputPaddingMask)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  encoderOutputShape
</span><a href="#local-6989586621679586869"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586868"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586867"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 2))
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     (SoftmaxF ('SelectDim ('ByIndex 2)) 'UncheckedShape)
forall (selectDim :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SSelectDim selectDim
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor
     gradient layout device dataType (SoftmaxF selectDim shape)
</span><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#logSoftmax"><span class="hs-identifier hs-var">logSoftmax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 2) -&gt; SSelectDim ('SelectDim ('ByIndex 2))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 2) -&gt; SSelectDim ('SelectDim ('ByIndex 2)))
-&gt; SBy ('ByIndex 2) -&gt; SSelectDim ('SelectDim ('ByIndex 2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 2 =&gt; SBy ('ByIndex 2)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586870"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#UnsafeTensor"><span class="hs-identifier hs-type">UnsafeTensor</span></a></span><span> </span><span id="local-6989586621679586850"><span class="annot"><span class="annottext">ForeignPtr Tensor
</span><a href="#local-6989586621679586850"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[[Float]]]
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [[[Float]]]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([[[Float]]]
 -&gt; StateT
      (Maybe (encoderOutput, inputPaddingMask),
       Generator generatorDevice)
      IO
      [[[Float]]])
-&gt; (ForeignPtr Tensor -&gt; [[[Float]]])
-&gt; ForeignPtr Tensor
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [[[Float]]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; [[[Float]]]
forall a. TensorLike a =&gt; Tensor -&gt; a
</span><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-var">Torch.Tensor.asValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; [[[Float]]])
-&gt; (ForeignPtr Tensor -&gt; Tensor)
-&gt; ForeignPtr Tensor
-&gt; [[[Float]]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Tensor -&gt; Tensor
</span><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-var">Torch.Tensor.Unsafe</span></a></span><span> </span><span class="annot"><span class="annottext">(ForeignPtr Tensor
 -&gt; StateT
      (Maybe (encoderOutput, inputPaddingMask),
       Generator generatorDevice)
      IO
      [[[Float]]])
-&gt; ForeignPtr Tensor
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     IO
     [[[Float]]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Tensor
</span><a href="#local-6989586621679586850"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="#local-6989586621679586877"><span class="hs-identifier hs-type">mkHypothesis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Hypothesis"><span class="hs-identifier hs-type">Hypothesis</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Unfinished"><span class="hs-identifier hs-type">Unfinished</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-type">SomeHypothesis</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679586877"><span class="annot"><span class="annottext">mkHypothesis :: Hypothesis 'Unfinished Int [Int]
-&gt; Int -&gt; Float -&gt; SomeHypothesis Int [Int]
</span><a href="#local-6989586621679586877"><span class="hs-identifier hs-var hs-var">mkHypothesis</span></a></span></span><span> </span><span id="local-6989586621679586847"><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586847"><span class="hs-identifier hs-var">previousHypothesis</span></a></span></span><span> </span><span id="local-6989586621679586846"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586846"><span class="hs-identifier hs-var">token</span></a></span></span><span> </span><span id="local-6989586621679586845"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586845"><span class="hs-identifier hs-var">logProb</span></a></span></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586846"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5EOSTokenId"><span class="hs-identifier hs-var">t5EOSTokenId</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586844"><span class="annot"><span class="annottext">finalValue :: [Int]
</span><a href="#local-6989586621679586844"><span class="hs-identifier hs-var hs-var">finalValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586846"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; [Int]
forall a b. Hypothesis 'Unfinished a b -&gt; [a]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getTokens"><span class="hs-identifier hs-var">getTokens</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586847"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span>
</span><span id="line-240"></span><span>            </span><span id="local-6989586621679586843"><span class="annot"><span class="annottext">finalScore :: Float
</span><a href="#local-6989586621679586843"><span class="hs-identifier hs-var hs-var">finalScore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586845"><span class="hs-identifier hs-var">logProb</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; Float
forall a b. Hypothesis 'Unfinished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getScore"><span class="hs-identifier hs-var">getScore</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586847"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span>
</span><span id="line-241"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Finished Int [Int] -&gt; SomeHypothesis Int [Int]
forall a b (isFinished :: IsFinished).
Hypothesis isFinished a b -&gt; SomeHypothesis a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-var">SomeHypothesis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Float
-&gt; Hypothesis 'Unfinished Int [Int]
-&gt; [Int]
-&gt; Hypothesis 'Finished Int [Int]
forall a b.
a
-&gt; Float
-&gt; Hypothesis 'Unfinished a b
-&gt; b
-&gt; Hypothesis 'Finished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#FinishedHypothesis"><span class="hs-identifier hs-var">FinishedHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586846"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586843"><span class="hs-identifier hs-var">finalScore</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586847"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586844"><span class="hs-identifier hs-var">finalValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586842"><span class="annot"><span class="annottext">score :: Float
</span><a href="#local-6989586621679586842"><span class="hs-identifier hs-var hs-var">score</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586845"><span class="hs-identifier hs-var">logProb</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; Float
forall a b. Hypothesis 'Unfinished a b -&gt; Float
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getScore"><span class="hs-identifier hs-var">getScore</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586847"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span>
</span><span id="line-244"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int] -&gt; SomeHypothesis Int [Int]
forall a b (isFinished :: IsFinished).
Hypothesis isFinished a b -&gt; SomeHypothesis a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#SomeHypothesis"><span class="hs-identifier hs-var">SomeHypothesis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Float
-&gt; Hypothesis 'Unfinished Int [Int]
-&gt; Hypothesis 'Unfinished Int [Int]
forall a b.
a
-&gt; Float
-&gt; Hypothesis 'Unfinished a b
-&gt; Hypothesis 'Unfinished a b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#UnfinishedHypothesis"><span class="hs-identifier hs-var">UnfinishedHypothesis</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586846"><span class="hs-identifier hs-var">token</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679586842"><span class="hs-identifier hs-var">score</span></a></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Unfinished Int [Int]
</span><a href="#local-6989586621679586847"><span class="hs-identifier hs-var">previousHypothesis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span id="testBeamSearch"><span class="annot"><span class="annottext">testBeamSearch :: IO ()
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#testBeamSearch"><span class="hs-identifier hs-var hs-var">testBeamSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621679586840"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 19)])
</span><a href="#local-6989586621679586840"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586839"><span class="annot"><span class="annottext">tokens :: [[Int]]
</span><a href="#local-6989586621679586839"><span class="hs-identifier hs-var hs-var">tokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">13959</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1566</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2968</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6536</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">43</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2008</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">24</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">293</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">53</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1782</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">19</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">207</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-comment">-- let tokens = [[13959, 1566, 12, 2968, 10, 148, 31, 60, 423, 13, 3, 7, 10536, 55, 1]]</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-comment">-- print $ ((t5Vocab Map.!) &lt;$&gt;) &lt;$&gt; tokens</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 19))
-&gt; SDevice ('Device 'CPU)
-&gt; [[Int]]
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 19)]))
forall (batchDim :: Dim (Name Symbol) (Size Nat))
       (seqDim :: Dim (Name Symbol) (Size Nat))
       (device :: Device (DeviceType Nat)) (m :: * -&gt; *) output.
(MonadThrow m, SGetDim batchDim, SGetDim seqDim,
 'Shape '[batchDim, seqDim]
 ~ Seq
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) 'UncheckedSize,
           'Dim ('Name &quot;*&quot;) 'UncheckedSize]
      &lt;+&gt; 'Shape '[batchDim, seqDim])
     ('Shape '[batchDim, seqDim]),
 output
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     ('Shape '[batchDim, seqDim])) =&gt;
SDim batchDim
-&gt; SDim seqDim -&gt; SDevice device -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5Input"><span class="hs-identifier hs-var">mkT5Input</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 19) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 19))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 19 =&gt; SSize ('Size 19)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">19</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679586839"><span class="hs-identifier hs-var">tokens</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621679586837"><span class="annot"><span class="annottext">StateDict
</span><a href="#local-6989586621679586837"><span class="hs-identifier hs-var">stateDict</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO StateDict
</span><a href="Torch.GraduallyTyped.NN.Class.html#stateDictFromFile"><span class="hs-identifier hs-var">stateDictFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/tmp/t5-small-state-dict.pt&quot;</span></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586836"><span class="annot"><span class="annottext">spec :: ModelSpec
  (T5Small 'WithLMHead ('Gradient 'WithGradient) ('Device 'CPU))
</span><a href="#local-6989586621679586836"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STransformerHead 'WithLMHead
-&gt; SGradient ('Gradient 'WithGradient)
-&gt; SDevice ('Device 'CPU)
-&gt; ModelSpec
     (T5Small 'WithLMHead ('Gradient 'WithGradient) ('Device 'CPU))
forall (transformerHead :: TransformerHead)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)).
STransformerHead transformerHead
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; ModelSpec (T5Small transformerHead gradient device)
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Small.html#t5SmallSpec"><span class="hs-identifier hs-var">t5SmallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerHead 'WithLMHead
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SWithLMHead"><span class="hs-identifier hs-var">SWithLMHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
-&gt; SGradient ('Gradient 'WithGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithGradient"><span class="hs-identifier hs-var">SWithGradient</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621679586833"><span class="annot"><span class="annottext">GSimplifiedEncoderDecoderTransformer
  (GEncoderDecoderTransformer
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     (NamedModel
        (GTransformer
           ()
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32))
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 'Nothing))
           ()
           Dropout
           (NamedModel
              (GTransformerStack
                 (Vector
                    6
                    (GTransformerBlock
                       (NamedModel
                          (GSelfAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       ()
                       (NamedModel
                          (GTransformerFeedForwardNetwork
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Relu
                             Dropout
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                   (NamedModel ())))
                             Dropout
                             ()))))))
           (NamedModel
              (LayerNorm
                 'WithoutBias
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 T5DataType
                 ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
           Dropout))
     (NamedModel
        (GTransformer
           ()
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32))
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 'Nothing))
           ()
           Dropout
           (NamedModel
              (GTransformerStack
                 (Vector
                    6
                    (GTransformerBlock
                       (NamedModel
                          (GSelfAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       (NamedModel
                          (GCrossAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       (NamedModel
                          (GTransformerFeedForwardNetwork
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Relu
                             Dropout
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                   (NamedModel ())))
                             Dropout
                             ()))))))
           (NamedModel
              (LayerNorm
                 'WithoutBias
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 T5DataType
                 ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
           Dropout))
     (NamedModel
        (Embedding
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           ('Dim ('Name &quot;*&quot;) ('Size 32128))
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           'Nothing))
     (NamedModel
        (GLMHead
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           ()
           ()
           ()
           (NamedModel
              (GLinear
                 (NamedModel
                    (Tensor
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape
                          '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel ())))
           (GBias ()))))
  (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
  (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
  MkTransformerPaddingMask
  (MkTransformerAttentionMask T5DataType)
  (MkTransformerCrossAttentionMask T5DataType)
  (MkTransformerDecoderAttentionMask T5DataType)
</span><a href="#local-6989586621679586833"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (GSimplifiedEncoderDecoderTransformer
      (GEncoderDecoderTransformer
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         (NamedModel
            (GTransformer
               ()
               (NamedModel
                  (Embedding
                     ('Gradient 'WithGradient)
                     ('Layout 'Dense)
                     ('Device 'CPU)
                     T5DataType
                     ('Dim ('Name &quot;*&quot;) ('Size 32))
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     'Nothing))
               ()
               Dropout
               (NamedModel
                  (GTransformerStack
                     (Vector
                        6
                        (GTransformerBlock
                           (NamedModel
                              (GSelfAttention
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GMultiHeadAttention
                                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       Dropout))
                                 Dropout
                                 ()))
                           ()
                           (NamedModel
                              (GTransformerFeedForwardNetwork
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                   'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                       (NamedModel ())))
                                 Relu
                                 Dropout
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                   'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                       (NamedModel ())))
                                 Dropout
                                 ()))))))
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     T5DataType
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               Dropout))
         (NamedModel
            (GTransformer
               ()
               (NamedModel
                  (Embedding
                     ('Gradient 'WithGradient)
                     ('Layout 'Dense)
                     ('Device 'CPU)
                     T5DataType
                     ('Dim ('Name &quot;*&quot;) ('Size 32))
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     'Nothing))
               ()
               Dropout
               (NamedModel
                  (GTransformerStack
                     (Vector
                        6
                        (GTransformerBlock
                           (NamedModel
                              (GSelfAttention
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GMultiHeadAttention
                                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       Dropout))
                                 Dropout
                                 ()))
                           (NamedModel
                              (GCrossAttention
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GMultiHeadAttention
                                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       Dropout))
                                 Dropout
                                 ()))
                           (NamedModel
                              (GTransformerFeedForwardNetwork
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                   'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                       (NamedModel ())))
                                 Relu
                                 Dropout
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                   'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                       (NamedModel ())))
                                 Dropout
                                 ()))))))
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     T5DataType
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               Dropout))
         (NamedModel
            (Embedding
               ('Gradient 'WithGradient)
               ('Layout 'Dense)
               ('Device 'CPU)
               T5DataType
               ('Dim ('Name &quot;*&quot;) ('Size 32128))
               ('Dim ('Name &quot;*&quot;) ('Size 512))
               'Nothing))
         (NamedModel
            (GLMHead
               ('Dim ('Name &quot;*&quot;) ('Size 512))
               ()
               ()
               ()
               (NamedModel
                  (GLinear
                     (NamedModel
                        (Tensor
                           ('Gradient 'WithGradient)
                           ('Layout 'Dense)
                           ('Device 'CPU)
                           T5DataType
                           ('Shape
                              '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel ())))
               (GBias ()))))
      (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
      (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
      MkTransformerPaddingMask
      (MkTransformerAttentionMask T5DataType)
      (MkTransformerCrossAttentionMask T5DataType)
      (MkTransformerDecoderAttentionMask T5DataType))
 -&gt; StateDict
 -&gt; IO
      (GSimplifiedEncoderDecoderTransformer
         (GEncoderDecoderTransformer
            ('Dim ('Name &quot;*&quot;) ('Size 512))
            (NamedModel
               (GTransformer
                  ()
                  (NamedModel
                     (Embedding
                        ('Gradient 'WithGradient)
                        ('Layout 'Dense)
                        ('Device 'CPU)
                        T5DataType
                        ('Dim ('Name &quot;*&quot;) ('Size 32))
                        ('Dim ('Name &quot;*&quot;) ('Size 8))
                        'Nothing))
                  ()
                  Dropout
                  (NamedModel
                     (GTransformerStack
                        (Vector
                           6
                           (GTransformerBlock
                              (NamedModel
                                 (GSelfAttention
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GMultiHeadAttention
                                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          Dropout))
                                    Dropout
                                    ()))
                              ()
                              (NamedModel
                                 (GTransformerFeedForwardNetwork
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                          (NamedModel ())))
                                    Relu
                                    Dropout
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                          (NamedModel ())))
                                    Dropout
                                    ()))))))
                  (NamedModel
                     (LayerNorm
                        'WithoutBias
                        ('Gradient 'WithGradient)
                        ('Device 'CPU)
                        T5DataType
                        ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                  Dropout))
            (NamedModel
               (GTransformer
                  ()
                  (NamedModel
                     (Embedding
                        ('Gradient 'WithGradient)
                        ('Layout 'Dense)
                        ('Device 'CPU)
                        T5DataType
                        ('Dim ('Name &quot;*&quot;) ('Size 32))
                        ('Dim ('Name &quot;*&quot;) ('Size 8))
                        'Nothing))
                  ()
                  Dropout
                  (NamedModel
                     (GTransformerStack
                        (Vector
                           6
                           (GTransformerBlock
                              (NamedModel
                                 (GSelfAttention
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GMultiHeadAttention
                                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          Dropout))
                                    Dropout
                                    ()))
                              (NamedModel
                                 (GCrossAttention
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GMultiHeadAttention
                                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          Dropout))
                                    Dropout
                                    ()))
                              (NamedModel
                                 (GTransformerFeedForwardNetwork
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                          (NamedModel ())))
                                    Relu
                                    Dropout
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                          (NamedModel ())))
                                    Dropout
                                    ()))))))
                  (NamedModel
                     (LayerNorm
                        'WithoutBias
                        ('Gradient 'WithGradient)
                        ('Device 'CPU)
                        T5DataType
                        ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                  Dropout))
            (NamedModel
               (Embedding
                  ('Gradient 'WithGradient)
                  ('Layout 'Dense)
                  ('Device 'CPU)
                  T5DataType
                  ('Dim ('Name &quot;*&quot;) ('Size 32128))
                  ('Dim ('Name &quot;*&quot;) ('Size 512))
                  'Nothing))
            (NamedModel
               (GLMHead
                  ('Dim ('Name &quot;*&quot;) ('Size 512))
                  ()
                  ()
                  ()
                  (NamedModel
                     (GLinear
                        (NamedModel
                           (Tensor
                              ('Gradient 'WithGradient)
                              ('Layout 'Dense)
                              ('Device 'CPU)
                              T5DataType
                              ('Shape
                                 '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel ())))
                  (GBias ()))))
         (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
         (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
         MkTransformerPaddingMask
         (MkTransformerAttentionMask T5DataType)
         (MkTransformerCrossAttentionMask T5DataType)
         (MkTransformerDecoderAttentionMask T5DataType)))
-&gt; StateDict
-&gt; StateT
     StateDict
     IO
     (GSimplifiedEncoderDecoderTransformer
        (GEncoderDecoderTransformer
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             ()
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GCrossAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32128))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 'Nothing))
           (NamedModel
              (GLMHead
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ()
                 ()
                 ()
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             T5DataType
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 (GBias ()))))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        MkTransformerPaddingMask
        (MkTransformerAttentionMask T5DataType)
        (MkTransformerCrossAttentionMask T5DataType)
        (MkTransformerDecoderAttentionMask T5DataType))
-&gt; IO
     (GSimplifiedEncoderDecoderTransformer
        (GEncoderDecoderTransformer
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             ()
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GCrossAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32128))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 'Nothing))
           (NamedModel
              (GLMHead
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ()
                 ()
                 ()
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             T5DataType
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 (GBias ()))))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        MkTransformerPaddingMask
        (MkTransformerAttentionMask T5DataType)
        (MkTransformerCrossAttentionMask T5DataType)
        (MkTransformerDecoderAttentionMask T5DataType))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT
  StateDict
  IO
  (GSimplifiedEncoderDecoderTransformer
     (GEncoderDecoderTransformer
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          ()
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GCrossAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (Embedding
              ('Gradient 'WithGradient)
              ('Layout 'Dense)
              ('Device 'CPU)
              T5DataType
              ('Dim ('Name &quot;*&quot;) ('Size 32128))
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              'Nothing))
        (NamedModel
           (GLMHead
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              ()
              ()
              ()
              (NamedModel
                 (GLinear
                    (NamedModel
                       (Tensor
                          ('Gradient 'WithGradient)
                          ('Layout 'Dense)
                          ('Device 'CPU)
                          T5DataType
                          ('Shape
                             '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel ())))
              (GBias ()))))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     MkTransformerPaddingMask
     (MkTransformerAttentionMask T5DataType)
     (MkTransformerCrossAttentionMask T5DataType)
     (MkTransformerDecoderAttentionMask T5DataType))
-&gt; StateDict
-&gt; IO
     (GSimplifiedEncoderDecoderTransformer
        (GEncoderDecoderTransformer
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             ()
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GCrossAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32128))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 'Nothing))
           (NamedModel
              (GLMHead
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ()
                 ()
                 ()
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             T5DataType
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 (GBias ()))))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        MkTransformerPaddingMask
        (MkTransformerAttentionMask T5DataType)
        (MkTransformerCrossAttentionMask T5DataType)
        (MkTransformerDecoderAttentionMask T5DataType))
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="annot"><span class="annottext">StateDict
</span><a href="#local-6989586621679586837"><span class="hs-identifier hs-var">stateDict</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (GSimplifiedEncoderDecoderTransformer
      (GEncoderDecoderTransformer
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         (NamedModel
            (GTransformer
               ()
               (NamedModel
                  (Embedding
                     ('Gradient 'WithGradient)
                     ('Layout 'Dense)
                     ('Device 'CPU)
                     T5DataType
                     ('Dim ('Name &quot;*&quot;) ('Size 32))
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     'Nothing))
               ()
               Dropout
               (NamedModel
                  (GTransformerStack
                     (Vector
                        6
                        (GTransformerBlock
                           (NamedModel
                              (GSelfAttention
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GMultiHeadAttention
                                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       Dropout))
                                 Dropout
                                 ()))
                           ()
                           (NamedModel
                              (GTransformerFeedForwardNetwork
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                   'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                       (NamedModel ())))
                                 Relu
                                 Dropout
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                   'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                       (NamedModel ())))
                                 Dropout
                                 ()))))))
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     T5DataType
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               Dropout))
         (NamedModel
            (GTransformer
               ()
               (NamedModel
                  (Embedding
                     ('Gradient 'WithGradient)
                     ('Layout 'Dense)
                     ('Device 'CPU)
                     T5DataType
                     ('Dim ('Name &quot;*&quot;) ('Size 32))
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     'Nothing))
               ()
               Dropout
               (NamedModel
                  (GTransformerStack
                     (Vector
                        6
                        (GTransformerBlock
                           (NamedModel
                              (GSelfAttention
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GMultiHeadAttention
                                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       Dropout))
                                 Dropout
                                 ()))
                           (NamedModel
                              (GCrossAttention
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GMultiHeadAttention
                                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       (NamedModel
                                          (GLinear
                                             (NamedModel
                                                (Tensor
                                                   ('Gradient 'WithGradient)
                                                   ('Layout 'Dense)
                                                   ('Device 'CPU)
                                                   T5DataType
                                                   ('Shape
                                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                             (NamedModel ())))
                                       Dropout))
                                 Dropout
                                 ()))
                           (NamedModel
                              (GTransformerFeedForwardNetwork
                                 (NamedModel
                                    (LayerNorm
                                       'WithoutBias
                                       ('Gradient 'WithGradient)
                                       ('Device 'CPU)
                                       T5DataType
                                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                   'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                       (NamedModel ())))
                                 Relu
                                 Dropout
                                 (NamedModel
                                    (GLinear
                                       (NamedModel
                                          (Tensor
                                             ('Gradient 'WithGradient)
                                             ('Layout 'Dense)
                                             ('Device 'CPU)
                                             T5DataType
                                             ('Shape
                                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                   'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                       (NamedModel ())))
                                 Dropout
                                 ()))))))
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     T5DataType
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               Dropout))
         (NamedModel
            (Embedding
               ('Gradient 'WithGradient)
               ('Layout 'Dense)
               ('Device 'CPU)
               T5DataType
               ('Dim ('Name &quot;*&quot;) ('Size 32128))
               ('Dim ('Name &quot;*&quot;) ('Size 512))
               'Nothing))
         (NamedModel
            (GLMHead
               ('Dim ('Name &quot;*&quot;) ('Size 512))
               ()
               ()
               ()
               (NamedModel
                  (GLinear
                     (NamedModel
                        (Tensor
                           ('Gradient 'WithGradient)
                           ('Layout 'Dense)
                           ('Device 'CPU)
                           T5DataType
                           ('Shape
                              '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel ())))
               (GBias ()))))
      (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
      (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
      MkTransformerPaddingMask
      (MkTransformerAttentionMask T5DataType)
      (MkTransformerCrossAttentionMask T5DataType)
      (MkTransformerDecoderAttentionMask T5DataType))
 -&gt; IO
      (GSimplifiedEncoderDecoderTransformer
         (GEncoderDecoderTransformer
            ('Dim ('Name &quot;*&quot;) ('Size 512))
            (NamedModel
               (GTransformer
                  ()
                  (NamedModel
                     (Embedding
                        ('Gradient 'WithGradient)
                        ('Layout 'Dense)
                        ('Device 'CPU)
                        T5DataType
                        ('Dim ('Name &quot;*&quot;) ('Size 32))
                        ('Dim ('Name &quot;*&quot;) ('Size 8))
                        'Nothing))
                  ()
                  Dropout
                  (NamedModel
                     (GTransformerStack
                        (Vector
                           6
                           (GTransformerBlock
                              (NamedModel
                                 (GSelfAttention
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GMultiHeadAttention
                                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          Dropout))
                                    Dropout
                                    ()))
                              ()
                              (NamedModel
                                 (GTransformerFeedForwardNetwork
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                          (NamedModel ())))
                                    Relu
                                    Dropout
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                          (NamedModel ())))
                                    Dropout
                                    ()))))))
                  (NamedModel
                     (LayerNorm
                        'WithoutBias
                        ('Gradient 'WithGradient)
                        ('Device 'CPU)
                        T5DataType
                        ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                  Dropout))
            (NamedModel
               (GTransformer
                  ()
                  (NamedModel
                     (Embedding
                        ('Gradient 'WithGradient)
                        ('Layout 'Dense)
                        ('Device 'CPU)
                        T5DataType
                        ('Dim ('Name &quot;*&quot;) ('Size 32))
                        ('Dim ('Name &quot;*&quot;) ('Size 8))
                        'Nothing))
                  ()
                  Dropout
                  (NamedModel
                     (GTransformerStack
                        (Vector
                           6
                           (GTransformerBlock
                              (NamedModel
                                 (GSelfAttention
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GMultiHeadAttention
                                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          Dropout))
                                    Dropout
                                    ()))
                              (NamedModel
                                 (GCrossAttention
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GMultiHeadAttention
                                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          (NamedModel
                                             (GLinear
                                                (NamedModel
                                                   (Tensor
                                                      ('Gradient 'WithGradient)
                                                      ('Layout 'Dense)
                                                      ('Device 'CPU)
                                                      T5DataType
                                                      ('Shape
                                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                                (NamedModel ())))
                                          Dropout))
                                    Dropout
                                    ()))
                              (NamedModel
                                 (GTransformerFeedForwardNetwork
                                    (NamedModel
                                       (LayerNorm
                                          'WithoutBias
                                          ('Gradient 'WithGradient)
                                          ('Device 'CPU)
                                          T5DataType
                                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                          (NamedModel ())))
                                    Relu
                                    Dropout
                                    (NamedModel
                                       (GLinear
                                          (NamedModel
                                             (Tensor
                                                ('Gradient 'WithGradient)
                                                ('Layout 'Dense)
                                                ('Device 'CPU)
                                                T5DataType
                                                ('Shape
                                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                          (NamedModel ())))
                                    Dropout
                                    ()))))))
                  (NamedModel
                     (LayerNorm
                        'WithoutBias
                        ('Gradient 'WithGradient)
                        ('Device 'CPU)
                        T5DataType
                        ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                  Dropout))
            (NamedModel
               (Embedding
                  ('Gradient 'WithGradient)
                  ('Layout 'Dense)
                  ('Device 'CPU)
                  T5DataType
                  ('Dim ('Name &quot;*&quot;) ('Size 32128))
                  ('Dim ('Name &quot;*&quot;) ('Size 512))
                  'Nothing))
            (NamedModel
               (GLMHead
                  ('Dim ('Name &quot;*&quot;) ('Size 512))
                  ()
                  ()
                  ()
                  (NamedModel
                     (GLinear
                        (NamedModel
                           (Tensor
                              ('Gradient 'WithGradient)
                              ('Layout 'Dense)
                              ('Device 'CPU)
                              T5DataType
                              ('Shape
                                 '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel ())))
                  (GBias ()))))
         (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
         (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
         MkTransformerPaddingMask
         (MkTransformerAttentionMask T5DataType)
         (MkTransformerCrossAttentionMask T5DataType)
         (MkTransformerDecoderAttentionMask T5DataType)))
-&gt; StateT
     StateDict
     IO
     (GSimplifiedEncoderDecoderTransformer
        (GEncoderDecoderTransformer
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             ()
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GCrossAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32128))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 'Nothing))
           (NamedModel
              (GLMHead
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ()
                 ()
                 ()
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             T5DataType
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 (GBias ()))))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        MkTransformerPaddingMask
        (MkTransformerAttentionMask T5DataType)
        (MkTransformerCrossAttentionMask T5DataType)
        (MkTransformerDecoderAttentionMask T5DataType))
-&gt; IO
     (GSimplifiedEncoderDecoderTransformer
        (GEncoderDecoderTransformer
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             ()
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GCrossAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32128))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 'Nothing))
           (NamedModel
              (GLMHead
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ()
                 ()
                 ()
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             T5DataType
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 (GBias ()))))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        MkTransformerPaddingMask
        (MkTransformerAttentionMask T5DataType)
        (MkTransformerCrossAttentionMask T5DataType)
        (MkTransformerDecoderAttentionMask T5DataType))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (GSimplifiedEncoderDecoderTransformer
     (GEncoderDecoderTransformer
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          ()
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GCrossAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (Embedding
              ('Gradient 'WithGradient)
              ('Layout 'Dense)
              ('Device 'CPU)
              T5DataType
              ('Dim ('Name &quot;*&quot;) ('Size 32128))
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              'Nothing))
        (NamedModel
           (GLMHead
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              ()
              ()
              ()
              (NamedModel
                 (GLinear
                    (NamedModel
                       (Tensor
                          ('Gradient 'WithGradient)
                          ('Layout 'Dense)
                          ('Device 'CPU)
                          T5DataType
                          ('Shape
                             '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel ())))
              (GBias ()))))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     MkTransformerPaddingMask
     (MkTransformerAttentionMask T5DataType)
     (MkTransformerCrossAttentionMask T5DataType)
     (MkTransformerDecoderAttentionMask T5DataType))
-&gt; StateDictKey
-&gt; StateT
     StateDict
     IO
     (GSimplifiedEncoderDecoderTransformer
        (GEncoderDecoderTransformer
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             ()
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (GTransformer
                 ()
                 (NamedModel
                    (Embedding
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Dim ('Name &quot;*&quot;) ('Size 32))
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       'Nothing))
                 ()
                 Dropout
                 (NamedModel
                    (GTransformerStack
                       (Vector
                          6
                          (GTransformerBlock
                             (NamedModel
                                (GSelfAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GCrossAttention
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GMultiHeadAttention
                                         ('Dim ('Name &quot;*&quot;) ('Size 8))
                                         ('Dim ('Name &quot;*&quot;) ('Size 64))
                                         ('Dim ('Name &quot;*&quot;) ('Size 512))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         (NamedModel
                                            (GLinear
                                               (NamedModel
                                                  (Tensor
                                                     ('Gradient 'WithGradient)
                                                     ('Layout 'Dense)
                                                     ('Device 'CPU)
                                                     T5DataType
                                                     ('Shape
                                                        '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                           'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                               (NamedModel ())))
                                         Dropout))
                                   Dropout
                                   ()))
                             (NamedModel
                                (GTransformerFeedForwardNetwork
                                   (NamedModel
                                      (LayerNorm
                                         'WithoutBias
                                         ('Gradient 'WithGradient)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Relu
                                   Dropout
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                         (NamedModel ())))
                                   Dropout
                                   ()))))))
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 Dropout))
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32128))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 'Nothing))
           (NamedModel
              (GLMHead
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ()
                 ()
                 ()
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             T5DataType
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 (GBias ()))))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
        MkTransformerPaddingMask
        (MkTransformerAttentionMask T5DataType)
        (MkTransformerCrossAttentionMask T5DataType)
        (MkTransformerDecoderAttentionMask T5DataType))
forall model (m :: * -&gt; *).
(HasStateDict model, MonadIO m, MonadThrow m,
 MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (GSimplifiedEncoderDecoderTransformer
     (GEncoderDecoderTransformer
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          ()
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GCrossAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (Embedding
              ('Gradient 'WithGradient)
              ('Layout 'Dense)
              ('Device 'CPU)
              T5DataType
              ('Dim ('Name &quot;*&quot;) ('Size 32128))
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              'Nothing))
        (NamedModel
           (GLMHead
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              ()
              ()
              ()
              (NamedModel
                 (GLinear
                    (NamedModel
                       (Tensor
                          ('Gradient 'WithGradient)
                          ('Layout 'Dense)
                          ('Device 'CPU)
                          T5DataType
                          ('Shape
                             '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel ())))
              (GBias ()))))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     MkTransformerPaddingMask
     (MkTransformerAttentionMask T5DataType)
     (MkTransformerCrossAttentionMask T5DataType)
     (MkTransformerDecoderAttentionMask T5DataType))
GSimplifiedEncoderDecoderTransformer
  (GEncoderDecoderTransformer
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     (NamedModel
        (GTransformer
           ()
           (NamedModel
              (EmbeddingSpec
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32))
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 'Nothing))
           ()
           Dropout
           (NamedModel
              (GTransformerStack
                 (VectorSpec
                    6
                    (GTransformerBlock
                       (NamedModel
                          (GSelfAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       ()
                       (NamedModel
                          (GTransformerFeedForwardNetwork
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Relu
                             Dropout
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                   (NamedModel ())))
                             Dropout
                             ()))))))
           (NamedModel
              (LayerNormSpec
                 'WithoutBias
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 T5DataType
                 ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
           Dropout))
     (NamedModel
        (GTransformer
           ()
           (NamedModel
              (EmbeddingSpec
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32))
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 'Nothing))
           ()
           Dropout
           (NamedModel
              (GTransformerStack
                 (VectorSpec
                    6
                    (GTransformerBlock
                       (NamedModel
                          (GSelfAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       (NamedModel
                          (GCrossAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       (NamedModel
                          (GTransformerFeedForwardNetwork
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Relu
                             Dropout
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                   (NamedModel ())))
                             Dropout
                             ()))))))
           (NamedModel
              (LayerNormSpec
                 'WithoutBias
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 T5DataType
                 ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
           Dropout))
     (NamedModel
        (EmbeddingSpec
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           ('Dim ('Name &quot;*&quot;) ('Size 32128))
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           'Nothing))
     (NamedModel
        (GLMHead
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           ()
           ()
           ()
           (NamedModel
              (GLinear
                 (NamedModel
                    (TensorSpec
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape
                          '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel ())))
           (GBias ()))))
  (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
  (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
  MkTransformerPaddingMask
  (MkTransformerAttentionMask T5DataType)
  (MkTransformerCrossAttentionMask T5DataType)
  (MkTransformerDecoderAttentionMask T5DataType)
</span><a href="#local-6989586621679586836"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586831"><span class="annot"><span class="annottext">g :: Generator ('Device 'CPU)
</span><a href="#local-6989586621679586831"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU) -&gt; Word64 -&gt; Generator ('Device 'CPU)
forall (device :: Device (DeviceType Nat)).
SDevice device -&gt; Word64 -&gt; Generator device
</span><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier hs-var">sMkGenerator</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#Beams"><span class="hs-identifier hs-type">Beams</span></a></span><span> </span><span id="local-6989586621679586830"><span class="annot"><span class="annottext">[Hypothesis 'Finished Int [Int]]
</span><a href="#local-6989586621679586830"><span class="hs-identifier hs-var">finished</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Unfinished Int [Int]]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Beams Int [Int]] -&gt; Beams Int [Int]
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">([Beams Int [Int]] -&gt; Beams Int [Int])
-&gt; IO [Beams Int [Int]] -&gt; IO (Beams Int [Int])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; GSimplifiedEncoderDecoderTransformer
     (GEncoderDecoderTransformer
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          ()
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (GTransformer
              ()
              (NamedModel
                 (Embedding
                    ('Gradient 'WithGradient)
                    ('Layout 'Dense)
                    ('Device 'CPU)
                    T5DataType
                    ('Dim ('Name &quot;*&quot;) ('Size 32))
                    ('Dim ('Name &quot;*&quot;) ('Size 8))
                    'Nothing))
              ()
              Dropout
              (NamedModel
                 (GTransformerStack
                    (Vector
                       6
                       (GTransformerBlock
                          (NamedModel
                             (GSelfAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GCrossAttention
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GMultiHeadAttention
                                      ('Dim ('Name &quot;*&quot;) ('Size 8))
                                      ('Dim ('Name &quot;*&quot;) ('Size 64))
                                      ('Dim ('Name &quot;*&quot;) ('Size 512))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      (NamedModel
                                         (GLinear
                                            (NamedModel
                                               (Tensor
                                                  ('Gradient 'WithGradient)
                                                  ('Layout 'Dense)
                                                  ('Device 'CPU)
                                                  T5DataType
                                                  ('Shape
                                                     '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                        'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                            (NamedModel ())))
                                      Dropout))
                                Dropout
                                ()))
                          (NamedModel
                             (GTransformerFeedForwardNetwork
                                (NamedModel
                                   (LayerNorm
                                      'WithoutBias
                                      ('Gradient 'WithGradient)
                                      ('Device 'CPU)
                                      T5DataType
                                      ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                                  'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                      (NamedModel ())))
                                Relu
                                Dropout
                                (NamedModel
                                   (GLinear
                                      (NamedModel
                                         (Tensor
                                            ('Gradient 'WithGradient)
                                            ('Layout 'Dense)
                                            ('Device 'CPU)
                                            T5DataType
                                            ('Shape
                                               '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                  'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                      (NamedModel ())))
                                Dropout
                                ()))))))
              (NamedModel
                 (LayerNorm
                    'WithoutBias
                    ('Gradient 'WithGradient)
                    ('Device 'CPU)
                    T5DataType
                    ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
              Dropout))
        (NamedModel
           (Embedding
              ('Gradient 'WithGradient)
              ('Layout 'Dense)
              ('Device 'CPU)
              T5DataType
              ('Dim ('Name &quot;*&quot;) ('Size 32128))
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              'Nothing))
        (NamedModel
           (GLMHead
              ('Dim ('Name &quot;*&quot;) ('Size 512))
              ()
              ()
              ()
              (NamedModel
                 (GLinear
                    (NamedModel
                       (Tensor
                          ('Gradient 'WithGradient)
                          ('Layout 'Dense)
                          ('Device 'CPU)
                          T5DataType
                          ('Shape
                             '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel ())))
              (GBias ()))))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
     MkTransformerPaddingMask
     (MkTransformerAttentionMask T5DataType)
     (MkTransformerCrossAttentionMask T5DataType)
     (MkTransformerDecoderAttentionMask T5DataType)
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 19)])
-&gt; Generator ('Device 'CPU)
-&gt; IO [Beams Int [Int]]
forall model input decoderInput encoderOutput
       (encoderOutputShape :: Shape [Dim (Name Symbol) (Size Nat)])
       encoderOutput' inputPaddingMask decoderOutput
       (generatorDevice :: Device (DeviceType Nat)).
(HasForward
   model
   (SimplifiedEncoderDecoderTransformerInput input decoderInput)
   generatorDevice
   (SimplifiedEncoderDecoderTransformerOutput
      decoderOutput encoderOutput inputPaddingMask)
   generatorDevice,
 encoderOutput
 ~ Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     encoderOutputShape,
 'UncheckedShape
 ~ BroadcastShapesF encoderOutputShape 'UncheckedShape,
 SGetShape encoderOutputShape,
 HasForward
   model
   (SimplifiedEncoderDecoderTransformerGenerationInput
      decoderInput encoderOutput' inputPaddingMask)
   generatorDevice
   (SimplifiedEncoderDecoderTransformerOutput
      decoderOutput encoderOutput' inputPaddingMask)
   generatorDevice,
 encoderOutput'
 ~ Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape,
 decoderInput
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) 'UncheckedSize,
           'Dim ('Name &quot;*&quot;) 'UncheckedSize]),
 decoderOutput
 ~ Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape,
 generatorDevice ~ 'Device 'CPU) =&gt;
Int
-&gt; Int
-&gt; model
-&gt; input
-&gt; Generator generatorDevice
-&gt; IO [Beams Int [Int]]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#runBeamSearch"><span class="hs-identifier hs-var">runBeamSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">GSimplifiedEncoderDecoderTransformer
  (GEncoderDecoderTransformer
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     (NamedModel
        (GTransformer
           ()
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32))
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 'Nothing))
           ()
           Dropout
           (NamedModel
              (GTransformerStack
                 (Vector
                    6
                    (GTransformerBlock
                       (NamedModel
                          (GSelfAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       ()
                       (NamedModel
                          (GTransformerFeedForwardNetwork
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Relu
                             Dropout
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                   (NamedModel ())))
                             Dropout
                             ()))))))
           (NamedModel
              (LayerNorm
                 'WithoutBias
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 T5DataType
                 ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
           Dropout))
     (NamedModel
        (GTransformer
           ()
           (NamedModel
              (Embedding
                 ('Gradient 'WithGradient)
                 ('Layout 'Dense)
                 ('Device 'CPU)
                 T5DataType
                 ('Dim ('Name &quot;*&quot;) ('Size 32))
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 'Nothing))
           ()
           Dropout
           (NamedModel
              (GTransformerStack
                 (Vector
                    6
                    (GTransformerBlock
                       (NamedModel
                          (GSelfAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       (NamedModel
                          (GCrossAttention
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GMultiHeadAttention
                                   ('Dim ('Name &quot;*&quot;) ('Size 8))
                                   ('Dim ('Name &quot;*&quot;) ('Size 64))
                                   ('Dim ('Name &quot;*&quot;) ('Size 512))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   (NamedModel
                                      (GLinear
                                         (NamedModel
                                            (Tensor
                                               ('Gradient 'WithGradient)
                                               ('Layout 'Dense)
                                               ('Device 'CPU)
                                               T5DataType
                                               ('Shape
                                                  '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                     'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                         (NamedModel ())))
                                   Dropout))
                             Dropout
                             ()))
                       (NamedModel
                          (GTransformerFeedForwardNetwork
                             (NamedModel
                                (LayerNorm
                                   'WithoutBias
                                   ('Gradient 'WithGradient)
                                   ('Device 'CPU)
                                   T5DataType
                                   ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Relu
                             Dropout
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         T5DataType
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                                   (NamedModel ())))
                             Dropout
                             ()))))))
           (NamedModel
              (LayerNorm
                 'WithoutBias
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 T5DataType
                 ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
           Dropout))
     (NamedModel
        (Embedding
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           ('Dim ('Name &quot;*&quot;) ('Size 32128))
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           'Nothing))
     (NamedModel
        (GLMHead
           ('Dim ('Name &quot;*&quot;) ('Size 512))
           ()
           ()
           ()
           (NamedModel
              (GLinear
                 (NamedModel
                    (Tensor
                       ('Gradient 'WithGradient)
                       ('Layout 'Dense)
                       ('Device 'CPU)
                       T5DataType
                       ('Shape
                          '[ 'Dim ('Name &quot;*&quot;) ('Size 32128), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel ())))
           (GBias ()))))
  (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
  (MkRelPos ('Dim ('Name &quot;*&quot;) ('Size 32)))
  MkTransformerPaddingMask
  (MkTransformerAttentionMask T5DataType)
  (MkTransformerCrossAttentionMask T5DataType)
  (MkTransformerDecoderAttentionMask T5DataType)
</span><a href="#local-6989586621679586833"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 19)])
</span><a href="#local-6989586621679586840"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679586831"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><span class="annottext">[[Int]] -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">([[Int]] -&gt; IO ()) -&gt; [[Int]] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hypothesis 'Finished Int [Int] -&gt; [Int]
forall a b. Hypothesis 'Finished a b -&gt; b
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#finalValue"><span class="hs-identifier hs-var hs-var">finalValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Hypothesis 'Finished Int [Int] -&gt; [Int])
-&gt; [Hypothesis 'Finished Int [Int]] -&gt; [[Int]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Hypothesis 'Finished Int [Int]]
</span><a href="#local-6989586621679586830"><span class="hs-identifier hs-var">finished</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-comment">-- let tmp = parseString @[] (transParser t5Vocab t5Text) . finalValue &lt;$&gt; finished</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- print tmp</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#next"><span class="hs-identifier hs-type">next</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587108"><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621679587107"><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679587109"><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679587106"><span class="annot"><a href="#local-6989586621679587106"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587106"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587106"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679587106"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="#local-6989586621679587108"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587109"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587107"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679587106"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-280"></span><span id="next"><span class="annot"><span class="annottext">next :: t (StateT [i] b) i
-&gt; Parser (StateT [i] b) i a
-&gt; (Parser (StateT [i] b) i a -&gt; t (StateT [i] b) a)
-&gt; t (StateT [i] b) a
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#next"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span id="local-6989586621679586828"><span class="annot"><span class="annottext">t (StateT [i] b) i
</span><a href="#local-6989586621679586828"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span id="local-6989586621679586827"><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586827"><span class="hs-identifier hs-var">parser</span></a></span></span><span> </span><span id="local-6989586621679586826"><span class="annot"><span class="annottext">Parser (StateT [i] b) i a -&gt; t (StateT [i] b) a
</span><a href="#local-6989586621679586826"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">StateT [i] b Bool -&gt; t (StateT [i] b) Bool
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a -&gt; StateT [i] b Bool
forall (b :: * -&gt; *) i a.
(Monad b, Foldable b) =&gt;
Parser (StateT [i] b) i a -&gt; StateT [i] b Bool
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586827"><span class="hs-identifier hs-var">parser</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (StateT [i] b) Bool
-&gt; (Bool -&gt; t (StateT [i] b) ()) -&gt; t (StateT [i] b) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; t (StateT [i] b) ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span>
</span><span id="line-282"></span><span>  </span><span id="local-6989586621679586824"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679586824"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t (StateT [i] b) i
</span><a href="#local-6989586621679586828"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="annottext">StateT [i] b () -&gt; t (StateT [i] b) ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(StateT [i] b () -&gt; t (StateT [i] b) ())
-&gt; StateT [i] b () -&gt; t (StateT [i] b) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([i] -&gt; [i]) -&gt; StateT [i] b ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679586824"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">i -&gt; [i] -&gt; [i]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621679586823"><span class="annot"><span class="annottext">FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)
</span><a href="#local-6989586621679586823"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
-&gt; t (StateT [i] b) (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
 -&gt; t (StateT [i] b) (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)))
-&gt; StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
-&gt; t (StateT [i] b) (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
-&gt; StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
FreeT f m a -&gt; m (FreeF f a (FreeT f m a))
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var hs-var">runFreeT</span></a></span><span> </span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586827"><span class="hs-identifier hs-var">parser</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)
</span><a href="#local-6989586621679586823"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621679586821"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586821"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; t (StateT [i] b) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586821"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621679586819"><span class="annot"><span class="annottext">i -&gt; Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586819"><span class="hs-identifier hs-var">feed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (t (StateT [i] b) a) -&gt; t (StateT [i] b) a
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (t (StateT [i] b) a) -&gt; t (StateT [i] b) a)
-&gt; IO (t (StateT [i] b) a) -&gt; t (StateT [i] b) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-comment">-- putStrLn $ &quot;feed: &quot; &lt;&gt; show (t5Vocab Map.! i)</span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">t (StateT [i] b) a -&gt; IO (t (StateT [i] b) a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(t (StateT [i] b) a -&gt; IO (t (StateT [i] b) a))
-&gt; t (StateT [i] b) a -&gt; IO (t (StateT [i] b) a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a -&gt; t (StateT [i] b) a
</span><a href="#local-6989586621679586826"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">(Parser (StateT [i] b) i a -&gt; t (StateT [i] b) a)
-&gt; (i -&gt; Parser (StateT [i] b) i a) -&gt; i -&gt; t (StateT [i] b) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">i -&gt; Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586819"><span class="hs-identifier hs-var">feed</span></a></span><span> </span><span class="annot"><span class="annottext">(i -&gt; t (StateT [i] b) a) -&gt; i -&gt; t (StateT [i] b) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679586824"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span id="local-6989586621679587233"><span id="local-6989586621679587234"><span id="local-6989586621679587235"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#notNull"><span class="hs-identifier hs-type">notNull</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679587235"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679587235"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587234"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587235"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679587234"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587233"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679587234"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587235"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-295"></span><span id="notNull"><span class="annot"><span class="annottext">notNull :: Parser (StateT [i] b) i a -&gt; StateT [i] b Bool
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#notNull"><span class="hs-identifier hs-var hs-var">notNull</span></a></span></span><span> </span><span id="local-6989586621679586818"><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586818"><span class="hs-identifier hs-var">parser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([i] -&gt; Bool) -&gt; StateT [i] b Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">(([i] -&gt; Bool) -&gt; StateT [i] b Bool)
-&gt; ([i] -&gt; Bool) -&gt; StateT [i] b Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)) -&gt; Bool)
-&gt; b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)) -&gt; Bool)
-&gt; ([i] -&gt; b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)))
-&gt; [i]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
-&gt; [i] -&gt; b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
-&gt; StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
FreeT f m a -&gt; m (FreeF f a (FreeT f m a))
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var hs-var">runFreeT</span></a></span><span> </span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586818"><span class="hs-identifier hs-var">parser</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span id="local-6989586621679586813"><span id="local-6989586621679586814"><span id="local-6989586621679586815"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#hasFree"><span class="hs-identifier hs-type">hasFree</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679586815"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679586815"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679586814"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679586815"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679586814"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586813"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679586814"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679586815"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span></span><span>
</span><span id="line-301"></span><span id="hasFree"><span class="annot"><span class="annottext">hasFree :: Parser (StateT [i] b) i a -&gt; StateT [i] b Bool
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#hasFree"><span class="hs-identifier hs-var hs-var">hasFree</span></a></span></span><span> </span><span id="local-6989586621679586811"><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586811"><span class="hs-identifier hs-var">parser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([i] -&gt; Bool) -&gt; StateT [i] b Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">(([i] -&gt; Bool) -&gt; StateT [i] b Bool)
-&gt; ([i] -&gt; Bool) -&gt; StateT [i] b Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a) -&gt; Bool)
-&gt; b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span class="annot"><span class="annottext">i -&gt; Parser (StateT [i] b) i a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)) -&gt; Bool)
-&gt; ([i] -&gt; b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a)))
-&gt; [i]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
-&gt; [i] -&gt; b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
-&gt; StateT [i] b (FreeF ((-&gt;) i) a (Parser (StateT [i] b) i a))
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
FreeT f m a -&gt; m (FreeF f a (FreeT f m a))
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var hs-var">runFreeT</span></a></span><span> </span><span class="annot"><span class="annottext">Parser (StateT [i] b) i a
</span><a href="#local-6989586621679586811"><span class="hs-identifier hs-var">parser</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | @transParser vocab p@ transforms a parser @p@ over characters 'Char'</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- into a parser over token indices 'Int' using the vocabulary @vocab@.</span><span>
</span><span id="line-305"></span><span id="local-6989586621679587199"><span id="local-6989586621679587201"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#transParser"><span class="hs-identifier hs-type">transParser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679587201"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587201"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="#local-6989586621679587199"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587201"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679587199"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-306"></span><span id="transParser"><span class="annot"><span class="annottext">transParser :: Map Int String -&gt; Parser b Char a -&gt; Parser b Int a
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#transParser"><span class="hs-identifier hs-var hs-var">transParser</span></a></span></span><span> </span><span id="local-6989586621679586808"><span class="annot"><span class="annottext">Map Int String
</span><a href="#local-6989586621679586808"><span class="hs-identifier hs-var">vocab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b (FreeF ((-&gt;) Int) a (Parser b Int a)) -&gt; Parser b Int a
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
m (FreeF f a (FreeT f m a)) -&gt; FreeT f m a
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var">FreeT</span></a></span><span> </span><span class="annot"><span class="annottext">(b (FreeF ((-&gt;) Int) a (Parser b Int a)) -&gt; Parser b Int a)
-&gt; (Parser b Char a -&gt; b (FreeF ((-&gt;) Int) a (Parser b Int a)))
-&gt; Parser b Char a
-&gt; Parser b Int a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FreeF ((-&gt;) Char) a (Parser b Char a)
 -&gt; FreeF ((-&gt;) Int) a (Parser b Int a))
-&gt; b (FreeF ((-&gt;) Char) a (Parser b Char a))
-&gt; b (FreeF ((-&gt;) Int) a (Parser b Int a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Parser b Char a -&gt; Parser b Int a)
-&gt; FreeF ((-&gt;) Int) a (Parser b Char a)
-&gt; FreeF ((-&gt;) Int) a (Parser b Int a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int String -&gt; Parser b Char a -&gt; Parser b Int a
forall (b :: * -&gt; *) a.
MonadPlus b =&gt;
Map Int String -&gt; Parser b Char a -&gt; Parser b Int a
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#transParser"><span class="hs-identifier hs-var">transParser</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int String
</span><a href="#local-6989586621679586808"><span class="hs-identifier hs-var">vocab</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FreeF ((-&gt;) Int) a (Parser b Char a)
 -&gt; FreeF ((-&gt;) Int) a (Parser b Int a))
-&gt; (FreeF ((-&gt;) Char) a (Parser b Char a)
    -&gt; FreeF ((-&gt;) Int) a (Parser b Char a))
-&gt; FreeF ((-&gt;) Char) a (Parser b Char a)
-&gt; FreeF ((-&gt;) Int) a (Parser b Int a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FreeF ((-&gt;) Char) a (Parser b Char a)
-&gt; FreeF ((-&gt;) Int) a (Parser b Char a)
</span><a href="#local-6989586621679586806"><span class="hs-identifier hs-var">transFreeF</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(b (FreeF ((-&gt;) Char) a (Parser b Char a))
 -&gt; b (FreeF ((-&gt;) Int) a (Parser b Int a)))
-&gt; (Parser b Char a -&gt; b (FreeF ((-&gt;) Char) a (Parser b Char a)))
-&gt; Parser b Char a
-&gt; b (FreeF ((-&gt;) Int) a (Parser b Int a))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Parser b Char a -&gt; b (FreeF ((-&gt;) Char) a (Parser b Char a))
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
FreeT f m a -&gt; m (FreeF f a (FreeT f m a))
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var hs-var">runFreeT</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679586806"><span class="annot"><span class="annottext">transFreeF :: FreeF ((-&gt;) Char) a (Parser b Char a)
-&gt; FreeF ((-&gt;) Int) a (Parser b Char a)
</span><a href="#local-6989586621679586806"><span class="hs-identifier hs-var hs-var">transFreeF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621679586805"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586805"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; FreeF ((-&gt;) Int) a (Parser b Char a)
forall (f :: * -&gt; *) a b. a -&gt; FreeF f a b
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var">Pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586805"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="#local-6989586621679586806"><span class="hs-identifier hs-var">transFreeF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621679586804"><span class="annot"><span class="annottext">Char -&gt; Parser b Char a
</span><a href="#local-6989586621679586804"><span class="hs-identifier hs-var">feed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586803"><span class="annot"><span class="annottext">feed' :: Int -&gt; Parser b Char a
</span><a href="#local-6989586621679586803"><span class="hs-identifier hs-var hs-var">feed'</span></a></span></span><span> </span><span id="local-6989586621679586802"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586802"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>            </span><span id="local-6989586621679586801"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586801"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-312"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586800"><span class="annot"><span class="annottext">clean :: ShowS
</span><a href="#local-6989586621679586800"><span class="hs-identifier hs-var hs-var">clean</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&#9601;'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679586799"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586799"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586799"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-313"></span><span>                  </span><span class="annot"><a href="#local-6989586621679586800"><span class="hs-identifier hs-var">clean</span></a></span><span> </span><span id="local-6989586621679586798"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586798"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586798"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-314"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b String
-&gt; (String -&gt; FreeT ((-&gt;) Char) b String)
-&gt; Maybe String
-&gt; FreeT ((-&gt;) Char) b String
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b String
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FreeT ((-&gt;) Char) b String
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; FreeT ((-&gt;) Char) b String)
-&gt; ShowS -&gt; String -&gt; FreeT ((-&gt;) Char) b String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="#local-6989586621679586800"><span class="hs-identifier hs-var">clean</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Map Int String -&gt; Maybe String
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586802"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int String
</span><a href="#local-6989586621679586808"><span class="hs-identifier hs-var">vocab</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679586795"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679586795"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586794"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586794"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b (Char, String)
-&gt; ((Char, String) -&gt; FreeT ((-&gt;) Char) b (Char, String))
-&gt; Maybe (Char, String)
-&gt; FreeT ((-&gt;) Char) b (Char, String)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b (Char, String)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span> </span><span class="annot"><span class="annottext">(Char, String) -&gt; FreeT ((-&gt;) Char) b (Char, String)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe (Char, String)
forall a. [a] -&gt; Maybe (a, [a])
</span><span class="hs-identifier hs-var">uncons</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586801"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Parser b Char a -&gt; Parser b Char a
forall (m :: * -&gt; *) t a.
Monad m =&gt;
[t] -&gt; FreeT ((-&gt;) t) m a -&gt; FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586793"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586794"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Parser b Char a
</span><a href="#local-6989586621679586804"><span class="hs-identifier hs-var">feed</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679586795"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>          </span><span id="local-6989586621679586793"><span class="annot"><span class="annottext">go :: [t] -&gt; FreeT ((-&gt;) t) m a -&gt; FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586793"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679586792"><span class="annot"><span class="annottext">FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586792"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586792"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-318"></span><span>          </span><span class="annot"><a href="#local-6989586621679586793"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679586791"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679586791"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679586790"><span class="annot"><span class="annottext">[t]
</span><a href="#local-6989586621679586790"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679586789"><span class="annot"><span class="annottext">FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586789"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>            </span><span id="local-6989586621679586788"><span class="annot"><span class="annottext">FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a)
</span><a href="#local-6989586621679586788"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a))
-&gt; FreeT ((-&gt;) t) m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a))
 -&gt; FreeT ((-&gt;) t) m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a)))
-&gt; m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a))
-&gt; FreeT ((-&gt;) t) m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) t) m a -&gt; m (FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a))
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
FreeT f m a -&gt; m (FreeF f a (FreeT f m a))
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var hs-var">runFreeT</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586789"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-320"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FreeF ((-&gt;) t) a (FreeT ((-&gt;) t) m a)
</span><a href="#local-6989586621679586788"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>              </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621679586787"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586787"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; FreeT ((-&gt;) t) m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679586787"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-322"></span><span>              </span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">Free</span></a></span><span> </span><span id="local-6989586621679586786"><span class="annot"><span class="annottext">t -&gt; FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586786"><span class="hs-identifier hs-var">feed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[t] -&gt; FreeT ((-&gt;) t) m a -&gt; FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586793"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[t]
</span><a href="#local-6989586621679586790"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; FreeT ((-&gt;) t) m a
</span><a href="#local-6989586621679586786"><span class="hs-identifier hs-var">feed</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679586791"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Parser b Char a) -&gt; FreeF ((-&gt;) Int) a (Parser b Char a)
forall (f :: * -&gt; *) a b. f b -&gt; FreeF f a b
</span><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-var">Free</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Parser b Char a
</span><a href="#local-6989586621679586803"><span class="hs-identifier hs-var">feed'</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span id="local-6989586621679586785"><span class="hs-keyword">instance</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679586785"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679586785"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679586785"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-327"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-type">Parsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">FreeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-&gt;</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679586785"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621679586775"><span class="annot"><span class="annottext">try :: FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">try</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-330"></span><span>  </span><span id="local-6989586621679586772"><span class="annot"><span class="annottext">&lt;?&gt; :: FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; String -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;?&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; String -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span>
</span><span id="line-331"></span><span>  </span><span id="local-6989586621679586769"><span class="annot"><span class="annottext">skipMany :: FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">skipMany</span></a></span></span><span> </span><span id="local-6989586621679586767"><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="#local-6989586621679586767"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="#local-6989586621679586766"><span class="hs-identifier hs-var">scan</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679586766"><span class="annot"><span class="annottext">scan :: FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="#local-6989586621679586766"><span class="hs-identifier hs-var hs-var">scan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="#local-6989586621679586767"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="#local-6989586621679586766"><span class="hs-identifier hs-var">scan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) ()
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>  </span><span id="local-6989586621679586764"><span class="annot"><span class="annottext">skipSome :: FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">skipSome</span></a></span></span><span> </span><span id="local-6989586621679586762"><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="#local-6989586621679586762"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="#local-6989586621679586762"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall (m :: * -&gt; *) a. Parsing m =&gt; m a -&gt; m ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var">skipMany</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="#local-6989586621679586762"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span id="local-6989586621679586761"><span class="annot"><span class="annottext">unexpected :: String -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) a
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">unexpected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; String -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-334"></span><span>  </span><span id="local-6989586621679586759"><span class="annot"><span class="annottext">eof :: FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">eof</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-335"></span><span>  </span><span id="local-6989586621679586757"><span class="annot"><span class="annottext">notFollowedBy :: FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">notFollowedBy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) a
-&gt; FreeT ((-&gt;) Char) (StateT [Int] b) ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span id="local-6989586621679586755"><span class="hs-keyword">instance</span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621679586747"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679586755"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679586755"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679586755"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-type">CharParsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">FreeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-&gt;</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679586755"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>  </span><span id="local-6989586621679586745"><span class="annot"><span class="annottext">satisfy :: (Char -&gt; Bool) -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) Char
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">satisfy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) Char
forall (b :: * -&gt; *) i. MonadPlus b =&gt; (i -&gt; Bool) -&gt; Parser b i i
</span><a href="Torch.Data.Parser.html#satisfy"><span class="hs-identifier hs-var">Torch.Data.Parser.satisfy</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621679586743"><span class="annot"><span class="annottext">char :: Char -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) Char
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">char</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) Char
forall (b :: * -&gt; *) i. (MonadPlus b, Eq i) =&gt; i -&gt; Parser b i i
</span><a href="Torch.Data.Parser.html#isToken"><span class="hs-identifier hs-var">isToken</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span id="local-6989586621679586741"><span class="annot"><span class="annottext">notChar :: Char -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) Char
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">notChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) Char
forall (b :: * -&gt; *) i. (MonadPlus b, Eq i) =&gt; i -&gt; Parser b i i
</span><a href="Torch.Data.Parser.html#isNotToken"><span class="hs-identifier hs-var">isNotToken</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span id="local-6989586621679586739"><span class="annot"><span class="annottext">anyChar :: FreeT ((-&gt;) Char) (StateT [Int] b) Char
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">anyChar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) (StateT [Int] b) Char
forall (b :: * -&gt; *) i. Monad b =&gt; Parser b i i
</span><a href="Torch.Data.Parser.html#token"><span class="hs-identifier hs-var">Torch.Data.Parser.token</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span id="local-6989586621679586737"><span class="annot"><span class="annottext">string :: String -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) String
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FreeT ((-&gt;) Char) (StateT [Int] b) String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span id="local-6989586621679586735"><span class="hs-keyword">instance</span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621679586724"><span id="local-6989586621679586726"><span id="local-6989586621679586728"><span id="local-6989586621679586730"><span id="local-6989586621679586732"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679586735"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679586735"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679586735"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-type">TokenParsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">FreeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-&gt;</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679586735"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- | Get continuations from model</span><span>
</span><span id="line-352"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getIs"><span class="hs-identifier hs-type">getIs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679587098"><span class="annot"><a href="#local-6989586621679587098"><span class="hs-identifier hs-type">model</span></a></span></span><span> </span><span id="local-6989586621679587097"><span class="annot"><a href="#local-6989586621679587097"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679587101"><span class="annot"><a href="#local-6989586621679587101"><span class="hs-identifier hs-type">generatorDevice</span></a></span></span><span> </span><span id="local-6989586621679587105"><span class="annot"><a href="#local-6989586621679587105"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679587100"><span class="annot"><a href="#local-6989586621679587100"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span id="local-6989586621679587103"><span class="annot"><a href="#local-6989586621679587103"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679587099"><span class="annot"><a href="#local-6989586621679587099"><span class="hs-identifier hs-type">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679587102"><span class="annot"><a href="#local-6989586621679587102"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span> </span><span id="local-6989586621679587104"><span class="annot"><a href="#local-6989586621679587104"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679587105"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587105"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="#local-6989586621679587104"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679587103"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679587102"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587101"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><a href="#local-6989586621679587100"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithoutGradient"><span class="hs-identifier hs-type">WithoutGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span>
</span><span id="line-364"></span><span>              </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedSize"><span class="hs-identifier hs-type">UncheckedSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-365"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><a href="#local-6989586621679587099"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-368"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithGradient"><span class="hs-identifier hs-type">WithGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><a href="#local-6989586621679587098"><span class="hs-identifier hs-type">model</span></a></span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerInput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587097"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587100"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><a href="#local-6989586621679587101"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587099"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587103"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587102"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><a href="#local-6989586621679587101"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><a href="#local-6989586621679587098"><span class="hs-identifier hs-type">model</span></a></span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerGenerationInput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587100"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587103"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587102"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>      </span><span class="annot"><a href="#local-6989586621679587101"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-383"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587099"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587103"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679587102"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><a href="#local-6989586621679587101"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="#local-6989586621679587098"><span class="hs-identifier hs-type">model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><a href="#local-6989586621679587097"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="#local-6989586621679587104"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679587105"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-390"></span><span id="getIs"><span class="annot"><span class="annottext">getIs :: Int -&gt; model -&gt; input -&gt; StateT s (StateT [Int] b) Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getIs"><span class="hs-identifier hs-var hs-var">getIs</span></a></span></span><span> </span><span id="local-6989586621679586721"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586721"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679586720"><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586720"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679586719"><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679586719"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-comment">-- tokens &lt;- reverse &lt;$&gt; lift get</span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679586718"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586718"><span class="hs-identifier hs-var">tokens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621679586717"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586717"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int])
-&gt; StateT s (StateT [Int] b) [Int]
-&gt; StateT s (StateT [Int] b) [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT [Int] b [Int] -&gt; StateT s (StateT [Int] b) [Int]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">StateT [Int] b [Int]
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586716"><span class="annot"><span class="annottext">ts' :: [Int]
</span><a href="#local-6989586621679586716"><span class="hs-identifier hs-var hs-var">ts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO [Int] -&gt; [Int]
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [Int] -&gt; [Int]) -&gt; IO [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>          </span><span class="hs-comment">-- putStrLn $ &quot;tokens: &quot; &lt;&gt; show ((t5Vocab Map.!) &lt;$&gt; ts)</span><span>
</span><span id="line-396"></span><span>          </span><span class="annot"><span class="annottext">[Int] -&gt; IO [Int]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586717"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><span class="annottext">[Int] -&gt; StateT s (StateT [Int] b) [Int]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586716"><span class="hs-identifier hs-var">ts'</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621679586715"><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586715"><span class="hs-identifier hs-var">decoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679587100"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SDim ('Dim ('Name &quot;*&quot;) 'UncheckedSize)
-&gt; SDevice ('Device 'CPU)
-&gt; [[Int]]
-&gt; StateT s (StateT [Int] b) decoderInput
forall (batchDim :: Dim (Name Symbol) (Size Nat))
       (seqDim :: Dim (Name Symbol) (Size Nat))
       (device :: Device (DeviceType Nat)) (m :: * -&gt; *) output.
(MonadThrow m, SGetDim batchDim, SGetDim seqDim,
 'Shape '[batchDim, seqDim]
 ~ Seq
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) 'UncheckedSize,
           'Dim ('Name &quot;*&quot;) 'UncheckedSize]
      &lt;+&gt; 'Shape '[batchDim, seqDim])
     ('Shape '[batchDim, seqDim]),
 output
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     ('Shape '[batchDim, seqDim])) =&gt;
SDim batchDim
-&gt; SDim seqDim -&gt; SDevice device -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5Input"><span class="hs-identifier hs-var">mkT5Input</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize 'UncheckedSize -&gt; SDim ('Dim ('Name &quot;*&quot;) 'UncheckedSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SSize 'UncheckedSize
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SUncheckedSize"><span class="hs-identifier hs-var">SUncheckedSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586718"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586718"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-404"></span><span>  </span><span id="local-6989586621679586714"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586714"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679586713"><span class="annot"><span class="annottext">Maybe (encoderOutput, inputPaddingMask)
</span><a href="#local-6989586621679586713"><span class="hs-identifier hs-var">mTensors</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586712"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586712"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  s
  (StateT [Int] b)
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerOutput"><span class="hs-identifier hs-type">SimplifiedEncoderDecoderTransformerOutput</span></a></span><span> </span><span id="local-6989586621679586711"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586711"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679586710"><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679586710"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679586709"><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586709"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586708"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586708"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-407"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (encoderOutput, inputPaddingMask)
</span><a href="#local-6989586621679586713"><span class="hs-identifier hs-var">mTensors</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">Maybe (encoderOutput, inputPaddingMask)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">model
-&gt; SimplifiedEncoderDecoderTransformerInput input decoderInput
-&gt; Generator generatorDevice
-&gt; StateT
     s
     (StateT [Int] b)
     (SimplifiedEncoderDecoderTransformerOutput
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           'UncheckedShape)
        encoderOutput
        inputPaddingMask,
      Generator generatorDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586720"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">input
-&gt; decoderInput
-&gt; SimplifiedEncoderDecoderTransformerInput input decoderInput
forall input decoderInput.
input
-&gt; decoderInput
-&gt; SimplifiedEncoderDecoderTransformerInput input decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerInput"><span class="hs-identifier hs-var">SimplifiedEncoderDecoderTransformerInput</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679586719"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586715"><span class="hs-identifier hs-var">decoderInput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586712"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679586707"><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679586707"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679586706"><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586706"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-410"></span><span>          </span><span class="annot"><span class="annottext">model
-&gt; SimplifiedEncoderDecoderTransformerGenerationInput
     decoderInput encoderOutput inputPaddingMask
-&gt; Generator generatorDevice
-&gt; StateT
     s
     (StateT [Int] b)
     (SimplifiedEncoderDecoderTransformerOutput
        (Tensor
           ('Gradient 'WithGradient)
           ('Layout 'Dense)
           ('Device 'CPU)
           T5DataType
           'UncheckedShape)
        encoderOutput
        inputPaddingMask,
      Generator generatorDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586720"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">decoderInput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; SimplifiedEncoderDecoderTransformerGenerationInput
     decoderInput encoderOutput inputPaddingMask
forall decoderInput encoderOutput inputPaddingMask.
decoderInput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; SimplifiedEncoderDecoderTransformerGenerationInput
     decoderInput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.GEncoderDecoder.html#SimplifiedEncoderDecoderTransformerGenerationInput"><span class="hs-identifier hs-var">SimplifiedEncoderDecoderTransformerGenerationInput</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679586715"><span class="hs-identifier hs-var">decoderInput</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679586707"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586706"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586712"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><span class="annottext">(Maybe (encoderOutput, inputPaddingMask),
 Generator generatorDevice)
-&gt; StateT s (StateT [Int] b) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(encoderOutput, inputPaddingMask)
-&gt; Maybe (encoderOutput, inputPaddingMask)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679586710"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679586709"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586708"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
-&gt; StateT
     s
     (StateT [Int] b)
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        'UncheckedShape)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586711"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Order
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
-&gt; Sorted
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     (SortF ('SelectDim ('ByIndex 2)) 'UncheckedShape)
forall (selectDim :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SingI selectDim =&gt;
Order
-&gt; Tensor gradient layout device dataType shape
-&gt; Sorted gradient layout device dataType (SortF selectDim shape)
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Order
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html#Descending"><span class="hs-identifier hs-var">Descending</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="annottext">(Tensor
   ('Gradient 'WithGradient)
   ('Layout 'Dense)
   ('Device 'CPU)
   T5DataType
   'UncheckedShape
 -&gt; Sorted
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      T5DataType
      'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      T5DataType
      'UncheckedShape
    -&gt; Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         'UncheckedShape)
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
-&gt; Sorted
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 2))
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     (SoftmaxF ('SelectDim ('ByIndex 2)) 'UncheckedShape)
forall (selectDim :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SSelectDim selectDim
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor
     gradient layout device dataType (SoftmaxF selectDim shape)
</span><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#logSoftmax"><span class="hs-identifier hs-var">logSoftmax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 2) -&gt; SSelectDim ('SelectDim ('ByIndex 2))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 2) -&gt; SSelectDim ('SelectDim ('ByIndex 2)))
-&gt; SBy ('ByIndex 2) -&gt; SSelectDim ('SelectDim ('ByIndex 2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 2 =&gt; SBy ('ByIndex 2)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">(Tensor
   ('Gradient 'WithGradient)
   ('Layout 'Dense)
   ('Device 'CPU)
   T5DataType
   'UncheckedShape
 -&gt; Sorted
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      T5DataType
      'UncheckedShape)
-&gt; Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
-&gt; Sorted
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><a href="#local-6989586621679586714"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Comparison.html#Sorted"><span class="hs-identifier hs-type">Sorted</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  'UncheckedShape
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#UnsafeTensor"><span class="hs-identifier hs-type">UnsafeTensor</span></a></span><span> </span><span id="local-6989586621679586703"><span class="annot"><span class="annottext">ForeignPtr Tensor
</span><a href="#local-6989586621679586703"><span class="hs-identifier hs-var">indices</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586702"><span class="annot"><span class="annottext">indices' :: [Int]
</span><a href="#local-6989586621679586702"><span class="hs-identifier hs-var hs-var">indices'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586721"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int])
-&gt; (ForeignPtr Tensor -&gt; [Int]) -&gt; ForeignPtr Tensor -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Int]] -&gt; [Int]
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">([[Int]] -&gt; [Int])
-&gt; (ForeignPtr Tensor -&gt; [[Int]]) -&gt; ForeignPtr Tensor -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[[Int]]] -&gt; [[Int]]
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([[[Int]]] -&gt; [[Int]])
-&gt; (ForeignPtr Tensor -&gt; [[[Int]]]) -&gt; ForeignPtr Tensor -&gt; [[Int]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TensorLike [[[Int]]] =&gt; Tensor -&gt; [[[Int]]]
forall a. TensorLike a =&gt; Tensor -&gt; a
</span><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-var">Torch.Tensor.asValue</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; [[[Int]]])
-&gt; (ForeignPtr Tensor -&gt; Tensor) -&gt; ForeignPtr Tensor -&gt; [[[Int]]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Tensor -&gt; Tensor
</span><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-var">Torch.Tensor.Unsafe</span></a></span><span> </span><span class="annot"><span class="annottext">(ForeignPtr Tensor -&gt; [Int]) -&gt; ForeignPtr Tensor -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Tensor
</span><a href="#local-6989586621679586703"><span class="hs-identifier hs-var">indices</span></a></span><span>
</span><span id="line-418"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">StateT [Int] b Int -&gt; StateT s (StateT [Int] b) Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(StateT [Int] b Int -&gt; StateT s (StateT [Int] b) Int)
-&gt; ([b Int] -&gt; StateT [Int] b Int)
-&gt; [b Int]
-&gt; StateT s (StateT [Int] b) Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b Int -&gt; StateT [Int] b Int
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(b Int -&gt; StateT [Int] b Int)
-&gt; ([b Int] -&gt; b Int) -&gt; [b Int] -&gt; StateT [Int] b Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[b Int] -&gt; b Int
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Alternative f) =&gt;
t (f a) -&gt; f a
</span><span class="hs-identifier hs-var">asum</span></span><span> </span><span class="annot"><span class="annottext">([b Int] -&gt; StateT s (StateT [Int] b) Int)
-&gt; [b Int] -&gt; StateT s (StateT [Int] b) Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; b Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; b Int) -&gt; [Int] -&gt; [b Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679586702"><span class="hs-identifier hs-var">indices'</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#runParser"><span class="hs-identifier hs-type">runParser</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679586699"><span class="annot"><a href="#local-6989586621679586699"><span class="hs-identifier hs-type">model</span></a></span></span><span> </span><span id="local-6989586621679586698"><span class="annot"><a href="#local-6989586621679586698"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679586697"><span class="annot"><a href="#local-6989586621679586697"><span class="hs-identifier hs-type">generatorDevice</span></a></span></span><span> </span><span id="local-6989586621679586696"><span class="annot"><a href="#local-6989586621679586696"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679586695"><span class="annot"><a href="#local-6989586621679586695"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-423"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><a href="#local-6989586621679586699"><span class="hs-identifier hs-type">model</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><a href="#local-6989586621679586698"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586697"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679586696"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679586695"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><a href="#local-6989586621679586696"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679586695"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span id="runParser"><span class="annot"><span class="annottext">runParser :: Int
-&gt; model
-&gt; input
-&gt; Generator generatorDevice
-&gt; Parser (StateT [Int] b) Int a
-&gt; b (a, [Int])
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#runParser"><span class="hs-identifier hs-var hs-var">runParser</span></a></span></span><span> </span><span id="local-6989586621679586694"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586694"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679586693"><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586693"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679586692"><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679586692"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679586691"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586691"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><span class="annottext">(StateT [Int] b a -&gt; [Int] -&gt; b (a, [Int]))
-&gt; [Int] -&gt; StateT [Int] b a -&gt; b (a, [Int])
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT [Int] b a -&gt; [Int] -&gt; b (a, [Int])
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><span class="hs-identifier hs-var hs-var">runStateT</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">(StateT [Int] b a -&gt; b (a, [Int]))
-&gt; (Parser (StateT [Int] b) Int a -&gt; StateT [Int] b a)
-&gt; Parser (StateT [Int] b) Int a
-&gt; b (a, [Int])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StateT
   (Maybe (encoderOutput, inputPaddingMask),
    Generator generatorDevice)
   (StateT [Int] b)
   a
 -&gt; (Maybe (encoderOutput, inputPaddingMask),
     Generator generatorDevice)
 -&gt; StateT [Int] b a)
-&gt; (Maybe (encoderOutput, inputPaddingMask),
    Generator generatorDevice)
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     (StateT [Int] b)
     a
-&gt; StateT [Int] b a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
  (StateT [Int] b)
  a
-&gt; (Maybe (encoderOutput, inputPaddingMask),
    Generator generatorDevice)
-&gt; StateT [Int] b a
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (encoderOutput, inputPaddingMask)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679586691"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">(StateT
   (Maybe (encoderOutput, inputPaddingMask),
    Generator generatorDevice)
   (StateT [Int] b)
   a
 -&gt; StateT [Int] b a)
-&gt; (Parser (StateT [Int] b) Int a
    -&gt; StateT
         (Maybe (encoderOutput, inputPaddingMask),
          Generator generatorDevice)
         (StateT [Int] b)
         a)
-&gt; Parser (StateT [Int] b) Int a
-&gt; StateT [Int] b a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Parser (StateT [Int] b) Int a
 -&gt; (Parser (StateT [Int] b) Int a
     -&gt; StateT
          (Maybe (encoderOutput, inputPaddingMask),
           Generator generatorDevice)
          (StateT [Int] b)
          a)
 -&gt; StateT
      (Maybe (encoderOutput, inputPaddingMask),
       Generator generatorDevice)
      (StateT [Int] b)
      a)
-&gt; Parser (StateT [Int] b) Int a
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     (StateT [Int] b)
     a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (b :: * -&gt; *) i a.
(Parser b i a -&gt; (Parser b i a -&gt; t b a) -&gt; t b a)
-&gt; Parser b i a -&gt; t b a
</span><a href="Torch.Data.Parser.html#recurse"><span class="hs-identifier hs-var">recurse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateT
  (Maybe (encoderOutput, inputPaddingMask),
   Generator generatorDevice)
  (StateT [Int] b)
  Int
-&gt; Parser (StateT [Int] b) Int a
-&gt; (Parser (StateT [Int] b) Int a
    -&gt; StateT
         (Maybe (encoderOutput, inputPaddingMask),
          Generator generatorDevice)
         (StateT [Int] b)
         a)
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     (StateT [Int] b)
     a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (b :: * -&gt; *) i a.
(i ~ Int, Show i, MonadTrans t, Monad (t (StateT [i] b)),
 Alternative (t (StateT [i] b)), Monad b, Foldable b) =&gt;
t (StateT [i] b) i
-&gt; Parser (StateT [i] b) i a
-&gt; (Parser (StateT [i] b) i a -&gt; t (StateT [i] b) a)
-&gt; t (StateT [i] b) a
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#next"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; model
-&gt; input
-&gt; StateT
     (Maybe (encoderOutput, inputPaddingMask),
      Generator generatorDevice)
     (StateT [Int] b)
     Int
forall model input (generatorDevice :: Device (DeviceType Nat))
       (b :: * -&gt; *) decoderInput encoderOutput decoderOutput
       inputPaddingMask s.
(Alternative b, MonadThrow b,
 s
 ~ (Maybe (encoderOutput, inputPaddingMask),
    Generator generatorDevice),
 decoderInput
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) 'UncheckedSize]),
 decoderOutput
 ~ Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     'UncheckedShape,
 HasForward
   model
   (SimplifiedEncoderDecoderTransformerInput input decoderInput)
   generatorDevice
   (SimplifiedEncoderDecoderTransformerOutput
      decoderOutput encoderOutput inputPaddingMask)
   generatorDevice,
 HasForward
   model
   (SimplifiedEncoderDecoderTransformerGenerationInput
      decoderInput encoderOutput inputPaddingMask)
   generatorDevice
   (SimplifiedEncoderDecoderTransformerOutput
      decoderOutput encoderOutput inputPaddingMask)
   generatorDevice) =&gt;
Int -&gt; model -&gt; input -&gt; StateT s (StateT [Int] b) Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#getIs"><span class="hs-identifier hs-var">getIs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586694"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">model
</span><a href="#local-6989586621679586693"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679586692"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-comment">-- testParser = do</span><span>
</span><span id="line-435"></span><span class="hs-comment">--   input &lt;- do</span><span>
</span><span id="line-436"></span><span class="hs-comment">--     let tokens = [[13959, 1566, 12, 2968, 10, 6536, 43, 2008, 24, 293, 53, 3, 9, 1782, 19, 207, 21, 25, 1]]</span><span>
</span><span id="line-437"></span><span class="hs-comment">--     -- let tokens = [[13959, 1566, 12, 2968, 10, 148, 31, 60, 423, 13, 3, 7, 10536, 55, 1]]</span><span>
</span><span id="line-438"></span><span class="hs-comment">--     -- let tokens = [[13959, 1566, 12, 2968, 10, 3, 31, 7, 15, 3437, 3, 17, 4416, 4350, 6, 3476, 599, 1935, 61, 45, 4219, 38, 3, 17, 536, 1715, 14939, 38, 3, 17, 357, 30, 3, 17, 5411, 2427, 12925, 834, 23, 26, 3274, 3, 17, 4416, 2427, 12925, 834, 23, 26, 563, 57, 3, 17, 5411, 2427, 12925, 834, 23, 26, 31, 1]]</span><span>
</span><span id="line-439"></span><span class="hs-comment">--     -- let tokens = [[13959, 1566, 12, 2968, 10, 96, 3, 23143, 14196, 332, 4416, 4350, 6, 2847, 17161, 599, 1935, 61, 21680, 4219, 6157, 332, 536, 3, 15355, 3162, 14939, 6157, 332, 357, 9191, 332, 5411, 2427, 12925, 834, 23, 26, 3274, 332, 4416, 2427, 12925, 834, 23, 26, 350, 4630, 6880, 272, 476, 3, 17, 5411, 2427, 12925, 834, 23, 26, 96, 1]]</span><span>
</span><span id="line-440"></span><span class="hs-comment">--     print $ length &lt;$&gt; tokens</span><span>
</span><span id="line-441"></span><span class="hs-comment">--     print $ ((t5Vocab Map.!) &lt;$&gt;) &lt;$&gt; tokens</span><span>
</span><span id="line-442"></span><span class="hs-comment">--     mkT5Input</span><span>
</span><span id="line-443"></span><span class="hs-comment">--       @('Dim ('Name &quot;*&quot;) ('Size 1))</span><span>
</span><span id="line-444"></span><span class="hs-comment">--       @('Dim ('Name &quot;*&quot;) ('Size 61))</span><span>
</span><span id="line-445"></span><span class="hs-comment">--       tokens</span><span>
</span><span id="line-446"></span><span class="hs-comment">--   model &lt;-</span><span>
</span><span id="line-447"></span><span class="hs-comment">--     initialize</span><span>
</span><span id="line-448"></span><span class="hs-comment">--       @(T5Small ('Device 'CPU))</span><span>
</span><span id="line-449"></span><span class="hs-comment">--       &quot;/Users/torsten.scholak/Projects/thirdParty/hasktorch/hasktorch/src/Torch/GraduallyTyped/NN/Transformer/t5-small.pt&quot;</span><span>
</span><span id="line-450"></span><span class="hs-comment">--   g &lt;- mkGenerator @('Device CPU) 0</span><span>
</span><span id="line-451"></span><span class="hs-comment">--   let outputs = runParser 5 model input g (transParser t5Vocab t5Test)</span><span>
</span><span id="line-452"></span><span class="hs-comment">--   pure . fst $ observe outputs</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- | @t5Text@ parses a 'Char' sequence delimited by @&lt;/s&gt;@ as a 'String'.</span><span>
</span><span id="line-455"></span><span id="local-6989586621679586689"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#t5Text"><span class="hs-identifier hs-type">t5Text</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679586689"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586689"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-456"></span><span id="t5Text"><span class="annot"><span class="annottext">t5Text :: Parser b Char String
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#t5Text"><span class="hs-identifier hs-var hs-var">t5Text</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
-&gt; Parser b Char String -&gt; Parser b Char String
forall (m :: * -&gt; *) a end. Alternative m =&gt; m a -&gt; m end -&gt; m [a]
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var">manyTill</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
forall (b :: * -&gt; *) i. Monad b =&gt; Parser b i i
</span><a href="Torch.Data.Parser.html#token"><span class="hs-identifier hs-var">Torch.Data.Parser.token</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Parser b Char String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;/s&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- &gt;&gt;&gt; head $ parseString @[] t5Test &quot;Studien haben belegt, dass es gut ist, einen Hund zu haben&lt;/s&gt;&quot;</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- []</span><span>
</span><span id="line-460"></span><span id="local-6989586621679586687"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#t5Test"><span class="hs-identifier hs-type">t5Test</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679586687"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586687"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-461"></span><span id="t5Test"><span class="annot"><span class="annottext">t5Test :: Parser b Char String
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#t5Test"><span class="hs-identifier hs-var hs-var">t5Test</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Parser b Char String
forall (b :: * -&gt; *).
MonadPlus b =&gt;
Int -&gt; FreeT ((-&gt;) Char) b String
</span><a href="#local-6989586621679586685"><span class="hs-identifier hs-var">notEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="annottext">Parser b Char String
-&gt; Parser b Char String -&gt; Parser b Char String
forall (f :: * -&gt; *) a.
(Applicative f, Semigroup a) =&gt;
f a -&gt; f a -&gt; f a
</span><a href="Torch.Data.Parser.html#combine"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser b Char String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;belegt&quot;</span></span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><span class="annottext">Parser b Char String
-&gt; Parser b Char String -&gt; Parser b Char String
forall (f :: * -&gt; *) a.
(Applicative f, Semigroup a) =&gt;
f a -&gt; f a -&gt; f a
</span><a href="Torch.Data.Parser.html#combine"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Parser b Char String
forall (b :: * -&gt; *).
MonadPlus b =&gt;
Int -&gt; FreeT ((-&gt;) Char) b String
</span><a href="#local-6989586621679586685"><span class="hs-identifier hs-var">notEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-465"></span><span>    </span><span class="annot"><span class="annottext">Parser b Char String
-&gt; Parser b Char String -&gt; Parser b Char String
forall (f :: * -&gt; *) a.
(Applicative f, Semigroup a) =&gt;
f a -&gt; f a -&gt; f a
</span><a href="Torch.Data.Parser.html#combine"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser b Char String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dass es&quot;</span></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">Parser b Char String
-&gt; Parser b Char String -&gt; Parser b Char String
forall (f :: * -&gt; *) a.
(Applicative f, Semigroup a) =&gt;
f a -&gt; f a -&gt; f a
</span><a href="Torch.Data.Parser.html#combine"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Parser b Char String
forall (b :: * -&gt; *).
MonadPlus b =&gt;
Int -&gt; FreeT ((-&gt;) Char) b String
</span><a href="#local-6989586621679586685"><span class="hs-identifier hs-var">notEnd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">25</span></span><span>
</span><span id="line-467"></span><span>    </span><span class="annot"><span class="annottext">Parser b Char String
-&gt; Parser b Char String -&gt; Parser b Char String
forall (f :: * -&gt; *) a.
(Applicative f, Semigroup a) =&gt;
f a -&gt; f a -&gt; f a
</span><a href="Torch.Data.Parser.html#combine"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser b Char String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;haben&quot;</span></span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="annottext">Parser b Char String
-&gt; Parser b Char String -&gt; Parser b Char String
forall (f :: * -&gt; *) a.
(Applicative f, Semigroup a) =&gt;
f a -&gt; f a -&gt; f a
</span><a href="Torch.Data.Parser.html#combine"><span class="hs-operator hs-var">`combine`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser b Char String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;/s&gt;&quot;</span></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-470"></span><span>    </span><span id="local-6989586621679586685"><span class="annot"><span class="annottext">notEnd :: Int -&gt; FreeT ((-&gt;) Char) b String
</span><a href="#local-6989586621679586685"><span class="hs-identifier hs-var hs-var">notEnd</span></a></span></span><span> </span><span id="local-6989586621679586684"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586684"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Char -&gt; Maybe String)
-&gt; String -&gt; FreeT ((-&gt;) Char) b Char -&gt; FreeT ((-&gt;) Char) b String
forall (m :: * -&gt; *) s a.
(Alternative m, Monad m) =&gt;
(s -&gt; a -&gt; Maybe s) -&gt; s -&gt; m a -&gt; m [a]
</span><a href="Torch.Data.Parser.html#scan"><span class="hs-identifier hs-var">scan</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Char -&gt; Maybe String
</span><a href="#local-6989586621679586683"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
forall (b :: * -&gt; *) i. Monad b =&gt; Parser b i i
</span><a href="Torch.Data.Parser.html#token"><span class="hs-identifier hs-var">Torch.Data.Parser.token</span></a></span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span>        </span><span id="local-6989586621679586683"><span class="annot"><span class="annottext">f :: String -&gt; Char -&gt; Maybe String
</span><a href="#local-6989586621679586683"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679586682"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586682"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679586681"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679586681"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586682"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679586681"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-473"></span><span>          </span><span id="local-6989586621679586680"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586680"><span class="hs-identifier hs-var">s'</span></a></span></span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;/s&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586680"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-475"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586680"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679586684"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-476"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679586680"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- | @t5Sql@ parses a 'Char' sequence starting with @\&quot;@ and ending with @\&quot; &lt;/s&gt;@</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- as 'SpiderSQL'.</span><span>
</span><span id="line-480"></span><span id="local-6989586621679586678"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#t5Sql"><span class="hs-identifier hs-type">t5Sql</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-type">TokenParsing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/q154yhzyqbj85jbmxvqr5brnw9x6zgxr-free-lib-free-5.1.6-haddock-doc/share/doc/free/html/src"><span class="hs-identifier hs-type">FreeT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-&gt;</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679586678"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="#local-6989586621679586678"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-482"></span><span>  </span><span class="annot"><a href="Torch.Data.Parser.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679586678"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="annot"><a href="Torch.Language.SpiderSQL.html#SpiderSQL"><span class="hs-identifier hs-type">SpiderSQL</span></a></span></span><span>
</span><span id="line-483"></span><span id="t5Sql"><span class="annot"><span class="annottext">t5Sql :: Parser b Char SpiderSQL
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Generation.html#t5Sql"><span class="hs-identifier hs-var hs-var">t5Sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679586676"><span class="annot"><span class="annottext">q :: FreeT ((-&gt;) Char) b Char
</span><a href="#local-6989586621679586676"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b ()
forall (m :: * -&gt; *). CharParsing m =&gt; m ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var">spaces</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b ()
-&gt; FreeT ((-&gt;) Char) b Char -&gt; FreeT ((-&gt;) Char) b Char
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; FreeT ((-&gt;) Char) b Char
forall (m :: * -&gt; *). CharParsing m =&gt; Char -&gt; m Char
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
-&gt; FreeT ((-&gt;) Char) b () -&gt; FreeT ((-&gt;) Char) b Char
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b ()
forall (m :: * -&gt; *). CharParsing m =&gt; m ()
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var">spaces</span></a></span><span>
</span><span id="line-485"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
-&gt; FreeT ((-&gt;) Char) b Char
-&gt; Parser b Char SpiderSQL
-&gt; Parser b Char SpiderSQL
forall (m :: * -&gt; *) bra ket a.
Applicative m =&gt;
m bra -&gt; m ket -&gt; m a -&gt; m a
</span><a href="../file:///nix/store/3mbl54gihlp0ilg9wcm9x7h71jawmmaz-parsers-lib-parsers-0.12.10-haddock-doc/share/doc/parsers/html/src"><span class="hs-identifier hs-var">between</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
</span><a href="#local-6989586621679586676"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">FreeT ((-&gt;) Char) b Char
</span><a href="#local-6989586621679586676"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Parser b Char SpiderSQL
forall (m :: * -&gt; *). (TokenParsing m, Monad m) =&gt; m SpiderSQL
</span><a href="Torch.Language.SpiderSQL.html#spiderSQL"><span class="hs-identifier hs-var">spiderSQL</span></a></span><span> </span><span class="annot"><span class="annottext">Parser b Char SpiderSQL
-&gt; FreeT ((-&gt;) Char) b String -&gt; Parser b Char SpiderSQL
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; FreeT ((-&gt;) Char) b String
forall (t :: * -&gt; *) (b :: * -&gt; *) i.
(Traversable t, MonadPlus b, Eq i) =&gt;
t i -&gt; Parser b i (t i)
</span><a href="Torch.Data.Parser.html#isString"><span class="hs-identifier hs-var">isString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;/s&gt;&quot;</span></span><span>
</span><span id="line-486"></span></pre></body></html>
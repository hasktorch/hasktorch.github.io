<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Functional.Sparse</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Natural</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Natural</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeError</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DType"><span class="hs-identifier">DType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier">DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html"><span class="hs-identifier">Torch.GraduallyTyped.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#LayoutType"><span class="hs-identifier">LayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html"><span class="hs-identifier">Torch.GraduallyTyped.Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Reverse"><span class="hs-identifier">Reverse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Seq"><span class="hs-identifier">Seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier">Size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetLayout"><span class="hs-identifier">SGetLayout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier">Tensor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html"><span class="hs-identifier">Torch.GraduallyTyped.Unify</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%7C%3E"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../libtorch-ffi/html/src"><span class="hs-identifier">Torch.Internal.Cast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../libtorch-ffi/html/src"><span class="hs-identifier">cast5</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../libtorch-ffi/html/src"><span class="hs-identifier">Torch.Internal.Managed.Native</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ATen</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-identifier">Type.Errors.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator">(%)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">type</span><span> </span><span id="EmbedDimsErrorMessage"><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbedDimsErrorMessage"><span class="hs-identifier hs-var">EmbedDimsErrorMessage</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679800418"><span class="annot"><a href="#local-6989586621679800418"><span class="hs-identifier hs-type">embedDims</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-string">&quot;Cannot apply the embedding.&quot;</span></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">%</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;The embedding weight tensor must have exactly two dimensions,&quot;</span></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">%</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;but the following dimensions were found:&quot;</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">%</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">%</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;    &quot;</span></span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800418"><span class="hs-identifier hs-type">embedDims</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator hs-type">%</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="EmbeddingF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbeddingF"><span class="hs-identifier hs-var">EmbeddingF</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679800417"><span class="annot"><a href="#local-6989586621679800417"><span class="hs-identifier hs-type">weightShape</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679800416"><span class="annot"><a href="#local-6989586621679800416"><span class="hs-identifier hs-type">inputShape</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>  </span><span id="EmbeddingF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbeddingF"><span class="hs-identifier hs-var">EmbeddingF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span id="EmbeddingF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbeddingF"><span class="hs-identifier hs-var">EmbeddingF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#UncheckedShape"><span class="hs-identifier hs-type">UncheckedShape</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span id="EmbeddingF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbeddingF"><span class="hs-identifier hs-var">EmbeddingF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span id="local-6989586621679800413"><span class="annot"><a href="#local-6989586621679800413"><span class="hs-identifier hs-type hs-type">_embedNumDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679800412"><span class="annot"><a href="#local-6989586621679800412"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span id="local-6989586621679800411"><span class="annot"><a href="#local-6989586621679800411"><span class="hs-identifier hs-type hs-type">inputDims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Reverse"><span class="hs-identifier hs-type">Reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679800412"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Reverse"><span class="hs-identifier hs-type">Reverse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800411"><span class="hs-identifier hs-type">inputDims</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>  </span><span id="EmbeddingF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbeddingF"><span class="hs-identifier hs-var">EmbeddingF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span id="local-6989586621679800410"><span class="annot"><a href="#local-6989586621679800410"><span class="hs-identifier hs-type hs-type">embedDims</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbedDimsErrorMessage"><span class="hs-identifier hs-type">EmbedDimsErrorMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800410"><span class="hs-identifier hs-type">embedDims</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#embedding"><span class="hs-identifier hs-type">embedding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679800408"><span class="annot"><a href="#local-6989586621679800408"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679800407"><span class="annot"><a href="#local-6989586621679800407"><span class="hs-identifier hs-type">layout</span></a></span></span><span> </span><span id="local-6989586621679800406"><span class="annot"><a href="#local-6989586621679800406"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679800405"><span class="annot"><a href="#local-6989586621679800405"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679800404"><span class="annot"><a href="#local-6989586621679800404"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span id="local-6989586621679800403"><span class="annot"><a href="#local-6989586621679800403"><span class="hs-identifier hs-type">gradient'</span></a></span></span><span> </span><span id="local-6989586621679800402"><span class="annot"><a href="#local-6989586621679800402"><span class="hs-identifier hs-type">layout'</span></a></span></span><span> </span><span id="local-6989586621679800401"><span class="annot"><a href="#local-6989586621679800401"><span class="hs-identifier hs-type">device'</span></a></span></span><span> </span><span id="local-6989586621679800400"><span class="annot"><a href="#local-6989586621679800400"><span class="hs-identifier hs-type">dataType'</span></a></span></span><span> </span><span id="local-6989586621679800399"><span class="annot"><a href="#local-6989586621679800399"><span class="hs-identifier hs-type">shape'</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetLayout"><span class="hs-identifier hs-type">SGetLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800407"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-comment">-- | padding index</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-comment">-- | whether or not to scale gradients by the inverse of frequency of the words in the mini-batch</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-comment">-- | weight</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800408"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800407"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800406"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800405"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800404"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-comment">-- | input</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800403"><span class="hs-identifier hs-type">gradient'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800402"><span class="hs-identifier hs-type">layout'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800401"><span class="hs-identifier hs-type">device'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800400"><span class="hs-identifier hs-type">dataType'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800399"><span class="hs-identifier hs-type">shape'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-50"></span><span>  </span><span class="hs-comment">-- | output</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679800408"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%7C%3E"><span class="hs-operator hs-type">&lt;|&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800403"><span class="hs-identifier hs-type">gradient'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679800407"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800402"><span class="hs-identifier hs-type">layout'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679800406"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800401"><span class="hs-identifier hs-type">device'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679800400"><span class="hs-identifier hs-type">dataType'</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#Int64"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679800405"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#EmbeddingF"><span class="hs-identifier hs-type">EmbeddingF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800404"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679800399"><span class="hs-identifier hs-type">shape'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span id="embedding"><span class="annot"><span class="annottext">embedding :: Maybe Natural
-&gt; Bool
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor gradient' layout' device' dataType' shape'
-&gt; Tensor
     (gradient &lt;|&gt; gradient')
     (layout &lt;+&gt; layout')
     (device &lt;+&gt; device')
     (Seq (dataType' &lt;+&gt; 'DataType 'Int64) dataType)
     (EmbeddingF shape shape')
</span><a href="Torch.GraduallyTyped.NN.Functional.Sparse.html#embedding"><span class="hs-identifier hs-var hs-var">embedding</span></a></span></span><span> </span><span id="local-6989586621679800398"><span class="annot"><span class="annottext">Maybe Natural
</span><a href="#local-6989586621679800398"><span class="hs-identifier hs-var">paddingIdx</span></a></span></span><span> </span><span id="local-6989586621679800397"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679800397"><span class="hs-identifier hs-var">scaleGradByFreq</span></a></span></span><span> </span><span id="local-6989586621679800396"><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679800396"><span class="hs-identifier hs-var">weight</span></a></span></span><span> </span><span id="local-6989586621679800395"><span class="annot"><span class="annottext">Tensor gradient' layout' device' dataType' shape'
</span><a href="#local-6989586621679800395"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679800394"><span class="annot"><span class="annottext">isSparse :: Bool
</span><a href="#local-6989586621679800394"><span class="hs-identifier hs-var hs-var">isSparse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape -&gt; LayoutType
forall (layout :: Layout LayoutType)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGetLayout layout =&gt;
Tensor gradient layout device dataType shape -&gt; LayoutType
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#layoutType"><span class="hs-identifier hs-var">layoutType</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679800396"><span class="hs-identifier hs-var">weight</span></a></span><span> </span><span class="annot"><span class="annottext">LayoutType -&gt; LayoutType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">LayoutType
</span><a href="Torch.GraduallyTyped.Layout.html#Sparse"><span class="hs-identifier hs-var">Sparse</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span id="local-6989586621679800391"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679800391"><span class="hs-identifier hs-var">paddingIdx'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Natural -&gt; Int) -&gt; Maybe Natural -&gt; Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Maybe Natural
</span><a href="#local-6989586621679800398"><span class="hs-identifier hs-var">paddingIdx</span></a></span><span>
</span><span id="line-60"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO
  (Tensor
     (Or (Gradient RequiresGradient) gradient gradient')
     (Unify (Layout LayoutType) layout layout')
     (Unify (Device (DeviceType Nat)) device device')
     (Seq
        (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
     (EmbeddingF shape shape'))
-&gt; Tensor
     (Or (Gradient RequiresGradient) gradient gradient')
     (Unify (Layout LayoutType) layout layout')
     (Unify (Device (DeviceType Nat)) device device')
     (Seq
        (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
     (EmbeddingF shape shape')
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      (Or (Gradient RequiresGradient) gradient gradient')
      (Unify (Layout LayoutType) layout layout')
      (Unify (Device (DeviceType Nat)) device device')
      (Seq
         (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
      (EmbeddingF shape shape'))
 -&gt; Tensor
      (Or (Gradient RequiresGradient) gradient gradient')
      (Unify (Layout LayoutType) layout layout')
      (Unify (Device (DeviceType Nat)) device device')
      (Seq
         (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
      (EmbeddingF shape shape'))
-&gt; IO
     (Tensor
        (Or (Gradient RequiresGradient) gradient gradient')
        (Unify (Layout LayoutType) layout layout')
        (Unify (Device (DeviceType Nat)) device device')
        (Seq
           (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
        (EmbeddingF shape shape'))
-&gt; Tensor
     (Or (Gradient RequiresGradient) gradient gradient')
     (Unify (Layout LayoutType) layout layout')
     (Unify (Device (DeviceType Nat)) device device')
     (Seq
        (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
     (EmbeddingF shape shape')
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ForeignPtr Tensor
 -&gt; ForeignPtr Tensor
 -&gt; Int64
 -&gt; CBool
 -&gt; CBool
 -&gt; IO (ForeignPtr Tensor))
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor gradient' layout' device' dataType' shape'
-&gt; Int
-&gt; Bool
-&gt; Bool
-&gt; IO
     (Tensor
        (Or (Gradient RequiresGradient) gradient gradient')
        (Unify (Layout LayoutType) layout layout')
        (Unify (Device (DeviceType Nat)) device device')
        (Seq
           (Unify (DataType DType) dataType' ('DataType 'Int64)) dataType)
        (EmbeddingF shape shape'))
forall a ca x1 cx1 x2 cx2 x3 cx3 x4 cx4 y cy.
(Castable a ca, Castable x1 cx1, Castable x2 cx2, Castable x3 cx3,
 Castable x4 cx4, Castable y cy) =&gt;
(ca -&gt; cx1 -&gt; cx2 -&gt; cx3 -&gt; cx4 -&gt; IO cy)
-&gt; a -&gt; x1 -&gt; x2 -&gt; x3 -&gt; x4 -&gt; IO y
</span><a href="../../../../libtorch-ffi/html/src"><span class="hs-identifier hs-var">cast5</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Tensor
-&gt; ForeignPtr Tensor
-&gt; Int64
-&gt; CBool
-&gt; CBool
-&gt; IO (ForeignPtr Tensor)
</span><a href="../../../../libtorch-ffi/html/src"><span class="hs-identifier hs-var">ATen.embedding_ttlbb</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679800396"><span class="hs-identifier hs-var">weight</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient' layout' device' dataType' shape'
</span><a href="#local-6989586621679800395"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679800391"><span class="hs-identifier hs-var">paddingIdx'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679800397"><span class="hs-identifier hs-var">scaleGradByFreq</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679800394"><span class="hs-identifier hs-var">isSparse</span></a></span><span>
</span><span id="line-61"></span></pre></body></html>
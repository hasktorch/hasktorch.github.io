<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_Jn5Sdix6711xZf3kCdGuM"><span id="%24con2tag_LtgkuQkYbsqBg7KGpt1d04"></span></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE StandaloneKindSignatures #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-23"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-24"></span><span class="hs-pragma">{-# LANGUAGE NoStarIsType #-}</span><span>
</span><span id="line-25"></span><span class="hs-pragma">{-# OPTIONS_GHC -fplugin TypeLevel.Rewrite
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyRightAssociativeL
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL2
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL2C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL3
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL3C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL4
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL4C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL5
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL5C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL6
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL6C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL7
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL7C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL8
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL8C #-}</span><span>
</span><span id="line-41"></span><span class="hs-pragma">{-# OPTIONS_GHC -v2 -Wall #-}</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">MonadThrow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Control.Monad.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">ireturn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&gt;&gt;&gt;=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">Control.Monad.Indexed.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">IxState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evalStateT</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Data.Functor.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&lt;&lt;$&gt;&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&lt;&lt;*&gt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SingI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SingKind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons.Prelude.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">Torch.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">DType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier">DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDType"><span class="hs-identifier">SDType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier">SDataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html"><span class="hs-identifier">Torch.GraduallyTyped.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier">DeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier">SDevice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDeviceType"><span class="hs-identifier">SDeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html"><span class="hs-identifier">Torch.GraduallyTyped.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier">Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#LayoutType"><span class="hs-identifier">LayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier">SLayout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayoutType"><span class="hs-identifier">SLayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier">HasInitialize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Dropout.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Dropout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Dropout.html#Dropout"><span class="hs-identifier">Dropout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Functional.NonLinearActivation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#SoftmaxF"><span class="hs-identifier">SoftmaxF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#softmax"><span class="hs-identifier">softmax</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Linear</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier">Linear</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier">STransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier">TransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#HasBias"><span class="hs-identifier">HasBias</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html"><span class="hs-identifier">Torch.GraduallyTyped.Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier">forgetIsChecked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html"><span class="hs-identifier">Torch.GraduallyTyped.Random</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier">Generator</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier">sMkGenerator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html"><span class="hs-identifier">Torch.GraduallyTyped.RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier">Gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier">RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier">SGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SRequiresGradient"><span class="hs-identifier">SRequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#BroadcastShapesF"><span class="hs-identifier">BroadcastShapesF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier">sGetDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#sUnifyDim"><span class="hs-identifier">sUnifyDim</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#By"><span class="hs-identifier">By</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SBy"><span class="hs-identifier">SBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier">SDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier">SName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier">SSelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier">SShape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier">SSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier">Size</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator">(:&amp;:)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator">(:|:)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Creation.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Creation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier">sOnes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.IndexingSlicingJoining</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#ReshapeF"><span class="hs-identifier">ReshapeF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#TransposeF"><span class="hs-identifier">TransposeF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sReshape"><span class="hs-identifier">sReshape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#transpose"><span class="hs-identifier">transpose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html#MatmulF"><span class="hs-identifier">MatmulF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html#matmul"><span class="hs-identifier">matmul</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Pointwise.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.MathOperations.Pointwise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Pointwise.html#add"><span class="hs-identifier">add</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.Pointwise.html#mulScalar"><span class="hs-identifier">mulScalar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier">SGetShape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier">Tensor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html"><span class="hs-identifier">Torch.GraduallyTyped.Unify</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%7C%3E"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | Generic multi-headed attention layer.</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Needs to be specialized to a given transformer type, e.g. 'T5'.</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- See 'MultiHeadAttention'.</span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span>
</span><span id="line-83"></span><span>  </span><span id="GMultiHeadAttention"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-var">GMultiHeadAttention</span></a></span></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752203"><span class="annot"><a href="#local-6989586621679752203"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752202"><span class="annot"><a href="#local-6989586621679752202"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752201"><span class="annot"><a href="#local-6989586621679752201"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752200"><span class="annot"><a href="#local-6989586621679752200"><span class="hs-identifier hs-type">qInProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752199"><span class="annot"><a href="#local-6989586621679752199"><span class="hs-identifier hs-type">kInProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752198"><span class="annot"><a href="#local-6989586621679752198"><span class="hs-identifier hs-type">vInProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752197"><span class="annot"><a href="#local-6989586621679752197"><span class="hs-identifier hs-type">outProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752196"><span class="annot"><a href="#local-6989586621679752196"><span class="hs-identifier hs-type">dropout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-93"></span><span>  </span><span id="GMultiHeadAttention"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-var">GMultiHeadAttention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679752609"><span class="annot"><a href="#local-6989586621679752609"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679752608"><span class="annot"><a href="#local-6989586621679752608"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752607"><span class="annot"><a href="#local-6989586621679752607"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679752606"><span class="annot"><a href="#local-6989586621679752606"><span class="hs-identifier hs-type">qInProj</span></a></span></span><span> </span><span id="local-6989586621679752605"><span class="annot"><a href="#local-6989586621679752605"><span class="hs-identifier hs-type">kInProj</span></a></span></span><span> </span><span id="local-6989586621679752604"><span class="annot"><a href="#local-6989586621679752604"><span class="hs-identifier hs-type">vInProj</span></a></span></span><span> </span><span id="local-6989586621679752603"><span class="annot"><a href="#local-6989586621679752603"><span class="hs-identifier hs-type">outProj</span></a></span></span><span> </span><span id="local-6989586621679752602"><span class="annot"><a href="#local-6989586621679752602"><span class="hs-identifier hs-type">dropout</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | head dim</span><span>
</span><span id="line-96"></span><span>      </span><span id="mhaHeadDim"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaHeadDim"><span class="hs-identifier hs-var hs-var">mhaHeadDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752609"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>      </span><span class="hs-comment">-- | head embed dim</span><span>
</span><span id="line-98"></span><span>      </span><span id="mhaHeadEmbedDim"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headEmbedDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaHeadEmbedDim"><span class="hs-identifier hs-var hs-var">mhaHeadEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752608"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>      </span><span class="hs-comment">-- | embed dim</span><span>
</span><span id="line-100"></span><span>      </span><span id="mhaEmbedDim"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim embedDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaEmbedDim"><span class="hs-identifier hs-var hs-var">mhaEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752607"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-comment">-- | in-projection for query</span><span>
</span><span id="line-102"></span><span>      </span><span id="mhaQInProj"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; qInProj
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaQInProj"><span class="hs-identifier hs-var hs-var">mhaQInProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679752606"><span class="hs-identifier hs-type">qInProj</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>      </span><span class="hs-comment">-- | in-projection for key</span><span>
</span><span id="line-104"></span><span>      </span><span id="mhaKInProj"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; kInProj
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaKInProj"><span class="hs-identifier hs-var hs-var">mhaKInProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679752605"><span class="hs-identifier hs-type">kInProj</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-comment">-- | in-projection for value</span><span>
</span><span id="line-106"></span><span>      </span><span id="mhaVInProj"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; vInProj
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaVInProj"><span class="hs-identifier hs-var hs-var">mhaVInProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679752604"><span class="hs-identifier hs-type">vInProj</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-comment">-- | out-projection</span><span>
</span><span id="line-108"></span><span>      </span><span id="mhaOutProj"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; outProj
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaOutProj"><span class="hs-identifier hs-var hs-var">mhaOutProj</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679752603"><span class="hs-identifier hs-type">outProj</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-comment">-- | dropout</span><span>
</span><span id="line-110"></span><span>      </span><span id="mhaDropout"><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; dropout
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#mhaDropout"><span class="hs-identifier hs-var hs-var">mhaDropout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679752602"><span class="hs-identifier hs-type">dropout</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752609"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752608"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752607"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752606"><span class="hs-identifier hs-type">qInProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752605"><span class="hs-identifier hs-type">kInProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752604"><span class="hs-identifier hs-type">vInProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752603"><span class="hs-identifier hs-type">outProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752602"><span class="hs-identifier hs-type">dropout</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Multi-headed attention layer.</span><span>
</span><span id="line-115"></span><span class="hs-keyword">newtype</span><span>
</span><span id="line-116"></span><span>  </span><span id="MultiHeadAttention"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-var">MultiHeadAttention</span></a></span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752186"><span class="annot"><a href="#local-6989586621679752186"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752185"><span class="annot"><a href="#local-6989586621679752185"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752184"><span class="annot"><a href="#local-6989586621679752184"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752183"><span class="annot"><a href="#local-6989586621679752183"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752182"><span class="annot"><a href="#local-6989586621679752182"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752181"><span class="annot"><a href="#local-6989586621679752181"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752180"><span class="annot"><a href="#local-6989586621679752180"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752179"><span class="annot"><a href="#local-6989586621679752179"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752178"><span class="annot"><a href="#local-6989586621679752178"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752177"><span class="annot"><a href="#local-6989586621679752177"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752176"><span class="annot"><a href="#local-6989586621679752176"><span class="hs-identifier hs-type">dropoutP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>  </span><span id="MultiHeadAttention"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-var">MultiHeadAttention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679752566"><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679752565"><span class="annot"><a href="#local-6989586621679752565"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752564"><span class="annot"><a href="#local-6989586621679752564"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752563"><span class="annot"><a href="#local-6989586621679752563"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752569"><span class="annot"><a href="#local-6989586621679752569"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679752568"><span class="annot"><a href="#local-6989586621679752568"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752567"><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679752562"><span class="annot"><a href="#local-6989586621679752562"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752561"><span class="annot"><a href="#local-6989586621679752561"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752560"><span class="annot"><a href="#local-6989586621679752560"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752559"><span class="annot"><a href="#local-6989586621679752559"><span class="hs-identifier hs-type">dropoutP</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><a href="#local-6989586621679752569"><span class="hs-identifier hs-type">headDim</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="#local-6989586621679752568"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-type">QInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752565"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752564"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752563"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752562"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-type">KInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752565"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752564"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752563"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752561"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-type">VInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752565"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752564"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752563"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752560"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-type">OutProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752565"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752564"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752563"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752562"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#DropoutF"><span class="hs-identifier hs-type">DropoutF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752559"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752566"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752565"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752564"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752563"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752569"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752568"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752567"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752562"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752561"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752560"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752559"><span class="hs-identifier hs-type">dropoutP</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-143"></span><span>  </span><span id="QInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-var">QInProjF</span></a></span></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752174"><span class="annot"><a href="#local-6989586621679752174"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752173"><span class="annot"><a href="#local-6989586621679752173"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752172"><span class="annot"><a href="#local-6989586621679752172"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752171"><span class="annot"><a href="#local-6989586621679752171"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752170"><span class="annot"><a href="#local-6989586621679752170"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752169"><span class="annot"><a href="#local-6989586621679752169"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>  </span><span id="QInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-var">QInProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span id="local-6989586621679752168"><span class="annot"><a href="#local-6989586621679752168"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752167"><span class="annot"><a href="#local-6989586621679752167"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752166"><span class="annot"><a href="#local-6989586621679752166"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752165"><span class="annot"><a href="#local-6989586621679752165"><span class="hs-identifier hs-type hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752164"><span class="annot"><a href="#local-6989586621679752164"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithoutBias"><span class="hs-identifier hs-type">WithoutBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752168"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752167"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752166"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752165"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752164"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span id="QInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-var">QInProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier hs-type">ByT5</span></a></span><span> </span><span id="local-6989586621679752162"><span class="annot"><a href="#local-6989586621679752162"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752161"><span class="annot"><a href="#local-6989586621679752161"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752160"><span class="annot"><a href="#local-6989586621679752160"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752159"><span class="annot"><a href="#local-6989586621679752159"><span class="hs-identifier hs-type hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752158"><span class="annot"><a href="#local-6989586621679752158"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-type">QInProjF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752162"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752161"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752160"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752159"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752158"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span id="QInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-var">QInProjF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679752157"><span class="annot"><a href="#local-6989586621679752157"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752156"><span class="annot"><a href="#local-6989586621679752156"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752155"><span class="annot"><a href="#local-6989586621679752155"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752154"><span class="annot"><a href="#local-6989586621679752154"><span class="hs-identifier hs-type hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752153"><span class="annot"><a href="#local-6989586621679752153"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithBias"><span class="hs-identifier hs-type">WithBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752157"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752156"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752155"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752154"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752153"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-157"></span><span>  </span><span id="KInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-var">KInProjF</span></a></span></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752152"><span class="annot"><a href="#local-6989586621679752152"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752151"><span class="annot"><a href="#local-6989586621679752151"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752150"><span class="annot"><a href="#local-6989586621679752150"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752149"><span class="annot"><a href="#local-6989586621679752149"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752148"><span class="annot"><a href="#local-6989586621679752148"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752147"><span class="annot"><a href="#local-6989586621679752147"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>  </span><span id="KInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-var">KInProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span id="local-6989586621679752146"><span class="annot"><a href="#local-6989586621679752146"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752145"><span class="annot"><a href="#local-6989586621679752145"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752144"><span class="annot"><a href="#local-6989586621679752144"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752143"><span class="annot"><a href="#local-6989586621679752143"><span class="hs-identifier hs-type hs-type">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752142"><span class="annot"><a href="#local-6989586621679752142"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithoutBias"><span class="hs-identifier hs-type">WithoutBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752146"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752145"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752144"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752143"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752142"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span id="KInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-var">KInProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier hs-type">ByT5</span></a></span><span> </span><span id="local-6989586621679752141"><span class="annot"><a href="#local-6989586621679752141"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752140"><span class="annot"><a href="#local-6989586621679752140"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752139"><span class="annot"><a href="#local-6989586621679752139"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752138"><span class="annot"><a href="#local-6989586621679752138"><span class="hs-identifier hs-type hs-type">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752137"><span class="annot"><a href="#local-6989586621679752137"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-type">KInProjF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752141"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752140"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752139"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752138"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752137"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span id="KInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-var">KInProjF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679752136"><span class="annot"><a href="#local-6989586621679752136"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752135"><span class="annot"><a href="#local-6989586621679752135"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752134"><span class="annot"><a href="#local-6989586621679752134"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752133"><span class="annot"><a href="#local-6989586621679752133"><span class="hs-identifier hs-type hs-type">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752132"><span class="annot"><a href="#local-6989586621679752132"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithBias"><span class="hs-identifier hs-type">WithBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752136"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752135"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752134"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752133"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752132"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-171"></span><span>  </span><span id="VInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-var">VInProjF</span></a></span></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752131"><span class="annot"><a href="#local-6989586621679752131"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752130"><span class="annot"><a href="#local-6989586621679752130"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752129"><span class="annot"><a href="#local-6989586621679752129"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752128"><span class="annot"><a href="#local-6989586621679752128"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752127"><span class="annot"><a href="#local-6989586621679752127"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752126"><span class="annot"><a href="#local-6989586621679752126"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>  </span><span id="VInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-var">VInProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span id="local-6989586621679752125"><span class="annot"><a href="#local-6989586621679752125"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752124"><span class="annot"><a href="#local-6989586621679752124"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752123"><span class="annot"><a href="#local-6989586621679752123"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752122"><span class="annot"><a href="#local-6989586621679752122"><span class="hs-identifier hs-type hs-type">valueEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752121"><span class="annot"><a href="#local-6989586621679752121"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithoutBias"><span class="hs-identifier hs-type">WithoutBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752125"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752124"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752123"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752122"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752121"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span id="VInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-var">VInProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier hs-type">ByT5</span></a></span><span> </span><span id="local-6989586621679752120"><span class="annot"><a href="#local-6989586621679752120"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752119"><span class="annot"><a href="#local-6989586621679752119"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752118"><span class="annot"><a href="#local-6989586621679752118"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752117"><span class="annot"><a href="#local-6989586621679752117"><span class="hs-identifier hs-type hs-type">valueEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752116"><span class="annot"><a href="#local-6989586621679752116"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-type">VInProjF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752120"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752119"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752118"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752117"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752116"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span id="VInProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-var">VInProjF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679752115"><span class="annot"><a href="#local-6989586621679752115"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752114"><span class="annot"><a href="#local-6989586621679752114"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752113"><span class="annot"><a href="#local-6989586621679752113"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752112"><span class="annot"><a href="#local-6989586621679752112"><span class="hs-identifier hs-type hs-type">valueEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679752111"><span class="annot"><a href="#local-6989586621679752111"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithBias"><span class="hs-identifier hs-type">WithBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752115"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752114"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752113"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752112"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752111"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-185"></span><span>  </span><span id="OutProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-var">OutProjF</span></a></span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752110"><span class="annot"><a href="#local-6989586621679752110"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752109"><span class="annot"><a href="#local-6989586621679752109"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752108"><span class="annot"><a href="#local-6989586621679752108"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752107"><span class="annot"><a href="#local-6989586621679752107"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752106"><span class="annot"><a href="#local-6989586621679752106"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752105"><span class="annot"><a href="#local-6989586621679752105"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-194"></span><span>  </span><span id="OutProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-var">OutProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span id="local-6989586621679752104"><span class="annot"><a href="#local-6989586621679752104"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752103"><span class="annot"><a href="#local-6989586621679752103"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752102"><span class="annot"><a href="#local-6989586621679752102"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752101"><span class="annot"><a href="#local-6989586621679752101"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679752100"><span class="annot"><a href="#local-6989586621679752100"><span class="hs-identifier hs-type hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithoutBias"><span class="hs-identifier hs-type">WithoutBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752104"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752103"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752102"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752101"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752100"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span id="OutProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-var">OutProjF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier hs-type">ByT5</span></a></span><span> </span><span id="local-6989586621679752099"><span class="annot"><a href="#local-6989586621679752099"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752098"><span class="annot"><a href="#local-6989586621679752098"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752097"><span class="annot"><a href="#local-6989586621679752097"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752096"><span class="annot"><a href="#local-6989586621679752096"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679752095"><span class="annot"><a href="#local-6989586621679752095"><span class="hs-identifier hs-type hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-type">OutProjF</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752099"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752098"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752097"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752096"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752095"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span id="OutProjF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-var">OutProjF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679752094"><span class="annot"><a href="#local-6989586621679752094"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679752093"><span class="annot"><a href="#local-6989586621679752093"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679752092"><span class="annot"><a href="#local-6989586621679752092"><span class="hs-identifier hs-type hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679752091"><span class="annot"><a href="#local-6989586621679752091"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679752090"><span class="annot"><a href="#local-6989586621679752090"><span class="hs-identifier hs-type hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Linear.html#Linear"><span class="hs-identifier hs-type">Linear</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#WithBias"><span class="hs-identifier hs-type">WithBias</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752094"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752093"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752092"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752091"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752090"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-199"></span><span>  </span><span id="DropoutF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#DropoutF"><span class="hs-identifier hs-var">DropoutF</span></a></span></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752089"><span class="annot"><a href="#local-6989586621679752089"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679752088"><span class="annot"><a href="#local-6989586621679752088"><span class="hs-identifier hs-type">dropoutP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>  </span><span id="DropoutF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#DropoutF"><span class="hs-identifier hs-var">DropoutF</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679752087"><span class="annot"><a href="#local-6989586621679752087"><span class="hs-identifier hs-type hs-type">dropoutP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Dropout.html#Dropout"><span class="hs-identifier hs-type">Dropout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752087"><span class="hs-identifier hs-type">dropoutP</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span id="local-6989586621679752066"><span id="local-6989586621679752067"><span id="local-6989586621679752068"><span id="local-6989586621679752069"><span id="local-6989586621679752070"><span id="local-6989586621679752071"><span id="local-6989586621679752072"><span id="local-6989586621679752073"><span id="local-6989586621679752074"><span id="local-6989586621679752075"><span id="local-6989586621679752076"><span id="local-6989586621679752077"><span id="local-6989586621679752078"><span id="local-6989586621679752079"><span id="local-6989586621679752080"><span id="local-6989586621679752081"><span id="local-6989586621679752082"><span id="local-6989586621679752083"><span id="local-6989586621679752084"><span id="local-6989586621679752085"><span id="local-6989586621679752086"><span class="hs-keyword">instance</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679752086"><span class="hs-identifier hs-type">qInProj</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-type">QInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752085"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752081"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752086"><span class="hs-identifier hs-type">qInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752081"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679752079"><span class="hs-identifier hs-type">generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752078"><span class="hs-identifier hs-type">generator'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="#local-6989586621679752077"><span class="hs-identifier hs-type">kInProj</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-type">KInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752085"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752076"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752077"><span class="hs-identifier hs-type">kInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752076"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679752078"><span class="hs-identifier hs-type">generator'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752075"><span class="hs-identifier hs-type">generator''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="#local-6989586621679752074"><span class="hs-identifier hs-type">vInProj</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-type">VInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752085"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752073"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752074"><span class="hs-identifier hs-type">vInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752073"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679752075"><span class="hs-identifier hs-type">generator''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752072"><span class="hs-identifier hs-type">generator'''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="#local-6989586621679752071"><span class="hs-identifier hs-type">outProj</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-type">OutProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752085"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752081"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752071"><span class="hs-identifier hs-type">outProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752081"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679752072"><span class="hs-identifier hs-type">generator'''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752070"><span class="hs-identifier hs-type">generator''''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="#local-6989586621679752069"><span class="hs-identifier hs-type">dropout</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#DropoutF"><span class="hs-identifier hs-type">DropoutF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752085"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752068"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752069"><span class="hs-identifier hs-type">dropout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752068"><span class="hs-identifier hs-type">dropoutP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752070"><span class="hs-identifier hs-type">generator''''</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752070"><span class="hs-identifier hs-type">generator''''</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752085"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752067"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752066"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752081"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752076"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752073"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752068"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752084"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752083"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752082"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752067"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752066"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752080"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752081"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752076"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752073"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679752068"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><a href="#local-6989586621679752079"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="#local-6989586621679752070"><span class="hs-identifier hs-type">generator''''</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621679752063"><span class="annot"><span class="annottext">initialize :: (SGradient gradient, SDevice device, SDataType dataType,
 SDim headDim, SDim headEmbedDim, SDim embedDim, SDim queryEmbedDim,
 SDim keyEmbedDim, SDim valueEmbedDim, dropoutP)
-&gt; generator
-&gt; (MultiHeadAttention
      style
      gradient
      device
      dataType
      headDim
      headEmbedDim
      embedDim
      queryEmbedDim
      keyEmbedDim
      valueEmbedDim
      dropoutP,
    generator'''')
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialize</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679752061"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752061"><span class="hs-identifier hs-var">gradient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752060"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752060"><span class="hs-identifier hs-var">device</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752059"><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752059"><span class="hs-identifier hs-var">dataType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752058"><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679752058"><span class="hs-identifier hs-var">headDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752057"><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679752057"><span class="hs-identifier hs-var">headEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752056"><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752056"><span class="hs-identifier hs-var">embedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752055"><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752055"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752054"><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752054"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752053"><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752053"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752052"><span class="annot"><span class="annottext">dropoutP
</span><a href="#local-6989586621679752052"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679752051"><span class="annot"><span class="annottext">qInProj :: IxState generator generator' qInProj
</span><a href="#local-6989586621679752051"><span class="hs-identifier hs-var hs-var">qInProj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(generator -&gt; (qInProj, generator'))
-&gt; IxState generator generator' qInProj
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator -&gt; (qInProj, generator'))
 -&gt; IxState generator generator' qInProj)
-&gt; (generator -&gt; (qInProj, generator'))
-&gt; IxState generator generator' qInProj
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; generator -&gt; (qInProj, generator')
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752061"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752060"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752059"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752055"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752056"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621679752049"><span class="annot"><span class="annottext">kInProj :: IxState generator' generator'' kInProj
</span><a href="#local-6989586621679752049"><span class="hs-identifier hs-var hs-var">kInProj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(generator' -&gt; (kInProj, generator''))
-&gt; IxState generator' generator'' kInProj
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator' -&gt; (kInProj, generator''))
 -&gt; IxState generator' generator'' kInProj)
-&gt; (generator' -&gt; (kInProj, generator''))
-&gt; IxState generator' generator'' kInProj
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; generator' -&gt; (kInProj, generator'')
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752061"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752060"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752059"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752054"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752056"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621679752048"><span class="annot"><span class="annottext">vInProj :: IxState generator'' generator''' vInProj
</span><a href="#local-6989586621679752048"><span class="hs-identifier hs-var hs-var">vInProj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(generator'' -&gt; (vInProj, generator'''))
-&gt; IxState generator'' generator''' vInProj
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator'' -&gt; (vInProj, generator'''))
 -&gt; IxState generator'' generator''' vInProj)
-&gt; (generator'' -&gt; (vInProj, generator'''))
-&gt; IxState generator'' generator''' vInProj
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; generator'' -&gt; (vInProj, generator''')
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752061"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752060"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752059"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752053"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752056"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>        </span><span id="local-6989586621679752047"><span class="annot"><span class="annottext">outProj :: IxState generator''' generator'''' outProj
</span><a href="#local-6989586621679752047"><span class="hs-identifier hs-var hs-var">outProj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(generator''' -&gt; (outProj, generator''''))
-&gt; IxState generator''' generator'''' outProj
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator''' -&gt; (outProj, generator''''))
 -&gt; IxState generator''' generator'''' outProj)
-&gt; (generator''' -&gt; (outProj, generator''''))
-&gt; IxState generator''' generator'''' outProj
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; generator''' -&gt; (outProj, generator'''')
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752061"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752060"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752059"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752056"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752055"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>        </span><span id="local-6989586621679752046"><span class="annot"><span class="annottext">dropout :: IxState generator'''' generator'''' (Dropout dropoutP)
</span><a href="#local-6989586621679752046"><span class="hs-identifier hs-var hs-var">dropout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(generator'''' -&gt; (Dropout dropoutP, generator''''))
-&gt; IxState generator'''' generator'''' (Dropout dropoutP)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator'''' -&gt; (Dropout dropoutP, generator''''))
 -&gt; IxState generator'''' generator'''' (Dropout dropoutP))
-&gt; (generator'''' -&gt; (Dropout dropoutP, generator''''))
-&gt; IxState generator'''' generator'''' (Dropout dropoutP)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">dropoutP -&gt; generator'''' -&gt; (Dropout dropoutP, generator'''')
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="annot"><span class="annottext">dropoutP
</span><a href="#local-6989586621679752052"><span class="hs-identifier hs-var">dropoutP</span></a></span><span>
</span><span id="line-230"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IxState
  generator
  generator''''
  (MultiHeadAttention
     style
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     queryEmbedDim
     keyEmbedDim
     valueEmbedDim
     dropoutP)
-&gt; generator
-&gt; (MultiHeadAttention
      style
      gradient
      device
      dataType
      headDim
      headEmbedDim
      embedDim
      queryEmbedDim
      keyEmbedDim
      valueEmbedDim
      dropoutP,
    generator'''')
forall i j a. IxState i j a -&gt; i -&gt; (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxState</span></a></span><span> </span><span class="annot"><span class="annottext">(IxState
   generator
   generator''''
   (MultiHeadAttention
      style
      gradient
      device
      dataType
      headDim
      headEmbedDim
      embedDim
      queryEmbedDim
      keyEmbedDim
      valueEmbedDim
      dropoutP)
 -&gt; generator
 -&gt; (MultiHeadAttention
       style
       gradient
       device
       dataType
       headDim
       headEmbedDim
       embedDim
       queryEmbedDim
       keyEmbedDim
       valueEmbedDim
       dropoutP,
     generator''''))
-&gt; IxState
     generator
     generator''''
     (MultiHeadAttention
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        valueEmbedDim
        dropoutP)
-&gt; generator
-&gt; (MultiHeadAttention
      style
      gradient
      device
      dataType
      headDim
      headEmbedDim
      embedDim
      queryEmbedDim
      keyEmbedDim
      valueEmbedDim
      dropoutP,
    generator'''')
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; qInProj
-&gt; kInProj
-&gt; vInProj
-&gt; outProj
-&gt; Dropout dropoutP
-&gt; GMultiHeadAttention
     headDim
     headEmbedDim
     embedDim
     qInProj
     kInProj
     vInProj
     outProj
     (Dropout dropoutP)
forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; qInProj
-&gt; kInProj
-&gt; vInProj
-&gt; outProj
-&gt; dropout
-&gt; GMultiHeadAttention
     headDim
     headEmbedDim
     embedDim
     qInProj
     kInProj
     vInProj
     outProj
     dropout
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-var">GMultiHeadAttention</span></a></span><span>
</span><span id="line-232"></span><span>              </span><span class="annot"><span class="annottext">(SDim headDim
 -&gt; SDim headEmbedDim
 -&gt; SDim embedDim
 -&gt; qInProj
 -&gt; kInProj
 -&gt; vInProj
 -&gt; outProj
 -&gt; Dropout dropoutP
 -&gt; GMultiHeadAttention
      headDim
      headEmbedDim
      embedDim
      qInProj
      kInProj
      vInProj
      outProj
      (Dropout dropoutP))
-&gt; IxState generator generator (SDim headDim)
-&gt; IxState
     generator
     generator
     (SDim headEmbedDim
      -&gt; SDim embedDim
      -&gt; qInProj
      -&gt; kInProj
      -&gt; vInProj
      -&gt; outProj
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 k2 (f :: k1 -&gt; k2 -&gt; Type -&gt; Type) a b (j :: k1)
       (k3 :: k2).
IxFunctor f =&gt;
(a -&gt; b) -&gt; f j k3 a -&gt; f j k3 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim -&gt; IxState generator generator (SDim headDim)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679752058"><span class="hs-identifier hs-var">headDim</span></a></span><span>
</span><span id="line-233"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (SDim headEmbedDim
   -&gt; SDim embedDim
   -&gt; qInProj
   -&gt; kInProj
   -&gt; vInProj
   -&gt; outProj
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator generator (SDim headEmbedDim)
-&gt; IxState
     generator
     generator
     (SDim embedDim
      -&gt; qInProj
      -&gt; kInProj
      -&gt; vInProj
      -&gt; outProj
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
-&gt; IxState generator generator (SDim headEmbedDim)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679752057"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span>
</span><span id="line-234"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (SDim embedDim
   -&gt; qInProj
   -&gt; kInProj
   -&gt; vInProj
   -&gt; outProj
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator generator (SDim embedDim)
-&gt; IxState
     generator
     generator
     (qInProj
      -&gt; kInProj
      -&gt; vInProj
      -&gt; outProj
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim -&gt; IxState generator generator (SDim embedDim)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752056"><span class="hs-identifier hs-var">embedDim</span></a></span><span>
</span><span id="line-235"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (qInProj
   -&gt; kInProj
   -&gt; vInProj
   -&gt; outProj
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator generator' qInProj
-&gt; IxState
     generator
     generator'
     (kInProj
      -&gt; vInProj
      -&gt; outProj
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState generator generator' qInProj
</span><a href="#local-6989586621679752051"><span class="hs-identifier hs-var">qInProj</span></a></span><span>
</span><span id="line-236"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator'
  (kInProj
   -&gt; vInProj
   -&gt; outProj
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator' generator'' kInProj
-&gt; IxState
     generator
     generator''
     (vInProj
      -&gt; outProj
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState generator' generator'' kInProj
</span><a href="#local-6989586621679752049"><span class="hs-identifier hs-var">kInProj</span></a></span><span>
</span><span id="line-237"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator''
  (vInProj
   -&gt; outProj
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator'' generator''' vInProj
-&gt; IxState
     generator
     generator'''
     (outProj
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState generator'' generator''' vInProj
</span><a href="#local-6989586621679752048"><span class="hs-identifier hs-var">vInProj</span></a></span><span>
</span><span id="line-238"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator'''
  (outProj
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator''' generator'''' outProj
-&gt; IxState
     generator
     generator''''
     (Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           qInProj
           kInProj
           vInProj
           outProj
           (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState generator''' generator'''' outProj
</span><a href="#local-6989586621679752047"><span class="hs-identifier hs-var">outProj</span></a></span><span>
</span><span id="line-239"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator''''
  (Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
-&gt; IxState generator'''' generator'''' (Dropout dropoutP)
-&gt; IxState
     generator
     generator''''
     (GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        qInProj
        kInProj
        vInProj
        outProj
        (Dropout dropoutP))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState generator'''' generator'''' (Dropout dropoutP)
</span><a href="#local-6989586621679752046"><span class="hs-identifier hs-var">dropout</span></a></span><span>
</span><span id="line-240"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><span class="annottext">IxState
  generator
  generator''''
  (GMultiHeadAttention
     headDim
     headEmbedDim
     embedDim
     qInProj
     kInProj
     vInProj
     outProj
     (Dropout dropoutP))
-&gt; (GMultiHeadAttention
      headDim
      headEmbedDim
      embedDim
      qInProj
      kInProj
      vInProj
      outProj
      (Dropout dropoutP)
    -&gt; IxState
         generator''''
         generator''''
         (MultiHeadAttention
            style
            gradient
            device
            dataType
            headDim
            headEmbedDim
            embedDim
            queryEmbedDim
            keyEmbedDim
            valueEmbedDim
            dropoutP))
-&gt; IxState
     generator
     generator''''
     (MultiHeadAttention
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        valueEmbedDim
        dropoutP)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">MultiHeadAttention
  style
  gradient
  device
  dataType
  headDim
  headEmbedDim
  embedDim
  queryEmbedDim
  keyEmbedDim
  valueEmbedDim
  dropoutP
-&gt; IxState
     generator''''
     generator''''
     (MultiHeadAttention
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        valueEmbedDim
        dropoutP)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(MultiHeadAttention
   style
   gradient
   device
   dataType
   headDim
   headEmbedDim
   embedDim
   queryEmbedDim
   keyEmbedDim
   valueEmbedDim
   dropoutP
 -&gt; IxState
      generator''''
      generator''''
      (MultiHeadAttention
         style
         gradient
         device
         dataType
         headDim
         headEmbedDim
         embedDim
         queryEmbedDim
         keyEmbedDim
         valueEmbedDim
         dropoutP))
-&gt; (GMultiHeadAttention
      headDim
      headEmbedDim
      embedDim
      qInProj
      kInProj
      vInProj
      outProj
      (Dropout dropoutP)
    -&gt; MultiHeadAttention
         style
         gradient
         device
         dataType
         headDim
         headEmbedDim
         embedDim
         queryEmbedDim
         keyEmbedDim
         valueEmbedDim
         dropoutP)
-&gt; GMultiHeadAttention
     headDim
     headEmbedDim
     embedDim
     qInProj
     kInProj
     vInProj
     outProj
     (Dropout dropoutP)
-&gt; IxState
     generator''''
     generator''''
     (MultiHeadAttention
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        valueEmbedDim
        dropoutP)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  (Dropout dropoutP)
-&gt; MultiHeadAttention
     style
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     queryEmbedDim
     keyEmbedDim
     valueEmbedDim
     dropoutP
forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (keyEmbedDim :: Dim (Name Symbol) (Size Nat))
       (valueEmbedDim :: Dim (Name Symbol) (Size Nat)) dropoutP.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
-&gt; MultiHeadAttention
     style
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     queryEmbedDim
     keyEmbedDim
     valueEmbedDim
     dropoutP
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-var">MultiHeadAttention</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span id="local-6989586621679752033"><span id="local-6989586621679752034"><span id="local-6989586621679752035"><span id="local-6989586621679752036"><span id="local-6989586621679752037"><span id="local-6989586621679752038"><span id="local-6989586621679752039"><span id="local-6989586621679752040"><span id="local-6989586621679752041"><span id="local-6989586621679752042"><span id="local-6989586621679752043"><span class="hs-keyword">instance</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752042"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752041"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752040"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752039"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752038"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752037"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752036"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752035"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752034"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752033"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752042"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752041"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752040"><span class="hs-identifier hs-type">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752039"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752038"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752037"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752036"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752035"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752034"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679752033"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679752029"><span class="annot"><span class="annottext">fromStateDict :: (SGradient gradient, SDevice device, SDataType dataType,
 SDim headDim, SDim headEmbedDim, SDim embedDim, SDim queryEmbedDim,
 SDim keyEmbedDim, SDim valueEmbedDim, dropoutP)
-&gt; StateDictKey
-&gt; m (MultiHeadAttention
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        valueEmbedDim
        dropoutP)
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromStateDict</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679752027"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752026"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752025"><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752024"><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679752024"><span class="hs-identifier hs-var">headDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752023"><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679752023"><span class="hs-identifier hs-var">headEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752022"><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752021"><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752020"><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752019"><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679752018"><span class="annot"><span class="annottext">dropoutP
</span><a href="#local-6989586621679752018"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679752017"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679752016"><span class="annot"><span class="annottext">qInProj :: STransformerStyle style
-&gt; m (QInProjF
        style gradient device dataType queryEmbedDim embedDim)
</span><a href="#local-6989586621679752016"><span class="hs-identifier hs-var hs-var">qInProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.query.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim queryEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType queryEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.query.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (QInProjF style gradient device dataType queryEmbedDim embedDim)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-258"></span><span>        </span><span id="local-6989586621679752006"><span class="annot"><span class="annottext">kInProj :: STransformerStyle style
-&gt; m (KInProjF style gradient device dataType keyEmbedDim embedDim)
</span><a href="#local-6989586621679752006"><span class="hs-identifier hs-var hs-var">kInProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.key.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim keyEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType keyEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679752020"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.key.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (KInProjF style gradient device dataType keyEmbedDim embedDim)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-266"></span><span>        </span><span id="local-6989586621679752005"><span class="annot"><span class="annottext">vInProj :: STransformerStyle style
-&gt; m (VInProjF
        style gradient device dataType valueEmbedDim embedDim)
</span><a href="#local-6989586621679752005"><span class="hs-identifier hs-var hs-var">vInProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.value.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim valueEmbedDim, SDim embedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType valueEmbedDim embedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim valueEmbedDim
</span><a href="#local-6989586621679752019"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.value.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (VInProjF style gradient device dataType valueEmbedDim embedDim)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-274"></span><span>        </span><span id="local-6989586621679752004"><span class="annot"><span class="annottext">outProj :: STransformerStyle style
-&gt; m (OutProjF
        style gradient device dataType embedDim queryEmbedDim)
</span><a href="#local-6989586621679752004"><span class="hs-identifier hs-var hs-var">outProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;o.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithoutBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;o.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;out_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;out_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;out_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;output.dense.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType dataType,
 SDim embedDim, SDim queryEmbedDim)
-&gt; StateDictKey
-&gt; m (Linear
        'WithBias gradient device dataType embedDim queryEmbedDim)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679752027"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679752026"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679752025"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679752021"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;output.dense.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (OutProjF style gradient device dataType embedDim queryEmbedDim)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-282"></span><span>        </span><span id="local-6989586621679752003"><span class="annot"><span class="annottext">dropout :: STransformerStyle style -&gt; m (Dropout dropoutP)
</span><a href="#local-6989586621679752003"><span class="hs-identifier hs-var hs-var">dropout</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">dropoutP -&gt; StateDictKey -&gt; m (Dropout dropoutP)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">dropoutP
</span><a href="#local-6989586621679752018"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679752017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-283"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; MultiHeadAttention
     style
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     queryEmbedDim
     keyEmbedDim
     valueEmbedDim
     dropoutP
forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (keyEmbedDim :: Dim (Name Symbol) (Size Nat))
       (valueEmbedDim :: Dim (Name Symbol) (Size Nat)) dropoutP.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
-&gt; MultiHeadAttention
     style
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     queryEmbedDim
     keyEmbedDim
     valueEmbedDim
     dropoutP
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-var">MultiHeadAttention</span></a></span><span>
</span><span id="line-284"></span><span>          </span><span class="annot"><span class="annottext">(GMultiHeadAttention
   headDim
   headEmbedDim
   embedDim
   (QInProjF style gradient device dataType queryEmbedDim embedDim)
   (KInProjF style gradient device dataType keyEmbedDim embedDim)
   (VInProjF style gradient device dataType valueEmbedDim embedDim)
   (OutProjF style gradient device dataType embedDim queryEmbedDim)
   (Dropout dropoutP)
 -&gt; MultiHeadAttention
      style
      gradient
      device
      dataType
      headDim
      headEmbedDim
      embedDim
      queryEmbedDim
      keyEmbedDim
      valueEmbedDim
      dropoutP)
-&gt; m (GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (MultiHeadAttention
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        valueEmbedDim
        dropoutP)
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
-&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
-&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
-&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
-&gt; Dropout dropoutP
-&gt; GMultiHeadAttention
     headDim
     headEmbedDim
     embedDim
     (QInProjF style gradient device dataType queryEmbedDim embedDim)
     (KInProjF style gradient device dataType keyEmbedDim embedDim)
     (VInProjF style gradient device dataType valueEmbedDim embedDim)
     (OutProjF style gradient device dataType embedDim queryEmbedDim)
     (Dropout dropoutP)
forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; qInProj
-&gt; kInProj
-&gt; vInProj
-&gt; outProj
-&gt; dropout
-&gt; GMultiHeadAttention
     headDim
     headEmbedDim
     embedDim
     qInProj
     kInProj
     vInProj
     outProj
     dropout
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-var">GMultiHeadAttention</span></a></span><span>
</span><span id="line-285"></span><span>                  </span><span class="annot"><span class="annottext">(SDim headDim
 -&gt; SDim headEmbedDim
 -&gt; SDim embedDim
 -&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
 -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
 -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
 -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
 -&gt; Dropout dropoutP
 -&gt; GMultiHeadAttention
      headDim
      headEmbedDim
      embedDim
      (QInProjF style gradient device dataType queryEmbedDim embedDim)
      (KInProjF style gradient device dataType keyEmbedDim embedDim)
      (VInProjF style gradient device dataType valueEmbedDim embedDim)
      (OutProjF style gradient device dataType embedDim queryEmbedDim)
      (Dropout dropoutP))
-&gt; m (SDim headDim)
-&gt; m (SDim headEmbedDim
      -&gt; SDim embedDim
      -&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
      -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
      -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
      -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDim headDim -&gt; m (SDim headDim)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679752024"><span class="hs-identifier hs-var">headDim</span></a></span><span>
</span><span id="line-286"></span><span>                  </span><span class="annot"><span class="annottext">m (SDim headEmbedDim
   -&gt; SDim embedDim
   -&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
   -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
   -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
   -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (SDim headEmbedDim)
-&gt; m (SDim embedDim
      -&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
      -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
      -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
      -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim -&gt; m (SDim headEmbedDim)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679752023"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span>
</span><span id="line-287"></span><span>                  </span><span class="annot"><span class="annottext">m (SDim embedDim
   -&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
   -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
   -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
   -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (SDim embedDim)
-&gt; m (QInProjF
        style gradient device dataType queryEmbedDim embedDim
      -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
      -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
      -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDim embedDim -&gt; m (SDim embedDim)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679752022"><span class="hs-identifier hs-var">embedDim</span></a></span><span>
</span><span id="line-288"></span><span>                  </span><span class="annot"><span class="annottext">m (QInProjF style gradient device dataType queryEmbedDim embedDim
   -&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
   -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
   -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (QInProjF
        style gradient device dataType queryEmbedDim embedDim)
-&gt; m (KInProjF style gradient device dataType keyEmbedDim embedDim
      -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
      -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; m (QInProjF
        style gradient device dataType queryEmbedDim embedDim)
</span><a href="#local-6989586621679752016"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>                  </span><span class="annot"><span class="annottext">m (KInProjF style gradient device dataType keyEmbedDim embedDim
   -&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
   -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (KInProjF style gradient device dataType keyEmbedDim embedDim)
-&gt; m (VInProjF
        style gradient device dataType valueEmbedDim embedDim
      -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; m (KInProjF style gradient device dataType keyEmbedDim embedDim)
</span><a href="#local-6989586621679752006"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>                  </span><span class="annot"><span class="annottext">m (VInProjF style gradient device dataType valueEmbedDim embedDim
   -&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (VInProjF
        style gradient device dataType valueEmbedDim embedDim)
-&gt; m (OutProjF
        style gradient device dataType embedDim queryEmbedDim
      -&gt; Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; m (VInProjF
        style gradient device dataType valueEmbedDim embedDim)
</span><a href="#local-6989586621679752005"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                  </span><span class="annot"><span class="annottext">m (OutProjF style gradient device dataType embedDim queryEmbedDim
   -&gt; Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (OutProjF
        style gradient device dataType embedDim queryEmbedDim)
-&gt; m (Dropout dropoutP
      -&gt; GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (QInProjF style gradient device dataType queryEmbedDim embedDim)
           (KInProjF style gradient device dataType keyEmbedDim embedDim)
           (VInProjF style gradient device dataType valueEmbedDim embedDim)
           (OutProjF style gradient device dataType embedDim queryEmbedDim)
           (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; m (OutProjF
        style gradient device dataType embedDim queryEmbedDim)
</span><a href="#local-6989586621679752004"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>                  </span><span class="annot"><span class="annottext">m (Dropout dropoutP
   -&gt; GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
-&gt; m (Dropout dropoutP)
-&gt; m (GMultiHeadAttention
        headDim
        headEmbedDim
        embedDim
        (QInProjF style gradient device dataType queryEmbedDim embedDim)
        (KInProjF style gradient device dataType keyEmbedDim embedDim)
        (VInProjF style gradient device dataType valueEmbedDim embedDim)
        (OutProjF style gradient device dataType embedDim queryEmbedDim)
        (Dropout dropoutP))
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style -&gt; m (Dropout dropoutP)
</span><a href="#local-6989586621679752003"><span class="hs-identifier hs-var">dropout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621679752000"><span class="annot"><span class="annottext">toStateDict :: StateDictKey
-&gt; MultiHeadAttention
     style
     gradient
     device
     dataType
     headDim
     headEmbedDim
     embedDim
     queryEmbedDim
     keyEmbedDim
     valueEmbedDim
     dropoutP
-&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">toStateDict</span></a></span></span><span> </span><span id="local-6989586621679751998"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679751990"><span id="local-6989586621679751991"><span id="local-6989586621679751992"><span id="local-6989586621679751993"><span id="local-6989586621679751994"><span id="local-6989586621679751995"><span id="local-6989586621679751996"><span id="local-6989586621679751997"><span class="annot"><span class="annottext">SDim headDim
SDim headEmbedDim
SDim embedDim
DropoutF style dropoutP
OutProjF style gradient device dataType embedDim queryEmbedDim
VInProjF style gradient device dataType valueEmbedDim embedDim
KInProjF style gradient device dataType keyEmbedDim embedDim
QInProjF style gradient device dataType queryEmbedDim embedDim
mhaDropout :: DropoutF style dropoutP
mhaOutProj :: OutProjF style gradient device dataType embedDim queryEmbedDim
mhaVInProj :: VInProjF style gradient device dataType valueEmbedDim embedDim
mhaKInProj :: KInProjF style gradient device dataType keyEmbedDim embedDim
mhaQInProj :: QInProjF style gradient device dataType queryEmbedDim embedDim
mhaEmbedDim :: SDim embedDim
mhaHeadEmbedDim :: SDim headEmbedDim
mhaHeadDim :: SDim headDim
mhaDropout :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; dropout
mhaOutProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; outProj
mhaVInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; vInProj
mhaKInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; kInProj
mhaQInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; qInProj
mhaEmbedDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim embedDim
mhaHeadEmbedDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headEmbedDim
mhaHeadDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headDim
</span><a href="#local-6989586621679751990"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751989"><span class="annot"><span class="annottext">qInProj :: STransformerStyle style
-&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
-&gt; m ()
</span><a href="#local-6989586621679751989"><span class="hs-identifier hs-var hs-var">qInProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;q_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.query.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.query.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QInProjF style gradient device dataType queryEmbedDim embedDim
-&gt; m ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-303"></span><span>        </span><span id="local-6989586621679751988"><span class="annot"><span class="annottext">kInProj :: STransformerStyle style
-&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
-&gt; m ()
</span><a href="#local-6989586621679751988"><span class="hs-identifier hs-var hs-var">kInProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;k_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.key.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.key.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KInProjF style gradient device dataType keyEmbedDim embedDim
-&gt; m ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-311"></span><span>        </span><span id="local-6989586621679751987"><span class="annot"><span class="annottext">vInProj :: STransformerStyle style
-&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
-&gt; m ()
</span><a href="#local-6989586621679751987"><span class="hs-identifier hs-var hs-var">vInProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;v_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.value.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;self.value.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VInProjF style gradient device dataType valueEmbedDim embedDim
-&gt; m ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621679751986"><span class="annot"><span class="annottext">outProj :: STransformerStyle style
-&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
-&gt; m ()
</span><a href="#local-6989586621679751986"><span class="hs-identifier hs-var hs-var">outProj</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;o.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear
     'WithoutBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;o.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;out_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;out_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;out_proj.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;output.dense.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; Linear 'WithBias gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679751998"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; StateDictKey -&gt; StateDictKey
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;output.dense.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutProjF style gradient device dataType embedDim queryEmbedDim
-&gt; m ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-327"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; QInProjF style gradient device dataType queryEmbedDim embedDim
-&gt; m ()
</span><a href="#local-6989586621679751989"><span class="hs-identifier hs-var">qInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QInProjF style gradient device dataType queryEmbedDim embedDim
</span><a href="#local-6989586621679751994"><span class="hs-identifier hs-var">mhaQInProj</span></a></span><span>
</span><span id="line-329"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; KInProjF style gradient device dataType keyEmbedDim embedDim
-&gt; m ()
</span><a href="#local-6989586621679751988"><span class="hs-identifier hs-var">kInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KInProjF style gradient device dataType keyEmbedDim embedDim
</span><a href="#local-6989586621679751993"><span class="hs-identifier hs-var">mhaKInProj</span></a></span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; VInProjF style gradient device dataType valueEmbedDim embedDim
-&gt; m ()
</span><a href="#local-6989586621679751987"><span class="hs-identifier hs-var">vInProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VInProjF style gradient device dataType valueEmbedDim embedDim
</span><a href="#local-6989586621679751992"><span class="hs-identifier hs-var">mhaVInProj</span></a></span><span>
</span><span id="line-331"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; OutProjF style gradient device dataType embedDim queryEmbedDim
-&gt; m ()
</span><a href="#local-6989586621679751986"><span class="hs-identifier hs-var">outProj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679752043"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OutProjF style gradient device dataType embedDim queryEmbedDim
</span><a href="#local-6989586621679751991"><span class="hs-identifier hs-var">mhaOutProj</span></a></span><span>
</span><span id="line-332"></span><span>          </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- | Whether or not scaling is applied in the multi-headed attention layer.</span><span>
</span><span id="line-335"></span><span id="local-6989586621679751984"><span id="local-6989586621679751985"></span></span><span class="hs-keyword">data</span><span> </span><span id="Scaling"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#Scaling"><span class="hs-identifier hs-var">Scaling</span></a></span></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Scaling is not done.</span><span>
</span><span id="line-337"></span><span>    </span><span id="NoScaling"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#NoScaling"><span class="hs-identifier hs-var">NoScaling</span></a></span></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Scaling is applied to the query after in the in-projection.</span><span>
</span><span id="line-339"></span><span>    </span><span id="QueryScaling"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QueryScaling"><span class="hs-identifier hs-var">QueryScaling</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Scaling is applied to the attention weights.</span><span>
</span><span id="line-341"></span><span>    </span><span id="WeightScaling"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#WeightScaling"><span class="hs-identifier hs-var">WeightScaling</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679751977"><span id="local-6989586621679751979"><span class="annot"><span class="annottext">Scaling -&gt; Scaling -&gt; Bool
(Scaling -&gt; Scaling -&gt; Bool)
-&gt; (Scaling -&gt; Scaling -&gt; Bool) -&gt; Eq Scaling
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Scaling -&gt; Scaling -&gt; Bool
$c/= :: Scaling -&gt; Scaling -&gt; Bool
== :: Scaling -&gt; Scaling -&gt; Bool
$c== :: Scaling -&gt; Scaling -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751961"><span id="local-6989586621679751963"><span id="local-6989586621679751965"><span id="local-6989586621679751967"><span id="local-6989586621679751969"><span id="local-6989586621679751971"><span id="local-6989586621679751973"><span class="annot"><span class="annottext">Eq Scaling
Eq Scaling
-&gt; (Scaling -&gt; Scaling -&gt; Ordering)
-&gt; (Scaling -&gt; Scaling -&gt; Bool)
-&gt; (Scaling -&gt; Scaling -&gt; Bool)
-&gt; (Scaling -&gt; Scaling -&gt; Bool)
-&gt; (Scaling -&gt; Scaling -&gt; Bool)
-&gt; (Scaling -&gt; Scaling -&gt; Scaling)
-&gt; (Scaling -&gt; Scaling -&gt; Scaling)
-&gt; Ord Scaling
Scaling -&gt; Scaling -&gt; Bool
Scaling -&gt; Scaling -&gt; Ordering
Scaling -&gt; Scaling -&gt; Scaling
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Scaling -&gt; Scaling -&gt; Scaling
$cmin :: Scaling -&gt; Scaling -&gt; Scaling
max :: Scaling -&gt; Scaling -&gt; Scaling
$cmax :: Scaling -&gt; Scaling -&gt; Scaling
&gt;= :: Scaling -&gt; Scaling -&gt; Bool
$c&gt;= :: Scaling -&gt; Scaling -&gt; Bool
&gt; :: Scaling -&gt; Scaling -&gt; Bool
$c&gt; :: Scaling -&gt; Scaling -&gt; Bool
&lt;= :: Scaling -&gt; Scaling -&gt; Bool
$c&lt;= :: Scaling -&gt; Scaling -&gt; Bool
&lt; :: Scaling -&gt; Scaling -&gt; Bool
$c&lt; :: Scaling -&gt; Scaling -&gt; Bool
compare :: Scaling -&gt; Scaling -&gt; Ordering
$ccompare :: Scaling -&gt; Scaling -&gt; Ordering
$cp1Ord :: Eq Scaling
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751954"><span id="local-6989586621679751956"><span id="local-6989586621679751958"><span class="annot"><span class="annottext">Int -&gt; Scaling -&gt; StateDictKey -&gt; StateDictKey
[Scaling] -&gt; StateDictKey -&gt; StateDictKey
Scaling -&gt; StateDictKey
(Int -&gt; Scaling -&gt; StateDictKey -&gt; StateDictKey)
-&gt; (Scaling -&gt; StateDictKey)
-&gt; ([Scaling] -&gt; StateDictKey -&gt; StateDictKey)
-&gt; Show Scaling
forall a.
(Int -&gt; a -&gt; StateDictKey -&gt; StateDictKey)
-&gt; (a -&gt; StateDictKey)
-&gt; ([a] -&gt; StateDictKey -&gt; StateDictKey)
-&gt; Show a
showList :: [Scaling] -&gt; StateDictKey -&gt; StateDictKey
$cshowList :: [Scaling] -&gt; StateDictKey -&gt; StateDictKey
show :: Scaling -&gt; StateDictKey
$cshow :: Scaling -&gt; StateDictKey
showsPrec :: Int -&gt; Scaling -&gt; StateDictKey -&gt; StateDictKey
$cshowsPrec :: Int -&gt; Scaling -&gt; StateDictKey -&gt; StateDictKey
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. Scaling -&gt; Rep Scaling x)
-&gt; (forall x. Rep Scaling x -&gt; Scaling) -&gt; Generic Scaling
forall x. Rep Scaling x -&gt; Scaling
forall x. Scaling -&gt; Rep Scaling x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep Scaling x -&gt; Scaling
$cfrom :: forall x. Scaling -&gt; Rep Scaling x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- | Whether or not out-projection is applied in the multi-headed attention layer.</span><span>
</span><span id="line-345"></span><span id="local-6989586621679751948"><span id="local-6989586621679751949"></span></span><span class="hs-keyword">data</span><span> </span><span id="OutProj"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProj"><span class="hs-identifier hs-var">OutProj</span></a></span></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Out-projection is absent.</span><span>
</span><span id="line-347"></span><span>    </span><span id="NoOutProj"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#NoOutProj"><span class="hs-identifier hs-var">NoOutProj</span></a></span></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | Out-projection is applied.</span><span>
</span><span id="line-349"></span><span>    </span><span id="OutProj"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProj"><span class="hs-identifier hs-var">OutProj</span></a></span></span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679751942"><span id="local-6989586621679751944"><span class="annot"><span class="annottext">OutProj -&gt; OutProj -&gt; Bool
(OutProj -&gt; OutProj -&gt; Bool)
-&gt; (OutProj -&gt; OutProj -&gt; Bool) -&gt; Eq OutProj
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: OutProj -&gt; OutProj -&gt; Bool
$c/= :: OutProj -&gt; OutProj -&gt; Bool
== :: OutProj -&gt; OutProj -&gt; Bool
$c== :: OutProj -&gt; OutProj -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751927"><span id="local-6989586621679751929"><span id="local-6989586621679751931"><span id="local-6989586621679751933"><span id="local-6989586621679751935"><span id="local-6989586621679751937"><span id="local-6989586621679751939"><span class="annot"><span class="annottext">Eq OutProj
Eq OutProj
-&gt; (OutProj -&gt; OutProj -&gt; Ordering)
-&gt; (OutProj -&gt; OutProj -&gt; Bool)
-&gt; (OutProj -&gt; OutProj -&gt; Bool)
-&gt; (OutProj -&gt; OutProj -&gt; Bool)
-&gt; (OutProj -&gt; OutProj -&gt; Bool)
-&gt; (OutProj -&gt; OutProj -&gt; OutProj)
-&gt; (OutProj -&gt; OutProj -&gt; OutProj)
-&gt; Ord OutProj
OutProj -&gt; OutProj -&gt; Bool
OutProj -&gt; OutProj -&gt; Ordering
OutProj -&gt; OutProj -&gt; OutProj
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: OutProj -&gt; OutProj -&gt; OutProj
$cmin :: OutProj -&gt; OutProj -&gt; OutProj
max :: OutProj -&gt; OutProj -&gt; OutProj
$cmax :: OutProj -&gt; OutProj -&gt; OutProj
&gt;= :: OutProj -&gt; OutProj -&gt; Bool
$c&gt;= :: OutProj -&gt; OutProj -&gt; Bool
&gt; :: OutProj -&gt; OutProj -&gt; Bool
$c&gt; :: OutProj -&gt; OutProj -&gt; Bool
&lt;= :: OutProj -&gt; OutProj -&gt; Bool
$c&lt;= :: OutProj -&gt; OutProj -&gt; Bool
&lt; :: OutProj -&gt; OutProj -&gt; Bool
$c&lt; :: OutProj -&gt; OutProj -&gt; Bool
compare :: OutProj -&gt; OutProj -&gt; Ordering
$ccompare :: OutProj -&gt; OutProj -&gt; Ordering
$cp1Ord :: Eq OutProj
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751921"><span id="local-6989586621679751923"><span id="local-6989586621679751925"><span class="annot"><span class="annottext">Int -&gt; OutProj -&gt; StateDictKey -&gt; StateDictKey
[OutProj] -&gt; StateDictKey -&gt; StateDictKey
OutProj -&gt; StateDictKey
(Int -&gt; OutProj -&gt; StateDictKey -&gt; StateDictKey)
-&gt; (OutProj -&gt; StateDictKey)
-&gt; ([OutProj] -&gt; StateDictKey -&gt; StateDictKey)
-&gt; Show OutProj
forall a.
(Int -&gt; a -&gt; StateDictKey -&gt; StateDictKey)
-&gt; (a -&gt; StateDictKey)
-&gt; ([a] -&gt; StateDictKey -&gt; StateDictKey)
-&gt; Show a
showList :: [OutProj] -&gt; StateDictKey -&gt; StateDictKey
$cshowList :: [OutProj] -&gt; StateDictKey -&gt; StateDictKey
show :: OutProj -&gt; StateDictKey
$cshow :: OutProj -&gt; StateDictKey
showsPrec :: Int -&gt; OutProj -&gt; StateDictKey -&gt; StateDictKey
$cshowsPrec :: Int -&gt; OutProj -&gt; StateDictKey -&gt; StateDictKey
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. OutProj -&gt; Rep OutProj x)
-&gt; (forall x. Rep OutProj x -&gt; OutProj) -&gt; Generic OutProj
forall x. Rep OutProj x -&gt; OutProj
forall x. OutProj -&gt; Rep OutProj x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep OutProj x -&gt; OutProj
$cfrom :: forall x. OutProj -&gt; Rep OutProj x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-- | 'HasForward' instance for 'MultiHeadAttention'.</span><span>
</span><span id="line-353"></span><span class="hs-comment">--</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- 'Scaling' of queries is optional.</span><span>
</span><span id="line-355"></span><span class="hs-comment">--</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;        &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;       &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;       &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- &#9474; attentionBias &#9474;        &#9474; query &#9474;       &#9474; key &#9474;       &#9474; value &#9474;</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;        &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;       &#9492;&#9472;&#9472;&#9516;&#9472;&#9472;&#9496;       &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-360"></span><span class="hs-comment">--         &#9474;                    &#9474;              &#9474;              &#9474;</span><span>
</span><span id="line-361"></span><span class="hs-comment">--         &#9474;                    &#9660;              &#9660;              &#9660;</span><span>
</span><span id="line-362"></span><span class="hs-comment">--         &#9474;                mhaQInProj     mhaKInProj     mhaVInProj</span><span>
</span><span id="line-363"></span><span class="hs-comment">--         &#9474;                    &#9660;              &#9474;              &#9474;</span><span>
</span><span id="line-364"></span><span class="hs-comment">--         &#9474;                (scaling)          &#9474;              &#9474;</span><span>
</span><span id="line-365"></span><span class="hs-comment">--         &#9474;                    &#9660;              &#9660;              &#9660;</span><span>
</span><span id="line-366"></span><span class="hs-comment">--         &#9474;                 reshape        reshape        reshape</span><span>
</span><span id="line-367"></span><span class="hs-comment">--         &#9474;                    &#9660;              &#9660;              &#9660;</span><span>
</span><span id="line-368"></span><span class="hs-comment">--         &#9474;                transpose      transpose      transpose</span><span>
</span><span id="line-369"></span><span class="hs-comment">--         &#9474;                    &#9474;              &#9660;              &#9474;</span><span>
</span><span id="line-370"></span><span class="hs-comment">--         &#9474;                    &#9474;          transpose          &#9474;</span><span>
</span><span id="line-371"></span><span class="hs-comment">--         &#9474;                    &#9474;              &#9474;              &#9474;</span><span>
</span><span id="line-372"></span><span class="hs-comment">--         &#9474;                    &#9492;&#9472;&#9472;&#9472;&#9658;matmul&#9668;&#9472;&#9472;&#9472;&#9496;              &#9474;</span><span>
</span><span id="line-373"></span><span class="hs-comment">--         &#9474;                           &#9660;                      &#9474;</span><span>
</span><span id="line-374"></span><span class="hs-comment">--         &#9474;                       (scaling)                  &#9474;</span><span>
</span><span id="line-375"></span><span class="hs-comment">--         &#9474;                           &#9474;                      &#9474;</span><span>
</span><span id="line-376"></span><span class="hs-comment">--         &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9658;add&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;                      &#9474;</span><span>
</span><span id="line-377"></span><span class="hs-comment">--                      &#9660;                                     &#9474;</span><span>
</span><span id="line-378"></span><span class="hs-comment">--                   softmax                                  &#9474;</span><span>
</span><span id="line-379"></span><span class="hs-comment">--                      &#9660;                                     &#9474;</span><span>
</span><span id="line-380"></span><span class="hs-comment">--                  mhaDropout                                &#9474;</span><span>
</span><span id="line-381"></span><span class="hs-comment">--                      &#9474;                                     &#9474;</span><span>
</span><span id="line-382"></span><span class="hs-comment">--                      &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9658;matmul&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-383"></span><span class="hs-comment">--                                        &#9660;</span><span>
</span><span id="line-384"></span><span class="hs-comment">--                                    transpose</span><span>
</span><span id="line-385"></span><span class="hs-comment">--                                        &#9660;</span><span>
</span><span id="line-386"></span><span class="hs-comment">--                                     reshape</span><span>
</span><span id="line-387"></span><span class="hs-comment">--                                        &#9660;</span><span>
</span><span id="line-388"></span><span class="hs-comment">--                                   (mhaOutProj)</span><span>
</span><span id="line-389"></span><span class="hs-comment">--                                        &#9474;</span><span>
</span><span id="line-390"></span><span class="hs-comment">--                                        &#9660;</span><span>
</span><span id="line-391"></span><span class="hs-comment">--                                    &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-392"></span><span class="hs-comment">--                                    &#9474; query &#9474;</span><span>
</span><span id="line-393"></span><span class="hs-comment">--                                    &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-395"></span><span id="local-6989586621679751884"><span id="local-6989586621679751885"><span id="local-6989586621679751886"><span id="local-6989586621679751887"><span id="local-6989586621679751888"><span id="local-6989586621679751889"><span id="local-6989586621679751890"><span id="local-6989586621679751891"><span id="local-6989586621679751892"><span id="local-6989586621679751893"><span id="local-6989586621679751894"><span id="local-6989586621679751895"><span id="local-6989586621679751896"><span id="local-6989586621679751897"><span id="local-6989586621679751898"><span id="local-6989586621679751899"><span id="local-6989586621679751900"><span id="local-6989586621679751901"><span id="local-6989586621679751902"><span id="local-6989586621679751903"><span id="local-6989586621679751904"><span id="local-6989586621679751905"><span id="local-6989586621679751906"><span id="local-6989586621679751907"><span id="local-6989586621679751908"><span id="local-6989586621679751909"><span id="local-6989586621679751910"><span id="local-6989586621679751911"><span id="local-6989586621679751912"><span id="local-6989586621679751913"><span id="local-6989586621679751914"><span id="local-6989586621679751915"><span id="local-6989586621679751916"><span id="local-6989586621679751917"><span id="local-6989586621679751918"><span class="hs-keyword">instance</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-397"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span>
</span><span id="line-399"></span><span>          </span><span class="annot"><a href="#local-6989586621679751917"><span class="hs-identifier hs-type">headDim</span></a></span><span>
</span><span id="line-400"></span><span>          </span><span class="annot"><a href="#local-6989586621679751916"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span>
</span><span id="line-401"></span><span>          </span><span class="annot"><a href="#local-6989586621679751915"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-402"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QInProjF"><span class="hs-identifier hs-type">QInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751914"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751912"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751911"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751915"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KInProjF"><span class="hs-identifier hs-type">KInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751914"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751912"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751910"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751915"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#VInProjF"><span class="hs-identifier hs-type">VInProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751914"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751912"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751909"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751915"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#OutProjF"><span class="hs-identifier hs-type">OutProjF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751914"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751912"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751915"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751911"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#DropoutF"><span class="hs-identifier hs-type">DropoutF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751908"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#Scaling"><span class="hs-identifier hs-type">Scaling</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751907"><span class="hs-identifier hs-type">queryRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751906"><span class="hs-identifier hs-type">queryLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751905"><span class="hs-identifier hs-type">queryDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751904"><span class="hs-identifier hs-type">queryDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751903"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-410"></span><span>        </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751902"><span class="hs-identifier hs-type">keyRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751901"><span class="hs-identifier hs-type">keyLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751900"><span class="hs-identifier hs-type">keyDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751899"><span class="hs-identifier hs-type">keyDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751898"><span class="hs-identifier hs-type">keyShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751897"><span class="hs-identifier hs-type">valueRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751896"><span class="hs-identifier hs-type">valueLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751895"><span class="hs-identifier hs-type">valueDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751894"><span class="hs-identifier hs-type">valueDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751893"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-412"></span><span>        </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751892"><span class="hs-identifier hs-type">attentionBiasRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751891"><span class="hs-identifier hs-type">attentionBiasLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751890"><span class="hs-identifier hs-type">attentionBiasDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751889"><span class="hs-identifier hs-type">attentionBiasDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751888"><span class="hs-identifier hs-type">attentionBiasShape</span></a></span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751887"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>      </span><span class="annot"><a href="#local-6989586621679751886"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><a href="#local-6989586621679751885"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="#local-6989586621679751886"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-418"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-419"></span><span>          </span><span class="annot"><a href="#local-6989586621679751914"><span class="hs-identifier hs-type">gradient</span></a></span><span>
</span><span id="line-420"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751906"><span class="hs-identifier hs-type">queryLayout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751901"><span class="hs-identifier hs-type">keyLayout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751891"><span class="hs-identifier hs-type">attentionBiasLayout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751896"><span class="hs-identifier hs-type">valueLayout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751905"><span class="hs-identifier hs-type">queryDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751900"><span class="hs-identifier hs-type">keyDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751890"><span class="hs-identifier hs-type">attentionBiasDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751887"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751895"><span class="hs-identifier hs-type">valueDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751912"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751904"><span class="hs-identifier hs-type">queryDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751899"><span class="hs-identifier hs-type">keyDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751889"><span class="hs-identifier hs-type">attentionBiasDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751894"><span class="hs-identifier hs-type">valueDataType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>          </span><span class="annot"><a href="#local-6989586621679751884"><span class="hs-identifier hs-type">outputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><a href="#local-6989586621679751885"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751905"><span class="hs-identifier hs-type">queryDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751900"><span class="hs-identifier hs-type">keyDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751890"><span class="hs-identifier hs-type">attentionBiasDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751887"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751914"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751913"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751912"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751917"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751916"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751915"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751911"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751910"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751909"><span class="hs-identifier hs-type">valueEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751908"><span class="hs-identifier hs-type">dropoutP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751907"><span class="hs-identifier hs-type">queryRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751906"><span class="hs-identifier hs-type">queryLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751905"><span class="hs-identifier hs-type">queryDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751904"><span class="hs-identifier hs-type">queryDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751903"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-430"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751902"><span class="hs-identifier hs-type">keyRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751901"><span class="hs-identifier hs-type">keyLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751900"><span class="hs-identifier hs-type">keyDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751899"><span class="hs-identifier hs-type">keyDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751898"><span class="hs-identifier hs-type">keyShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751897"><span class="hs-identifier hs-type">valueRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751896"><span class="hs-identifier hs-type">valueLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751895"><span class="hs-identifier hs-type">valueDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751894"><span class="hs-identifier hs-type">valueDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751893"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-432"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751892"><span class="hs-identifier hs-type">attentionBiasRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751891"><span class="hs-identifier hs-type">attentionBiasLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751890"><span class="hs-identifier hs-type">attentionBiasDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751889"><span class="hs-identifier hs-type">attentionBiasDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751888"><span class="hs-identifier hs-type">attentionBiasShape</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#Generator"><span class="hs-identifier hs-type">Generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751887"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><a href="#local-6989586621679751886"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><a href="#local-6989586621679751885"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>  </span><span id="local-6989586621679751881"><span class="annot"><span class="annottext">forward :: MultiHeadAttention
  style
  gradient
  device
  dataType
  headDim
  headEmbedDim
  embedDim
  queryEmbedDim
  keyEmbedDim
  valueEmbedDim
  dropoutP
-&gt; (Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span id="local-6989586621679751879"><span class="annot"><span class="annottext">gmha :: GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679751871"><span id="local-6989586621679751872"><span id="local-6989586621679751873"><span id="local-6989586621679751874"><span id="local-6989586621679751875"><span id="local-6989586621679751876"><span id="local-6989586621679751877"><span id="local-6989586621679751878"><span class="annot"><span class="annottext">SDim headDim
SDim headEmbedDim
SDim embedDim
DropoutF style dropoutP
OutProjF style gradient device dataType embedDim queryEmbedDim
VInProjF style gradient device dataType valueEmbedDim embedDim
KInProjF style gradient device dataType keyEmbedDim embedDim
QInProjF style gradient device dataType queryEmbedDim embedDim
mhaDropout :: DropoutF style dropoutP
mhaOutProj :: OutProjF style gradient device dataType embedDim queryEmbedDim
mhaVInProj :: VInProjF style gradient device dataType valueEmbedDim embedDim
mhaKInProj :: KInProjF style gradient device dataType keyEmbedDim embedDim
mhaQInProj :: QInProjF style gradient device dataType queryEmbedDim embedDim
mhaEmbedDim :: SDim embedDim
mhaHeadEmbedDim :: SDim headEmbedDim
mhaHeadDim :: SDim headDim
mhaDropout :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; dropout
mhaOutProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; outProj
mhaVInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; vInProj
mhaKInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; kInProj
mhaQInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; qInProj
mhaEmbedDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim embedDim
mhaHeadEmbedDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headEmbedDim
mhaHeadDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headDim
</span><a href="#local-6989586621679751871"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679751870"><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751869"><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751868"><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751867"><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679751866"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SingI style =&gt; Sing style
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679751918"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-440"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-441"></span><span>        </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear
     'WithoutBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithoutBias gradient device dataType keyEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType valueEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear
     'WithoutBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithoutBias gradient device dataType keyEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType valueEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#NoScaling"><span class="hs-identifier hs-var">NoScaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear
     'WithoutBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithoutBias gradient device dataType keyEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType valueEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear
     'WithoutBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithoutBias gradient device dataType keyEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType valueEmbedDim embedDim)
  (Linear
     'WithoutBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#NoScaling"><span class="hs-identifier hs-var">NoScaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751865"><span class="annot"><span class="annottext">scaling :: Double
</span><a href="#local-6989586621679751865"><span class="hs-identifier hs-var hs-var">scaling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Integer) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SDim headEmbedDim -&gt; IsChecked Integer)
-&gt; SDim headEmbedDim
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dim (IsChecked StateDictKey) (IsChecked Integer)
-&gt; IsChecked Integer
forall name size. Dim name size -&gt; size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#dimSize"><span class="hs-identifier hs-var hs-var">dimSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Dim (IsChecked StateDictKey) (IsChecked Integer)
 -&gt; IsChecked Integer)
-&gt; (SDim headEmbedDim
    -&gt; Dim (IsChecked StateDictKey) (IsChecked Integer))
-&gt; SDim headEmbedDim
-&gt; IsChecked Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
-&gt; Dim (IsChecked StateDictKey) (IsChecked Integer)
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751877"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QueryScaling"><span class="hs-identifier hs-var">QueryScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751865"><span class="hs-identifier hs-var">scaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751860"><span class="annot"><span class="annottext">scaling :: Double
</span><a href="#local-6989586621679751860"><span class="hs-identifier hs-var hs-var">scaling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Integer) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SDim headEmbedDim -&gt; IsChecked Integer)
-&gt; SDim headEmbedDim
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dim (IsChecked StateDictKey) (IsChecked Integer)
-&gt; IsChecked Integer
forall name size. Dim name size -&gt; size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#dimSize"><span class="hs-identifier hs-var hs-var">dimSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Dim (IsChecked StateDictKey) (IsChecked Integer)
 -&gt; IsChecked Integer)
-&gt; (SDim headEmbedDim
    -&gt; Dim (IsChecked StateDictKey) (IsChecked Integer))
-&gt; SDim headEmbedDim
-&gt; IsChecked Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
-&gt; Dim (IsChecked StateDictKey) (IsChecked Integer)
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751877"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QueryScaling"><span class="hs-identifier hs-var">QueryScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751860"><span class="hs-identifier hs-var">scaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751859"><span class="annot"><span class="annottext">scaling :: Double
</span><a href="#local-6989586621679751859"><span class="hs-identifier hs-var hs-var">scaling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Integer) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SDim headEmbedDim -&gt; IsChecked Integer)
-&gt; SDim headEmbedDim
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dim (IsChecked StateDictKey) (IsChecked Integer)
-&gt; IsChecked Integer
forall name size. Dim name size -&gt; size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#dimSize"><span class="hs-identifier hs-var hs-var">dimSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Dim (IsChecked StateDictKey) (IsChecked Integer)
 -&gt; IsChecked Integer)
-&gt; (SDim headEmbedDim
    -&gt; Dim (IsChecked StateDictKey) (IsChecked Integer))
-&gt; SDim headEmbedDim
-&gt; IsChecked Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
-&gt; Dim (IsChecked StateDictKey) (IsChecked Integer)
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751877"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#WeightScaling"><span class="hs-identifier hs-var">WeightScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751859"><span class="hs-identifier hs-var">scaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-453"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-454"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751858"><span class="annot"><span class="annottext">scaling :: Double
</span><a href="#local-6989586621679751858"><span class="hs-identifier hs-var hs-var">scaling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Integer) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SDim headEmbedDim -&gt; IsChecked Integer)
-&gt; SDim headEmbedDim
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dim (IsChecked StateDictKey) (IsChecked Integer)
-&gt; IsChecked Integer
forall name size. Dim name size -&gt; size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#dimSize"><span class="hs-identifier hs-var hs-var">dimSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Dim (IsChecked StateDictKey) (IsChecked Integer)
 -&gt; IsChecked Integer)
-&gt; (SDim headEmbedDim
    -&gt; Dim (IsChecked StateDictKey) (IsChecked Integer))
-&gt; SDim headEmbedDim
-&gt; IsChecked Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
-&gt; Dim (IsChecked StateDictKey) (IsChecked Integer)
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751877"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#WeightScaling"><span class="hs-identifier hs-var">WeightScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751858"><span class="hs-identifier hs-var">scaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-456"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751857"><span class="annot"><span class="annottext">scaling :: Double
</span><a href="#local-6989586621679751857"><span class="hs-identifier hs-var hs-var">scaling</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Double)
-&gt; (SDim headEmbedDim -&gt; Integer) -&gt; SDim headEmbedDim -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SDim headEmbedDim -&gt; IsChecked Integer)
-&gt; SDim headEmbedDim
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Dim (IsChecked StateDictKey) (IsChecked Integer)
-&gt; IsChecked Integer
forall name size. Dim name size -&gt; size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#dimSize"><span class="hs-identifier hs-var hs-var">dimSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Dim (IsChecked StateDictKey) (IsChecked Integer)
 -&gt; IsChecked Integer)
-&gt; (SDim headEmbedDim
    -&gt; Dim (IsChecked StateDictKey) (IsChecked Integer))
-&gt; SDim headEmbedDim
-&gt; IsChecked Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
-&gt; Dim (IsChecked StateDictKey) (IsChecked Integer)
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SDim headEmbedDim -&gt; Double) -&gt; SDim headEmbedDim -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751877"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; Generator generatorDevice
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (Linear 'WithBias gradient device dataType queryEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType keyEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType valueEmbedDim embedDim)
  (Linear 'WithBias gradient device dataType embedDim queryEmbedDim)
  (Dropout dropoutP)
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  (QInProjF style gradient device dataType queryEmbedDim embedDim)
  (KInProjF style gradient device dataType keyEmbedDim embedDim)
  (VInProjF style gradient device dataType valueEmbedDim embedDim)
  (OutProjF style gradient device dataType embedDim queryEmbedDim)
  (DropoutF style dropoutP)
</span><a href="#local-6989586621679751879"><span class="hs-identifier hs-var">gmha</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QueryScaling"><span class="hs-identifier hs-var">QueryScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751857"><span class="hs-identifier hs-var">scaling</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751870"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751869"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751868"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751867"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679751866"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-459"></span><span>      </span><span class="annot"><span class="annottext">Sing style
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(output, generatorOutput)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#BatchDim"><span class="hs-identifier hs-type">BatchDim</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-462"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-465"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-keyword">type</span><span> </span><span id="BatchDim"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#BatchDim"><span class="hs-identifier hs-var">BatchDim</span></a></span></span><span> </span><span id="local-6989586621679751856"><span class="annot"><a href="#local-6989586621679751856"><span class="hs-identifier hs-type">queryShape</span></a></span></span><span> </span><span id="local-6989586621679751855"><span class="annot"><a href="#local-6989586621679751855"><span class="hs-identifier hs-type">keyShape</span></a></span></span><span> </span><span id="local-6989586621679751854"><span class="annot"><a href="#local-6989586621679751854"><span class="hs-identifier hs-type">valueShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751856"><span class="hs-identifier hs-type">queryShape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751855"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751854"><span class="hs-identifier hs-type">valueShape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getBatchDim"><span class="hs-identifier hs-type">getBatchDim</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679752340"><span class="annot"><a href="#local-6989586621679752340"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679752338"><span class="annot"><a href="#local-6989586621679752338"><span class="hs-identifier hs-type">queryShape</span></a></span></span><span> </span><span id="local-6989586621679752337"><span class="annot"><a href="#local-6989586621679752337"><span class="hs-identifier hs-type">keyShape</span></a></span></span><span> </span><span id="local-6989586621679752336"><span class="annot"><a href="#local-6989586621679752336"><span class="hs-identifier hs-type">valueShape</span></a></span></span><span> </span><span id="local-6989586621679752339"><span class="annot"><a href="#local-6989586621679752339"><span class="hs-identifier hs-type">batchDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752340"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679752339"><span class="hs-identifier hs-type">batchDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#BatchDim"><span class="hs-identifier hs-type">BatchDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752338"><span class="hs-identifier hs-type">queryShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752337"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752336"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-type">SShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752338"><span class="hs-identifier hs-type">queryShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-type">SShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752337"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-type">SShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752336"><span class="hs-identifier hs-type">valueShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>  </span><span class="annot"><a href="#local-6989586621679752340"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752339"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span id="getBatchDim"><span class="annot"><span class="annottext">getBatchDim :: SShape queryShape
-&gt; SShape keyShape -&gt; SShape valueShape -&gt; m (SDim batchDim)
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getBatchDim"><span class="hs-identifier hs-var hs-var">getBatchDim</span></a></span></span><span> </span><span id="local-6989586621679751852"><span class="annot"><span class="annottext">SShape queryShape
</span><a href="#local-6989586621679751852"><span class="hs-identifier hs-var">queryShape</span></a></span></span><span> </span><span id="local-6989586621679751851"><span class="annot"><span class="annottext">SShape keyShape
</span><a href="#local-6989586621679751851"><span class="hs-identifier hs-var">keyShape</span></a></span></span><span> </span><span id="local-6989586621679751850"><span class="annot"><span class="annottext">SShape valueShape
</span><a href="#local-6989586621679751850"><span class="hs-identifier hs-var">valueShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-478"></span><span>  </span><span id="local-6989586621679751849"><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) queryShape)
</span><a href="#local-6989586621679751849"><span class="hs-identifier hs-var">queryBatchDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 0))
-&gt; SShape queryShape
-&gt; m (SDim (GetDimF ('SelectDim ('ByIndex 0)) queryShape))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: Type -&gt; Type).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0)))
-&gt; SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 0 =&gt; SBy ('ByIndex 0)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape queryShape
</span><a href="#local-6989586621679751852"><span class="hs-identifier hs-var">queryShape</span></a></span><span>
</span><span id="line-479"></span><span>  </span><span id="local-6989586621679751846"><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
</span><a href="#local-6989586621679751846"><span class="hs-identifier hs-var">keyBatchDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 0))
-&gt; SShape keyShape
-&gt; m (SDim (GetDimF ('SelectDim ('ByIndex 0)) keyShape))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: Type -&gt; Type).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0)))
-&gt; SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 0 =&gt; SBy ('ByIndex 0)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape keyShape
</span><a href="#local-6989586621679751851"><span class="hs-identifier hs-var">keyShape</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span id="local-6989586621679751845"><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) valueShape)
</span><a href="#local-6989586621679751845"><span class="hs-identifier hs-var">valueBatchDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 0))
-&gt; SShape valueShape
-&gt; m (SDim (GetDimF ('SelectDim ('ByIndex 0)) valueShape))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: Type -&gt; Type).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0)))
-&gt; SBy ('ByIndex 0) -&gt; SSelectDim ('SelectDim ('ByIndex 0))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 0 =&gt; SBy ('ByIndex 0)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape valueShape
</span><a href="#local-6989586621679751850"><span class="hs-identifier hs-var">valueShape</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621679751844"><span class="annot"><span class="annottext">SDim
  (Unify
     (Dim (Name Symbol) (Size Nat))
     (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
     (GetDimF ('SelectDim ('ByIndex 0)) valueShape))
</span><a href="#local-6989586621679751844"><span class="hs-identifier hs-var">keyValueBatchDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
-&gt; SDim (GetDimF ('SelectDim ('ByIndex 0)) valueShape)
-&gt; m (SDim
        (GetDimF ('SelectDim ('ByIndex 0)) keyShape
         &lt;+&gt; GetDimF ('SelectDim ('ByIndex 0)) valueShape))
forall (m :: Type -&gt; Type) (dim :: Dim (Name Symbol) (Size Nat))
       (dim' :: Dim (Name Symbol) (Size Nat)).
MonadThrow m =&gt;
SDim dim -&gt; SDim dim' -&gt; m (SDim (dim &lt;+&gt; dim'))
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sUnifyDim"><span class="hs-identifier hs-var">sUnifyDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
</span><a href="#local-6989586621679751846"><span class="hs-identifier hs-var">keyBatchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) valueShape)
</span><a href="#local-6989586621679751845"><span class="hs-identifier hs-var">valueBatchDim</span></a></span><span>
</span><span id="line-482"></span><span>  </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) queryShape)
-&gt; SDim
     (Unify
        (Dim (Name Symbol) (Size Nat))
        (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
        (GetDimF ('SelectDim ('ByIndex 0)) valueShape))
-&gt; m (SDim
        (GetDimF ('SelectDim ('ByIndex 0)) queryShape
         &lt;+&gt; Unify
               (Dim (Name Symbol) (Size Nat))
               (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
               (GetDimF ('SelectDim ('ByIndex 0)) valueShape)))
forall (m :: Type -&gt; Type) (dim :: Dim (Name Symbol) (Size Nat))
       (dim' :: Dim (Name Symbol) (Size Nat)).
MonadThrow m =&gt;
SDim dim -&gt; SDim dim' -&gt; m (SDim (dim &lt;+&gt; dim'))
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sUnifyDim"><span class="hs-identifier hs-var">sUnifyDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 0)) queryShape)
</span><a href="#local-6989586621679751849"><span class="hs-identifier hs-var">queryBatchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim
  (Unify
     (Dim (Name Symbol) (Size Nat))
     (GetDimF ('SelectDim ('ByIndex 0)) keyShape)
     (GetDimF ('SelectDim ('ByIndex 0)) valueShape))
</span><a href="#local-6989586621679751844"><span class="hs-identifier hs-var">keyValueBatchDim</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QuerySeqDim"><span class="hs-identifier hs-type">QuerySeqDim</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="hs-keyword">type</span><span> </span><span id="QuerySeqDim"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QuerySeqDim"><span class="hs-identifier hs-var">QuerySeqDim</span></a></span></span><span> </span><span id="local-6989586621679751843"><span class="annot"><a href="#local-6989586621679751843"><span class="hs-identifier hs-type">queryShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="#local-6989586621679751843"><span class="hs-identifier hs-type">queryShape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getQuerySeqDim"><span class="hs-identifier hs-type">getQuerySeqDim</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679752335"><span class="annot"><a href="#local-6989586621679752335"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679752333"><span class="annot"><a href="#local-6989586621679752333"><span class="hs-identifier hs-type">queryShape</span></a></span></span><span> </span><span id="local-6989586621679752334"><span class="annot"><a href="#local-6989586621679752334"><span class="hs-identifier hs-type">querySeqDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752335"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679752334"><span class="hs-identifier hs-type">querySeqDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QuerySeqDim"><span class="hs-identifier hs-type">QuerySeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752333"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-type">SShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752333"><span class="hs-identifier hs-type">queryShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><a href="#local-6989586621679752335"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752334"><span class="hs-identifier hs-type">querySeqDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span id="getQuerySeqDim"><span class="annot"><span class="annottext">getQuerySeqDim :: SShape queryShape -&gt; m (SDim querySeqDim)
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getQuerySeqDim"><span class="hs-identifier hs-var hs-var">getQuerySeqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 1))
-&gt; SShape queryShape -&gt; m (SDim querySeqDim)
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: Type -&gt; Type).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1)))
-&gt; SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SBy ('ByIndex 1)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KeySeqDim"><span class="hs-identifier hs-type">KeySeqDim</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-499"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="hs-keyword">type</span><span> </span><span id="KeySeqDim"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KeySeqDim"><span class="hs-identifier hs-var">KeySeqDim</span></a></span></span><span> </span><span id="local-6989586621679751841"><span class="annot"><a href="#local-6989586621679751841"><span class="hs-identifier hs-type">keyShape</span></a></span></span><span> </span><span id="local-6989586621679751840"><span class="annot"><a href="#local-6989586621679751840"><span class="hs-identifier hs-type">valueShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751841"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751840"><span class="hs-identifier hs-type">valueShape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getKeySeqDim"><span class="hs-identifier hs-type">getKeySeqDim</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679752332"><span class="annot"><a href="#local-6989586621679752332"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679752330"><span class="annot"><a href="#local-6989586621679752330"><span class="hs-identifier hs-type">keyShape</span></a></span></span><span> </span><span id="local-6989586621679752329"><span class="annot"><a href="#local-6989586621679752329"><span class="hs-identifier hs-type">valueShape</span></a></span></span><span> </span><span id="local-6989586621679752331"><span class="annot"><a href="#local-6989586621679752331"><span class="hs-identifier hs-type">keySeqDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752332"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679752331"><span class="hs-identifier hs-type">keySeqDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KeySeqDim"><span class="hs-identifier hs-type">KeySeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752330"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752329"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-type">SShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752330"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-type">SShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752329"><span class="hs-identifier hs-type">valueShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-511"></span><span>  </span><span class="annot"><a href="#local-6989586621679752332"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679752331"><span class="hs-identifier hs-type">keySeqDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span id="getKeySeqDim"><span class="annot"><span class="annottext">getKeySeqDim :: SShape keyShape -&gt; SShape valueShape -&gt; m (SDim keySeqDim)
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getKeySeqDim"><span class="hs-identifier hs-var hs-var">getKeySeqDim</span></a></span></span><span> </span><span id="local-6989586621679751838"><span class="annot"><span class="annottext">SShape keyShape
</span><a href="#local-6989586621679751838"><span class="hs-identifier hs-var">keyShape</span></a></span></span><span> </span><span id="local-6989586621679751837"><span class="annot"><span class="annottext">SShape valueShape
</span><a href="#local-6989586621679751837"><span class="hs-identifier hs-var">valueShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621679751836"><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 1)) keyShape)
</span><a href="#local-6989586621679751836"><span class="hs-identifier hs-var">keySeqDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 1))
-&gt; SShape keyShape
-&gt; m (SDim (GetDimF ('SelectDim ('ByIndex 1)) keyShape))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: Type -&gt; Type).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1)))
-&gt; SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SBy ('ByIndex 1)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape keyShape
</span><a href="#local-6989586621679751838"><span class="hs-identifier hs-var">keyShape</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span id="local-6989586621679751835"><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 1)) valueShape)
</span><a href="#local-6989586621679751835"><span class="hs-identifier hs-var">valueSeqDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 1))
-&gt; SShape valueShape
-&gt; m (SDim (GetDimF ('SelectDim ('ByIndex 1)) valueShape))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: Type -&gt; Type).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1)))
-&gt; SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SBy ('ByIndex 1)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape valueShape
</span><a href="#local-6989586621679751837"><span class="hs-identifier hs-var">valueShape</span></a></span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 1)) keyShape)
-&gt; SDim (GetDimF ('SelectDim ('ByIndex 1)) valueShape)
-&gt; m (SDim
        (GetDimF ('SelectDim ('ByIndex 1)) keyShape
         &lt;+&gt; GetDimF ('SelectDim ('ByIndex 1)) valueShape))
forall (m :: Type -&gt; Type) (dim :: Dim (Name Symbol) (Size Nat))
       (dim' :: Dim (Name Symbol) (Size Nat)).
MonadThrow m =&gt;
SDim dim -&gt; SDim dim' -&gt; m (SDim (dim &lt;+&gt; dim'))
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sUnifyDim"><span class="hs-identifier hs-var">sUnifyDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 1)) keyShape)
</span><a href="#local-6989586621679751836"><span class="hs-identifier hs-var">keySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim (GetDimF ('SelectDim ('ByIndex 1)) valueShape)
</span><a href="#local-6989586621679751835"><span class="hs-identifier hs-var">valueSeqDim</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span id="local-6989586621679751776"><span id="local-6989586621679751777"><span id="local-6989586621679751778"><span id="local-6989586621679751779"><span id="local-6989586621679751780"><span id="local-6989586621679751781"><span id="local-6989586621679751782"><span id="local-6989586621679751783"><span id="local-6989586621679751784"><span id="local-6989586621679751785"><span id="local-6989586621679751786"><span id="local-6989586621679751787"><span id="local-6989586621679751788"><span id="local-6989586621679751789"><span id="local-6989586621679751790"><span id="local-6989586621679751791"><span id="local-6989586621679751792"><span id="local-6989586621679751793"><span id="local-6989586621679751794"><span id="local-6989586621679751795"><span id="local-6989586621679751796"><span id="local-6989586621679751797"><span id="local-6989586621679751798"><span id="local-6989586621679751799"><span id="local-6989586621679751800"><span id="local-6989586621679751801"><span id="local-6989586621679751802"><span id="local-6989586621679751803"><span id="local-6989586621679751804"><span id="local-6989586621679751805"><span id="local-6989586621679751806"><span id="local-6989586621679751807"><span id="local-6989586621679751808"><span id="local-6989586621679751809"><span id="local-6989586621679751810"><span id="local-6989586621679751811"><span id="local-6989586621679751812"><span id="local-6989586621679751813"><span id="local-6989586621679751814"><span id="local-6989586621679751815"><span id="local-6989586621679751816"><span id="local-6989586621679751817"><span id="local-6989586621679751818"><span id="local-6989586621679751819"><span id="local-6989586621679751820"><span id="local-6989586621679751821"><span id="local-6989586621679751822"><span id="local-6989586621679751823"><span id="local-6989586621679751824"><span id="local-6989586621679751825"><span id="local-6989586621679751826"><span id="local-6989586621679751827"><span id="local-6989586621679751828"><span id="local-6989586621679751829"><span id="local-6989586621679751830"><span id="local-6989586621679751831"><span id="local-6989586621679751832"><span id="local-6989586621679751833"><span id="local-6989586621679751834"><span class="hs-keyword">instance</span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><a href="#local-6989586621679751834"><span class="hs-identifier hs-type">qInProj</span></a></span><span>
</span><span id="line-521"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751833"><span class="hs-identifier hs-type">queryRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751832"><span class="hs-identifier hs-type">queryLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751831"><span class="hs-identifier hs-type">queryDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751830"><span class="hs-identifier hs-type">queryDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751829"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>      </span><span class="annot"><a href="#local-6989586621679751828"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-523"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751827"><span class="hs-identifier hs-type">qRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751826"><span class="hs-identifier hs-type">qLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751825"><span class="hs-identifier hs-type">qDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751824"><span class="hs-identifier hs-type">qDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751823"><span class="hs-identifier hs-type">qShape0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>      </span><span class="annot"><a href="#local-6989586621679751822"><span class="hs-identifier hs-type">qGeneratorOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><a href="#local-6989586621679751821"><span class="hs-identifier hs-type">qShape</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#TransposeF"><span class="hs-identifier hs-type">TransposeF</span></a></span><span>
</span><span id="line-527"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#ReshapeF"><span class="hs-identifier hs-type">ReshapeF</span></a></span><span>
</span><span id="line-530"></span><span>              </span><span class="annot"><a href="#local-6989586621679751823"><span class="hs-identifier hs-type">qShape0</span></a></span><span>
</span><span id="line-531"></span><span>              </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679751820"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751819"><span class="hs-identifier hs-type">querySeqDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751818"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751817"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-534"></span><span>      </span><span class="annot"><a href="#local-6989586621679751816"><span class="hs-identifier hs-type">kInProj</span></a></span><span>
</span><span id="line-535"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751815"><span class="hs-identifier hs-type">keyRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751814"><span class="hs-identifier hs-type">keyLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751813"><span class="hs-identifier hs-type">keyDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751812"><span class="hs-identifier hs-type">keyDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751811"><span class="hs-identifier hs-type">keyShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>      </span><span class="annot"><a href="#local-6989586621679751822"><span class="hs-identifier hs-type">qGeneratorOutput</span></a></span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751827"><span class="hs-identifier hs-type">qRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751810"><span class="hs-identifier hs-type">kLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751809"><span class="hs-identifier hs-type">kDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751808"><span class="hs-identifier hs-type">kDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751807"><span class="hs-identifier hs-type">kShape0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>      </span><span class="annot"><a href="#local-6989586621679751806"><span class="hs-identifier hs-type">kGeneratorOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-539"></span><span>    </span><span class="annot"><a href="#local-6989586621679751805"><span class="hs-identifier hs-type">weightsShape0</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#SoftmaxF"><span class="hs-identifier hs-type">SoftmaxF</span></a></span><span>
</span><span id="line-541"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#BroadcastShapesF"><span class="hs-identifier hs-type">BroadcastShapesF</span></a></span><span>
</span><span id="line-543"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html#MatmulF"><span class="hs-identifier hs-type">MatmulF</span></a></span><span>
</span><span id="line-544"></span><span>                  </span><span class="annot"><a href="#local-6989586621679751821"><span class="hs-identifier hs-type">qShape</span></a></span><span>
</span><span id="line-545"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#TransposeF"><span class="hs-identifier hs-type">TransposeF</span></a></span><span>
</span><span id="line-546"></span><span>                      </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>                      </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#TransposeF"><span class="hs-identifier hs-type">TransposeF</span></a></span><span>
</span><span id="line-549"></span><span>                          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>                          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#ReshapeF"><span class="hs-identifier hs-type">ReshapeF</span></a></span><span>
</span><span id="line-552"></span><span>                              </span><span class="annot"><a href="#local-6989586621679751807"><span class="hs-identifier hs-type">kShape0</span></a></span><span>
</span><span id="line-553"></span><span>                              </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679751820"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751804"><span class="hs-identifier hs-type">keySeqDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751818"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751817"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>                          </span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>              </span><span class="annot"><a href="#local-6989586621679751803"><span class="hs-identifier hs-type">attentionBiasShape</span></a></span><span>
</span><span id="line-559"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-561"></span><span>      </span><span class="annot"><a href="#local-6989586621679751802"><span class="hs-identifier hs-type">dropout</span></a></span><span>
</span><span id="line-562"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-563"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751827"><span class="hs-identifier hs-type">qRequiresGradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%7C%3E"><span class="hs-operator hs-type">&lt;|&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751801"><span class="hs-identifier hs-type">attentionBiasRequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751826"><span class="hs-identifier hs-type">qLayout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751810"><span class="hs-identifier hs-type">kLayout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751800"><span class="hs-identifier hs-type">attentionBiasLayout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751825"><span class="hs-identifier hs-type">qDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751809"><span class="hs-identifier hs-type">kDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751799"><span class="hs-identifier hs-type">attentionBiasDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751824"><span class="hs-identifier hs-type">qDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751808"><span class="hs-identifier hs-type">kDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751798"><span class="hs-identifier hs-type">attentionBiasDataType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>          </span><span class="annot"><a href="#local-6989586621679751805"><span class="hs-identifier hs-type">weightsShape0</span></a></span><span>
</span><span id="line-568"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>      </span><span class="annot"><a href="#local-6989586621679751806"><span class="hs-identifier hs-type">kGeneratorOutput</span></a></span><span>
</span><span id="line-570"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751797"><span class="hs-identifier hs-type">weightsRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751796"><span class="hs-identifier hs-type">weightsLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751795"><span class="hs-identifier hs-type">weightsDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751794"><span class="hs-identifier hs-type">weightsDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751793"><span class="hs-identifier hs-type">weightsShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>      </span><span class="annot"><a href="#local-6989586621679751792"><span class="hs-identifier hs-type">weightsGeneratorOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-573"></span><span>      </span><span class="annot"><a href="#local-6989586621679751791"><span class="hs-identifier hs-type">vInProj</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751790"><span class="hs-identifier hs-type">valueRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751789"><span class="hs-identifier hs-type">valueLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751788"><span class="hs-identifier hs-type">valueDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751787"><span class="hs-identifier hs-type">valueDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751786"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>      </span><span class="annot"><a href="#local-6989586621679751792"><span class="hs-identifier hs-type">weightsGeneratorOutput</span></a></span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751797"><span class="hs-identifier hs-type">weightsRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751785"><span class="hs-identifier hs-type">vLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751784"><span class="hs-identifier hs-type">vDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751783"><span class="hs-identifier hs-type">vDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751782"><span class="hs-identifier hs-type">vShape0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><a href="#local-6989586621679751781"><span class="hs-identifier hs-type">vGeneratorOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><a href="#local-6989586621679751780"><span class="hs-identifier hs-type">outputQueryShape0</span></a></span><span>
</span><span id="line-579"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#TransposeF"><span class="hs-identifier hs-type">TransposeF</span></a></span><span>
</span><span id="line-580"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html#MatmulF"><span class="hs-identifier hs-type">MatmulF</span></a></span><span>
</span><span id="line-583"></span><span>              </span><span class="annot"><a href="#local-6989586621679751793"><span class="hs-identifier hs-type">weightsShape</span></a></span><span>
</span><span id="line-584"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#TransposeF"><span class="hs-identifier hs-type">TransposeF</span></a></span><span>
</span><span id="line-585"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#ReshapeF"><span class="hs-identifier hs-type">ReshapeF</span></a></span><span>
</span><span id="line-588"></span><span>                      </span><span class="annot"><a href="#local-6989586621679751782"><span class="hs-identifier hs-type">vShape0</span></a></span><span>
</span><span id="line-589"></span><span>                      </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679751820"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751804"><span class="hs-identifier hs-type">keySeqDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751818"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751817"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-593"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-594"></span><span>      </span><span class="annot"><a href="#local-6989586621679751779"><span class="hs-identifier hs-type">outProj</span></a></span><span>
</span><span id="line-595"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-596"></span><span>          </span><span class="annot"><a href="#local-6989586621679751797"><span class="hs-identifier hs-type">weightsRequiresGradient</span></a></span><span>
</span><span id="line-597"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751796"><span class="hs-identifier hs-type">weightsLayout</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751785"><span class="hs-identifier hs-type">vLayout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751795"><span class="hs-identifier hs-type">weightsDevice</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751784"><span class="hs-identifier hs-type">vDevice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679751794"><span class="hs-identifier hs-type">weightsDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Unify.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751783"><span class="hs-identifier hs-type">vDataType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#ReshapeF"><span class="hs-identifier hs-type">ReshapeF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751780"><span class="hs-identifier hs-type">outputQueryShape0</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679751820"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751819"><span class="hs-identifier hs-type">querySeqDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679751778"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>      </span><span class="annot"><a href="#local-6989586621679751781"><span class="hs-identifier hs-type">vGeneratorOutput</span></a></span><span>
</span><span id="line-603"></span><span>      </span><span class="annot"><a href="#local-6989586621679751777"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-604"></span><span>      </span><span class="annot"><a href="#local-6989586621679751776"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier hs-type">SGetShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751829"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier hs-type">SGetShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751811"><span class="hs-identifier hs-type">keyShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier hs-type">SGetShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751786"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><a href="#local-6989586621679751820"><span class="hs-identifier hs-type">batchDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#BatchDim"><span class="hs-identifier hs-type">BatchDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751829"><span class="hs-identifier hs-type">queryShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751811"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751786"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="#local-6989586621679751819"><span class="hs-identifier hs-type">querySeqDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QuerySeqDim"><span class="hs-identifier hs-type">QuerySeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751829"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><a href="#local-6989586621679751804"><span class="hs-identifier hs-type">keySeqDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#KeySeqDim"><span class="hs-identifier hs-type">KeySeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751811"><span class="hs-identifier hs-type">keyShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751786"><span class="hs-identifier hs-type">valueShape</span></a></span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751818"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751817"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751778"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751834"><span class="hs-identifier hs-type">qInProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751816"><span class="hs-identifier hs-type">kInProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751791"><span class="hs-identifier hs-type">vInProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751779"><span class="hs-identifier hs-type">outProj</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751802"><span class="hs-identifier hs-type">dropout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#Scaling"><span class="hs-identifier hs-type">Scaling</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751833"><span class="hs-identifier hs-type">queryRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751832"><span class="hs-identifier hs-type">queryLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751831"><span class="hs-identifier hs-type">queryDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751830"><span class="hs-identifier hs-type">queryDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751829"><span class="hs-identifier hs-type">queryShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-616"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751815"><span class="hs-identifier hs-type">keyRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751814"><span class="hs-identifier hs-type">keyLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751813"><span class="hs-identifier hs-type">keyDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751812"><span class="hs-identifier hs-type">keyDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751811"><span class="hs-identifier hs-type">keyShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-617"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751790"><span class="hs-identifier hs-type">valueRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751789"><span class="hs-identifier hs-type">valueLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751788"><span class="hs-identifier hs-type">valueDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751787"><span class="hs-identifier hs-type">valueDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751786"><span class="hs-identifier hs-type">valueShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-618"></span><span>      </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751801"><span class="hs-identifier hs-type">attentionBiasRequiresGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751800"><span class="hs-identifier hs-type">attentionBiasLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751799"><span class="hs-identifier hs-type">attentionBiasDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751798"><span class="hs-identifier hs-type">attentionBiasDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679751803"><span class="hs-identifier hs-type">attentionBiasShape</span></a></span><span>
</span><span id="line-619"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="#local-6989586621679751828"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><a href="#local-6989586621679751777"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-622"></span><span>    </span><span class="annot"><a href="#local-6989586621679751776"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-624"></span><span>  </span><span id="local-6989586621679751774"><span class="annot"><span class="annottext">forward :: GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; (Scaling,
    Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape,
    Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape,
    Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape,
    Tensor
      attentionBiasRequiresGradient
      attentionBiasLayout
      attentionBiasDevice
      attentionBiasDataType
      attentionBiasShape)
-&gt; generator
-&gt; (output, generatorOutput)
</span><a href="#local-6989586621679751774"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#GMultiHeadAttention"><span class="hs-identifier hs-type">GMultiHeadAttention</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679751766"><span id="local-6989586621679751767"><span id="local-6989586621679751768"><span id="local-6989586621679751769"><span id="local-6989586621679751770"><span id="local-6989586621679751771"><span id="local-6989586621679751772"><span id="local-6989586621679751773"><span class="annot"><span class="annottext">qInProj
kInProj
dropout
vInProj
outProj
SDim headDim
SDim headEmbedDim
SDim embedDim
mhaDropout :: dropout
mhaOutProj :: outProj
mhaVInProj :: vInProj
mhaKInProj :: kInProj
mhaQInProj :: qInProj
mhaEmbedDim :: SDim embedDim
mhaHeadEmbedDim :: SDim headEmbedDim
mhaHeadDim :: SDim headDim
mhaDropout :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; dropout
mhaOutProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; outProj
mhaVInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; vInProj
mhaKInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; kInProj
mhaQInProj :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; qInProj
mhaEmbedDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim embedDim
mhaHeadEmbedDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headEmbedDim
mhaHeadDim :: forall (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat)) qInProj kInProj vInProj
       outProj dropout.
GMultiHeadAttention
  headDim
  headEmbedDim
  embedDim
  qInProj
  kInProj
  vInProj
  outProj
  dropout
-&gt; SDim headDim
</span><a href="#local-6989586621679751766"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679751765"><span class="annot"><span class="annottext">Scaling
</span><a href="#local-6989586621679751765"><span class="hs-identifier hs-var">scaling</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751764"><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751764"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751763"><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751763"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751762"><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751762"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751761"><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751761"><span class="hs-identifier hs-var">attentionBias</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-625"></span><span>    </span><span class="annot"><span class="annottext">IxState generator generatorOutput output
-&gt; generator -&gt; (output, generatorOutput)
forall i j a. IxState i j a -&gt; i -&gt; (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxState</span></a></span><span> </span><span class="annot"><span class="annottext">(IxState generator generatorOutput output
 -&gt; generator -&gt; (output, generatorOutput))
-&gt; IxState generator generatorOutput output
-&gt; generator
-&gt; (output, generatorOutput)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-626"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751760"><span class="annot"><span class="annottext">batchDim :: SDim batchDim
</span><a href="#local-6989586621679751760"><span class="hs-identifier hs-var hs-var">batchDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-627"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751759"><span class="annot"><span class="annottext">queryShape :: SShape queryShape
</span><a href="#local-6989586621679751759"><span class="hs-identifier hs-var hs-var">queryShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
-&gt; SShape queryShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751764"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-628"></span><span>                </span><span id="local-6989586621679751757"><span class="annot"><span class="annottext">keyShape :: SShape keyShape
</span><a href="#local-6989586621679751757"><span class="hs-identifier hs-var hs-var">keyShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
-&gt; SShape keyShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751763"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-629"></span><span>                </span><span id="local-6989586621679751756"><span class="annot"><span class="annottext">valueShape :: SShape valueShape
</span><a href="#local-6989586621679751756"><span class="hs-identifier hs-var hs-var">valueShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
-&gt; SShape valueShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751762"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-630"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO (SDim batchDim) -&gt; SDim batchDim
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (SDim batchDim) -&gt; SDim batchDim)
-&gt; IO (SDim batchDim) -&gt; SDim batchDim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SShape queryShape
-&gt; SShape keyShape -&gt; SShape valueShape -&gt; IO (SDim batchDim)
forall (m :: Type -&gt; Type)
       (queryShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (keyShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (valueShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (batchDim :: Dim (Name Symbol) (Size Nat)).
(MonadThrow m,
 batchDim ~ BatchDim queryShape keyShape valueShape) =&gt;
SShape queryShape
-&gt; SShape keyShape -&gt; SShape valueShape -&gt; m (SDim batchDim)
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getBatchDim"><span class="hs-identifier hs-var">getBatchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SShape queryShape
</span><a href="#local-6989586621679751759"><span class="hs-identifier hs-var">queryShape</span></a></span><span> </span><span class="annot"><span class="annottext">SShape keyShape
</span><a href="#local-6989586621679751757"><span class="hs-identifier hs-var">keyShape</span></a></span><span> </span><span class="annot"><span class="annottext">SShape valueShape
</span><a href="#local-6989586621679751756"><span class="hs-identifier hs-var">valueShape</span></a></span><span>
</span><span id="line-631"></span><span>          </span><span id="local-6989586621679751755"><span class="annot"><span class="annottext">querySeqDim :: SDim querySeqDim
</span><a href="#local-6989586621679751755"><span class="hs-identifier hs-var hs-var">querySeqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-632"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751754"><span class="annot"><span class="annottext">queryShape :: SShape queryShape
</span><a href="#local-6989586621679751754"><span class="hs-identifier hs-var hs-var">queryShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
-&gt; SShape queryShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751764"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-633"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO (SDim querySeqDim) -&gt; SDim querySeqDim
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (SDim querySeqDim) -&gt; SDim querySeqDim)
-&gt; IO (SDim querySeqDim) -&gt; SDim querySeqDim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SShape queryShape -&gt; IO (SDim querySeqDim)
forall (m :: Type -&gt; Type)
       (queryShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (querySeqDim :: Dim (Name Symbol) (Size Nat)).
(MonadThrow m, querySeqDim ~ QuerySeqDim queryShape) =&gt;
SShape queryShape -&gt; m (SDim querySeqDim)
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getQuerySeqDim"><span class="hs-identifier hs-var">getQuerySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SShape queryShape
</span><a href="#local-6989586621679751754"><span class="hs-identifier hs-var">queryShape</span></a></span><span>
</span><span id="line-634"></span><span>          </span><span id="local-6989586621679751753"><span class="annot"><span class="annottext">keySeqDim :: SDim keySeqDim
</span><a href="#local-6989586621679751753"><span class="hs-identifier hs-var hs-var">keySeqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-635"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751752"><span class="annot"><span class="annottext">keyShape :: SShape keyShape
</span><a href="#local-6989586621679751752"><span class="hs-identifier hs-var hs-var">keyShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
-&gt; SShape keyShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751763"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-636"></span><span>                </span><span id="local-6989586621679751751"><span class="annot"><span class="annottext">valueShape :: SShape valueShape
</span><a href="#local-6989586621679751751"><span class="hs-identifier hs-var hs-var">valueShape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
-&gt; SShape valueShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751762"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-637"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO (SDim keySeqDim) -&gt; SDim keySeqDim
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (SDim keySeqDim) -&gt; SDim keySeqDim)
-&gt; IO (SDim keySeqDim) -&gt; SDim keySeqDim
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SShape keyShape -&gt; SShape valueShape -&gt; IO (SDim keySeqDim)
forall (m :: Type -&gt; Type)
       (keyShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (valueShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (keySeqDim :: Dim (Name Symbol) (Size Nat)).
(MonadThrow m, keySeqDim ~ KeySeqDim keyShape valueShape) =&gt;
SShape keyShape -&gt; SShape valueShape -&gt; m (SDim keySeqDim)
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#getKeySeqDim"><span class="hs-identifier hs-var">getKeySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SShape keyShape
</span><a href="#local-6989586621679751752"><span class="hs-identifier hs-var">keyShape</span></a></span><span> </span><span class="annot"><span class="annottext">SShape valueShape
</span><a href="#local-6989586621679751751"><span class="hs-identifier hs-var">valueShape</span></a></span><span>
</span><span id="line-638"></span><span>          </span><span id="local-6989586621679751750"><span class="annot"><span class="annottext">q :: IxState
  generator
  qGeneratorOutput
  (Tensor qRequiresGradient qLayout qDevice qDataType qShape)
</span><a href="#local-6989586621679751750"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-639"></span><span>            </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
-&gt; IxState
     generator
     generator
     (Tensor
        queryRequiresGradient
        queryLayout
        queryDevice
        queryDataType
        queryShape)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  queryRequiresGradient
  queryLayout
  queryDevice
  queryDataType
  queryShape
</span><a href="#local-6989586621679751764"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-640"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     queryRequiresGradient
     queryLayout
     queryDevice
     queryDataType
     queryShape)
-&gt; (Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape
    -&gt; IxState
         generator
         qGeneratorOutput
         (Tensor qRequiresGradient qLayout qDevice qDataType qShape0))
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0,
     qGeneratorOutput))
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0,
      qGeneratorOutput))
 -&gt; IxState
      generator
      qGeneratorOutput
      (Tensor qRequiresGradient qLayout qDevice qDataType qShape0))
-&gt; (Tensor
      queryRequiresGradient
      queryLayout
      queryDevice
      queryDataType
      queryShape
    -&gt; generator
    -&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0,
        qGeneratorOutput))
-&gt; Tensor
     queryRequiresGradient
     queryLayout
     queryDevice
     queryDataType
     queryShape
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">qInProj
-&gt; Tensor
     queryRequiresGradient
     queryLayout
     queryDevice
     queryDataType
     queryShape
-&gt; generator
-&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0,
    qGeneratorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">qInProj
</span><a href="#local-6989586621679751770"><span class="hs-identifier hs-var">mhaQInProj</span></a></span><span>
</span><span id="line-641"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  qGeneratorOutput
  (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
-&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0
    -&gt; IxState
         qGeneratorOutput
         qGeneratorOutput
         (Tensor qRequiresGradient qLayout qDevice qDataType qShape0))
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span>
</span><span id="line-642"></span><span>                </span><span class="annot"><span class="annottext">(Tensor qRequiresGradient qLayout qDevice qDataType qShape0
 -&gt; IxState
      qGeneratorOutput
      qGeneratorOutput
      (Tensor qRequiresGradient qLayout qDevice qDataType qShape0))
-&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0
    -&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-643"></span><span>                      </span><span class="annot"><span class="annottext">Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#NoScaling"><span class="hs-identifier hs-var">NoScaling</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-644"></span><span>                      </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QueryScaling"><span class="hs-identifier hs-type">QueryScaling</span></a></span><span> </span><span id="local-6989586621679751748"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751748"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Tensor qRequiresGradient qLayout qDevice qDataType qShape0
 -&gt; Double
 -&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
-&gt; Double
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; Double
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
forall other (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
Scalar other =&gt;
Tensor gradient layout device dataType shape
-&gt; other -&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.Pointwise.html#mulScalar"><span class="hs-identifier hs-var">mulScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751748"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-645"></span><span>                      </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#WeightScaling"><span class="hs-identifier hs-type">WeightScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-646"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>                  </span><span class="annot"><span class="annottext">Scaling
</span><a href="#local-6989586621679751765"><span class="hs-identifier hs-var">scaling</span></a></span><span>
</span><span id="line-648"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  qGeneratorOutput
  (Tensor qRequiresGradient qLayout qDevice qDataType qShape0)
-&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0
    -&gt; IxState
         qGeneratorOutput
         qGeneratorOutput
         (Tensor
            qRequiresGradient
            qLayout
            qDevice
            qDataType
            (ReshapeImplF
               (NumelF qShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF querySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               qShape0
               ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))))
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor
        qRequiresGradient
        qLayout
        qDevice
        qDataType
        (ReshapeImplF
           (NumelF qShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF querySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           qShape0
           ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  qLayout
  qDevice
  qDataType
  (ReshapeImplF
     (NumelF qShape0)
     (LiftTimesMaybe
        (NumelDimF batchDim)
        (LiftTimesMaybe
           (NumelDimF querySeqDim)
           (LiftTimesMaybe
              (NumelDimF headDim)
              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
     qShape0
     ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor
        qRequiresGradient
        qLayout
        qDevice
        qDataType
        (ReshapeImplF
           (NumelF qShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF querySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           qShape0
           ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   qRequiresGradient
   qLayout
   qDevice
   qDataType
   (ReshapeImplF
      (NumelF qShape0)
      (LiftTimesMaybe
         (NumelDimF batchDim)
         (LiftTimesMaybe
            (NumelDimF querySeqDim)
            (LiftTimesMaybe
               (NumelDimF headDim)
               (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
      qShape0
      ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
 -&gt; IxState
      qGeneratorOutput
      qGeneratorOutput
      (Tensor
         qRequiresGradient
         qLayout
         qDevice
         qDataType
         (ReshapeImplF
            (NumelF qShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF querySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            qShape0
            ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))))
-&gt; (Tensor qRequiresGradient qLayout qDevice qDataType qShape0
    -&gt; Tensor
         qRequiresGradient
         qLayout
         qDevice
         qDataType
         (ReshapeImplF
            (NumelF qShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF querySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            qShape0
            ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])))
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor
        qRequiresGradient
        qLayout
        qDevice
        qDataType
        (ReshapeImplF
           (NumelF qShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF querySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           qShape0
           ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SShape ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])
-&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape0
-&gt; Tensor
     qRequiresGradient
     qLayout
     qDevice
     qDataType
     (ReshapeImplF
        (NumelF qShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        qShape0
        ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape'' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'' ~ ReshapeF shape shape') =&gt;
SShape shape'
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape''
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sReshape"><span class="hs-identifier hs-var">sReshape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList '[batchDim, querySeqDim, headDim, headEmbedDim]
-&gt; SShape ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList '[batchDim, querySeqDim, headDim, headEmbedDim]
 -&gt; SShape ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
-&gt; SList '[batchDim, querySeqDim, headDim, headEmbedDim]
-&gt; SShape ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
</span><a href="#local-6989586621679751760"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
-&gt; SList '[querySeqDim, headDim, headEmbedDim]
-&gt; SList '[batchDim, querySeqDim, headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim querySeqDim
</span><a href="#local-6989586621679751755"><span class="hs-identifier hs-var">querySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim querySeqDim
-&gt; SList '[headDim, headEmbedDim]
-&gt; SList '[querySeqDim, headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679751773"><span class="hs-identifier hs-var">mhaHeadDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
-&gt; SList '[headEmbedDim] -&gt; SList '[headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751772"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim -&gt; SList '[] -&gt; SList '[headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  qGeneratorOutput
  (Tensor
     qRequiresGradient
     qLayout
     qDevice
     qDataType
     (ReshapeImplF
        (NumelF qShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        qShape0
        ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim])))
-&gt; (Tensor
      qRequiresGradient
      qLayout
      qDevice
      qDataType
      (ReshapeImplF
         (NumelF qShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF querySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         qShape0
         ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
    -&gt; IxState
         qGeneratorOutput
         qGeneratorOutput
         (Tensor qRequiresGradient qLayout qDevice qDataType qShape))
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor qRequiresGradient qLayout qDevice qDataType qShape
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor qRequiresGradient qLayout qDevice qDataType qShape
 -&gt; IxState
      qGeneratorOutput
      qGeneratorOutput
      (Tensor qRequiresGradient qLayout qDevice qDataType qShape))
-&gt; (Tensor
      qRequiresGradient
      qLayout
      qDevice
      qDataType
      (ReshapeImplF
         (NumelF qShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF querySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         qShape0
         ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
    -&gt; Tensor qRequiresGradient qLayout qDevice qDataType qShape)
-&gt; Tensor
     qRequiresGradient
     qLayout
     qDevice
     qDataType
     (ReshapeImplF
        (NumelF qShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        qShape0
        ('Shape '[batchDim, querySeqDim, headDim, headEmbedDim]))
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'
 ~ TransposeF
     ('SelectDim ('ByIndex 1)) ('SelectDim ('ByIndex 2)) shape,
 SingI ('SelectDim ('ByIndex 1)),
 SingI ('SelectDim ('ByIndex 2))) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
forall (selectDim0 :: SelectDim (By Symbol Nat))
       (selectDim1 :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape' ~ TransposeF selectDim0 selectDim1 shape, SingI selectDim0,
 SingI selectDim1) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#transpose"><span class="hs-identifier hs-var">transpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>          </span><span id="local-6989586621679751744"><span class="annot"><span class="annottext">k :: IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
</span><a href="#local-6989586621679751744"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-651"></span><span>            </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
-&gt; IxState
     qGeneratorOutput
     qGeneratorOutput
     (Tensor
        keyRequiresGradient keyLayout keyDevice keyDataType keyShape)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor keyRequiresGradient keyLayout keyDevice keyDataType keyShape
</span><a href="#local-6989586621679751763"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-652"></span><span>              </span><span class="annot"><span class="annottext">IxState
  qGeneratorOutput
  qGeneratorOutput
  (Tensor
     keyRequiresGradient keyLayout keyDevice keyDataType keyShape)
-&gt; (Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape
    -&gt; IxState
         qGeneratorOutput
         kGeneratorOutput
         (Tensor qRequiresGradient kLayout kDevice kDataType kShape0))
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor qRequiresGradient kLayout kDevice kDataType kShape0)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(qGeneratorOutput
 -&gt; (Tensor qRequiresGradient kLayout kDevice kDataType kShape0,
     kGeneratorOutput))
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor qRequiresGradient kLayout kDevice kDataType kShape0)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((qGeneratorOutput
  -&gt; (Tensor qRequiresGradient kLayout kDevice kDataType kShape0,
      kGeneratorOutput))
 -&gt; IxState
      qGeneratorOutput
      kGeneratorOutput
      (Tensor qRequiresGradient kLayout kDevice kDataType kShape0))
-&gt; (Tensor
      keyRequiresGradient keyLayout keyDevice keyDataType keyShape
    -&gt; qGeneratorOutput
    -&gt; (Tensor qRequiresGradient kLayout kDevice kDataType kShape0,
        kGeneratorOutput))
-&gt; Tensor
     keyRequiresGradient keyLayout keyDevice keyDataType keyShape
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor qRequiresGradient kLayout kDevice kDataType kShape0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">kInProj
-&gt; Tensor
     keyRequiresGradient keyLayout keyDevice keyDataType keyShape
-&gt; qGeneratorOutput
-&gt; (Tensor qRequiresGradient kLayout kDevice kDataType kShape0,
    kGeneratorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">kInProj
</span><a href="#local-6989586621679751769"><span class="hs-identifier hs-var">mhaKInProj</span></a></span><span>
</span><span id="line-653"></span><span>              </span><span class="annot"><span class="annottext">IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor qRequiresGradient kLayout kDevice kDataType kShape0)
-&gt; (Tensor qRequiresGradient kLayout kDevice kDataType kShape0
    -&gt; IxState
         kGeneratorOutput
         kGeneratorOutput
         (Tensor
            qRequiresGradient
            kLayout
            kDevice
            kDataType
            (ReshapeImplF
               (NumelF kShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               kShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  kLayout
  kDevice
  kDataType
  (ReshapeImplF
     (NumelF kShape0)
     (LiftTimesMaybe
        (NumelDimF batchDim)
        (LiftTimesMaybe
           (NumelDimF keySeqDim)
           (LiftTimesMaybe
              (NumelDimF headDim)
              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
     kShape0
     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   qRequiresGradient
   kLayout
   kDevice
   kDataType
   (ReshapeImplF
      (NumelF kShape0)
      (LiftTimesMaybe
         (NumelDimF batchDim)
         (LiftTimesMaybe
            (NumelDimF keySeqDim)
            (LiftTimesMaybe
               (NumelDimF headDim)
               (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
      kShape0
      ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
 -&gt; IxState
      kGeneratorOutput
      kGeneratorOutput
      (Tensor
         qRequiresGradient
         kLayout
         kDevice
         kDataType
         (ReshapeImplF
            (NumelF kShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            kShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; (Tensor qRequiresGradient kLayout kDevice kDataType kShape0
    -&gt; Tensor
         qRequiresGradient
         kLayout
         kDevice
         kDataType
         (ReshapeImplF
            (NumelF kShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            kShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; Tensor qRequiresGradient kLayout kDevice kDataType kShape0
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])
-&gt; Tensor qRequiresGradient kLayout kDevice kDataType kShape0
-&gt; Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (ReshapeImplF
        (NumelF kShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        kShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape'' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'' ~ ReshapeF shape shape') =&gt;
SShape shape'
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape''
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sReshape"><span class="hs-identifier hs-var">sReshape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList '[batchDim, keySeqDim, headDim, headEmbedDim]
-&gt; SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList '[batchDim, keySeqDim, headDim, headEmbedDim]
 -&gt; SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
-&gt; SList '[batchDim, keySeqDim, headDim, headEmbedDim]
-&gt; SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
</span><a href="#local-6989586621679751760"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
-&gt; SList '[keySeqDim, headDim, headEmbedDim]
-&gt; SList '[batchDim, keySeqDim, headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim keySeqDim
</span><a href="#local-6989586621679751753"><span class="hs-identifier hs-var">keySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim keySeqDim
-&gt; SList '[headDim, headEmbedDim]
-&gt; SList '[keySeqDim, headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679751773"><span class="hs-identifier hs-var">mhaHeadDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
-&gt; SList '[headEmbedDim] -&gt; SList '[headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751772"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim -&gt; SList '[] -&gt; SList '[headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>              </span><span class="annot"><span class="annottext">IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (ReshapeImplF
        (NumelF kShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        kShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; (Tensor
      qRequiresGradient
      kLayout
      kDevice
      kDataType
      (ReshapeImplF
         (NumelF kShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF keySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         kShape0
         ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
    -&gt; IxState
         kGeneratorOutput
         kGeneratorOutput
         (Tensor
            qRequiresGradient
            kLayout
            kDevice
            kDataType
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  kLayout
  kDevice
  kDataType
  (TransposeF
     ('SelectDim ('ByIndex 1))
     ('SelectDim ('ByIndex 2))
     (ReshapeImplF
        (NumelF kShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        kShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   qRequiresGradient
   kLayout
   kDevice
   kDataType
   (TransposeF
      ('SelectDim ('ByIndex 1))
      ('SelectDim ('ByIndex 2))
      (ReshapeImplF
         (NumelF kShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF keySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         kShape0
         ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
 -&gt; IxState
      kGeneratorOutput
      kGeneratorOutput
      (Tensor
         qRequiresGradient
         kLayout
         kDevice
         kDataType
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF kShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               kShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; (Tensor
      qRequiresGradient
      kLayout
      kDevice
      kDataType
      (ReshapeImplF
         (NumelF kShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF keySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         kShape0
         ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
    -&gt; Tensor
         qRequiresGradient
         kLayout
         kDevice
         kDataType
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF kShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               kShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (ReshapeImplF
        (NumelF kShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        kShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'
 ~ TransposeF
     ('SelectDim ('ByIndex 1)) ('SelectDim ('ByIndex 2)) shape,
 SingI ('SelectDim ('ByIndex 1)),
 SingI ('SelectDim ('ByIndex 2))) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
forall (selectDim0 :: SelectDim (By Symbol Nat))
       (selectDim1 :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape' ~ TransposeF selectDim0 selectDim1 shape, SingI selectDim0,
 SingI selectDim1) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#transpose"><span class="hs-identifier hs-var">transpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>          </span><span id="local-6989586621679751743"><span class="annot"><span class="annottext">kt :: IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
</span><a href="#local-6989586621679751743"><span class="hs-identifier hs-var hs-var">kt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
</span><a href="#local-6989586621679751744"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; (Tensor
      qRequiresGradient
      kLayout
      kDevice
      kDataType
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (ReshapeImplF
            (NumelF kShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            kShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
    -&gt; IxState
         kGeneratorOutput
         kGeneratorOutput
         (Tensor
            qRequiresGradient
            kLayout
            kDevice
            kDataType
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  kLayout
  kDevice
  kDataType
  (TransposeF
     ('SelectDim ('ByIndex 2))
     ('SelectDim ('ByIndex 3))
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   qRequiresGradient
   kLayout
   kDevice
   kDataType
   (TransposeF
      ('SelectDim ('ByIndex 2))
      ('SelectDim ('ByIndex 3))
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (ReshapeImplF
            (NumelF kShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            kShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
 -&gt; IxState
      kGeneratorOutput
      kGeneratorOutput
      (Tensor
         qRequiresGradient
         kLayout
         kDevice
         kDataType
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; (Tensor
      qRequiresGradient
      kLayout
      kDevice
      kDataType
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (ReshapeImplF
            (NumelF kShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            kShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
    -&gt; Tensor
         qRequiresGradient
         kLayout
         kDevice
         kDataType
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF kShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           kShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'
 ~ TransposeF
     ('SelectDim ('ByIndex 2)) ('SelectDim ('ByIndex 3)) shape,
 SingI ('SelectDim ('ByIndex 2)),
 SingI ('SelectDim ('ByIndex 3))) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
forall (selectDim0 :: SelectDim (By Symbol Nat))
       (selectDim1 :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape' ~ TransposeF selectDim0 selectDim1 shape, SingI selectDim0,
 SingI selectDim1) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#transpose"><span class="hs-identifier hs-var">transpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>          </span><span id="local-6989586621679751742"><span class="annot"><span class="annottext">weights :: IxState
  generator
  weightsGeneratorOutput
  (Tensor
     weightsRequiresGradient
     weightsLayout
     weightsDevice
     weightsDataType
     weightsShape)
</span><a href="#local-6989586621679751742"><span class="hs-identifier hs-var hs-var">weights</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-657"></span><span>            </span><span class="annot"><span class="annottext">Tensor qRequiresGradient qLayout qDevice qDataType qShape
-&gt; Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (layout' :: Layout LayoutType)
       (device :: Device (DeviceType Nat))
       (device' :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (dataType' :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout' device' dataType' shape'
-&gt; Tensor
     gradient
     (layout &lt;+&gt; layout')
     (device &lt;+&gt; device')
     (dataType &lt;+&gt; dataType')
     (MatmulF shape shape')
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html#matmul"><span class="hs-identifier hs-var">matmul</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor qRequiresGradient qLayout qDevice qDataType qShape
 -&gt; Tensor
      qRequiresGradient
      kLayout
      kDevice
      kDataType
      (TransposeF
         ('SelectDim ('ByIndex 2))
         ('SelectDim ('ByIndex 3))
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF kShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               kShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
 -&gt; Tensor
      qRequiresGradient
      (Unify (Layout LayoutType) qLayout kLayout)
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      (Unify (DataType DType) qDataType kDataType)
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor qRequiresGradient qLayout qDevice qDataType qShape)
-&gt; IxState
     generator
     qGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
      -&gt; Tensor
           qRequiresGradient
           (Unify (Layout LayoutType) qLayout kLayout)
           (Unify (Device (DeviceType Nat)) qDevice kDevice)
           (Unify (DataType DType) qDataType kDataType)
           (MatmulF
              qShape
              (TransposeF
                 ('SelectDim ('ByIndex 2))
                 ('SelectDim ('ByIndex 3))
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF kShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       kShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall k1 k2 (f :: k1 -&gt; k2 -&gt; Type -&gt; Type) a b (j :: k1)
       (k3 :: k2).
IxFunctor f =&gt;
(a -&gt; b) -&gt; f j k3 a -&gt; f j k3 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  generator
  qGeneratorOutput
  (Tensor qRequiresGradient qLayout qDevice qDataType qShape)
</span><a href="#local-6989586621679751750"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  generator
  qGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
   -&gt; Tensor
        qRequiresGradient
        (Unify (Layout LayoutType) qLayout kLayout)
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        (Unify (DataType DType) qDataType kDataType)
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; IxState
     qGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        kLayout
        kDevice
        kDataType
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     generator
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        (Unify (Layout LayoutType) qLayout kLayout)
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        (Unify (DataType DType) qDataType kDataType)
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  qGeneratorOutput
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     kLayout
     kDevice
     kDataType
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
</span><a href="#local-6989586621679751743"><span class="hs-identifier hs-var">kt</span></a></span><span>
</span><span id="line-658"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; (Tensor
      qRequiresGradient
      (Unify (Layout LayoutType) qLayout kLayout)
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      (Unify (DataType DType) qDataType kDataType)
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
    -&gt; IxState
         kGeneratorOutput
         kGeneratorOutput
         (Tensor
            qRequiresGradient
            (Unify (Layout LayoutType) qLayout kLayout)
            (Unify (Device (DeviceType Nat)) qDevice kDevice)
            (Unify (DataType DType) qDataType kDataType)
            (MatmulF
               qShape
               (TransposeF
                  ('SelectDim ('ByIndex 2))
                  ('SelectDim ('ByIndex 3))
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF kShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        kShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))))
-&gt; IxState
     generator
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        (Unify (Layout LayoutType) qLayout kLayout)
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        (Unify (DataType DType) qDataType kDataType)
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  (Unify (Layout LayoutType) qLayout kLayout)
  (Unify (Device (DeviceType Nat)) qDevice kDevice)
  (Unify (DataType DType) qDataType kDataType)
  (MatmulF
     qShape
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        (Unify (Layout LayoutType) qLayout kLayout)
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        (Unify (DataType DType) qDataType kDataType)
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span>
</span><span id="line-659"></span><span>                </span><span class="annot"><span class="annottext">(Tensor
   qRequiresGradient
   (Unify (Layout LayoutType) qLayout kLayout)
   (Unify (Device (DeviceType Nat)) qDevice kDevice)
   (Unify (DataType DType) qDataType kDataType)
   (MatmulF
      qShape
      (TransposeF
         ('SelectDim ('ByIndex 2))
         ('SelectDim ('ByIndex 3))
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF kShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               kShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
 -&gt; IxState
      kGeneratorOutput
      kGeneratorOutput
      (Tensor
         qRequiresGradient
         (Unify (Layout LayoutType) qLayout kLayout)
         (Unify (Device (DeviceType Nat)) qDevice kDevice)
         (Unify (DataType DType) qDataType kDataType)
         (MatmulF
            qShape
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))))
-&gt; (Tensor
      qRequiresGradient
      (Unify (Layout LayoutType) qLayout kLayout)
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      (Unify (DataType DType) qDataType kDataType)
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
    -&gt; Tensor
         qRequiresGradient
         (Unify (Layout LayoutType) qLayout kLayout)
         (Unify (Device (DeviceType Nat)) qDevice kDevice)
         (Unify (DataType DType) qDataType kDataType)
         (MatmulF
            qShape
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        qRequiresGradient
        (Unify (Layout LayoutType) qLayout kLayout)
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        (Unify (DataType DType) qDataType kDataType)
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-660"></span><span>                      </span><span class="annot"><span class="annottext">Scaling
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#NoScaling"><span class="hs-identifier hs-var">NoScaling</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  (Unify (Layout LayoutType) qLayout kLayout)
  (Unify (Device (DeviceType Nat)) qDevice kDevice)
  (Unify (DataType DType) qDataType kDataType)
  (MatmulF
     qShape
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-661"></span><span>                      </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#QueryScaling"><span class="hs-identifier hs-type">QueryScaling</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  (Unify (Layout LayoutType) qLayout kLayout)
  (Unify (Device (DeviceType Nat)) qDevice kDevice)
  (Unify (DataType DType) qDataType kDataType)
  (MatmulF
     qShape
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-662"></span><span>                      </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#WeightScaling"><span class="hs-identifier hs-type">WeightScaling</span></a></span><span> </span><span id="local-6989586621679751741"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751741"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Tensor
   qRequiresGradient
   (Unify (Layout LayoutType) qLayout kLayout)
   (Unify (Device (DeviceType Nat)) qDevice kDevice)
   (Unify (DataType DType) qDataType kDataType)
   (MatmulF
      qShape
      (TransposeF
         ('SelectDim ('ByIndex 2))
         ('SelectDim ('ByIndex 3))
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF kShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               kShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
 -&gt; Double
 -&gt; Tensor
      qRequiresGradient
      (Unify (Layout LayoutType) qLayout kLayout)
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      (Unify (DataType DType) qDataType kDataType)
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; Double
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  (Unify (Layout LayoutType) qLayout kLayout)
  (Unify (Device (DeviceType Nat)) qDevice kDevice)
  (Unify (DataType DType) qDataType kDataType)
  (MatmulF
     qShape
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Double
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall other (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
Scalar other =&gt;
Tensor gradient layout device dataType shape
-&gt; other -&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.Pointwise.html#mulScalar"><span class="hs-identifier hs-var">mulScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679751741"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-663"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>                  </span><span class="annot"><span class="annottext">Scaling
</span><a href="#local-6989586621679751765"><span class="hs-identifier hs-var">scaling</span></a></span><span>
</span><span id="line-665"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  kGeneratorOutput
  (Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; (Tensor
      qRequiresGradient
      (Unify (Layout LayoutType) qLayout kLayout)
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      (Unify (DataType DType) qDataType kDataType)
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
    -&gt; IxState
         kGeneratorOutput
         kGeneratorOutput
         (Tensor
            (Or
               (Gradient RequiresGradient)
               qRequiresGradient
               attentionBiasRequiresGradient)
            (Unify
               (Layout LayoutType)
               (Unify (Layout LayoutType) qLayout kLayout)
               attentionBiasLayout)
            (Unify
               (Device (DeviceType Nat))
               (Unify (Device (DeviceType Nat)) qDevice kDevice)
               attentionBiasDevice)
            (Unify
               (DataType DType)
               (Unify (DataType DType) qDataType kDataType)
               attentionBiasDataType)
            (BroadcastShapesF
               (MatmulF
                  qShape
                  (TransposeF
                     ('SelectDim ('ByIndex 2))
                     ('SelectDim ('ByIndex 3))
                     (TransposeF
                        ('SelectDim ('ByIndex 1))
                        ('SelectDim ('ByIndex 2))
                        (ReshapeImplF
                           (NumelF kShape0)
                           (LiftTimesMaybe
                              (NumelDimF batchDim)
                              (LiftTimesMaybe
                                 (NumelDimF keySeqDim)
                                 (LiftTimesMaybe
                                    (NumelDimF headDim)
                                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                           kShape0
                           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
               attentionBiasShape)))
-&gt; IxState
     generator
     kGeneratorOutput
     (Tensor
        (Or
           (Gradient RequiresGradient)
           qRequiresGradient
           attentionBiasRequiresGradient)
        (Unify
           (Layout LayoutType)
           (Unify (Layout LayoutType) qLayout kLayout)
           attentionBiasLayout)
        (Unify
           (Device (DeviceType Nat))
           (Unify (Device (DeviceType Nat)) qDevice kDevice)
           attentionBiasDevice)
        (Unify
           (DataType DType)
           (Unify (DataType DType) qDataType kDataType)
           attentionBiasDataType)
        (BroadcastShapesF
           (MatmulF
              qShape
              (TransposeF
                 ('SelectDim ('ByIndex 2))
                 ('SelectDim ('ByIndex 3))
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF kShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       kShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           attentionBiasShape))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  (Or
     (Gradient RequiresGradient)
     qRequiresGradient
     attentionBiasRequiresGradient)
  (Unify
     (Layout LayoutType)
     (Unify (Layout LayoutType) qLayout kLayout)
     attentionBiasLayout)
  (Unify
     (Device (DeviceType Nat))
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     attentionBiasDevice)
  (Unify
     (DataType DType)
     (Unify (DataType DType) qDataType kDataType)
     attentionBiasDataType)
  (BroadcastShapesF
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
     attentionBiasShape)
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        (Or
           (Gradient RequiresGradient)
           qRequiresGradient
           attentionBiasRequiresGradient)
        (Unify
           (Layout LayoutType)
           (Unify (Layout LayoutType) qLayout kLayout)
           attentionBiasLayout)
        (Unify
           (Device (DeviceType Nat))
           (Unify (Device (DeviceType Nat)) qDevice kDevice)
           attentionBiasDevice)
        (Unify
           (DataType DType)
           (Unify (DataType DType) qDataType kDataType)
           attentionBiasDataType)
        (BroadcastShapesF
           (MatmulF
              qShape
              (TransposeF
                 ('SelectDim ('ByIndex 2))
                 ('SelectDim ('ByIndex 3))
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF kShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       kShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           attentionBiasShape))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   (Or
      (Gradient RequiresGradient)
      qRequiresGradient
      attentionBiasRequiresGradient)
   (Unify
      (Layout LayoutType)
      (Unify (Layout LayoutType) qLayout kLayout)
      attentionBiasLayout)
   (Unify
      (Device (DeviceType Nat))
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      attentionBiasDevice)
   (Unify
      (DataType DType)
      (Unify (DataType DType) qDataType kDataType)
      attentionBiasDataType)
   (BroadcastShapesF
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
      attentionBiasShape)
 -&gt; IxState
      kGeneratorOutput
      kGeneratorOutput
      (Tensor
         (Or
            (Gradient RequiresGradient)
            qRequiresGradient
            attentionBiasRequiresGradient)
         (Unify
            (Layout LayoutType)
            (Unify (Layout LayoutType) qLayout kLayout)
            attentionBiasLayout)
         (Unify
            (Device (DeviceType Nat))
            (Unify (Device (DeviceType Nat)) qDevice kDevice)
            attentionBiasDevice)
         (Unify
            (DataType DType)
            (Unify (DataType DType) qDataType kDataType)
            attentionBiasDataType)
         (BroadcastShapesF
            (MatmulF
               qShape
               (TransposeF
                  ('SelectDim ('ByIndex 2))
                  ('SelectDim ('ByIndex 3))
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF kShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        kShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
            attentionBiasShape)))
-&gt; (Tensor
      qRequiresGradient
      (Unify (Layout LayoutType) qLayout kLayout)
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      (Unify (DataType DType) qDataType kDataType)
      (MatmulF
         qShape
         (TransposeF
            ('SelectDim ('ByIndex 2))
            ('SelectDim ('ByIndex 3))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF kShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  kShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
    -&gt; Tensor
         (Or
            (Gradient RequiresGradient)
            qRequiresGradient
            attentionBiasRequiresGradient)
         (Unify
            (Layout LayoutType)
            (Unify (Layout LayoutType) qLayout kLayout)
            attentionBiasLayout)
         (Unify
            (Device (DeviceType Nat))
            (Unify (Device (DeviceType Nat)) qDevice kDevice)
            attentionBiasDevice)
         (Unify
            (DataType DType)
            (Unify (DataType DType) qDataType kDataType)
            attentionBiasDataType)
         (BroadcastShapesF
            (MatmulF
               qShape
               (TransposeF
                  ('SelectDim ('ByIndex 2))
                  ('SelectDim ('ByIndex 3))
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF kShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        kShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
            attentionBiasShape))
-&gt; Tensor
     qRequiresGradient
     (Unify (Layout LayoutType) qLayout kLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice)
     (Unify (DataType DType) qDataType kDataType)
     (MatmulF
        qShape
        (TransposeF
           ('SelectDim ('ByIndex 2))
           ('SelectDim ('ByIndex 3))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF kShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 kShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     kGeneratorOutput
     kGeneratorOutput
     (Tensor
        (Or
           (Gradient RequiresGradient)
           qRequiresGradient
           attentionBiasRequiresGradient)
        (Unify
           (Layout LayoutType)
           (Unify (Layout LayoutType) qLayout kLayout)
           attentionBiasLayout)
        (Unify
           (Device (DeviceType Nat))
           (Unify (Device (DeviceType Nat)) qDevice kDevice)
           attentionBiasDevice)
        (Unify
           (DataType DType)
           (Unify (DataType DType) qDataType kDataType)
           attentionBiasDataType)
        (BroadcastShapesF
           (MatmulF
              qShape
              (TransposeF
                 ('SelectDim ('ByIndex 2))
                 ('SelectDim ('ByIndex 3))
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF kShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       kShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           attentionBiasShape))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  qRequiresGradient
  (Unify (Layout LayoutType) qLayout kLayout)
  (Unify (Device (DeviceType Nat)) qDevice kDevice)
  (Unify (DataType DType) qDataType kDataType)
  (MatmulF
     qShape
     (TransposeF
        ('SelectDim ('ByIndex 2))
        ('SelectDim ('ByIndex 3))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF kShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              kShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Tensor
     attentionBiasRequiresGradient
     attentionBiasLayout
     attentionBiasDevice
     attentionBiasDataType
     attentionBiasShape
-&gt; Tensor
     (qRequiresGradient &lt;|&gt; attentionBiasRequiresGradient)
     (Unify (Layout LayoutType) qLayout kLayout &lt;+&gt; attentionBiasLayout)
     (Unify (Device (DeviceType Nat)) qDevice kDevice
      &lt;+&gt; attentionBiasDevice)
     (Unify (DataType DType) qDataType kDataType
      &lt;+&gt; attentionBiasDataType)
     (BroadcastShapesF
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        attentionBiasShape)
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient' :: Gradient RequiresGradient)
       (layout' :: Layout LayoutType) (device' :: Device (DeviceType Nat))
       (dataType' :: DataType DType)
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
Tensor gradient layout device dataType shape
-&gt; Tensor gradient' layout' device' dataType' shape'
-&gt; Tensor
     (gradient &lt;|&gt; gradient')
     (layout &lt;+&gt; layout')
     (device &lt;+&gt; device')
     (dataType &lt;+&gt; dataType')
     (BroadcastShapesF shape shape')
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.Pointwise.html#add"><span class="hs-operator hs-var">`add`</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  attentionBiasRequiresGradient
  attentionBiasLayout
  attentionBiasDevice
  attentionBiasDataType
  attentionBiasShape
</span><a href="#local-6989586621679751761"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>              </span><span class="annot"><span class="annottext">IxState
  generator
  kGeneratorOutput
  (Tensor
     (Or
        (Gradient RequiresGradient)
        qRequiresGradient
        attentionBiasRequiresGradient)
     (Unify
        (Layout LayoutType)
        (Unify (Layout LayoutType) qLayout kLayout)
        attentionBiasLayout)
     (Unify
        (Device (DeviceType Nat))
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        attentionBiasDevice)
     (Unify
        (DataType DType)
        (Unify (DataType DType) qDataType kDataType)
        attentionBiasDataType)
     (BroadcastShapesF
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        attentionBiasShape))
-&gt; (Tensor
      (Or
         (Gradient RequiresGradient)
         qRequiresGradient
         attentionBiasRequiresGradient)
      (Unify
         (Layout LayoutType)
         (Unify (Layout LayoutType) qLayout kLayout)
         attentionBiasLayout)
      (Unify
         (Device (DeviceType Nat))
         (Unify (Device (DeviceType Nat)) qDevice kDevice)
         attentionBiasDevice)
      (Unify
         (DataType DType)
         (Unify (DataType DType) qDataType kDataType)
         attentionBiasDataType)
      (BroadcastShapesF
         (MatmulF
            qShape
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
         attentionBiasShape)
    -&gt; IxState
         kGeneratorOutput
         weightsGeneratorOutput
         (Tensor
            weightsRequiresGradient
            weightsLayout
            weightsDevice
            weightsDataType
            weightsShape))
-&gt; IxState
     generator
     weightsGeneratorOutput
     (Tensor
        weightsRequiresGradient
        weightsLayout
        weightsDevice
        weightsDataType
        weightsShape)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(kGeneratorOutput
 -&gt; (Tensor
       weightsRequiresGradient
       weightsLayout
       weightsDevice
       weightsDataType
       weightsShape,
     weightsGeneratorOutput))
-&gt; IxState
     kGeneratorOutput
     weightsGeneratorOutput
     (Tensor
        weightsRequiresGradient
        weightsLayout
        weightsDevice
        weightsDataType
        weightsShape)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((kGeneratorOutput
  -&gt; (Tensor
        weightsRequiresGradient
        weightsLayout
        weightsDevice
        weightsDataType
        weightsShape,
      weightsGeneratorOutput))
 -&gt; IxState
      kGeneratorOutput
      weightsGeneratorOutput
      (Tensor
         weightsRequiresGradient
         weightsLayout
         weightsDevice
         weightsDataType
         weightsShape))
-&gt; (Tensor
      (Or
         (Gradient RequiresGradient)
         qRequiresGradient
         attentionBiasRequiresGradient)
      (Unify
         (Layout LayoutType)
         (Unify (Layout LayoutType) qLayout kLayout)
         attentionBiasLayout)
      (Unify
         (Device (DeviceType Nat))
         (Unify (Device (DeviceType Nat)) qDevice kDevice)
         attentionBiasDevice)
      (Unify
         (DataType DType)
         (Unify (DataType DType) qDataType kDataType)
         attentionBiasDataType)
      (BroadcastShapesF
         (MatmulF
            qShape
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
         attentionBiasShape)
    -&gt; kGeneratorOutput
    -&gt; (Tensor
          weightsRequiresGradient
          weightsLayout
          weightsDevice
          weightsDataType
          weightsShape,
        weightsGeneratorOutput))
-&gt; Tensor
     (Or
        (Gradient RequiresGradient)
        qRequiresGradient
        attentionBiasRequiresGradient)
     (Unify
        (Layout LayoutType)
        (Unify (Layout LayoutType) qLayout kLayout)
        attentionBiasLayout)
     (Unify
        (Device (DeviceType Nat))
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        attentionBiasDevice)
     (Unify
        (DataType DType)
        (Unify (DataType DType) qDataType kDataType)
        attentionBiasDataType)
     (BroadcastShapesF
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        attentionBiasShape)
-&gt; IxState
     kGeneratorOutput
     weightsGeneratorOutput
     (Tensor
        weightsRequiresGradient
        weightsLayout
        weightsDevice
        weightsDataType
        weightsShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">dropout
-&gt; Tensor
     (Or
        (Gradient RequiresGradient)
        qRequiresGradient
        attentionBiasRequiresGradient)
     (Unify
        (Layout LayoutType)
        (Unify (Layout LayoutType) qLayout kLayout)
        attentionBiasLayout)
     (Unify
        (Device (DeviceType Nat))
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        attentionBiasDevice)
     (Unify
        (DataType DType)
        (Unify (DataType DType) qDataType kDataType)
        attentionBiasDataType)
     (SoftmaxF
        ('SelectDim ('ByIndex 3))
        (BroadcastShapesF
           (MatmulF
              qShape
              (TransposeF
                 ('SelectDim ('ByIndex 2))
                 ('SelectDim ('ByIndex 3))
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF kShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       kShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           attentionBiasShape))
-&gt; kGeneratorOutput
-&gt; (Tensor
      weightsRequiresGradient
      weightsLayout
      weightsDevice
      weightsDataType
      weightsShape,
    weightsGeneratorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">dropout
</span><a href="#local-6989586621679751766"><span class="hs-identifier hs-var">mhaDropout</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   (Or
      (Gradient RequiresGradient)
      qRequiresGradient
      attentionBiasRequiresGradient)
   (Unify
      (Layout LayoutType)
      (Unify (Layout LayoutType) qLayout kLayout)
      attentionBiasLayout)
   (Unify
      (Device (DeviceType Nat))
      (Unify (Device (DeviceType Nat)) qDevice kDevice)
      attentionBiasDevice)
   (Unify
      (DataType DType)
      (Unify (DataType DType) qDataType kDataType)
      attentionBiasDataType)
   (SoftmaxF
      ('SelectDim ('ByIndex 3))
      (BroadcastShapesF
         (MatmulF
            qShape
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
         attentionBiasShape))
 -&gt; kGeneratorOutput
 -&gt; (Tensor
       weightsRequiresGradient
       weightsLayout
       weightsDevice
       weightsDataType
       weightsShape,
     weightsGeneratorOutput))
-&gt; (Tensor
      (Or
         (Gradient RequiresGradient)
         qRequiresGradient
         attentionBiasRequiresGradient)
      (Unify
         (Layout LayoutType)
         (Unify (Layout LayoutType) qLayout kLayout)
         attentionBiasLayout)
      (Unify
         (Device (DeviceType Nat))
         (Unify (Device (DeviceType Nat)) qDevice kDevice)
         attentionBiasDevice)
      (Unify
         (DataType DType)
         (Unify (DataType DType) qDataType kDataType)
         attentionBiasDataType)
      (BroadcastShapesF
         (MatmulF
            qShape
            (TransposeF
               ('SelectDim ('ByIndex 2))
               ('SelectDim ('ByIndex 3))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF kShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     kShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
         attentionBiasShape)
    -&gt; Tensor
         (Or
            (Gradient RequiresGradient)
            qRequiresGradient
            attentionBiasRequiresGradient)
         (Unify
            (Layout LayoutType)
            (Unify (Layout LayoutType) qLayout kLayout)
            attentionBiasLayout)
         (Unify
            (Device (DeviceType Nat))
            (Unify (Device (DeviceType Nat)) qDevice kDevice)
            attentionBiasDevice)
         (Unify
            (DataType DType)
            (Unify (DataType DType) qDataType kDataType)
            attentionBiasDataType)
         (SoftmaxF
            ('SelectDim ('ByIndex 3))
            (BroadcastShapesF
               (MatmulF
                  qShape
                  (TransposeF
                     ('SelectDim ('ByIndex 2))
                     ('SelectDim ('ByIndex 3))
                     (TransposeF
                        ('SelectDim ('ByIndex 1))
                        ('SelectDim ('ByIndex 2))
                        (ReshapeImplF
                           (NumelF kShape0)
                           (LiftTimesMaybe
                              (NumelDimF batchDim)
                              (LiftTimesMaybe
                                 (NumelDimF keySeqDim)
                                 (LiftTimesMaybe
                                    (NumelDimF headDim)
                                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                           kShape0
                           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
               attentionBiasShape)))
-&gt; Tensor
     (Or
        (Gradient RequiresGradient)
        qRequiresGradient
        attentionBiasRequiresGradient)
     (Unify
        (Layout LayoutType)
        (Unify (Layout LayoutType) qLayout kLayout)
        attentionBiasLayout)
     (Unify
        (Device (DeviceType Nat))
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        attentionBiasDevice)
     (Unify
        (DataType DType)
        (Unify (DataType DType) qDataType kDataType)
        attentionBiasDataType)
     (BroadcastShapesF
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        attentionBiasShape)
-&gt; kGeneratorOutput
-&gt; (Tensor
      weightsRequiresGradient
      weightsLayout
      weightsDevice
      weightsDataType
      weightsShape,
    weightsGeneratorOutput)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 3))
-&gt; Tensor
     (Or
        (Gradient RequiresGradient)
        qRequiresGradient
        attentionBiasRequiresGradient)
     (Unify
        (Layout LayoutType)
        (Unify (Layout LayoutType) qLayout kLayout)
        attentionBiasLayout)
     (Unify
        (Device (DeviceType Nat))
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        attentionBiasDevice)
     (Unify
        (DataType DType)
        (Unify (DataType DType) qDataType kDataType)
        attentionBiasDataType)
     (BroadcastShapesF
        (MatmulF
           qShape
           (TransposeF
              ('SelectDim ('ByIndex 2))
              ('SelectDim ('ByIndex 3))
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF kShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    kShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        attentionBiasShape)
-&gt; Tensor
     (Or
        (Gradient RequiresGradient)
        qRequiresGradient
        attentionBiasRequiresGradient)
     (Unify
        (Layout LayoutType)
        (Unify (Layout LayoutType) qLayout kLayout)
        attentionBiasLayout)
     (Unify
        (Device (DeviceType Nat))
        (Unify (Device (DeviceType Nat)) qDevice kDevice)
        attentionBiasDevice)
     (Unify
        (DataType DType)
        (Unify (DataType DType) qDataType kDataType)
        attentionBiasDataType)
     (SoftmaxF
        ('SelectDim ('ByIndex 3))
        (BroadcastShapesF
           (MatmulF
              qShape
              (TransposeF
                 ('SelectDim ('ByIndex 2))
                 ('SelectDim ('ByIndex 3))
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF kShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       kShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           attentionBiasShape))
forall (selectDim :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SSelectDim selectDim
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor
     gradient layout device dataType (SoftmaxF selectDim shape)
</span><a href="Torch.GraduallyTyped.NN.Functional.NonLinearActivation.html#softmax"><span class="hs-identifier hs-var">softmax</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 3) -&gt; SSelectDim ('SelectDim ('ByIndex 3))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 3) -&gt; SSelectDim ('SelectDim ('ByIndex 3)))
-&gt; SBy ('ByIndex 3) -&gt; SSelectDim ('SelectDim ('ByIndex 3))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 3 =&gt; SBy ('ByIndex 3)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>          </span><span id="local-6989586621679751740"><span class="annot"><span class="annottext">v :: IxState
  weightsGeneratorOutput
  vGeneratorOutput
  (Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
</span><a href="#local-6989586621679751740"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-668"></span><span>            </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
-&gt; IxState
     weightsGeneratorOutput
     weightsGeneratorOutput
     (Tensor
        valueRequiresGradient
        valueLayout
        valueDevice
        valueDataType
        valueShape)
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  valueRequiresGradient
  valueLayout
  valueDevice
  valueDataType
  valueShape
</span><a href="#local-6989586621679751762"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-669"></span><span>              </span><span class="annot"><span class="annottext">IxState
  weightsGeneratorOutput
  weightsGeneratorOutput
  (Tensor
     valueRequiresGradient
     valueLayout
     valueDevice
     valueDataType
     valueShape)
-&gt; (Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape
    -&gt; IxState
         weightsGeneratorOutput
         vGeneratorOutput
         (Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0))
-&gt; IxState
     weightsGeneratorOutput
     vGeneratorOutput
     (Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0)
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(weightsGeneratorOutput
 -&gt; (Tensor
       weightsRequiresGradient vLayout vDevice vDataType vShape0,
     vGeneratorOutput))
-&gt; IxState
     weightsGeneratorOutput
     vGeneratorOutput
     (Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((weightsGeneratorOutput
  -&gt; (Tensor
        weightsRequiresGradient vLayout vDevice vDataType vShape0,
      vGeneratorOutput))
 -&gt; IxState
      weightsGeneratorOutput
      vGeneratorOutput
      (Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0))
-&gt; (Tensor
      valueRequiresGradient
      valueLayout
      valueDevice
      valueDataType
      valueShape
    -&gt; weightsGeneratorOutput
    -&gt; (Tensor
          weightsRequiresGradient vLayout vDevice vDataType vShape0,
        vGeneratorOutput))
-&gt; Tensor
     valueRequiresGradient
     valueLayout
     valueDevice
     valueDataType
     valueShape
-&gt; IxState
     weightsGeneratorOutput
     vGeneratorOutput
     (Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">vInProj
-&gt; Tensor
     valueRequiresGradient
     valueLayout
     valueDevice
     valueDataType
     valueShape
-&gt; weightsGeneratorOutput
-&gt; (Tensor
      weightsRequiresGradient vLayout vDevice vDataType vShape0,
    vGeneratorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">vInProj
</span><a href="#local-6989586621679751768"><span class="hs-identifier hs-var">mhaVInProj</span></a></span><span>
</span><span id="line-670"></span><span>              </span><span class="annot"><span class="annottext">IxState
  weightsGeneratorOutput
  vGeneratorOutput
  (Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0)
-&gt; (Tensor
      weightsRequiresGradient vLayout vDevice vDataType vShape0
    -&gt; IxState
         vGeneratorOutput
         vGeneratorOutput
         (Tensor
            weightsRequiresGradient
            vLayout
            vDevice
            vDataType
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; IxState
     weightsGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  weightsRequiresGradient
  vLayout
  vDevice
  vDataType
  (ReshapeImplF
     (NumelF vShape0)
     (LiftTimesMaybe
        (NumelDimF batchDim)
        (LiftTimesMaybe
           (NumelDimF keySeqDim)
           (LiftTimesMaybe
              (NumelDimF headDim)
              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
     vShape0
     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   weightsRequiresGradient
   vLayout
   vDevice
   vDataType
   (ReshapeImplF
      (NumelF vShape0)
      (LiftTimesMaybe
         (NumelDimF batchDim)
         (LiftTimesMaybe
            (NumelDimF keySeqDim)
            (LiftTimesMaybe
               (NumelDimF headDim)
               (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
      vShape0
      ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
 -&gt; IxState
      vGeneratorOutput
      vGeneratorOutput
      (Tensor
         weightsRequiresGradient
         vLayout
         vDevice
         vDataType
         (ReshapeImplF
            (NumelF vShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            vShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; (Tensor
      weightsRequiresGradient vLayout vDevice vDataType vShape0
    -&gt; Tensor
         weightsRequiresGradient
         vLayout
         vDevice
         vDataType
         (ReshapeImplF
            (NumelF vShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            vShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])
-&gt; Tensor weightsRequiresGradient vLayout vDevice vDataType vShape0
-&gt; Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (ReshapeImplF
        (NumelF vShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        vShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape'' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'' ~ ReshapeF shape shape') =&gt;
SShape shape'
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape''
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sReshape"><span class="hs-identifier hs-var">sReshape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList '[batchDim, keySeqDim, headDim, headEmbedDim]
-&gt; SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList '[batchDim, keySeqDim, headDim, headEmbedDim]
 -&gt; SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
-&gt; SList '[batchDim, keySeqDim, headDim, headEmbedDim]
-&gt; SShape ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
</span><a href="#local-6989586621679751760"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
-&gt; SList '[keySeqDim, headDim, headEmbedDim]
-&gt; SList '[batchDim, keySeqDim, headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim keySeqDim
</span><a href="#local-6989586621679751753"><span class="hs-identifier hs-var">keySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim keySeqDim
-&gt; SList '[headDim, headEmbedDim]
-&gt; SList '[keySeqDim, headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679751773"><span class="hs-identifier hs-var">mhaHeadDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
-&gt; SList '[headEmbedDim] -&gt; SList '[headDim, headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679751772"><span class="hs-identifier hs-var">mhaHeadEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim -&gt; SList '[] -&gt; SList '[headEmbedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>              </span><span class="annot"><span class="annottext">IxState
  weightsGeneratorOutput
  vGeneratorOutput
  (Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (ReshapeImplF
        (NumelF vShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        vShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; (Tensor
      weightsRequiresGradient
      vLayout
      vDevice
      vDataType
      (ReshapeImplF
         (NumelF vShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF keySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         vShape0
         ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
    -&gt; IxState
         vGeneratorOutput
         vGeneratorOutput
         (Tensor
            weightsRequiresGradient
            vLayout
            vDevice
            vDataType
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF vShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  vShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     weightsGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  weightsRequiresGradient
  vLayout
  vDevice
  vDataType
  (TransposeF
     ('SelectDim ('ByIndex 1))
     ('SelectDim ('ByIndex 2))
     (ReshapeImplF
        (NumelF vShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        vShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   weightsRequiresGradient
   vLayout
   vDevice
   vDataType
   (TransposeF
      ('SelectDim ('ByIndex 1))
      ('SelectDim ('ByIndex 2))
      (ReshapeImplF
         (NumelF vShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF keySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         vShape0
         ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
 -&gt; IxState
      vGeneratorOutput
      vGeneratorOutput
      (Tensor
         weightsRequiresGradient
         vLayout
         vDevice
         vDataType
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; (Tensor
      weightsRequiresGradient
      vLayout
      vDevice
      vDataType
      (ReshapeImplF
         (NumelF vShape0)
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF keySeqDim)
               (LiftTimesMaybe
                  (NumelDimF headDim)
                  (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
         vShape0
         ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
    -&gt; Tensor
         weightsRequiresGradient
         vLayout
         vDevice
         vDataType
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (ReshapeImplF
        (NumelF vShape0)
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF keySeqDim)
              (LiftTimesMaybe
                 (NumelDimF headDim)
                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
        vShape0
        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'
 ~ TransposeF
     ('SelectDim ('ByIndex 1)) ('SelectDim ('ByIndex 2)) shape,
 SingI ('SelectDim ('ByIndex 1)),
 SingI ('SelectDim ('ByIndex 2))) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
forall (selectDim0 :: SelectDim (By Symbol Nat))
       (selectDim1 :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape' ~ TransposeF selectDim0 selectDim1 shape, SingI selectDim0,
 SingI selectDim1) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#transpose"><span class="hs-identifier hs-var">transpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-672"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tensor
  weightsRequiresGradient
  weightsLayout
  weightsDevice
  weightsDataType
  weightsShape
-&gt; Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (MatmulF
        weightsShape
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (layout' :: Layout LayoutType)
       (device :: Device (DeviceType Nat))
       (device' :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (dataType' :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout' device' dataType' shape'
-&gt; Tensor
     gradient
     (layout &lt;+&gt; layout')
     (device &lt;+&gt; device')
     (dataType &lt;+&gt; dataType')
     (MatmulF shape shape')
</span><a href="Torch.GraduallyTyped.Tensor.MathOperations.BlasLapack.html#matmul"><span class="hs-identifier hs-var">matmul</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   weightsRequiresGradient
   weightsLayout
   weightsDevice
   weightsDataType
   weightsShape
 -&gt; Tensor
      weightsRequiresGradient
      vLayout
      vDevice
      vDataType
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (ReshapeImplF
            (NumelF vShape0)
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF keySeqDim)
                  (LiftTimesMaybe
                     (NumelDimF headDim)
                     (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
            vShape0
            ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
 -&gt; Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (MatmulF
         weightsShape
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     generator
     weightsGeneratorOutput
     (Tensor
        weightsRequiresGradient
        weightsLayout
        weightsDevice
        weightsDataType
        weightsShape)
-&gt; IxState
     generator
     weightsGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
      -&gt; Tensor
           weightsRequiresGradient
           (Unify (Layout LayoutType) weightsLayout vLayout)
           (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
           (Unify (DataType DType) weightsDataType vDataType)
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall k1 k2 (f :: k1 -&gt; k2 -&gt; Type -&gt; Type) a b (j :: k1)
       (k3 :: k2).
IxFunctor f =&gt;
(a -&gt; b) -&gt; f j k3 a -&gt; f j k3 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  generator
  weightsGeneratorOutput
  (Tensor
     weightsRequiresGradient
     weightsLayout
     weightsDevice
     weightsDataType
     weightsShape)
</span><a href="#local-6989586621679751742"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  generator
  weightsGeneratorOutput
  (Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))
   -&gt; Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (MatmulF
           weightsShape
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF vShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 vShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     weightsGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        vLayout
        vDevice
        vDataType
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; IxState
     generator
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (MatmulF
           weightsShape
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF vShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 vShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
forall k1 (f :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a b
       (k2 :: k1).
IxApplicative f =&gt;
f i j (a -&gt; b) -&gt; f j k2 a -&gt; f i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxState
  weightsGeneratorOutput
  vGeneratorOutput
  (Tensor
     weightsRequiresGradient
     vLayout
     vDevice
     vDataType
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (ReshapeImplF
           (NumelF vShape0)
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF keySeqDim)
                 (LiftTimesMaybe
                    (NumelDimF headDim)
                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
           vShape0
           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
</span><a href="#local-6989586621679751740"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-673"></span><span>            </span><span class="annot"><span class="annottext">IxState
  generator
  vGeneratorOutput
  (Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (MatmulF
        weightsShape
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; (Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (MatmulF
         weightsShape
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
    -&gt; IxState
         vGeneratorOutput
         vGeneratorOutput
         (Tensor
            weightsRequiresGradient
            (Unify (Layout LayoutType) weightsLayout vLayout)
            (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
            (Unify (DataType DType) weightsDataType vDataType)
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (MatmulF
                  weightsShape
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF vShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        vShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))))
-&gt; IxState
     generator
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  weightsRequiresGradient
  (Unify (Layout LayoutType) weightsLayout vLayout)
  (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
  (Unify (DataType DType) weightsDataType vDataType)
  (TransposeF
     ('SelectDim ('ByIndex 1))
     ('SelectDim ('ByIndex 2))
     (MatmulF
        weightsShape
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   weightsRequiresGradient
   (Unify (Layout LayoutType) weightsLayout vLayout)
   (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
   (Unify (DataType DType) weightsDataType vDataType)
   (TransposeF
      ('SelectDim ('ByIndex 1))
      ('SelectDim ('ByIndex 2))
      (MatmulF
         weightsShape
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
 -&gt; IxState
      vGeneratorOutput
      vGeneratorOutput
      (Tensor
         weightsRequiresGradient
         (Unify (Layout LayoutType) weightsLayout vLayout)
         (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
         (Unify (DataType DType) weightsDataType vDataType)
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (MatmulF
               weightsShape
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF vShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     vShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))))
-&gt; (Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (MatmulF
         weightsShape
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (ReshapeImplF
               (NumelF vShape0)
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF keySeqDim)
                     (LiftTimesMaybe
                        (NumelDimF headDim)
                        (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
               vShape0
               ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
    -&gt; Tensor
         weightsRequiresGradient
         (Unify (Layout LayoutType) weightsLayout vLayout)
         (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
         (Unify (DataType DType) weightsDataType vDataType)
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (MatmulF
               weightsShape
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF vShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     vShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (MatmulF
        weightsShape
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (ReshapeImplF
              (NumelF vShape0)
              (LiftTimesMaybe
                 (NumelDimF batchDim)
                 (LiftTimesMaybe
                    (NumelDimF keySeqDim)
                    (LiftTimesMaybe
                       (NumelDimF headDim)
                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
              vShape0
              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'
 ~ TransposeF
     ('SelectDim ('ByIndex 1)) ('SelectDim ('ByIndex 2)) shape,
 SingI ('SelectDim ('ByIndex 1)),
 SingI ('SelectDim ('ByIndex 2))) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
forall (selectDim0 :: SelectDim (By Symbol Nat))
       (selectDim1 :: SelectDim (By Symbol Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape' ~ TransposeF selectDim0 selectDim1 shape, SingI selectDim0,
 SingI selectDim1) =&gt;
Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape'
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#transpose"><span class="hs-identifier hs-var">transpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SelectDim"><span class="hs-identifier hs-type">SelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#ByIndex"><span class="hs-identifier hs-type">ByIndex</span></a></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>            </span><span class="annot"><span class="annottext">IxState
  generator
  vGeneratorOutput
  (Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (MatmulF
           weightsShape
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF vShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 vShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
-&gt; (Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (MatmulF
            weightsShape
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF vShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  vShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
    -&gt; IxState
         vGeneratorOutput
         vGeneratorOutput
         (Tensor
            weightsRequiresGradient
            (Unify (Layout LayoutType) weightsLayout vLayout)
            (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
            (Unify (DataType DType) weightsDataType vDataType)
            (ReshapeImplF
               (NumelF
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (MatmulF
                        weightsShape
                        (TransposeF
                           ('SelectDim ('ByIndex 1))
                           ('SelectDim ('ByIndex 2))
                           (ReshapeImplF
                              (NumelF vShape0)
                              (LiftTimesMaybe
                                 (NumelDimF batchDim)
                                 (LiftTimesMaybe
                                    (NumelDimF keySeqDim)
                                    (LiftTimesMaybe
                                       (NumelDimF headDim)
                                       (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                              vShape0
                              ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
               (LiftTimesMaybe
                  (NumelDimF batchDim)
                  (LiftTimesMaybe
                     (NumelDimF querySeqDim)
                     (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (MatmulF
                     weightsShape
                     (TransposeF
                        ('SelectDim ('ByIndex 1))
                        ('SelectDim ('ByIndex 2))
                        (ReshapeImplF
                           (NumelF vShape0)
                           (LiftTimesMaybe
                              (NumelDimF batchDim)
                              (LiftTimesMaybe
                                 (NumelDimF keySeqDim)
                                 (LiftTimesMaybe
                                    (NumelDimF headDim)
                                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                           vShape0
                           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
               ('Shape '[batchDim, querySeqDim, embedDim]))))
-&gt; IxState
     generator
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (ReshapeImplF
           (NumelF
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (MatmulF
                    weightsShape
                    (TransposeF
                       ('SelectDim ('ByIndex 1))
                       ('SelectDim ('ByIndex 2))
                       (ReshapeImplF
                          (NumelF vShape0)
                          (LiftTimesMaybe
                             (NumelDimF batchDim)
                             (LiftTimesMaybe
                                (NumelDimF keySeqDim)
                                (LiftTimesMaybe
                                   (NumelDimF headDim)
                                   (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                          vShape0
                          ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF querySeqDim)
                 (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           ('Shape '[batchDim, querySeqDim, embedDim])))
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  weightsRequiresGradient
  (Unify (Layout LayoutType) weightsLayout vLayout)
  (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
  (Unify (DataType DType) weightsDataType vDataType)
  (ReshapeImplF
     (NumelF
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
     (LiftTimesMaybe
        (NumelDimF batchDim)
        (LiftTimesMaybe
           (NumelDimF querySeqDim)
           (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (MatmulF
           weightsShape
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF vShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 vShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
     ('Shape '[batchDim, querySeqDim, embedDim]))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (ReshapeImplF
           (NumelF
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (MatmulF
                    weightsShape
                    (TransposeF
                       ('SelectDim ('ByIndex 1))
                       ('SelectDim ('ByIndex 2))
                       (ReshapeImplF
                          (NumelF vShape0)
                          (LiftTimesMaybe
                             (NumelDimF batchDim)
                             (LiftTimesMaybe
                                (NumelDimF keySeqDim)
                                (LiftTimesMaybe
                                   (NumelDimF headDim)
                                   (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                          vShape0
                          ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF querySeqDim)
                 (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           ('Shape '[batchDim, querySeqDim, embedDim])))
forall k (m :: k -&gt; k -&gt; Type -&gt; Type) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   weightsRequiresGradient
   (Unify (Layout LayoutType) weightsLayout vLayout)
   (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
   (Unify (DataType DType) weightsDataType vDataType)
   (ReshapeImplF
      (NumelF
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (MatmulF
               weightsShape
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF vShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     vShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
      (LiftTimesMaybe
         (NumelDimF batchDim)
         (LiftTimesMaybe
            (NumelDimF querySeqDim)
            (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (MatmulF
            weightsShape
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF vShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  vShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
      ('Shape '[batchDim, querySeqDim, embedDim]))
 -&gt; IxState
      vGeneratorOutput
      vGeneratorOutput
      (Tensor
         weightsRequiresGradient
         (Unify (Layout LayoutType) weightsLayout vLayout)
         (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
         (Unify (DataType DType) weightsDataType vDataType)
         (ReshapeImplF
            (NumelF
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (MatmulF
                     weightsShape
                     (TransposeF
                        ('SelectDim ('ByIndex 1))
                        ('SelectDim ('ByIndex 2))
                        (ReshapeImplF
                           (NumelF vShape0)
                           (LiftTimesMaybe
                              (NumelDimF batchDim)
                              (LiftTimesMaybe
                                 (NumelDimF keySeqDim)
                                 (LiftTimesMaybe
                                    (NumelDimF headDim)
                                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                           vShape0
                           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF querySeqDim)
                  (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (MatmulF
                  weightsShape
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF vShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        vShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
            ('Shape '[batchDim, querySeqDim, embedDim]))))
-&gt; (Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (TransposeF
         ('SelectDim ('ByIndex 1))
         ('SelectDim ('ByIndex 2))
         (MatmulF
            weightsShape
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (ReshapeImplF
                  (NumelF vShape0)
                  (LiftTimesMaybe
                     (NumelDimF batchDim)
                     (LiftTimesMaybe
                        (NumelDimF keySeqDim)
                        (LiftTimesMaybe
                           (NumelDimF headDim)
                           (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                  vShape0
                  ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
    -&gt; Tensor
         weightsRequiresGradient
         (Unify (Layout LayoutType) weightsLayout vLayout)
         (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
         (Unify (DataType DType) weightsDataType vDataType)
         (ReshapeImplF
            (NumelF
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (MatmulF
                     weightsShape
                     (TransposeF
                        ('SelectDim ('ByIndex 1))
                        ('SelectDim ('ByIndex 2))
                        (ReshapeImplF
                           (NumelF vShape0)
                           (LiftTimesMaybe
                              (NumelDimF batchDim)
                              (LiftTimesMaybe
                                 (NumelDimF keySeqDim)
                                 (LiftTimesMaybe
                                    (NumelDimF headDim)
                                    (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                           vShape0
                           ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
            (LiftTimesMaybe
               (NumelDimF batchDim)
               (LiftTimesMaybe
                  (NumelDimF querySeqDim)
                  (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (MatmulF
                  weightsShape
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF vShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        vShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
            ('Shape '[batchDim, querySeqDim, embedDim])))
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (MatmulF
           weightsShape
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF vShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 vShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; IxState
     vGeneratorOutput
     vGeneratorOutput
     (Tensor
        weightsRequiresGradient
        (Unify (Layout LayoutType) weightsLayout vLayout)
        (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
        (Unify (DataType DType) weightsDataType vDataType)
        (ReshapeImplF
           (NumelF
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (MatmulF
                    weightsShape
                    (TransposeF
                       ('SelectDim ('ByIndex 1))
                       ('SelectDim ('ByIndex 2))
                       (ReshapeImplF
                          (NumelF vShape0)
                          (LiftTimesMaybe
                             (NumelDimF batchDim)
                             (LiftTimesMaybe
                                (NumelDimF keySeqDim)
                                (LiftTimesMaybe
                                   (NumelDimF headDim)
                                   (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                          vShape0
                          ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
           (LiftTimesMaybe
              (NumelDimF batchDim)
              (LiftTimesMaybe
                 (NumelDimF querySeqDim)
                 (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
           ('Shape '[batchDim, querySeqDim, embedDim])))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SShape ('Shape '[batchDim, querySeqDim, embedDim])
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (TransposeF
        ('SelectDim ('ByIndex 1))
        ('SelectDim ('ByIndex 2))
        (MatmulF
           weightsShape
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (ReshapeImplF
                 (NumelF vShape0)
                 (LiftTimesMaybe
                    (NumelDimF batchDim)
                    (LiftTimesMaybe
                       (NumelDimF keySeqDim)
                       (LiftTimesMaybe
                          (NumelDimF headDim)
                          (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                 vShape0
                 ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (ReshapeImplF
        (NumelF
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        ('Shape '[batchDim, querySeqDim, embedDim]))
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (shape'' :: Shape [Dim (Name Symbol) (Size Nat)]).
(shape'' ~ ReshapeF shape shape') =&gt;
SShape shape'
-&gt; Tensor gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape''
</span><a href="Torch.GraduallyTyped.Tensor.IndexingSlicingJoining.html#sReshape"><span class="hs-identifier hs-var">sReshape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList '[batchDim, querySeqDim, embedDim]
-&gt; SShape ('Shape '[batchDim, querySeqDim, embedDim])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList '[batchDim, querySeqDim, embedDim]
 -&gt; SShape ('Shape '[batchDim, querySeqDim, embedDim]))
-&gt; SList '[batchDim, querySeqDim, embedDim]
-&gt; SShape ('Shape '[batchDim, querySeqDim, embedDim])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
</span><a href="#local-6989586621679751760"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim batchDim
-&gt; SList '[querySeqDim, embedDim]
-&gt; SList '[batchDim, querySeqDim, embedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim querySeqDim
</span><a href="#local-6989586621679751755"><span class="hs-identifier hs-var">querySeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim querySeqDim
-&gt; SList '[embedDim] -&gt; SList '[querySeqDim, embedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679751771"><span class="hs-identifier hs-var">mhaEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim -&gt; SList '[] -&gt; SList '[embedDim]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>            </span><span class="annot"><span class="annottext">IxState
  generator
  vGeneratorOutput
  (Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (ReshapeImplF
        (NumelF
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        ('Shape '[batchDim, querySeqDim, embedDim])))
-&gt; (Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (ReshapeImplF
         (NumelF
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (MatmulF
                  weightsShape
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF vShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        vShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF querySeqDim)
               (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (MatmulF
               weightsShape
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF vShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     vShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
         ('Shape '[batchDim, querySeqDim, embedDim]))
    -&gt; IxState vGeneratorOutput generatorOutput output)
-&gt; IxState generator generatorOutput output
forall k1 (m :: k1 -&gt; k1 -&gt; Type -&gt; Type) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(vGeneratorOutput -&gt; (output, generatorOutput))
-&gt; IxState vGeneratorOutput generatorOutput output
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((vGeneratorOutput -&gt; (output, generatorOutput))
 -&gt; IxState vGeneratorOutput generatorOutput output)
-&gt; (Tensor
      weightsRequiresGradient
      (Unify (Layout LayoutType) weightsLayout vLayout)
      (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
      (Unify (DataType DType) weightsDataType vDataType)
      (ReshapeImplF
         (NumelF
            (TransposeF
               ('SelectDim ('ByIndex 1))
               ('SelectDim ('ByIndex 2))
               (MatmulF
                  weightsShape
                  (TransposeF
                     ('SelectDim ('ByIndex 1))
                     ('SelectDim ('ByIndex 2))
                     (ReshapeImplF
                        (NumelF vShape0)
                        (LiftTimesMaybe
                           (NumelDimF batchDim)
                           (LiftTimesMaybe
                              (NumelDimF keySeqDim)
                              (LiftTimesMaybe
                                 (NumelDimF headDim)
                                 (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                        vShape0
                        ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
         (LiftTimesMaybe
            (NumelDimF batchDim)
            (LiftTimesMaybe
               (NumelDimF querySeqDim)
               (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
         (TransposeF
            ('SelectDim ('ByIndex 1))
            ('SelectDim ('ByIndex 2))
            (MatmulF
               weightsShape
               (TransposeF
                  ('SelectDim ('ByIndex 1))
                  ('SelectDim ('ByIndex 2))
                  (ReshapeImplF
                     (NumelF vShape0)
                     (LiftTimesMaybe
                        (NumelDimF batchDim)
                        (LiftTimesMaybe
                           (NumelDimF keySeqDim)
                           (LiftTimesMaybe
                              (NumelDimF headDim)
                              (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                     vShape0
                     ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
         ('Shape '[batchDim, querySeqDim, embedDim]))
    -&gt; vGeneratorOutput -&gt; (output, generatorOutput))
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (ReshapeImplF
        (NumelF
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        ('Shape '[batchDim, querySeqDim, embedDim]))
-&gt; IxState vGeneratorOutput generatorOutput output
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">outProj
-&gt; Tensor
     weightsRequiresGradient
     (Unify (Layout LayoutType) weightsLayout vLayout)
     (Unify (Device (DeviceType Nat)) weightsDevice vDevice)
     (Unify (DataType DType) weightsDataType vDataType)
     (ReshapeImplF
        (NumelF
           (TransposeF
              ('SelectDim ('ByIndex 1))
              ('SelectDim ('ByIndex 2))
              (MatmulF
                 weightsShape
                 (TransposeF
                    ('SelectDim ('ByIndex 1))
                    ('SelectDim ('ByIndex 2))
                    (ReshapeImplF
                       (NumelF vShape0)
                       (LiftTimesMaybe
                          (NumelDimF batchDim)
                          (LiftTimesMaybe
                             (NumelDimF keySeqDim)
                             (LiftTimesMaybe
                                (NumelDimF headDim)
                                (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                       vShape0
                       ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim]))))))
        (LiftTimesMaybe
           (NumelDimF batchDim)
           (LiftTimesMaybe
              (NumelDimF querySeqDim)
              (LiftTimesMaybe (NumelDimF embedDim) ('Just 1))))
        (TransposeF
           ('SelectDim ('ByIndex 1))
           ('SelectDim ('ByIndex 2))
           (MatmulF
              weightsShape
              (TransposeF
                 ('SelectDim ('ByIndex 1))
                 ('SelectDim ('ByIndex 2))
                 (ReshapeImplF
                    (NumelF vShape0)
                    (LiftTimesMaybe
                       (NumelDimF batchDim)
                       (LiftTimesMaybe
                          (NumelDimF keySeqDim)
                          (LiftTimesMaybe
                             (NumelDimF headDim)
                             (LiftTimesMaybe (NumelDimF headEmbedDim) ('Just 1)))))
                    vShape0
                    ('Shape '[batchDim, keySeqDim, headDim, headEmbedDim])))))
        ('Shape '[batchDim, querySeqDim, embedDim]))
-&gt; vGeneratorOutput
-&gt; (output, generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">outProj
</span><a href="#local-6989586621679751767"><span class="hs-identifier hs-var">mhaOutProj</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span id="testMHA"><span class="annot"><span class="annottext">testMHA :: IO
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
</span><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#testMHA"><span class="hs-identifier hs-var hs-var">testMHA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751738"><span class="annot"><span class="annottext">gradient :: SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679751738"><span class="hs-identifier hs-var hs-var">gradient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
-&gt; SGradient ('Gradient 'WithGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithGradient"><span class="hs-identifier hs-var">SWithGradient</span></a></span><span>
</span><span id="line-679"></span><span>      </span><span id="local-6989586621679751735"><span class="annot"><span class="annottext">device :: SDevice ('Device 'CPU)
</span><a href="#local-6989586621679751735"><span class="hs-identifier hs-var hs-var">device</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span>
</span><span id="line-680"></span><span>      </span><span id="local-6989586621679751732"><span class="annot"><span class="annottext">dataType :: SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var hs-var">dataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDType 'Float -&gt; SDataType ('DataType 'Float)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Float
</span><a href="Torch.GraduallyTyped.DType.html#SFloat"><span class="hs-identifier hs-var">SFloat</span></a></span><span>
</span><span id="line-681"></span><span>      </span><span id="local-6989586621679751729"><span class="annot"><span class="annottext">headDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679751729"><span class="hs-identifier hs-var hs-var">headDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 8) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 8 =&gt; SSize ('Size 8)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-682"></span><span>      </span><span id="local-6989586621679751726"><span class="annot"><span class="annottext">headEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679751726"><span class="hs-identifier hs-var hs-var">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 64) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 64 =&gt; SSize ('Size 64)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-683"></span><span>      </span><span id="local-6989586621679751725"><span class="annot"><span class="annottext">embedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751725"><span class="hs-identifier hs-var hs-var">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-684"></span><span>      </span><span id="local-6989586621679751724"><span class="annot"><span class="annottext">queryEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751724"><span class="hs-identifier hs-var hs-var">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-685"></span><span>      </span><span id="local-6989586621679751723"><span class="annot"><span class="annottext">keyEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751723"><span class="hs-identifier hs-var hs-var">keyEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751724"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span>
</span><span id="line-686"></span><span>      </span><span id="local-6989586621679751722"><span class="annot"><span class="annottext">valueEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751722"><span class="hs-identifier hs-var hs-var">valueEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751724"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span>
</span><span id="line-687"></span><span>      </span><span id="local-6989586621679751721"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679751721"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0.0</span></span><span>
</span><span id="line-688"></span><span>  </span><span id="local-6989586621679751720"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679751720"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU) -&gt; Word64 -&gt; IO (Generator ('Device 'CPU))
forall (device :: Device (DeviceType Nat)).
SDevice device -&gt; Word64 -&gt; IO (Generator device)
</span><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier hs-var">sMkGenerator</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679751735"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679751719"><span class="annot"><span class="annottext">MultiHeadAttention
  'T5
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  Float
</span><a href="#local-6989586621679751719"><span class="hs-identifier hs-var">mha</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679751718"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679751718"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient ('Gradient 'WithGradient), SDevice ('Device 'CPU),
 SDataType ('DataType 'Float), SDim ('Dim ('Name &quot;*&quot;) ('Size 8)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 64)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)), Float)
-&gt; Generator ('Device 'CPU)
-&gt; (MultiHeadAttention
      'T5
      ('Gradient 'WithGradient)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Dim ('Name &quot;*&quot;) ('Size 8))
      ('Dim ('Name &quot;*&quot;) ('Size 64))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      Float,
    Generator ('Device 'CPU))
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679751738"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679751735"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679751729"><span class="hs-identifier hs-var">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679751726"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751725"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751724"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751723"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751722"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679751721"><span class="hs-identifier hs-var">dropoutP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679751720"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-690"></span><span>  </span><span id="local-6989586621679751717"><span class="annot"><span class="annottext">MultiHeadAttention
  'T5
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  Float
</span><a href="#local-6989586621679751717"><span class="hs-identifier hs-var">mha'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (MultiHeadAttention
      'T5
      ('Gradient 'WithGradient)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Dim ('Name &quot;*&quot;) ('Size 8))
      ('Dim ('Name &quot;*&quot;) ('Size 64))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      Float)
 -&gt; StateDict
 -&gt; IO
      (MultiHeadAttention
         'T5
         ('Gradient 'WithGradient)
         ('Device 'CPU)
         ('DataType 'Float)
         ('Dim ('Name &quot;*&quot;) ('Size 8))
         ('Dim ('Name &quot;*&quot;) ('Size 64))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         Float))
-&gt; StateDict
-&gt; StateT
     StateDict
     IO
     (MultiHeadAttention
        'T5
        ('Gradient 'WithGradient)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Dim ('Name &quot;*&quot;) ('Size 8))
        ('Dim ('Name &quot;*&quot;) ('Size 64))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        Float)
-&gt; IO
     (MultiHeadAttention
        'T5
        ('Gradient 'WithGradient)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Dim ('Name &quot;*&quot;) ('Size 8))
        ('Dim ('Name &quot;*&quot;) ('Size 64))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        Float)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT
  StateDict
  IO
  (MultiHeadAttention
     'T5
     ('Gradient 'WithGradient)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Dim ('Name &quot;*&quot;) ('Size 8))
     ('Dim ('Name &quot;*&quot;) ('Size 64))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     Float)
-&gt; StateDict
-&gt; IO
     (MultiHeadAttention
        'T5
        ('Gradient 'WithGradient)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Dim ('Name &quot;*&quot;) ('Size 8))
        ('Dim ('Name &quot;*&quot;) ('Size 64))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        Float)
forall (m :: Type -&gt; Type) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="annot"><span class="annottext">StateDict
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (MultiHeadAttention
      'T5
      ('Gradient 'WithGradient)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Dim ('Name &quot;*&quot;) ('Size 8))
      ('Dim ('Name &quot;*&quot;) ('Size 64))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      Float)
 -&gt; IO
      (MultiHeadAttention
         'T5
         ('Gradient 'WithGradient)
         ('Device 'CPU)
         ('DataType 'Float)
         ('Dim ('Name &quot;*&quot;) ('Size 8))
         ('Dim ('Name &quot;*&quot;) ('Size 64))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         ('Dim ('Name &quot;*&quot;) ('Size 512))
         Float))
-&gt; StateT
     StateDict
     IO
     (MultiHeadAttention
        'T5
        ('Gradient 'WithGradient)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Dim ('Name &quot;*&quot;) ('Size 8))
        ('Dim ('Name &quot;*&quot;) ('Size 64))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        Float)
-&gt; IO
     (MultiHeadAttention
        'T5
        ('Gradient 'WithGradient)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Dim ('Name &quot;*&quot;) ('Size 8))
        ('Dim ('Name &quot;*&quot;) ('Size 64))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        Float)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey
-&gt; MultiHeadAttention
     'T5
     ('Gradient 'WithGradient)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Dim ('Name &quot;*&quot;) ('Size 8))
     ('Dim ('Name &quot;*&quot;) ('Size 64))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     Float
-&gt; StateT StateDict IO ()
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;mha&quot;</span></span><span> </span><span class="annot"><span class="annottext">MultiHeadAttention
  'T5
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  Float
</span><a href="#local-6989586621679751719"><span class="hs-identifier hs-var">mha</span></a></span><span>
</span><span id="line-692"></span><span>    </span><span class="annot"><span class="annottext">(SGradient ('Gradient 'WithGradient), SDevice ('Device 'CPU),
 SDataType ('DataType 'Float), SDim ('Dim ('Name &quot;*&quot;) ('Size 8)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 64)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)), Float)
-&gt; StateDictKey
-&gt; StateT
     StateDict
     IO
     (MultiHeadAttention
        'T5
        ('Gradient 'WithGradient)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Dim ('Name &quot;*&quot;) ('Size 8))
        ('Dim ('Name &quot;*&quot;) ('Size 64))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        ('Dim ('Name &quot;*&quot;) ('Size 512))
        Float)
forall model input (m :: Type -&gt; Type).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.MultiHeadAttention.html#MultiHeadAttention"><span class="hs-identifier hs-type">MultiHeadAttention</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679751738"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679751735"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var">dataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679751729"><span class="hs-identifier hs-var">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679751726"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751725"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751724"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751723"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751722"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679751721"><span class="hs-identifier hs-var">dropoutP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;mha&quot;</span></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679751715"><span class="annot"><span class="annottext">batchDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679751715"><span class="hs-identifier hs-var hs-var">batchDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 3) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 3 =&gt; SSize ('Size 3)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-694"></span><span>      </span><span id="local-6989586621679751714"><span class="annot"><span class="annottext">seqDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
</span><a href="#local-6989586621679751714"><span class="hs-identifier hs-var hs-var">seqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 4) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 4 =&gt; SSize ('Size 4)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">4</span></span><span>
</span><span id="line-695"></span><span>      </span><span id="local-6989586621679751713"><span class="annot"><span class="annottext">sOnes' :: SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679751713"><span class="hs-identifier hs-var hs-var">sOnes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithoutGradient)
-&gt; SLayout ('Layout 'Dense)
-&gt; SDevice ('Device 'CPU)
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGradient gradient
-&gt; SLayout layout
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier hs-var">sOnes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
-&gt; SGradient ('Gradient 'WithoutGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithoutGradient"><span class="hs-identifier hs-var">SWithoutGradient</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SLayoutType 'Dense -&gt; SLayout ('Layout 'Dense)
forall (layoutType :: LayoutType).
SLayoutType layoutType -&gt; SLayout ('Layout layoutType)
</span><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier hs-var">SLayout</span></a></span><span> </span><span class="annot"><span class="annottext">SLayoutType 'Dense
</span><a href="Torch.GraduallyTyped.Layout.html#SDense"><span class="hs-identifier hs-var">SDense</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679751735"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-696"></span><span>      </span><span id="local-6989586621679751709"><span class="annot"><span class="annottext">query :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751709"><span class="hs-identifier hs-var hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679751713"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
     'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
      'Dim ('Name &quot;*&quot;) ('Size 512)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679751715"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
</span><a href="#local-6989586621679751714"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751724"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>      </span><span id="local-6989586621679751708"><span class="annot"><span class="annottext">key :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751708"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679751713"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
     'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
      'Dim ('Name &quot;*&quot;) ('Size 512)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679751715"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
</span><a href="#local-6989586621679751714"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751723"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>      </span><span id="local-6989586621679751707"><span class="annot"><span class="annottext">value :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751707"><span class="hs-identifier hs-var hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679751713"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
     'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
      'Dim ('Name &quot;*&quot;) ('Size 512)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679751715"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
</span><a href="#local-6989586621679751714"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679751722"><span class="hs-identifier hs-var">valueEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>      </span><span id="local-6989586621679751706"><span class="annot"><span class="annottext">attentionBias :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)])
</span><a href="#local-6989586621679751706"><span class="hs-identifier hs-var hs-var">attentionBias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679751713"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679751732"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
     'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
      'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679751715"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 4)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 4)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
</span><a href="#local-6989586621679751714"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 4)]
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
</span><a href="#local-6989586621679751714"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 4))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 4)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679751705"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751705"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiHeadAttention
  'T5
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  Float
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)]))
-&gt; Generator ('Device 'CPU)
-&gt; (Tensor
      ('Gradient 'WithGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Generator ('Device 'CPU))
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">MultiHeadAttention
  'T5
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  Float
</span><a href="#local-6989586621679751717"><span class="hs-identifier hs-var">mha'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751709"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751708"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751707"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 4), 'Dim ('Name &quot;*&quot;) ('Size 4)])
</span><a href="#local-6989586621679751706"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679751718"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-701"></span><span>  </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; IO
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
              'Dim ('Name &quot;*&quot;) ('Size 512)]))
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 4),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679751705"><span class="hs-identifier hs-var">output</span></a></span></pre></body></html>
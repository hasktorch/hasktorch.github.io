<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GBlock</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Control.Monad.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">ireturn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&gt;&gt;&gt;=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">Control.Monad.Indexed.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">IxStateT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">GHC.TypeLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Nat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier">Symbol</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DType"><span class="hs-identifier">DType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier">DataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier">SDataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html"><span class="hs-identifier">Torch.GraduallyTyped.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier">DeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier">SDevice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier">HasInitialize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier">ModelSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GCrossAttention.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GCrossAttention</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GCrossAttention.html#GCrossAttentionF"><span class="hs-identifier">GCrossAttentionF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GCrossAttention.html#crossAttentionSpec"><span class="hs-identifier">crossAttentionSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html#GTransformerFeedForwardNetworkF"><span class="hs-identifier">GTransformerFeedForwardNetworkF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html#transformerFeedForwardNetworkSpec"><span class="hs-identifier">transformerFeedForwardNetworkSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GSelfAttention</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html#GSelfAttentionF"><span class="hs-identifier">GSelfAttentionF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html#selfAttentionSpec"><span class="hs-identifier">selfAttentionSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier">STransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#HasDropout"><span class="hs-identifier">HasDropout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#SHasDropout"><span class="hs-identifier">SHasDropout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html"><span class="hs-identifier">Torch.GraduallyTyped.RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier">Gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier">RequiresGradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier">SGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier">SDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier">Size</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | Generic transformer encoder block consisting of self-attention, cross-attention, and a feed-forward network.</span><span>
</span><span id="line-35"></span><span class="hs-comment">--</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- - @selfAttention@ is a self-attention layer.</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- - @crossAttention@ is a cross-attention layer.</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- - @feedForwardNetwork@ is a feed-forward layer.</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- TODO: Some transformers use LayerDrop, see https://arxiv.org/abs/1909.11556, during training.</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- To support this, we will need a layer wrapper that is either the identity function or the wrapped layer</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- based on a uniformly random draw from a supplied generator.</span><span>
</span><span id="line-43"></span><span id="local-6989586621679716696"><span id="local-6989586621679716697"></span></span><span class="hs-keyword">data</span><span>
</span><span id="line-44"></span><span>  </span><span id="GTransformerBlock"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-var">GTransformerBlock</span></a></span></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679717070"><span class="annot"><a href="#local-6989586621679717070"><span class="hs-identifier hs-type">selfAttention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679717069"><span class="annot"><a href="#local-6989586621679717069"><span class="hs-identifier hs-type">crossAttention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679717068"><span class="annot"><a href="#local-6989586621679717068"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>  </span><span id="GTransformerBlock"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-var">GTransformerBlock</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679717083"><span class="annot"><a href="#local-6989586621679717083"><span class="hs-identifier hs-type">selfAttention</span></a></span></span><span> </span><span id="local-6989586621679717082"><span class="annot"><a href="#local-6989586621679717082"><span class="hs-identifier hs-type">crossAttention</span></a></span></span><span> </span><span id="local-6989586621679717081"><span class="annot"><a href="#local-6989586621679717081"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- | self-attention layer</span><span>
</span><span id="line-52"></span><span>      </span><span id="tbSelfAttention"><span class="annot"><span class="annottext">forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; selfAttention
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#tbSelfAttention"><span class="hs-identifier hs-var hs-var">tbSelfAttention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679717083"><span class="hs-identifier hs-type">selfAttention</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-comment">-- | cross-attention layer</span><span>
</span><span id="line-54"></span><span>      </span><span id="tbCrossAttention"><span class="annot"><span class="annottext">forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; crossAttention
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#tbCrossAttention"><span class="hs-identifier hs-var hs-var">tbCrossAttention</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679717082"><span class="hs-identifier hs-type">crossAttention</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>      </span><span class="hs-comment">-- | feed-forward network</span><span>
</span><span id="line-56"></span><span>      </span><span id="tbFeedForwardNetwork"><span class="annot"><span class="annottext">forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; feedForwardNetwork
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#tbFeedForwardNetwork"><span class="hs-identifier hs-var hs-var">tbFeedForwardNetwork</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679717081"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717083"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717082"><span class="hs-identifier hs-type">crossAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717081"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679716685"><span id="local-6989586621679716690"><span class="annot"><span class="annottext">GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall selfAttention crossAttention feedForwardNetwork.
(Eq selfAttention, Eq crossAttention, Eq feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
/= :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
$c/= :: forall selfAttention crossAttention feedForwardNetwork.
(Eq selfAttention, Eq crossAttention, Eq feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
== :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
$c== :: forall selfAttention crossAttention feedForwardNetwork.
(Eq selfAttention, Eq crossAttention, Eq feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716659"><span id="local-6989586621679716661"><span id="local-6989586621679716664"><span id="local-6989586621679716667"><span id="local-6989586621679716670"><span id="local-6989586621679716675"><span id="local-6989586621679716680"><span class="annot"><span class="annottext">GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Ordering
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall {selfAttention} {crossAttention} {feedForwardNetwork}.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
Eq
  (GTransformerBlock selfAttention crossAttention feedForwardNetwork)
forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Ordering
forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
min :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
$cmin :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
max :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
$cmax :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
&gt;= :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
$c&gt;= :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
&gt; :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
$c&gt; :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
&lt;= :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
$c&lt;= :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
&lt; :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
$c&lt; :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Bool
compare :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Ordering
$ccompare :: forall selfAttention crossAttention feedForwardNetwork.
(Ord selfAttention, Ord crossAttention, Ord feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; Ordering
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716647"><span id="local-6989586621679716649"><span id="local-6989586621679716656"><span class="annot"><span class="annottext">Int
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall selfAttention crossAttention feedForwardNetwork.
(Show selfAttention, Show crossAttention,
 Show feedForwardNetwork) =&gt;
Int
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; ShowS
forall selfAttention crossAttention feedForwardNetwork.
(Show selfAttention, Show crossAttention,
 Show feedForwardNetwork) =&gt;
[GTransformerBlock selfAttention crossAttention feedForwardNetwork]
-&gt; ShowS
forall selfAttention crossAttention feedForwardNetwork.
(Show selfAttention, Show crossAttention,
 Show feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; String
showList :: [GTransformerBlock selfAttention crossAttention feedForwardNetwork]
-&gt; ShowS
$cshowList :: forall selfAttention crossAttention feedForwardNetwork.
(Show selfAttention, Show crossAttention,
 Show feedForwardNetwork) =&gt;
[GTransformerBlock selfAttention crossAttention feedForwardNetwork]
-&gt; ShowS
show :: GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; String
$cshow :: forall selfAttention crossAttention feedForwardNetwork.
(Show selfAttention, Show crossAttention,
 Show feedForwardNetwork) =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; String
showsPrec :: Int
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; ShowS
$cshowsPrec :: forall selfAttention crossAttention feedForwardNetwork.
(Show selfAttention, Show crossAttention,
 Show feedForwardNetwork) =&gt;
Int
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
-&gt; ShowS
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall selfAttention crossAttention feedForwardNetwork x.
Rep
  (GTransformerBlock selfAttention crossAttention feedForwardNetwork)
  x
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
forall selfAttention crossAttention feedForwardNetwork x.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; Rep
     (GTransformerBlock selfAttention crossAttention feedForwardNetwork)
     x
$cto :: forall selfAttention crossAttention feedForwardNetwork x.
Rep
  (GTransformerBlock selfAttention crossAttention feedForwardNetwork)
  x
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
$cfrom :: forall selfAttention crossAttention feedForwardNetwork x.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; Rep
     (GTransformerBlock selfAttention crossAttention feedForwardNetwork)
     x
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-62"></span><span>  </span><span id="ModelSpec"><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-var">ModelSpec</span></a></span></span><span> </span><span id="local-6989586621679716640"><span id="local-6989586621679716641"><span id="local-6989586621679716642"><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716642"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716641"><span class="hs-identifier hs-type">crossAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716640"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716642"><span class="hs-identifier hs-type">selfAttention</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716641"><span class="hs-identifier hs-type">crossAttention</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716640"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-66"></span><span>  </span><span id="EncoderBlockF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockF"><span class="hs-identifier hs-var">EncoderBlockF</span></a></span></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716639"><span class="annot"><a href="#local-6989586621679716639"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716638"><span class="annot"><a href="#local-6989586621679716638"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716637"><span class="annot"><a href="#local-6989586621679716637"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716636"><span class="annot"><a href="#local-6989586621679716636"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DType"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716635"><span class="annot"><a href="#local-6989586621679716635"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716634"><span class="annot"><a href="#local-6989586621679716634"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716633"><span class="annot"><a href="#local-6989586621679716633"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716632"><span class="annot"><a href="#local-6989586621679716632"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716631"><span class="annot"><a href="#local-6989586621679716631"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716630"><span class="annot"><a href="#local-6989586621679716630"><span class="hs-identifier hs-type">hasDropout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#HasDropout"><span class="hs-identifier hs-type">HasDropout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-78"></span><span>  </span><span id="EncoderBlockF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockF"><span class="hs-identifier hs-var">EncoderBlockF</span></a></span></span><span> </span><span id="local-6989586621679716620"><span id="local-6989586621679716621"><span id="local-6989586621679716622"><span id="local-6989586621679716623"><span id="local-6989586621679716624"><span id="local-6989586621679716625"><span id="local-6989586621679716626"><span id="local-6989586621679716627"><span id="local-6989586621679716628"><span id="local-6989586621679716629"><span class="annot"><a href="#local-6989586621679716629"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716628"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716627"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716626"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716625"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716624"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716623"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716622"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716621"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716620"><span class="hs-identifier hs-type">hasDropout</span></a></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-type">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html#GSelfAttentionF"><span class="hs-identifier hs-type">GSelfAttentionF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716629"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716628"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716627"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716626"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716625"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716624"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716623"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716622"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716620"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-type">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html#GTransformerFeedForwardNetworkF"><span class="hs-identifier hs-type">GTransformerFeedForwardNetworkF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716629"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716628"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716627"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716626"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716622"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716621"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716620"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#encoderBlockSpec"><span class="hs-identifier hs-type">encoderBlockSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679717051"><span class="annot"><a href="#local-6989586621679717051"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679717049"><span class="annot"><a href="#local-6989586621679717049"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679717047"><span class="annot"><a href="#local-6989586621679717047"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679717045"><span class="annot"><a href="#local-6989586621679717045"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679717043"><span class="annot"><a href="#local-6989586621679717043"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679717041"><span class="annot"><a href="#local-6989586621679717041"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679717040"><span class="annot"><a href="#local-6989586621679717040"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679717039"><span class="annot"><a href="#local-6989586621679717039"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679717038"><span class="annot"><a href="#local-6989586621679717038"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679717037"><span class="annot"><a href="#local-6989586621679717037"><span class="hs-identifier hs-type">hasDropout</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier hs-type">STransformerStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717051"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717049"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717047"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717045"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717043"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717041"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717040"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717039"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717038"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#SHasDropout"><span class="hs-identifier hs-type">SHasDropout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717037"><span class="hs-identifier hs-type">hasDropout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockF"><span class="hs-identifier hs-type">EncoderBlockF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717051"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717049"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717047"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717045"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717043"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717041"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717040"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717039"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717038"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717037"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span id="encoderBlockSpec"><span class="annot"><span class="annottext">encoderBlockSpec :: forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (EncoderBlockF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        ffnDim
        hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#encoderBlockSpec"><span class="hs-identifier hs-var hs-var">encoderBlockSpec</span></a></span></span><span> </span><span id="local-6989586621679716618"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716618"><span class="hs-identifier hs-var">style</span></a></span></span><span> </span><span id="local-6989586621679716617"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716617"><span class="hs-identifier hs-var">gradient</span></a></span></span><span> </span><span id="local-6989586621679716616"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716616"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679716615"><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716615"><span class="hs-identifier hs-var">dataType</span></a></span></span><span> </span><span id="local-6989586621679716614"><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679716614"><span class="hs-identifier hs-var">headDim</span></a></span></span><span> </span><span id="local-6989586621679716613"><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679716613"><span class="hs-identifier hs-var">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716612"><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679716612"><span class="hs-identifier hs-var">embedDim</span></a></span></span><span> </span><span id="local-6989586621679716611"><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716611"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716610"><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679716610"><span class="hs-identifier hs-var">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679716609"><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716609"><span class="hs-identifier hs-var">hasDropout</span></a></span></span><span> </span><span id="local-6989586621679716608"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716608"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span> </span><span id="local-6989586621679716607"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716607"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716606"><span class="annot"><span class="annottext">saSpec :: STransformerStyle style
-&gt; NamedModel
     (GSelfAttention
        (ModelSpec
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              (ModelSpec (DropoutF style hasDropout))))
        (ModelSpec (SADropoutF style hasDropout))
        (ModelSpec
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716606"><span class="hs-identifier hs-var hs-var">saSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.0.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.0.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'ByT5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'MBART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span>
</span><span id="line-105"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;attention.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BERT
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;attention.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'RoBERTa
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621679716575"><span class="annot"><span class="annottext">caSpec :: p -&gt; ()
</span><a href="#local-6989586621679716575"><span class="hs-identifier hs-var hs-var">caSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>      </span><span id="local-6989586621679716574"><span class="annot"><span class="annottext">ffnSpec :: STransformerStyle style
-&gt; NamedModel
     (GTransformerFeedForwardNetwork
        (ModelSpec
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
        (ModelSpec
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNActivationF style))
        (ModelSpec (FFNActivationDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNOutputDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716574"><span class="hs-identifier hs-var hs-var">ffnSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.1.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.1.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'ByT5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'MBART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BERT
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'RoBERTa
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-117"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall selfAttention crossAttention feedForwardNetwork.
selfAttention
-&gt; crossAttention
-&gt; feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-var">GTransformerBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; NamedModel
     (GSelfAttention
        (ModelSpec
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              (ModelSpec (DropoutF style hasDropout))))
        (ModelSpec (SADropoutF style hasDropout))
        (ModelSpec
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716606"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716618"><span class="hs-identifier hs-var">style</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {p}. p -&gt; ()
</span><a href="#local-6989586621679716575"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716618"><span class="hs-identifier hs-var">style</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; NamedModel
     (GTransformerFeedForwardNetwork
        (ModelSpec
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
        (ModelSpec
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNActivationF style))
        (ModelSpec (FFNActivationDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNOutputDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716574"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716618"><span class="hs-identifier hs-var">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="#local-6989586621679716600"><span class="hs-identifier hs-type">saSpec'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679716600"><span class="annot"><span class="annottext">saSpec' :: STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716600"><span class="hs-identifier hs-var hs-var">saSpec'</span></a></span></span><span> </span><span id="local-6989586621679716555"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716555"><span class="hs-identifier hs-var">style'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GSelfAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html#selfAttentionSpec"><span class="hs-identifier hs-var">selfAttentionSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716555"><span class="hs-identifier hs-var">style'</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716617"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716616"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716615"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679716614"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679716613"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679716612"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716611"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716609"><span class="hs-identifier hs-var">hasDropout</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716608"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716607"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="#local-6989586621679716571"><span class="hs-identifier hs-type">ffnSpec'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679716571"><span class="annot"><span class="annottext">ffnSpec' :: STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var hs-var">ffnSpec'</span></a></span></span><span> </span><span id="local-6989586621679716554"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716554"><span class="hs-identifier hs-var">style'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerFeedForwardNetworkF
        style gradient device dataType queryEmbedDim ffnDim hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html#transformerFeedForwardNetworkSpec"><span class="hs-identifier hs-var">transformerFeedForwardNetworkSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716554"><span class="hs-identifier hs-var">style'</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716617"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716616"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716615"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716611"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679716610"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716609"><span class="hs-identifier hs-var">hasDropout</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716608"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716607"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-125"></span><span>  </span><span id="DecoderBlockF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockF"><span class="hs-identifier hs-var">DecoderBlockF</span></a></span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716553"><span class="annot"><a href="#local-6989586621679716553"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716552"><span class="annot"><a href="#local-6989586621679716552"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716551"><span class="annot"><a href="#local-6989586621679716551"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716550"><span class="annot"><a href="#local-6989586621679716550"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DType"><span class="hs-identifier hs-type">DType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716549"><span class="annot"><a href="#local-6989586621679716549"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716548"><span class="annot"><a href="#local-6989586621679716548"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716547"><span class="annot"><a href="#local-6989586621679716547"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716546"><span class="annot"><a href="#local-6989586621679716546"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716545"><span class="annot"><a href="#local-6989586621679716545"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716544"><span class="annot"><a href="#local-6989586621679716544"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679716543"><span class="annot"><a href="#local-6989586621679716543"><span class="hs-identifier hs-type">hasDropout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#HasDropout"><span class="hs-identifier hs-type">HasDropout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>  </span><span id="DecoderBlockF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockF"><span class="hs-identifier hs-var">DecoderBlockF</span></a></span></span><span> </span><span id="local-6989586621679716532"><span id="local-6989586621679716533"><span id="local-6989586621679716534"><span id="local-6989586621679716535"><span id="local-6989586621679716536"><span id="local-6989586621679716537"><span id="local-6989586621679716538"><span id="local-6989586621679716539"><span id="local-6989586621679716540"><span id="local-6989586621679716541"><span id="local-6989586621679716542"><span class="annot"><a href="#local-6989586621679716542"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716541"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716540"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716539"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716538"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716537"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716536"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716535"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716534"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716533"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716532"><span class="hs-identifier hs-type">hasDropout</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-type">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html#GSelfAttentionF"><span class="hs-identifier hs-type">GSelfAttentionF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716542"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716541"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716540"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716539"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716538"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716537"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716536"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716535"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716532"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-type">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GCrossAttention.html#GCrossAttentionF"><span class="hs-identifier hs-type">GCrossAttentionF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716542"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716541"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716540"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716539"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716538"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716537"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716536"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716535"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716534"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716532"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-type">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html#GTransformerFeedForwardNetworkF"><span class="hs-identifier hs-type">GTransformerFeedForwardNetworkF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716542"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716541"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716540"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716539"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716535"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716533"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716532"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#decoderBlockSpec"><span class="hs-identifier hs-type">decoderBlockSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679716954"><span class="annot"><a href="#local-6989586621679716954"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679716953"><span class="annot"><a href="#local-6989586621679716953"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679716952"><span class="annot"><a href="#local-6989586621679716952"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679716951"><span class="annot"><a href="#local-6989586621679716951"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679716950"><span class="annot"><a href="#local-6989586621679716950"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679716949"><span class="annot"><a href="#local-6989586621679716949"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716948"><span class="annot"><a href="#local-6989586621679716948"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679716947"><span class="annot"><a href="#local-6989586621679716947"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716946"><span class="annot"><a href="#local-6989586621679716946"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716945"><span class="annot"><a href="#local-6989586621679716945"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679716944"><span class="annot"><a href="#local-6989586621679716944"><span class="hs-identifier hs-type">hasDropout</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier hs-type">STransformerStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716954"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716953"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716952"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716951"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716950"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716949"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716948"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716947"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716946"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716945"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Type.html#SHasDropout"><span class="hs-identifier hs-type">SHasDropout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716944"><span class="hs-identifier hs-type">hasDropout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockF"><span class="hs-identifier hs-type">DecoderBlockF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716954"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716953"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716952"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716951"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716950"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716949"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716948"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716947"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716946"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716945"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716944"><span class="hs-identifier hs-type">hasDropout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span id="decoderBlockSpec"><span class="annot"><span class="annottext">decoderBlockSpec :: forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (keyEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim keyEmbedDim
-&gt; SDim ffnDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (DecoderBlockF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        ffnDim
        hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#decoderBlockSpec"><span class="hs-identifier hs-var hs-var">decoderBlockSpec</span></a></span></span><span> </span><span id="local-6989586621679716530"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716530"><span class="hs-identifier hs-var">style</span></a></span></span><span> </span><span id="local-6989586621679716529"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716529"><span class="hs-identifier hs-var">gradient</span></a></span></span><span> </span><span id="local-6989586621679716528"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716528"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679716527"><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716527"><span class="hs-identifier hs-var">dataType</span></a></span></span><span> </span><span id="local-6989586621679716526"><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679716526"><span class="hs-identifier hs-var">headDim</span></a></span></span><span> </span><span id="local-6989586621679716525"><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679716525"><span class="hs-identifier hs-var">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716524"><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679716524"><span class="hs-identifier hs-var">embedDim</span></a></span></span><span> </span><span id="local-6989586621679716523"><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716523"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716522"><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679716522"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679716521"><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679716521"><span class="hs-identifier hs-var">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679716520"><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716520"><span class="hs-identifier hs-var">hasDropout</span></a></span></span><span> </span><span id="local-6989586621679716519"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716519"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span> </span><span id="local-6989586621679716518"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716518"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716517"><span class="annot"><span class="annottext">saSpec :: STransformerStyle style
-&gt; NamedModel
     (GSelfAttention
        (ModelSpec
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              (ModelSpec (DropoutF style hasDropout))))
        (ModelSpec (SADropoutF style hasDropout))
        (ModelSpec
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716517"><span class="hs-identifier hs-var hs-var">saSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.0.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716514"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.0.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716514"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'ByT5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716514"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716514"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'MBART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716514"><span class="hs-identifier hs-var">saSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-169"></span><span>      </span><span id="local-6989586621679716496"><span class="annot"><span class="annottext">caSpec :: STransformerStyle style
-&gt; NamedModel
     (GCrossAttention
        (ModelSpec
           (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType keyEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType keyEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              (ModelSpec (DropoutF style hasDropout))))
        (ModelSpec (CADropoutF style hasDropout))
        (ModelSpec
           (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716496"><span class="hs-identifier hs-var hs-var">caSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.1.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GCrossAttention
     (ModelSpec
        (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (CADropoutF style hasDropout))
     (ModelSpec
        (CAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716493"><span class="hs-identifier hs-var">caSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.1.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GCrossAttention
     (ModelSpec
        (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (CADropoutF style hasDropout))
     (ModelSpec
        (CAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716493"><span class="hs-identifier hs-var">caSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'ByT5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GCrossAttention
     (ModelSpec
        (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (CADropoutF style hasDropout))
     (ModelSpec
        (CAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716493"><span class="hs-identifier hs-var">caSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GCrossAttention
     (ModelSpec
        (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (CADropoutF style hasDropout))
     (ModelSpec
        (CAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716493"><span class="hs-identifier hs-var">caSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'MBART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GCrossAttention
     (ModelSpec
        (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (CADropoutF style hasDropout))
     (ModelSpec
        (CAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716493"><span class="hs-identifier hs-var">caSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-176"></span><span>      </span><span class="annot"><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-177"></span><span>      </span><span id="local-6989586621679716475"><span class="annot"><span class="annottext">ffnSpec :: STransformerStyle style
-&gt; NamedModel
     (GTransformerFeedForwardNetwork
        (ModelSpec
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
        (ModelSpec
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNActivationF style))
        (ModelSpec (FFNActivationDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNOutputDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716475"><span class="hs-identifier hs-var hs-var">ffnSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.2.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716472"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;layer.2.&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716472"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'ByT5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SByT5"><span class="hs-identifier hs-var">SByT5</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716472"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'BART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBART"><span class="hs-identifier hs-var">SBART</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716472"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'MBART
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SMBART"><span class="hs-identifier hs-var">SMBART</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall model. Text -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall {style :: TransformerStyle}.
STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716472"><span class="hs-identifier hs-var">ffnSpec'</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'Pegasus
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SPegasus"><span class="hs-identifier hs-var">SPegasus</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SBERT"><span class="hs-identifier hs-var">SBERT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SRoBERTa"><span class="hs-identifier hs-var">SRoBERTa</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#SGPT2"><span class="hs-identifier hs-var">SGPT2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">undefined</span></a></span><span>
</span><span id="line-185"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall selfAttention crossAttention feedForwardNetwork.
selfAttention
-&gt; crossAttention
-&gt; feedForwardNetwork
-&gt; GTransformerBlock
     selfAttention crossAttention feedForwardNetwork
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-var">GTransformerBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; NamedModel
     (GSelfAttention
        (ModelSpec
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              (ModelSpec (DropoutF style hasDropout))))
        (ModelSpec (SADropoutF style hasDropout))
        (ModelSpec
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716517"><span class="hs-identifier hs-var">saSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716530"><span class="hs-identifier hs-var">style</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; NamedModel
     (GCrossAttention
        (ModelSpec
           (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType keyEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType keyEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              (ModelSpec (DropoutF style hasDropout))))
        (ModelSpec (CADropoutF style hasDropout))
        (ModelSpec
           (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">caSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716530"><span class="hs-identifier hs-var">style</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; NamedModel
     (GTransformerFeedForwardNetwork
        (ModelSpec
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
        (ModelSpec
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNActivationF style))
        (ModelSpec (FFNActivationDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNOutputDropoutF style hasDropout))
        (ModelSpec
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim)))
</span><a href="#local-6989586621679716475"><span class="hs-identifier hs-var">ffnSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716530"><span class="hs-identifier hs-var">style</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679716514"><span class="hs-identifier hs-type">saSpec'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679716514"><span class="annot"><span class="annottext">saSpec' :: STransformerStyle style
-&gt; GSelfAttention
     (ModelSpec
        (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (SADropoutF style hasDropout))
     (ModelSpec
        (SAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716514"><span class="hs-identifier hs-var hs-var">saSpec'</span></a></span></span><span> </span><span id="local-6989586621679716454"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716454"><span class="hs-identifier hs-var">style'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GSelfAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GSelfAttention.html#selfAttentionSpec"><span class="hs-identifier hs-var">selfAttentionSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716454"><span class="hs-identifier hs-var">style'</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716529"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716528"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716527"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679716526"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679716525"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679716524"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716523"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716520"><span class="hs-identifier hs-var">hasDropout</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716519"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716518"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="#local-6989586621679716493"><span class="hs-identifier hs-type">caSpec'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621679716493"><span class="annot"><span class="annottext">caSpec' :: STransformerStyle style
-&gt; GCrossAttention
     (ModelSpec
        (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
     (NamedModel
        (GMultiHeadAttention
           headDim
           headEmbedDim
           embedDim
           (ModelSpec
              (QInProjF style gradient device dataType queryEmbedDim embedDim))
           (ModelSpec
              (KInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (VInProjF style gradient device dataType keyEmbedDim embedDim))
           (ModelSpec
              (OutProjF style gradient device dataType embedDim queryEmbedDim))
           (ModelSpec (DropoutF style hasDropout))))
     (ModelSpec (CADropoutF style hasDropout))
     (ModelSpec
        (CAFinalLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716493"><span class="hs-identifier hs-var hs-var">caSpec'</span></a></span></span><span> </span><span id="local-6989586621679716453"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716453"><span class="hs-identifier hs-var">style'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (keyEmbedDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim keyEmbedDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GCrossAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim
        hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GCrossAttention.html#crossAttentionSpec"><span class="hs-identifier hs-var">crossAttentionSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716453"><span class="hs-identifier hs-var">style'</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716529"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716528"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716527"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679716526"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679716525"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679716524"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716523"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679716522"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716520"><span class="hs-identifier hs-var">hasDropout</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716519"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716518"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="#local-6989586621679716472"><span class="hs-identifier hs-type">ffnSpec'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679716472"><span class="annot"><span class="annottext">ffnSpec' :: STransformerStyle style
-&gt; GTransformerFeedForwardNetwork
     (ModelSpec
        (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
     (ModelSpec
        (FFNInputTransformationF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNActivationF style))
     (ModelSpec (FFNActivationDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputProjectionF
           style gradient device dataType queryEmbedDim ffnDim))
     (ModelSpec (FFNOutputDropoutF style hasDropout))
     (ModelSpec
        (FFNOutputLayerNormF style gradient device dataType queryEmbedDim))
</span><a href="#local-6989586621679716472"><span class="hs-identifier hs-var hs-var">ffnSpec'</span></a></span></span><span> </span><span id="local-6989586621679716452"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716452"><span class="hs-identifier hs-var">style'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (hasDropout :: HasDropout).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; SHasDropout hasDropout
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerFeedForwardNetworkF
        style gradient device dataType queryEmbedDim ffnDim hasDropout)
</span><a href="Torch.GraduallyTyped.NN.Transformer.GFeedForwardNetwork.html#transformerFeedForwardNetworkSpec"><span class="hs-identifier hs-var">transformerFeedForwardNetworkSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679716452"><span class="hs-identifier hs-var">style'</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679716529"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679716528"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679716527"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679716523"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679716521"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">SHasDropout hasDropout
</span><a href="#local-6989586621679716520"><span class="hs-identifier hs-var">hasDropout</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716519"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679716518"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621679716450"><span id="local-6989586621679716898"><span id="local-6989586621679716899"><span id="local-6989586621679716900"><span id="local-6989586621679716901"><span id="local-6989586621679716902"><span id="local-6989586621679716903"><span id="local-6989586621679716904"><span id="local-6989586621679716905"><span id="local-6989586621679716906"><span id="local-6989586621679716907"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716907"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716906"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716905"><span class="hs-identifier hs-type">selfAttention'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716904"><span class="hs-identifier hs-type">generatorDevice0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716903"><span class="hs-identifier hs-type">crossAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716904"><span class="hs-identifier hs-type">generatorDevice0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716902"><span class="hs-identifier hs-type">crossAttention'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716901"><span class="hs-identifier hs-type">generatorDevice1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716900"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716901"><span class="hs-identifier hs-type">generatorDevice1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716899"><span class="hs-identifier hs-type">feedForwardNetwork'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716898"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716907"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716903"><span class="hs-identifier hs-type">crossAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716900"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="#local-6989586621679716906"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716905"><span class="hs-identifier hs-type">selfAttention'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716902"><span class="hs-identifier hs-type">crossAttention'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716899"><span class="hs-identifier hs-type">feedForwardNetwork'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621679716898"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621679716445"><span id="local-6989586621679716447"><span id="local-6989586621679716892"><span id="local-6989586621679716893"><span id="local-6989586621679716894"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716894"><span class="hs-identifier hs-type">selfAttention</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716893"><span class="hs-identifier hs-type">crossAttention</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716892"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716894"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716893"><span class="hs-identifier hs-type">crossAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716892"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | 'HasForward' instance for 'GTransformerBlock' in an encoder configuration.</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-215"></span><span class="hs-comment">--      &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-216"></span><span class="hs-comment">--      &#9474; query &#9474;  &#9474; attentionBias &#9474;</span><span>
</span><span id="line-217"></span><span class="hs-comment">--      &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-218"></span><span class="hs-comment">--          &#9474;              &#9474;</span><span>
</span><span id="line-219"></span><span class="hs-comment">--          &#9660;              &#9474;</span><span>
</span><span id="line-220"></span><span class="hs-comment">--   tbSelfAttention&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-221"></span><span class="hs-comment">--          &#9660;</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- tbFeedForwardNetwork</span><span>
</span><span id="line-223"></span><span class="hs-comment">--          &#9474;</span><span>
</span><span id="line-224"></span><span class="hs-comment">--          &#9660;</span><span>
</span><span id="line-225"></span><span class="hs-comment">--      &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-226"></span><span class="hs-comment">--      &#9474; query &#9474;</span><span>
</span><span id="line-227"></span><span class="hs-comment">--      &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-229"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621679716867"><span id="local-6989586621679716868"><span id="local-6989586621679716869"><span id="local-6989586621679716870"><span id="local-6989586621679716871"><span id="local-6989586621679716872"><span id="local-6989586621679716873"><span id="local-6989586621679716874"><span id="local-6989586621679716875"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-231"></span><span>      </span><span class="annot"><a href="#local-6989586621679716875"><span class="hs-identifier hs-type">selfAttention</span></a></span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679716874"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716873"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><a href="#local-6989586621679716872"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><a href="#local-6989586621679716871"><span class="hs-identifier hs-type">tensor0</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><a href="#local-6989586621679716870"><span class="hs-identifier hs-type">generatorDevice0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><a href="#local-6989586621679716869"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><a href="#local-6989586621679716871"><span class="hs-identifier hs-type">tensor0</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><a href="#local-6989586621679716870"><span class="hs-identifier hs-type">generatorDevice0</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><a href="#local-6989586621679716868"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><a href="#local-6989586621679716867"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716875"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679716869"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679716874"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716873"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="#local-6989586621679716872"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="#local-6989586621679716868"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621679716867"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621679716426"><span class="annot"><span class="annottext">forward :: forall (m :: * -&gt; *).
MonadThrow m =&gt;
GTransformerBlock selfAttention () feedForwardNetwork
-&gt; (query, attentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679716422"><span id="local-6989586621679716423"><span id="local-6989586621679716424"><span class="annot"><span class="annottext">selfAttention
feedForwardNetwork
()
tbFeedForwardNetwork :: feedForwardNetwork
tbCrossAttention :: ()
tbSelfAttention :: selfAttention
tbFeedForwardNetwork :: forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; feedForwardNetwork
tbCrossAttention :: forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; crossAttention
tbSelfAttention :: forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; selfAttention
</span><a href="#local-6989586621679716422"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679716421"><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679716421"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716420"><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679716420"><span class="hs-identifier hs-var">attentionBias</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. IxStateT m i j a -&gt; i -&gt; m (a, j)
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">runIxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679716421"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679716420"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">forall {k1} (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">selfAttention
</span><a href="#local-6989586621679716424"><span class="hs-identifier hs-var">tbSelfAttention</span></a></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">forall {k1} (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">feedForwardNetwork
</span><a href="#local-6989586621679716422"><span class="hs-identifier hs-var">tbFeedForwardNetwork</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- | 'HasForward' instance for 'GTransformerBlock' in a decoder configuration.</span><span>
</span><span id="line-257"></span><span class="hs-comment">--</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- &#9474; decoderAttentionBias &#9474;  &#9474; query &#9474;  &#9474; key &#9474;  &#9474; crossAttentionBias &#9474;</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9516;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-262"></span><span class="hs-comment">--            &#9474;                  &#9474;         &#9474;               &#9474;</span><span>
</span><span id="line-263"></span><span class="hs-comment">--            &#9474;                  &#9660;         &#9474;               &#9474;</span><span>
</span><span id="line-264"></span><span class="hs-comment">--            &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9658;tdbSelfAttention &#9474;               &#9474;</span><span>
</span><span id="line-265"></span><span class="hs-comment">--                               &#9474;         &#9474;               &#9474;</span><span>
</span><span id="line-266"></span><span class="hs-comment">--                               &#9660;         &#9660;               &#9474;</span><span>
</span><span id="line-267"></span><span class="hs-comment">--                            tdbCrossAttention&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-268"></span><span class="hs-comment">--                               &#9474;</span><span>
</span><span id="line-269"></span><span class="hs-comment">--                               &#9660;</span><span>
</span><span id="line-270"></span><span class="hs-comment">--                     tdbFeedForwardNetwork</span><span>
</span><span id="line-271"></span><span class="hs-comment">--                               &#9474;</span><span>
</span><span id="line-272"></span><span class="hs-comment">--                               &#9660;</span><span>
</span><span id="line-273"></span><span class="hs-comment">--                           &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-274"></span><span class="hs-comment">--                           &#9474; query &#9474;</span><span>
</span><span id="line-275"></span><span class="hs-comment">--                           &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-277"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-278"></span><span>  </span><span id="local-6989586621679716810"><span id="local-6989586621679716811"><span id="local-6989586621679716812"><span id="local-6989586621679716813"><span id="local-6989586621679716814"><span id="local-6989586621679716815"><span id="local-6989586621679716816"><span id="local-6989586621679716817"><span id="local-6989586621679716818"><span id="local-6989586621679716819"><span id="local-6989586621679716820"><span id="local-6989586621679716821"><span id="local-6989586621679716822"><span id="local-6989586621679716823"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><a href="#local-6989586621679716823"><span class="hs-identifier hs-type">selfAttention</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679716822"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716821"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><a href="#local-6989586621679716820"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><a href="#local-6989586621679716819"><span class="hs-identifier hs-type">tensor0</span></a></span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><a href="#local-6989586621679716818"><span class="hs-identifier hs-type">generatorDevice0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><a href="#local-6989586621679716817"><span class="hs-identifier hs-type">crossAttention</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679716819"><span class="hs-identifier hs-type">tensor0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716816"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716815"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><a href="#local-6989586621679716818"><span class="hs-identifier hs-type">generatorDevice0</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><a href="#local-6989586621679716814"><span class="hs-identifier hs-type">tensor1</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><a href="#local-6989586621679716813"><span class="hs-identifier hs-type">generatorDevice1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-291"></span><span>      </span><span class="annot"><a href="#local-6989586621679716812"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><a href="#local-6989586621679716814"><span class="hs-identifier hs-type">tensor1</span></a></span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><a href="#local-6989586621679716813"><span class="hs-identifier hs-type">generatorDevice1</span></a></span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><a href="#local-6989586621679716811"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><a href="#local-6989586621679716810"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716823"><span class="hs-identifier hs-type">selfAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716817"><span class="hs-identifier hs-type">crossAttention</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716812"><span class="hs-identifier hs-type">feedForwardNetwork</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679716822"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716816"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716821"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679716815"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><a href="#local-6989586621679716820"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span class="annot"><a href="#local-6989586621679716811"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><a href="#local-6989586621679716810"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621679716399"><span class="annot"><span class="annottext">forward :: forall (m :: * -&gt; *).
MonadThrow m =&gt;
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; (query, key, attentionBias, crossAttentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679716399"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679716396"><span id="local-6989586621679716397"><span id="local-6989586621679716398"><span class="annot"><span class="annottext">selfAttention
crossAttention
feedForwardNetwork
tbFeedForwardNetwork :: feedForwardNetwork
tbCrossAttention :: crossAttention
tbSelfAttention :: selfAttention
tbFeedForwardNetwork :: forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; feedForwardNetwork
tbCrossAttention :: forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; crossAttention
tbSelfAttention :: forall selfAttention crossAttention feedForwardNetwork.
GTransformerBlock selfAttention crossAttention feedForwardNetwork
-&gt; selfAttention
</span><a href="#local-6989586621679716396"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679716395"><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679716395"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716394"><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621679716394"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716393"><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679716393"><span class="hs-identifier hs-var">attentionBias</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716392"><span class="annot"><span class="annottext">crossAttentionBias
</span><a href="#local-6989586621679716392"><span class="hs-identifier hs-var">crossAttentionBias</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. IxStateT m i j a -&gt; i -&gt; m (a, j)
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">runIxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><span class="annottext">forall {k} (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679716395"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679716393"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">forall {k1} (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">selfAttention
</span><a href="#local-6989586621679716398"><span class="hs-identifier hs-var">tbSelfAttention</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">forall {k1} (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679716391"><span class="annot"><span class="annottext">tensor0
</span><a href="#local-6989586621679716391"><span class="hs-identifier hs-var">query'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">crossAttention
</span><a href="#local-6989586621679716397"><span class="hs-identifier hs-var">tbCrossAttention</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tensor0
</span><a href="#local-6989586621679716391"><span class="hs-identifier hs-var">query'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621679716394"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">crossAttentionBias
</span><a href="#local-6989586621679716392"><span class="hs-identifier hs-var">crossAttentionBias</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">forall {k1} (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/63793hdp0xr2k87xmzbhjz0cpd7vssdh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) i j a. (i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/hlan16hghcygrr1n0fqljpsq2978pxwg-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/9z106fx3296sgdwa5s05xi381ayi6qfk-ghc-9.2.4-doc/share/doc/ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: * -&gt; *).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">feedForwardNetwork
</span><a href="#local-6989586621679716396"><span class="hs-identifier hs-var">tbFeedForwardNetwork</span></a></span><span>
</span><span id="line-310"></span></pre></body></html>
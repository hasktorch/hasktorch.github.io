<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE StandaloneKindSignatures #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE NoStarIsType #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# OPTIONS_GHC -v2 #-}</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GStack</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">Control.Monad.Indexed.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">IxStateT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evalStateT</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Data.Functor.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&lt;&lt;$&gt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons.Prelude.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SNil</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons.TypeLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SNat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier">Data.Vector</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier">Data.Vector.Generic.Sized.Internal</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VGS</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier">Data.Vector.Sized</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VS</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(+)</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDType"><span class="hs-identifier">SDType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier">SDataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html"><span class="hs-identifier">Torch.GraduallyTyped.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier">SDevice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDeviceType"><span class="hs-identifier">SDeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html"><span class="hs-identifier">Torch.GraduallyTyped.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier">SLayout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier">SLayout</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayoutType"><span class="hs-identifier">SLayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SDense"><span class="hs-identifier">SDense</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier">HasInitialize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier">ModelSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier">NamedModel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#VectorSpec"><span class="hs-identifier">VectorSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.GBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockCrossAttentionF"><span class="hs-identifier">DecoderBlockCrossAttentionF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockFeedForwardNetworkF"><span class="hs-identifier">DecoderBlockFeedForwardNetworkF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockSelfAttentionF"><span class="hs-identifier">DecoderBlockSelfAttentionF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockCrossAttentionF"><span class="hs-identifier">EncoderBlockCrossAttentionF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockFeedForwardNetworkF"><span class="hs-identifier">EncoderBlockFeedForwardNetworkF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockSelfAttentionF"><span class="hs-identifier">EncoderBlockSelfAttentionF</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier">GTransformerBlock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#decoderBlockSpec"><span class="hs-identifier">decoderBlockSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#encoderBlockSpec"><span class="hs-identifier">encoderBlockSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier">STransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier">ST5</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html"><span class="hs-identifier">Torch.GraduallyTyped.Random</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier">sMkGenerator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html"><span class="hs-identifier">Torch.GraduallyTyped.RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier">SGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SRequiresGradient"><span class="hs-identifier">SRequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier">SDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier">SName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier">SShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier">SShape</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier">SSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator">(:&amp;:)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator">(:|:)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Creation.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Creation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier">sOnes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#TensorSpec"><span class="hs-identifier">TensorSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#TensorSpec"><span class="hs-identifier">TensorSpec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Generic transformer stack.</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- - @stack@ is a stack of tranformer blocks.</span><span>
</span><span id="line-52"></span><span class="hs-keyword">newtype</span><span> </span><span id="GTransformerStack"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-var">GTransformerStack</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582403"><span class="annot"><a href="#local-6989586621679582403"><span class="hs-identifier hs-type">stack</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>  </span><span id="GTransformerStack"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-var">GTransformerStack</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679582653"><span class="annot"><a href="#local-6989586621679582653"><span class="hs-identifier hs-type">stack</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679582653"><span class="hs-identifier hs-type">stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582653"><span class="hs-identifier hs-type">stack</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-56"></span><span>  </span><span id="ModelSpec"><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-var">ModelSpec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span id="local-6989586621679582401"><span class="annot"><a href="#local-6989586621679582401"><span class="hs-identifier hs-type hs-type">stack</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582401"><span class="hs-identifier hs-type">stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Specifies the parameters of a transformer stack in an encoder configuration.</span><span>
</span><span id="line-60"></span><span class="hs-comment">--</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- - @style@: the style of the transformer stack, e.g. 'ST5', 'SByT5', etc.</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- - @gradient@: whether to compute the gradient of the stack's parameters.</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- - @device@: the computational device on which the stack is allocated.</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- - @dataType@: the data type of the stack's parameters.</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- - @headDim@: the dimension of all transformer heads in the stack.</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- - @headEmbedDim@: the dimension of the transformer head embeddings.</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- - @embedDim@: the dimension of the transformer embeddings.</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- - @queryEmbedDim@: the dimension of the transformer query embeddings.</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- - @ffnDim@: the dimension of the feed-forward network.</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- - @dropoutP@: the dropout rate.</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- - @eps@: the epsilon value for numerical stability of the layer normalization.</span><span>
</span><span id="line-72"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#encoderStackSpec"><span class="hs-identifier hs-type">encoderStackSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679582477"><span class="annot"><a href="#local-6989586621679582477"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679582476"><span class="annot"><a href="#local-6989586621679582476"><span class="hs-identifier hs-type">numLayers</span></a></span></span><span> </span><span id="local-6989586621679582475"><span class="annot"><a href="#local-6989586621679582475"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679582474"><span class="annot"><a href="#local-6989586621679582474"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679582473"><span class="annot"><a href="#local-6989586621679582473"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679582472"><span class="annot"><a href="#local-6989586621679582472"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679582471"><span class="annot"><a href="#local-6989586621679582471"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582470"><span class="annot"><a href="#local-6989586621679582470"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679582469"><span class="annot"><a href="#local-6989586621679582469"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582468"><span class="annot"><a href="#local-6989586621679582468"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier hs-type">STransformerStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582477"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SNat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582476"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582475"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582474"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582473"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582472"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582471"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582470"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582469"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582468"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span>
</span><span id="line-89"></span><span>            </span><span class="annot"><a href="#local-6989586621679582476"><span class="hs-identifier hs-type">numLayers</span></a></span><span>
</span><span id="line-90"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span>
</span><span id="line-91"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockSelfAttentionF"><span class="hs-identifier hs-type">EncoderBlockSelfAttentionF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582477"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582475"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582474"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582473"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582472"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582471"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582470"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582469"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>                </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockCrossAttentionF"><span class="hs-identifier hs-type">EncoderBlockCrossAttentionF</span></a></span><span>
</span><span id="line-93"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#EncoderBlockFeedForwardNetworkF"><span class="hs-identifier hs-type">EncoderBlockFeedForwardNetworkF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582477"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582475"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582474"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582473"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582469"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582468"><span class="hs-identifier hs-type">ffnDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span id="encoderStackSpec"><span class="annot"><span class="annottext">encoderStackSpec :: STransformerStyle style
-&gt; SNat numLayers
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerStack
        (Vector
           numLayers
           (GTransformerBlock
              (EncoderBlockSelfAttentionF
                 style
                 gradient
                 device
                 dataType
                 headDim
                 headEmbedDim
                 embedDim
                 queryEmbedDim)
              EncoderBlockCrossAttentionF
              (EncoderBlockFeedForwardNetworkF
                 style gradient device dataType queryEmbedDim ffnDim))))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#encoderStackSpec"><span class="hs-identifier hs-var hs-var">encoderStackSpec</span></a></span></span><span> </span><span id="local-6989586621679582399"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679582399"><span class="hs-identifier hs-var">style</span></a></span></span><span> </span><span id="local-6989586621679582398"><span class="annot"><span class="annottext">numLayers :: SNat numLayers
</span><a href="#local-6989586621679582398"><span class="hs-identifier hs-var">numLayers</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNat</span></a></span><span> </span><span id="local-6989586621679582396"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679582396"><span class="hs-identifier hs-var">gradient</span></a></span></span><span> </span><span id="local-6989586621679582395"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679582395"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679582394"><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679582394"><span class="hs-identifier hs-var">dataType</span></a></span></span><span> </span><span id="local-6989586621679582393"><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679582393"><span class="hs-identifier hs-var">headDim</span></a></span></span><span> </span><span id="local-6989586621679582392"><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679582392"><span class="hs-identifier hs-var">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582391"><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679582391"><span class="hs-identifier hs-var">embedDim</span></a></span></span><span> </span><span id="local-6989586621679582390"><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679582390"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582389"><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679582389"><span class="hs-identifier hs-var">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679582388"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582388"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span> </span><span id="local-6989586621679582387"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582387"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582386"><span class="annot"><span class="annottext">blockSpec :: ModelSpec
  (GTransformerBlock
     (EncoderBlockSelfAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim)
     EncoderBlockCrossAttentionF
     (EncoderBlockFeedForwardNetworkF
        style gradient device dataType queryEmbedDim ffnDim))
</span><a href="#local-6989586621679582386"><span class="hs-identifier hs-var hs-var">blockSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerBlock
        (EncoderBlockSelfAttentionF
           style
           gradient
           device
           dataType
           headDim
           headEmbedDim
           embedDim
           queryEmbedDim)
        EncoderBlockCrossAttentionF
        (EncoderBlockFeedForwardNetworkF
           style gradient device dataType queryEmbedDim ffnDim))
forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat)).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerBlock
        (EncoderBlockSelfAttentionF
           style
           gradient
           device
           dataType
           headDim
           headEmbedDim
           embedDim
           queryEmbedDim)
        EncoderBlockCrossAttentionF
        (EncoderBlockFeedForwardNetworkF
           style gradient device dataType queryEmbedDim ffnDim))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#encoderBlockSpec"><span class="hs-identifier hs-var">encoderBlockSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679582399"><span class="hs-identifier hs-var">style</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679582396"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679582395"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679582394"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679582393"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679582392"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679582391"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679582390"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679582389"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582388"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582387"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-99"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">VectorSpec
  numLayers
  (GTransformerBlock
     (NamedModel
        (GSelfAttention
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
           (NamedModel
              (GMultiHeadAttention
                 headDim
                 headEmbedDim
                 embedDim
                 (QInProjF style gradient device dataType queryEmbedDim embedDim)
                 (KInProjF style gradient device dataType queryEmbedDim embedDim)
                 (VInProjF style gradient device dataType queryEmbedDim embedDim)
                 (OutProjF style gradient device dataType embedDim queryEmbedDim)
                 Dropout))
           Dropout
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
     ()
     (NamedModel
        (GTransformerFeedForwardNetwork
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim)
           (FFNActivationF style)
           (FFNActivationDropoutF style)
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim)
           Dropout
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim))))
-&gt; GTransformerStack
     (VectorSpec
        numLayers
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType queryEmbedDim embedDim)
                       (VInProjF style gradient device dataType queryEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim)
                 (FFNActivationF style)
                 (FFNActivationDropoutF style)
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim)
                 Dropout
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
forall stack. stack -&gt; GTransformerStack stack
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-var">GTransformerStack</span></a></span><span> </span><span class="annot"><span class="annottext">(VectorSpec
   numLayers
   (GTransformerBlock
      (NamedModel
         (GSelfAttention
            (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
            (NamedModel
               (GMultiHeadAttention
                  headDim
                  headEmbedDim
                  embedDim
                  (QInProjF style gradient device dataType queryEmbedDim embedDim)
                  (KInProjF style gradient device dataType queryEmbedDim embedDim)
                  (VInProjF style gradient device dataType queryEmbedDim embedDim)
                  (OutProjF style gradient device dataType embedDim queryEmbedDim)
                  Dropout))
            Dropout
            (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
      ()
      (NamedModel
         (GTransformerFeedForwardNetwork
            (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
            (FFNInputTransformationF
               style gradient device dataType queryEmbedDim ffnDim)
            (FFNActivationF style)
            (FFNActivationDropoutF style)
            (FFNOutputProjectionF
               style gradient device dataType queryEmbedDim ffnDim)
            Dropout
            (FFNOutputLayerNormF
               style gradient device dataType queryEmbedDim))))
 -&gt; GTransformerStack
      (VectorSpec
         numLayers
         (GTransformerBlock
            (NamedModel
               (GSelfAttention
                  (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                  (NamedModel
                     (GMultiHeadAttention
                        headDim
                        headEmbedDim
                        embedDim
                        (QInProjF style gradient device dataType queryEmbedDim embedDim)
                        (KInProjF style gradient device dataType queryEmbedDim embedDim)
                        (VInProjF style gradient device dataType queryEmbedDim embedDim)
                        (OutProjF style gradient device dataType embedDim queryEmbedDim)
                        Dropout))
                  Dropout
                  (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
            ()
            (NamedModel
               (GTransformerFeedForwardNetwork
                  (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                  (FFNInputTransformationF
                     style gradient device dataType queryEmbedDim ffnDim)
                  (FFNActivationF style)
                  (FFNActivationDropoutF style)
                  (FFNOutputProjectionF
                     style gradient device dataType queryEmbedDim ffnDim)
                  Dropout
                  (FFNOutputLayerNormF
                     style gradient device dataType queryEmbedDim))))))
-&gt; VectorSpec
     numLayers
     (GTransformerBlock
        (NamedModel
           (GSelfAttention
              (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (QInProjF style gradient device dataType queryEmbedDim embedDim)
                    (KInProjF style gradient device dataType queryEmbedDim embedDim)
                    (VInProjF style gradient device dataType queryEmbedDim embedDim)
                    (OutProjF style gradient device dataType embedDim queryEmbedDim)
                    Dropout))
              Dropout
              (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
        ()
        (NamedModel
           (GTransformerFeedForwardNetwork
              (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
              (FFNInputTransformationF
                 style gradient device dataType queryEmbedDim ffnDim)
              (FFNActivationF style)
              (FFNActivationDropoutF style)
              (FFNOutputProjectionF
                 style gradient device dataType queryEmbedDim ffnDim)
              Dropout
              (FFNOutputLayerNormF
                 style gradient device dataType queryEmbedDim))))
-&gt; GTransformerStack
     (VectorSpec
        numLayers
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType queryEmbedDim embedDim)
                       (VInProjF style gradient device dataType queryEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim)
                 (FFNActivationF style)
                 (FFNActivationDropoutF style)
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim)
                 Dropout
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
-&gt; Vector
     numLayers
     (ModelSpec
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType queryEmbedDim embedDim)
                       (VInProjF style gradient device dataType queryEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim)
                 (FFNActivationF style)
                 (FFNActivationDropoutF style)
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim)
                 Dropout
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
-&gt; VectorSpec
     numLayers
     (GTransformerBlock
        (NamedModel
           (GSelfAttention
              (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (QInProjF style gradient device dataType queryEmbedDim embedDim)
                    (KInProjF style gradient device dataType queryEmbedDim embedDim)
                    (VInProjF style gradient device dataType queryEmbedDim embedDim)
                    (OutProjF style gradient device dataType embedDim queryEmbedDim)
                    Dropout))
              Dropout
              (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
        ()
        (NamedModel
           (GTransformerFeedForwardNetwork
              (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
              (FFNInputTransformationF
                 style gradient device dataType queryEmbedDim ffnDim)
              (FFNActivationF style)
              (FFNActivationDropoutF style)
              (FFNOutputProjectionF
                 style gradient device dataType queryEmbedDim ffnDim)
              Dropout
              (FFNOutputLayerNormF
                 style gradient device dataType queryEmbedDim))))
forall (n :: Nat) a.
SNat n -&gt; Vector n (ModelSpec a) -&gt; VectorSpec n a
</span><a href="Torch.GraduallyTyped.NN.Class.html#VectorSpec"><span class="hs-identifier hs-var">VectorSpec</span></a></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="#local-6989586621679582398"><span class="hs-identifier hs-var">numLayers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SNat numLayers
-&gt; GTransformerBlock
     (NamedModel
        (GSelfAttention
           (ModelSpec
              (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
           (NamedModel
              (GMultiHeadAttention
                 headDim
                 headEmbedDim
                 embedDim
                 (ModelSpec
                    (QInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (KInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (VInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (OutProjF style gradient device dataType embedDim queryEmbedDim))
                 Dropout))
           Dropout
           (ModelSpec
              (SAFinalLayerNormF style gradient device dataType queryEmbedDim))))
     ()
     (NamedModel
        (GTransformerFeedForwardNetwork
           (ModelSpec
              (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
           (ModelSpec
              (FFNInputTransformationF
                 style gradient device dataType queryEmbedDim ffnDim))
           (ModelSpec (FFNActivationF style))
           (ModelSpec (FFNActivationDropoutF style))
           (ModelSpec
              (FFNOutputProjectionF
                 style gradient device dataType queryEmbedDim ffnDim))
           Dropout
           (ModelSpec
              (FFNOutputLayerNormF
                 style gradient device dataType queryEmbedDim))))
-&gt; Vector
     numLayers
     (GTransformerBlock
        (NamedModel
           (GSelfAttention
              (ModelSpec
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (ModelSpec
                       (QInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (KInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (VInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (OutProjF style gradient device dataType embedDim queryEmbedDim))
                    Dropout))
              Dropout
              (ModelSpec
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim))))
        ()
        (NamedModel
           (GTransformerFeedForwardNetwork
              (ModelSpec
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
              (ModelSpec
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim))
              (ModelSpec (FFNActivationF style))
              (ModelSpec (FFNActivationDropoutF style))
              (ModelSpec
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim))
              Dropout
              (ModelSpec
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
forall (n :: Nat) a (p :: Nat -&gt; Type).
KnownNat n =&gt;
p n -&gt; a -&gt; Vector n a
</span><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-var">VS.replicate'</span></a></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="#local-6989586621679582398"><span class="hs-identifier hs-var">numLayers</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (GTransformerBlock
     (EncoderBlockSelfAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim)
     EncoderBlockCrossAttentionF
     (EncoderBlockFeedForwardNetworkF
        style gradient device dataType queryEmbedDim ffnDim))
GTransformerBlock
  (NamedModel
     (GSelfAttention
        (ModelSpec
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              Dropout))
        Dropout
        (ModelSpec
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim))))
  ()
  (NamedModel
     (GTransformerFeedForwardNetwork
        (ModelSpec
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
        (ModelSpec
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNActivationF style))
        (ModelSpec (FFNActivationDropoutF style))
        (ModelSpec
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim))
        Dropout
        (ModelSpec
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim))))
</span><a href="#local-6989586621679582386"><span class="hs-identifier hs-var">blockSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Specifies the parameters of a transformer stack in a decoder configuration.</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- - @style@: the style of the transformer stack, e.g. 'ST5', 'SByT5', etc.</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- - @gradient@: whether to compute the gradient of the stack's parameters.</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- - @device@: the computational device on which the stack is allocated.</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- - @dataType@: the data type of the stack's parameters.</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- - @headDim@: the dimension of all transformer heads in the stack.</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- - @headEmbedDim@: the dimension of the transformer head embeddings.</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- - @embedDim@: the dimension of the transformer embeddings.</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- - @queryEmbedDim@: the dimension of the transformer query embeddings.</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- - @keyEmbedDim@: the dimension of the transformer key embeddings.</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- - @ffnDim@: the dimension of the feed-forward network.</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- - @dropoutP@: the dropout rate.</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- - @eps@: the epsilon value for numerical stability of the layer normalization.</span><span>
</span><span id="line-115"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#decoderStackSpec"><span class="hs-identifier hs-type">decoderStackSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679582430"><span class="annot"><a href="#local-6989586621679582430"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679582429"><span class="annot"><a href="#local-6989586621679582429"><span class="hs-identifier hs-type">numLayers</span></a></span></span><span> </span><span id="local-6989586621679582428"><span class="annot"><a href="#local-6989586621679582428"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679582427"><span class="annot"><a href="#local-6989586621679582427"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679582426"><span class="annot"><a href="#local-6989586621679582426"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679582425"><span class="annot"><a href="#local-6989586621679582425"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679582424"><span class="annot"><a href="#local-6989586621679582424"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582423"><span class="annot"><a href="#local-6989586621679582423"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679582422"><span class="annot"><a href="#local-6989586621679582422"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582421"><span class="annot"><a href="#local-6989586621679582421"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582420"><span class="annot"><a href="#local-6989586621679582420"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#STransformerStyle"><span class="hs-identifier hs-type">STransformerStyle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582430"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SNat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582429"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582428"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582427"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582426"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582425"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582424"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582423"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582422"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582421"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582420"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#ModelSpec"><span class="hs-identifier hs-type">ModelSpec</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><a href="#local-6989586621679582429"><span class="hs-identifier hs-type">numLayers</span></a></span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#GTransformerBlock"><span class="hs-identifier hs-type">GTransformerBlock</span></a></span><span>
</span><span id="line-135"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockSelfAttentionF"><span class="hs-identifier hs-type">DecoderBlockSelfAttentionF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582430"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582428"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582427"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582426"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582425"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582424"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582423"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582422"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockCrossAttentionF"><span class="hs-identifier hs-type">DecoderBlockCrossAttentionF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582430"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582428"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582427"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582426"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582425"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582424"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582423"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582422"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582421"><span class="hs-identifier hs-type">keyEmbedDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#DecoderBlockFeedForwardNetworkF"><span class="hs-identifier hs-type">DecoderBlockFeedForwardNetworkF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582430"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582428"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582427"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582426"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582422"><span class="hs-identifier hs-type">queryEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582420"><span class="hs-identifier hs-type">ffnDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span id="decoderStackSpec"><span class="annot"><span class="annottext">decoderStackSpec :: STransformerStyle style
-&gt; SNat numLayers
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim keyEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerStack
        (Vector
           numLayers
           (GTransformerBlock
              (DecoderBlockSelfAttentionF
                 style
                 gradient
                 device
                 dataType
                 headDim
                 headEmbedDim
                 embedDim
                 queryEmbedDim)
              (DecoderBlockCrossAttentionF
                 style
                 gradient
                 device
                 dataType
                 headDim
                 headEmbedDim
                 embedDim
                 queryEmbedDim
                 keyEmbedDim)
              (DecoderBlockFeedForwardNetworkF
                 style gradient device dataType queryEmbedDim ffnDim))))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#decoderStackSpec"><span class="hs-identifier hs-var hs-var">decoderStackSpec</span></a></span></span><span> </span><span id="local-6989586621679582382"><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679582382"><span class="hs-identifier hs-var">style</span></a></span></span><span> </span><span id="local-6989586621679582381"><span class="annot"><span class="annottext">numLayers :: SNat numLayers
</span><a href="#local-6989586621679582381"><span class="hs-identifier hs-var">numLayers</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNat</span></a></span><span> </span><span id="local-6989586621679582380"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679582380"><span class="hs-identifier hs-var">gradient</span></a></span></span><span> </span><span id="local-6989586621679582379"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679582379"><span class="hs-identifier hs-var">device</span></a></span></span><span> </span><span id="local-6989586621679582378"><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679582378"><span class="hs-identifier hs-var">dataType</span></a></span></span><span> </span><span id="local-6989586621679582377"><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679582377"><span class="hs-identifier hs-var">headDim</span></a></span></span><span> </span><span id="local-6989586621679582376"><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679582376"><span class="hs-identifier hs-var">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582375"><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679582375"><span class="hs-identifier hs-var">embedDim</span></a></span></span><span> </span><span id="local-6989586621679582374"><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679582374"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582373"><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679582373"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679582372"><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679582372"><span class="hs-identifier hs-var">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679582371"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582371"><span class="hs-identifier hs-var">dropoutP</span></a></span></span><span> </span><span id="local-6989586621679582370"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582370"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582369"><span class="annot"><span class="annottext">blockSpec :: ModelSpec
  (GTransformerBlock
     (DecoderBlockSelfAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim)
     (DecoderBlockCrossAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim)
     (DecoderBlockFeedForwardNetworkF
        style gradient device dataType queryEmbedDim ffnDim))
</span><a href="#local-6989586621679582369"><span class="hs-identifier hs-var hs-var">blockSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim keyEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerBlock
        (DecoderBlockSelfAttentionF
           style
           gradient
           device
           dataType
           headDim
           headEmbedDim
           embedDim
           queryEmbedDim)
        (DecoderBlockCrossAttentionF
           style
           gradient
           device
           dataType
           headDim
           headEmbedDim
           embedDim
           queryEmbedDim
           keyEmbedDim)
        (DecoderBlockFeedForwardNetworkF
           style gradient device dataType queryEmbedDim ffnDim))
forall (style :: TransformerStyle)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (keyEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat)).
STransformerStyle style
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim keyEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerBlock
        (DecoderBlockSelfAttentionF
           style
           gradient
           device
           dataType
           headDim
           headEmbedDim
           embedDim
           queryEmbedDim)
        (DecoderBlockCrossAttentionF
           style
           gradient
           device
           dataType
           headDim
           headEmbedDim
           embedDim
           queryEmbedDim
           keyEmbedDim)
        (DecoderBlockFeedForwardNetworkF
           style gradient device dataType queryEmbedDim ffnDim))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GBlock.html#decoderBlockSpec"><span class="hs-identifier hs-var">decoderBlockSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle style
</span><a href="#local-6989586621679582382"><span class="hs-identifier hs-var">style</span></a></span><span> </span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679582380"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679582379"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType dataType
</span><a href="#local-6989586621679582378"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headDim
</span><a href="#local-6989586621679582377"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim headEmbedDim
</span><a href="#local-6989586621679582376"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim embedDim
</span><a href="#local-6989586621679582375"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim queryEmbedDim
</span><a href="#local-6989586621679582374"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim keyEmbedDim
</span><a href="#local-6989586621679582373"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ffnDim
</span><a href="#local-6989586621679582372"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582371"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582370"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-143"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">VectorSpec
  numLayers
  (GTransformerBlock
     (NamedModel
        (GSelfAttention
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
           (NamedModel
              (GMultiHeadAttention
                 headDim
                 headEmbedDim
                 embedDim
                 (QInProjF style gradient device dataType queryEmbedDim embedDim)
                 (KInProjF style gradient device dataType queryEmbedDim embedDim)
                 (VInProjF style gradient device dataType queryEmbedDim embedDim)
                 (OutProjF style gradient device dataType embedDim queryEmbedDim)
                 Dropout))
           Dropout
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
     (NamedModel
        (GCrossAttention
           (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
           (NamedModel
              (GMultiHeadAttention
                 headDim
                 headEmbedDim
                 embedDim
                 (QInProjF style gradient device dataType queryEmbedDim embedDim)
                 (KInProjF style gradient device dataType keyEmbedDim embedDim)
                 (VInProjF style gradient device dataType keyEmbedDim embedDim)
                 (OutProjF style gradient device dataType embedDim queryEmbedDim)
                 Dropout))
           Dropout
           (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
     (NamedModel
        (GTransformerFeedForwardNetwork
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim)
           (FFNActivationF style)
           (FFNActivationDropoutF style)
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim)
           Dropout
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim))))
-&gt; GTransformerStack
     (VectorSpec
        numLayers
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType queryEmbedDim embedDim)
                       (VInProjF style gradient device dataType queryEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           (NamedModel
              (GCrossAttention
                 (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType keyEmbedDim embedDim)
                       (VInProjF style gradient device dataType keyEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim)
                 (FFNActivationF style)
                 (FFNActivationDropoutF style)
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim)
                 Dropout
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
forall stack. stack -&gt; GTransformerStack stack
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-var">GTransformerStack</span></a></span><span> </span><span class="annot"><span class="annottext">(VectorSpec
   numLayers
   (GTransformerBlock
      (NamedModel
         (GSelfAttention
            (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
            (NamedModel
               (GMultiHeadAttention
                  headDim
                  headEmbedDim
                  embedDim
                  (QInProjF style gradient device dataType queryEmbedDim embedDim)
                  (KInProjF style gradient device dataType queryEmbedDim embedDim)
                  (VInProjF style gradient device dataType queryEmbedDim embedDim)
                  (OutProjF style gradient device dataType embedDim queryEmbedDim)
                  Dropout))
            Dropout
            (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
      (NamedModel
         (GCrossAttention
            (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
            (NamedModel
               (GMultiHeadAttention
                  headDim
                  headEmbedDim
                  embedDim
                  (QInProjF style gradient device dataType queryEmbedDim embedDim)
                  (KInProjF style gradient device dataType keyEmbedDim embedDim)
                  (VInProjF style gradient device dataType keyEmbedDim embedDim)
                  (OutProjF style gradient device dataType embedDim queryEmbedDim)
                  Dropout))
            Dropout
            (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
      (NamedModel
         (GTransformerFeedForwardNetwork
            (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
            (FFNInputTransformationF
               style gradient device dataType queryEmbedDim ffnDim)
            (FFNActivationF style)
            (FFNActivationDropoutF style)
            (FFNOutputProjectionF
               style gradient device dataType queryEmbedDim ffnDim)
            Dropout
            (FFNOutputLayerNormF
               style gradient device dataType queryEmbedDim))))
 -&gt; GTransformerStack
      (VectorSpec
         numLayers
         (GTransformerBlock
            (NamedModel
               (GSelfAttention
                  (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                  (NamedModel
                     (GMultiHeadAttention
                        headDim
                        headEmbedDim
                        embedDim
                        (QInProjF style gradient device dataType queryEmbedDim embedDim)
                        (KInProjF style gradient device dataType queryEmbedDim embedDim)
                        (VInProjF style gradient device dataType queryEmbedDim embedDim)
                        (OutProjF style gradient device dataType embedDim queryEmbedDim)
                        Dropout))
                  Dropout
                  (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
            (NamedModel
               (GCrossAttention
                  (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
                  (NamedModel
                     (GMultiHeadAttention
                        headDim
                        headEmbedDim
                        embedDim
                        (QInProjF style gradient device dataType queryEmbedDim embedDim)
                        (KInProjF style gradient device dataType keyEmbedDim embedDim)
                        (VInProjF style gradient device dataType keyEmbedDim embedDim)
                        (OutProjF style gradient device dataType embedDim queryEmbedDim)
                        Dropout))
                  Dropout
                  (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
            (NamedModel
               (GTransformerFeedForwardNetwork
                  (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                  (FFNInputTransformationF
                     style gradient device dataType queryEmbedDim ffnDim)
                  (FFNActivationF style)
                  (FFNActivationDropoutF style)
                  (FFNOutputProjectionF
                     style gradient device dataType queryEmbedDim ffnDim)
                  Dropout
                  (FFNOutputLayerNormF
                     style gradient device dataType queryEmbedDim))))))
-&gt; VectorSpec
     numLayers
     (GTransformerBlock
        (NamedModel
           (GSelfAttention
              (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (QInProjF style gradient device dataType queryEmbedDim embedDim)
                    (KInProjF style gradient device dataType queryEmbedDim embedDim)
                    (VInProjF style gradient device dataType queryEmbedDim embedDim)
                    (OutProjF style gradient device dataType embedDim queryEmbedDim)
                    Dropout))
              Dropout
              (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
        (NamedModel
           (GCrossAttention
              (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (QInProjF style gradient device dataType queryEmbedDim embedDim)
                    (KInProjF style gradient device dataType keyEmbedDim embedDim)
                    (VInProjF style gradient device dataType keyEmbedDim embedDim)
                    (OutProjF style gradient device dataType embedDim queryEmbedDim)
                    Dropout))
              Dropout
              (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
        (NamedModel
           (GTransformerFeedForwardNetwork
              (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
              (FFNInputTransformationF
                 style gradient device dataType queryEmbedDim ffnDim)
              (FFNActivationF style)
              (FFNActivationDropoutF style)
              (FFNOutputProjectionF
                 style gradient device dataType queryEmbedDim ffnDim)
              Dropout
              (FFNOutputLayerNormF
                 style gradient device dataType queryEmbedDim))))
-&gt; GTransformerStack
     (VectorSpec
        numLayers
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType queryEmbedDim embedDim)
                       (VInProjF style gradient device dataType queryEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           (NamedModel
              (GCrossAttention
                 (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType keyEmbedDim embedDim)
                       (VInProjF style gradient device dataType keyEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim)
                 (FFNActivationF style)
                 (FFNActivationDropoutF style)
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim)
                 Dropout
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
-&gt; Vector
     numLayers
     (ModelSpec
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType queryEmbedDim embedDim)
                       (VInProjF style gradient device dataType queryEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           (NamedModel
              (GCrossAttention
                 (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
                 (NamedModel
                    (GMultiHeadAttention
                       headDim
                       headEmbedDim
                       embedDim
                       (QInProjF style gradient device dataType queryEmbedDim embedDim)
                       (KInProjF style gradient device dataType keyEmbedDim embedDim)
                       (VInProjF style gradient device dataType keyEmbedDim embedDim)
                       (OutProjF style gradient device dataType embedDim queryEmbedDim)
                       Dropout))
                 Dropout
                 (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim)
                 (FFNActivationF style)
                 (FFNActivationDropoutF style)
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim)
                 Dropout
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
-&gt; VectorSpec
     numLayers
     (GTransformerBlock
        (NamedModel
           (GSelfAttention
              (SAInitialLayerNormF style gradient device dataType queryEmbedDim)
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (QInProjF style gradient device dataType queryEmbedDim embedDim)
                    (KInProjF style gradient device dataType queryEmbedDim embedDim)
                    (VInProjF style gradient device dataType queryEmbedDim embedDim)
                    (OutProjF style gradient device dataType embedDim queryEmbedDim)
                    Dropout))
              Dropout
              (SAFinalLayerNormF style gradient device dataType queryEmbedDim)))
        (NamedModel
           (GCrossAttention
              (CAInitialLayerNormF style gradient device dataType queryEmbedDim)
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (QInProjF style gradient device dataType queryEmbedDim embedDim)
                    (KInProjF style gradient device dataType keyEmbedDim embedDim)
                    (VInProjF style gradient device dataType keyEmbedDim embedDim)
                    (OutProjF style gradient device dataType embedDim queryEmbedDim)
                    Dropout))
              Dropout
              (CAFinalLayerNormF style gradient device dataType queryEmbedDim)))
        (NamedModel
           (GTransformerFeedForwardNetwork
              (FFNInputLayerNormF style gradient device dataType queryEmbedDim)
              (FFNInputTransformationF
                 style gradient device dataType queryEmbedDim ffnDim)
              (FFNActivationF style)
              (FFNActivationDropoutF style)
              (FFNOutputProjectionF
                 style gradient device dataType queryEmbedDim ffnDim)
              Dropout
              (FFNOutputLayerNormF
                 style gradient device dataType queryEmbedDim))))
forall (n :: Nat) a.
SNat n -&gt; Vector n (ModelSpec a) -&gt; VectorSpec n a
</span><a href="Torch.GraduallyTyped.NN.Class.html#VectorSpec"><span class="hs-identifier hs-var">VectorSpec</span></a></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="#local-6989586621679582381"><span class="hs-identifier hs-var">numLayers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SNat numLayers
-&gt; GTransformerBlock
     (NamedModel
        (GSelfAttention
           (ModelSpec
              (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
           (NamedModel
              (GMultiHeadAttention
                 headDim
                 headEmbedDim
                 embedDim
                 (ModelSpec
                    (QInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (KInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (VInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (OutProjF style gradient device dataType embedDim queryEmbedDim))
                 Dropout))
           Dropout
           (ModelSpec
              (SAFinalLayerNormF style gradient device dataType queryEmbedDim))))
     (NamedModel
        (GCrossAttention
           (ModelSpec
              (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
           (NamedModel
              (GMultiHeadAttention
                 headDim
                 headEmbedDim
                 embedDim
                 (ModelSpec
                    (QInProjF style gradient device dataType queryEmbedDim embedDim))
                 (ModelSpec
                    (KInProjF style gradient device dataType keyEmbedDim embedDim))
                 (ModelSpec
                    (VInProjF style gradient device dataType keyEmbedDim embedDim))
                 (ModelSpec
                    (OutProjF style gradient device dataType embedDim queryEmbedDim))
                 Dropout))
           Dropout
           (ModelSpec
              (CAFinalLayerNormF style gradient device dataType queryEmbedDim))))
     (NamedModel
        (GTransformerFeedForwardNetwork
           (ModelSpec
              (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
           (ModelSpec
              (FFNInputTransformationF
                 style gradient device dataType queryEmbedDim ffnDim))
           (ModelSpec (FFNActivationF style))
           (ModelSpec (FFNActivationDropoutF style))
           (ModelSpec
              (FFNOutputProjectionF
                 style gradient device dataType queryEmbedDim ffnDim))
           Dropout
           (ModelSpec
              (FFNOutputLayerNormF
                 style gradient device dataType queryEmbedDim))))
-&gt; Vector
     numLayers
     (GTransformerBlock
        (NamedModel
           (GSelfAttention
              (ModelSpec
                 (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (ModelSpec
                       (QInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (KInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (VInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (OutProjF style gradient device dataType embedDim queryEmbedDim))
                    Dropout))
              Dropout
              (ModelSpec
                 (SAFinalLayerNormF style gradient device dataType queryEmbedDim))))
        (NamedModel
           (GCrossAttention
              (ModelSpec
                 (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
              (NamedModel
                 (GMultiHeadAttention
                    headDim
                    headEmbedDim
                    embedDim
                    (ModelSpec
                       (QInProjF style gradient device dataType queryEmbedDim embedDim))
                    (ModelSpec
                       (KInProjF style gradient device dataType keyEmbedDim embedDim))
                    (ModelSpec
                       (VInProjF style gradient device dataType keyEmbedDim embedDim))
                    (ModelSpec
                       (OutProjF style gradient device dataType embedDim queryEmbedDim))
                    Dropout))
              Dropout
              (ModelSpec
                 (CAFinalLayerNormF style gradient device dataType queryEmbedDim))))
        (NamedModel
           (GTransformerFeedForwardNetwork
              (ModelSpec
                 (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
              (ModelSpec
                 (FFNInputTransformationF
                    style gradient device dataType queryEmbedDim ffnDim))
              (ModelSpec (FFNActivationF style))
              (ModelSpec (FFNActivationDropoutF style))
              (ModelSpec
                 (FFNOutputProjectionF
                    style gradient device dataType queryEmbedDim ffnDim))
              Dropout
              (ModelSpec
                 (FFNOutputLayerNormF
                    style gradient device dataType queryEmbedDim)))))
forall (n :: Nat) a (p :: Nat -&gt; Type).
KnownNat n =&gt;
p n -&gt; a -&gt; Vector n a
</span><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-var">VS.replicate'</span></a></span><span> </span><span class="annot"><span class="annottext">SNat numLayers
</span><a href="#local-6989586621679582381"><span class="hs-identifier hs-var">numLayers</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (GTransformerBlock
     (DecoderBlockSelfAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim)
     (DecoderBlockCrossAttentionF
        style
        gradient
        device
        dataType
        headDim
        headEmbedDim
        embedDim
        queryEmbedDim
        keyEmbedDim)
     (DecoderBlockFeedForwardNetworkF
        style gradient device dataType queryEmbedDim ffnDim))
GTransformerBlock
  (NamedModel
     (GSelfAttention
        (ModelSpec
           (SAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              Dropout))
        Dropout
        (ModelSpec
           (SAFinalLayerNormF style gradient device dataType queryEmbedDim))))
  (NamedModel
     (GCrossAttention
        (ModelSpec
           (CAInitialLayerNormF style gradient device dataType queryEmbedDim))
        (NamedModel
           (GMultiHeadAttention
              headDim
              headEmbedDim
              embedDim
              (ModelSpec
                 (QInProjF style gradient device dataType queryEmbedDim embedDim))
              (ModelSpec
                 (KInProjF style gradient device dataType keyEmbedDim embedDim))
              (ModelSpec
                 (VInProjF style gradient device dataType keyEmbedDim embedDim))
              (ModelSpec
                 (OutProjF style gradient device dataType embedDim queryEmbedDim))
              Dropout))
        Dropout
        (ModelSpec
           (CAFinalLayerNormF style gradient device dataType queryEmbedDim))))
  (NamedModel
     (GTransformerFeedForwardNetwork
        (ModelSpec
           (FFNInputLayerNormF style gradient device dataType queryEmbedDim))
        (ModelSpec
           (FFNInputTransformationF
              style gradient device dataType queryEmbedDim ffnDim))
        (ModelSpec (FFNActivationF style))
        (ModelSpec (FFNActivationDropoutF style))
        (ModelSpec
           (FFNOutputProjectionF
              style gradient device dataType queryEmbedDim ffnDim))
        Dropout
        (ModelSpec
           (FFNOutputLayerNormF
              style gradient device dataType queryEmbedDim))))
</span><a href="#local-6989586621679582369"><span class="hs-identifier hs-var">blockSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span id="local-6989586621679582365"><span id="local-6989586621679582366"><span id="local-6989586621679582367"><span id="local-6989586621679582368"><span class="hs-keyword">instance</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582368"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582367"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582368"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582367"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621679582366"><span class="hs-identifier hs-type">numLayers'</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582365"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier hs-type">HasInitialize</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582366"><span class="hs-identifier hs-type">numLayers'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582368"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="#local-6989586621679582367"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582366"><span class="hs-identifier hs-type">numLayers'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582368"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621679582367"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679582362"><span class="annot"><span class="annottext">initialize :: ModelSpec (GTransformerStack (Vector numLayers' block))
-&gt; Generator generatorDevice
-&gt; m (GTransformerStack (Vector numLayers' block),
      Generator generatorDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span id="local-6989586621679582360"><span class="annot"><a href="#local-6989586621679582360"><span class="hs-identifier hs-var">vSpec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582359"><span class="annot"><span class="annottext">v :: IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Vector numLayers' block)
</span><a href="#local-6989586621679582359"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Generator generatorDevice
 -&gt; m (Vector numLayers' block, Generator generatorDevice))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Vector numLayers' block)
forall (m :: Type -&gt; Type) i j a.
(i -&gt; m (a, j)) -&gt; IxStateT m i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxStateT</span></a></span><span> </span><span class="annot"><span class="annottext">((Generator generatorDevice
  -&gt; m (Vector numLayers' block, Generator generatorDevice))
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Vector numLayers' block))
-&gt; (VectorSpec numLayers' block
    -&gt; Generator generatorDevice
    -&gt; m (Vector numLayers' block, Generator generatorDevice))
-&gt; VectorSpec numLayers' block
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Vector numLayers' block)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VectorSpec numLayers' block
-&gt; Generator generatorDevice
-&gt; m (Vector numLayers' block, Generator generatorDevice)
forall model (generatorDevice :: Device (DeviceType Nat)) output
       (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasInitialize model generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
ModelSpec model
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="annot"><span class="annottext">(VectorSpec numLayers' block
 -&gt; IxStateT
      m
      (Generator generatorDevice)
      (Generator generatorDevice)
      (Vector numLayers' block))
-&gt; VectorSpec numLayers' block
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Vector numLayers' block)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VectorSpec numLayers' block
</span><a href="#local-6989586621679582360"><span class="hs-identifier hs-var">vSpec</span></a></span><span>
</span><span id="line-157"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (GTransformerStack (Vector numLayers' block))
-&gt; Generator generatorDevice
-&gt; m (GTransformerStack (Vector numLayers' block),
      Generator generatorDevice)
forall (m :: Type -&gt; Type) i j a. IxStateT m i j a -&gt; i -&gt; m (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxStateT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector numLayers' block
-&gt; GTransformerStack (Vector numLayers' block)
forall stack. stack -&gt; GTransformerStack stack
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-var">GTransformerStack</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector numLayers' block
 -&gt; GTransformerStack (Vector numLayers' block))
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (Vector numLayers' block)
-&gt; IxStateT
     m
     (Generator generatorDevice)
     (Generator generatorDevice)
     (GTransformerStack (Vector numLayers' block))
forall k1 k2 (f :: k1 -&gt; k2 -&gt; Type -&gt; Type) a b (j :: k1)
       (k3 :: k2).
IxFunctor f =&gt;
(a -&gt; b) -&gt; f j k3 a -&gt; f j k3 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IxStateT
  m
  (Generator generatorDevice)
  (Generator generatorDevice)
  (Vector numLayers' block)
</span><a href="#local-6989586621679582359"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621679582354"><span id="local-6989586621679582355"><span class="hs-keyword">instance</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582355"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582354"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582355"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621679582350"><span class="annot"><span class="annottext">fromStateDict :: ModelSpec (GTransformerStack (Vector numLayers block))
-&gt; StateDictKey -&gt; m (GTransformerStack (Vector numLayers block))
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromStateDict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span id="local-6989586621679582348"><span class="annot"><a href="#local-6989586621679582348"><span class="hs-identifier hs-var">vSpec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679582347"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679582347"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">Vector numLayers block
-&gt; GTransformerStack (Vector numLayers block)
forall stack. stack -&gt; GTransformerStack stack
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-var">GTransformerStack</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector numLayers block
 -&gt; GTransformerStack (Vector numLayers block))
-&gt; m (Vector numLayers block)
-&gt; m (GTransformerStack (Vector numLayers block))
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModelSpec (Vector numLayers block)
-&gt; StateDictKey -&gt; m (Vector numLayers block)
forall model (m :: Type -&gt; Type).
(HasStateDict model, MonadIO m, MonadThrow m,
 MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">VectorSpec numLayers block
ModelSpec (Vector numLayers block)
</span><a href="#local-6989586621679582348"><span class="hs-identifier hs-var">vSpec</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679582347"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679582345"><span class="annot"><span class="annottext">toStateDict :: StateDictKey -&gt; GTransformerStack (Vector numLayers block) -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">toStateDict</span></a></span></span><span> </span><span id="local-6989586621679582343"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679582343"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span id="local-6989586621679582342"><span class="annot"><span class="annottext">Vector numLayers block
</span><a href="#local-6989586621679582342"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey -&gt; Vector numLayers block -&gt; m ()
forall model (m :: Type -&gt; Type).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679582343"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Vector numLayers block
</span><a href="#local-6989586621679582342"><span class="hs-identifier hs-var">v</span></a></span></span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span id="local-6989586621679582338"><span id="local-6989586621679582339"><span id="local-6989586621679582340"><span id="local-6989586621679582341"><span class="hs-keyword">instance</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621679582341"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582340"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582339"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="#local-6989586621679582338"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="#local-6989586621679582340"><span class="hs-identifier hs-type">query</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><a href="#local-6989586621679582338"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621679582335"><span class="annot"><span class="annottext">forward :: GTransformerStack (Vector 0 block)
-&gt; (query, attentionBias)
-&gt; Generator generatorDevice
-&gt; m (query, Generator generatorDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="annot"><span class="annottext">GTransformerStack (Vector 0 block)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582333"><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582333"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(query, Generator generatorDevice)
-&gt; m (query, Generator generatorDevice)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((query, Generator generatorDevice)
 -&gt; m (query, Generator generatorDevice))
-&gt; (Generator generatorDevice
    -&gt; (query, Generator generatorDevice))
-&gt; Generator generatorDevice
-&gt; m (query, Generator generatorDevice)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582333"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="local-6989586621679582327"><span id="local-6989586621679582328"><span id="local-6989586621679582329"><span id="local-6989586621679582330"><span id="local-6989586621679582331"><span id="local-6989586621679582332"><span class="hs-keyword">instance</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="#local-6989586621679582332"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582331"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582330"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="#local-6989586621679582329"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><a href="#local-6989586621679582328"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="#local-6989586621679582327"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621679582332"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582331"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582330"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679582329"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="#local-6989586621679582328"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="#local-6989586621679582327"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621679582325"><span class="annot"><span class="annottext">forward :: GTransformerStack (Vector 1 block)
-&gt; (query, attentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582325"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VGS.Vector</span></a></span><span> </span><span id="local-6989586621679582323"><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582323"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679582322"><span class="annot"><span class="annottext">(query, attentionBias)
</span><a href="#local-6989586621679582322"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679582321"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582321"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582320"><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582320"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vector block
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector block -&gt; Maybe (block, Vector block)
forall a. Vector a -&gt; Maybe (a, Vector a)
</span><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.uncons</span></a></span><span> </span><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582323"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-193"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">block
-&gt; (query, attentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582320"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">(query, attentionBias)
</span><a href="#local-6989586621679582322"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582321"><span class="hs-identifier hs-var">g</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span id="local-6989586621679582313"><span id="local-6989586621679582314"><span id="local-6989586621679582315"><span id="local-6989586621679582316"><span id="local-6989586621679582317"><span id="local-6989586621679582318"><span class="hs-keyword">instance</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="#local-6989586621679582318"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582317"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582316"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582315"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582314"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621679582313"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><a href="#local-6989586621679582317"><span class="hs-identifier hs-type">query</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="#local-6989586621679582313"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621679582311"><span class="annot"><span class="annottext">forward :: GTransformerStack (Vector 0 block)
-&gt; (query, key, attentionBias, crossAttentionBias)
-&gt; Generator generator
-&gt; m (query, Generator generator)
</span><a href="#local-6989586621679582311"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="annot"><span class="annottext">GTransformerStack (Vector 0 block)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582310"><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582310"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">key
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">crossAttentionBias
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(query, Generator generator) -&gt; m (query, Generator generator)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((query, Generator generator) -&gt; m (query, Generator generator))
-&gt; (Generator generator -&gt; (query, Generator generator))
-&gt; Generator generator
-&gt; m (query, Generator generator)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582310"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621679582302"><span id="local-6989586621679582303"><span id="local-6989586621679582304"><span id="local-6989586621679582305"><span id="local-6989586621679582306"><span id="local-6989586621679582307"><span id="local-6989586621679582308"><span id="local-6989586621679582309"><span class="hs-keyword">instance</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="#local-6989586621679582309"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582308"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582307"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582306"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582305"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="#local-6989586621679582304"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="#local-6989586621679582303"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="#local-6989586621679582302"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="#local-6989586621679582309"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582308"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582307"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582306"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582305"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="#local-6989586621679582304"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><a href="#local-6989586621679582303"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="#local-6989586621679582302"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621679582300"><span class="annot"><span class="annottext">forward :: GTransformerStack (Vector 1 block)
-&gt; (query, key, attentionBias, crossAttentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582300"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VGS.Vector</span></a></span><span> </span><span id="local-6989586621679582299"><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582299"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679582298"><span class="annot"><span class="annottext">(query, key, attentionBias, crossAttentionBias)
</span><a href="#local-6989586621679582298"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679582297"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582297"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582296"><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582296"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vector block
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector block -&gt; Maybe (block, Vector block)
forall a. Vector a -&gt; Maybe (a, Vector a)
</span><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.uncons</span></a></span><span> </span><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582299"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-221"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">block
-&gt; (query, key, attentionBias, crossAttentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582296"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">(query, key, attentionBias, crossAttentionBias)
</span><a href="#local-6989586621679582298"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582297"><span class="hs-identifier hs-var">g</span></a></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | 'HasForward' instance for 'GTransformerStack' in an encoder configuration.</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- &#9474; query &#9474;  &#9474; attentionBias &#9474;</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-229"></span><span class="hs-comment">--     &#9474;              &#9474;</span><span>
</span><span id="line-230"></span><span class="hs-comment">--     &#9660;              &#9474;</span><span>
</span><span id="line-231"></span><span class="hs-comment">--   block&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;</span><span>
</span><span id="line-232"></span><span class="hs-comment">--     &#9660;              &#9474;</span><span>
</span><span id="line-233"></span><span class="hs-comment">--   block&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;</span><span>
</span><span id="line-234"></span><span class="hs-comment">--     &#9660;              &#9474;</span><span>
</span><span id="line-235"></span><span class="hs-comment">--    ...            ...</span><span>
</span><span id="line-236"></span><span class="hs-comment">--     &#9660;              &#9474;</span><span>
</span><span id="line-237"></span><span class="hs-comment">--   block&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-238"></span><span class="hs-comment">--     &#9474;</span><span>
</span><span id="line-239"></span><span class="hs-comment">--     &#9660;</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- &#9474; query &#9474;</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-244"></span><span id="local-6989586621679582289"><span id="local-6989586621679582290"><span id="local-6989586621679582291"><span id="local-6989586621679582292"><span id="local-6989586621679582293"><span id="local-6989586621679582294"><span id="local-6989586621679582295"><span class="hs-keyword">instance</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><a href="#local-6989586621679582295"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582294"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582293"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>      </span><span class="annot"><a href="#local-6989586621679582292"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><a href="#local-6989586621679582291"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><a href="#local-6989586621679582290"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span class="annot"><a href="#local-6989586621679582295"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582291"><span class="hs-identifier hs-type">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582293"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><a href="#local-6989586621679582290"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><a href="#local-6989586621679582291"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><a href="#local-6989586621679582290"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582289"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582295"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582294"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582293"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="#local-6989586621679582292"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="#local-6989586621679582291"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621679582290"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-266"></span><span>  </span><span id="local-6989586621679582287"><span class="annot"><span class="annottext">forward :: GTransformerStack (Vector n block)
-&gt; (query, attentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582287"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VGS.Vector</span></a></span><span> </span><span id="local-6989586621679582286"><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582286"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582285"><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582285"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582284"><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679582284"><span class="hs-identifier hs-var">attentionBias</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679582283"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582283"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582282"><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582282"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582281"><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582281"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector block -&gt; Maybe (block, Vector block)
forall a. Vector a -&gt; Maybe (a, Vector a)
</span><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.uncons</span></a></span><span> </span><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582286"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-268"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(m (output, Generator generatorOutputDevice)
 -&gt; block -&gt; m (output, Generator generatorOutputDevice))
-&gt; m (output, Generator generatorOutputDevice)
-&gt; Vector block
-&gt; m (output, Generator generatorOutputDevice)
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.foldl</span></a></span><span>
</span><span id="line-269"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679582279"><span class="annot"><span class="annottext">m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582279"><span class="hs-identifier hs-var">agg</span></a></span></span><span> </span><span id="local-6989586621679582278"><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582278"><span class="hs-identifier hs-var">block'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679582277"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582277"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582276"><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582276"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582279"><span class="hs-identifier hs-var">agg</span></a></span><span>
</span><span id="line-271"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679582275"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582275"><span class="hs-identifier hs-var">output'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582274"><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582274"><span class="hs-identifier hs-var">g''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">block
-&gt; (output, attentionBias)
-&gt; Generator generatorOutputDevice
-&gt; m (output, Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582278"><span class="hs-identifier hs-var">block'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582277"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679582284"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582276"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-272"></span><span>              </span><span class="annot"><span class="annottext">(output, Generator generatorOutputDevice)
-&gt; m (output, Generator generatorOutputDevice)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582275"><span class="hs-identifier hs-var">output'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582274"><span class="hs-identifier hs-var">g''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679582273"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582273"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582272"><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582272"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">block
-&gt; (query, attentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582282"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582285"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679582284"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582283"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-276"></span><span>              </span><span class="annot"><span class="annottext">(output, Generator generatorOutputDevice)
-&gt; m (output, Generator generatorOutputDevice)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582273"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582272"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>          </span><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582281"><span class="hs-identifier hs-var">blocks</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- | 'HasForward' instance for 'GTransformerStack' in a decoder configuration.</span><span>
</span><span id="line-281"></span><span class="hs-comment">--</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- &#9474; query &#9474;  &#9474; key &#9474;  &#9474; attentionBias &#9474;  &#9474; crossAttentionBias &#9474;</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9516;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-286"></span><span class="hs-comment">--     &#9474;         &#9474;             &#9474;                    &#9474;</span><span>
</span><span id="line-287"></span><span class="hs-comment">--     &#9660;         &#9474;             &#9474;                    &#9474;</span><span>
</span><span id="line-288"></span><span class="hs-comment">--   block&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;</span><span>
</span><span id="line-289"></span><span class="hs-comment">--     &#9660;         &#9474;             &#9474;                    &#9474;</span><span>
</span><span id="line-290"></span><span class="hs-comment">--   block&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;</span><span>
</span><span id="line-291"></span><span class="hs-comment">--     &#9660;         &#9474;             &#9474;                    &#9474;</span><span>
</span><span id="line-292"></span><span class="hs-comment">--    ...       ...           ...                  ...</span><span>
</span><span id="line-293"></span><span class="hs-comment">--     &#9660;         &#9474;             &#9474;                    &#9474;</span><span>
</span><span id="line-294"></span><span class="hs-comment">--   block&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;&#9668;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-295"></span><span class="hs-comment">--     &#9474;</span><span>
</span><span id="line-296"></span><span class="hs-comment">--     &#9660;</span><span>
</span><span id="line-297"></span><span class="hs-comment">-- &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- &#9474; query &#9474;</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-301"></span><span id="local-6989586621679582263"><span id="local-6989586621679582264"><span id="local-6989586621679582265"><span id="local-6989586621679582266"><span id="local-6989586621679582267"><span id="local-6989586621679582268"><span id="local-6989586621679582269"><span id="local-6989586621679582270"><span id="local-6989586621679582271"><span class="hs-keyword">instance</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><a href="#local-6989586621679582271"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582270"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582269"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582268"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582267"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><a href="#local-6989586621679582266"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-307"></span><span>      </span><span class="annot"><a href="#local-6989586621679582265"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-308"></span><span>      </span><span class="annot"><a href="#local-6989586621679582264"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><a href="#local-6989586621679582271"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582265"><span class="hs-identifier hs-type">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582269"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582268"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582267"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>      </span><span class="annot"><a href="#local-6989586621679582264"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><a href="#local-6989586621679582265"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-314"></span><span>      </span><span class="annot"><a href="#local-6989586621679582264"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VS.Vector</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582263"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679582271"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679582270"><span class="hs-identifier hs-type">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582269"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582268"><span class="hs-identifier hs-type">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679582267"><span class="hs-identifier hs-type">crossAttentionBias</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621679582266"><span class="hs-identifier hs-type">generatorDevice</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="#local-6989586621679582265"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><a href="#local-6989586621679582264"><span class="hs-identifier hs-type">generatorOutputDevice</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-323"></span><span>  </span><span id="local-6989586621679582261"><span class="annot"><span class="annottext">forward :: GTransformerStack (Vector n block)
-&gt; (query, key, attentionBias, crossAttentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582261"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#GTransformerStack"><span class="hs-identifier hs-type">GTransformerStack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/33j53czfh9iaqr8w1k6rjcna7zg8rw55-vector-sized-lib-vector-sized-1.4.3.1-haddock-doc/share/doc/vector-sized/html/src"><span class="hs-identifier hs-type">VGS.Vector</span></a></span><span> </span><span id="local-6989586621679582260"><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582260"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582259"><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582259"><span class="hs-identifier hs-var">query</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582258"><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621679582258"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582257"><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679582257"><span class="hs-identifier hs-var">attentionBias</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582256"><span class="annot"><span class="annottext">crossAttentionBias
</span><a href="#local-6989586621679582256"><span class="hs-identifier hs-var">crossAttentionBias</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679582255"><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582255"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679582254"><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582254"><span class="hs-identifier hs-var">block</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582253"><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582253"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector block -&gt; Maybe (block, Vector block)
forall a. Vector a -&gt; Maybe (a, Vector a)
</span><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.uncons</span></a></span><span> </span><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582260"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-325"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(m (output, Generator generatorOutputDevice)
 -&gt; block -&gt; m (output, Generator generatorOutputDevice))
-&gt; m (output, Generator generatorOutputDevice)
-&gt; Vector block
-&gt; m (output, Generator generatorOutputDevice)
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Vector b -&gt; a
</span><a href="../file:///nix/store/yynp70g2av7yww0d41962k85vnlb2qia-vector-lib-vector-0.12.2.0-haddock-doc/share/doc/vector/html/src"><span class="hs-identifier hs-var">V.foldl</span></a></span><span>
</span><span id="line-326"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679582252"><span class="annot"><span class="annottext">m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582252"><span class="hs-identifier hs-var">agg</span></a></span></span><span> </span><span id="local-6989586621679582251"><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582251"><span class="hs-identifier hs-var">block'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679582250"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582250"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582249"><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582249"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (output, Generator generatorOutputDevice)
</span><a href="#local-6989586621679582252"><span class="hs-identifier hs-var">agg</span></a></span><span>
</span><span id="line-328"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679582248"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582248"><span class="hs-identifier hs-var">output'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582247"><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582247"><span class="hs-identifier hs-var">g''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">block
-&gt; (output, key, attentionBias, crossAttentionBias)
-&gt; Generator generatorOutputDevice
-&gt; m (output, Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582251"><span class="hs-identifier hs-var">block'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582250"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621679582258"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679582257"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">crossAttentionBias
</span><a href="#local-6989586621679582256"><span class="hs-identifier hs-var">crossAttentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582249"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-329"></span><span>              </span><span class="annot"><span class="annottext">(output, Generator generatorOutputDevice)
-&gt; m (output, Generator generatorOutputDevice)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582248"><span class="hs-identifier hs-var">output'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582247"><span class="hs-identifier hs-var">g''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679582246"><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582246"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582245"><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582245"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">block
-&gt; (query, key, attentionBias, crossAttentionBias)
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">block
</span><a href="#local-6989586621679582254"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">query
</span><a href="#local-6989586621679582259"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">key
</span><a href="#local-6989586621679582258"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">attentionBias
</span><a href="#local-6989586621679582257"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">crossAttentionBias
</span><a href="#local-6989586621679582256"><span class="hs-identifier hs-var">crossAttentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator generatorDevice
</span><a href="#local-6989586621679582255"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-333"></span><span>              </span><span class="annot"><span class="annottext">(output, Generator generatorOutputDevice)
-&gt; m (output, Generator generatorOutputDevice)
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">output
</span><a href="#local-6989586621679582246"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator generatorOutputDevice
</span><a href="#local-6989586621679582245"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">Vector block
</span><a href="#local-6989586621679582253"><span class="hs-identifier hs-var">blocks</span></a></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#testEncoderStack"><span class="hs-identifier hs-type">testEncoderStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-338"></span><span id="testEncoderStack"><span class="annot"><span class="annottext">testEncoderStack :: IO
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#testEncoderStack"><span class="hs-identifier hs-var hs-var">testEncoderStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582243"><span class="annot"><span class="annottext">gradient :: SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679582243"><span class="hs-identifier hs-var hs-var">gradient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
-&gt; SGradient ('Gradient 'WithGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithGradient"><span class="hs-identifier hs-var">SWithGradient</span></a></span><span>
</span><span id="line-340"></span><span>      </span><span id="local-6989586621679582240"><span class="annot"><span class="annottext">device :: SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582240"><span class="hs-identifier hs-var hs-var">device</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span id="local-6989586621679582237"><span class="annot"><span class="annottext">dataType :: SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582237"><span class="hs-identifier hs-var hs-var">dataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDType 'Float -&gt; SDataType ('DataType 'Float)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Float
</span><a href="Torch.GraduallyTyped.DType.html#SFloat"><span class="hs-identifier hs-var">SFloat</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span id="local-6989586621679582234"><span class="annot"><span class="annottext">headDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679582234"><span class="hs-identifier hs-var hs-var">headDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 8) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 8 =&gt; SSize ('Size 8)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621679582231"><span class="annot"><span class="annottext">headEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679582231"><span class="hs-identifier hs-var hs-var">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 64) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 64 =&gt; SSize ('Size 64)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-344"></span><span>      </span><span id="local-6989586621679582230"><span class="annot"><span class="annottext">embedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582230"><span class="hs-identifier hs-var hs-var">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621679582229"><span class="annot"><span class="annottext">queryEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582229"><span class="hs-identifier hs-var hs-var">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-346"></span><span>      </span><span id="local-6989586621679582228"><span class="annot"><span class="annottext">ffnDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
</span><a href="#local-6989586621679582228"><span class="hs-identifier hs-var hs-var">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 2048) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 2048 =&gt; SSize ('Size 2048)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2048</span></span><span>
</span><span id="line-347"></span><span>      </span><span id="local-6989586621679582227"><span class="annot"><span class="annottext">dropoutP :: Double
</span><a href="#local-6989586621679582227"><span class="hs-identifier hs-var hs-var">dropoutP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-348"></span><span>      </span><span id="local-6989586621679582226"><span class="annot"><span class="annottext">eps :: Double
</span><a href="#local-6989586621679582226"><span class="hs-identifier hs-var hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-6</span></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582225"><span class="annot"><span class="annottext">g :: Generator ('Device 'CPU)
</span><a href="#local-6989586621679582225"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU) -&gt; Word64 -&gt; Generator ('Device 'CPU)
forall (device :: Device (DeviceType Nat)).
SDevice device -&gt; Word64 -&gt; Generator device
</span><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier hs-var">sMkGenerator</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582240"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-350"></span><span>      </span><span id="local-6989586621679582224"><span class="annot"><span class="annottext">spec :: NamedModel
  (GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582224"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ()))))
-&gt; NamedModel
     (GTransformerStack
        (VectorSpec
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ())))))
forall model. StateDictKey -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;stack.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(GTransformerStack
   (VectorSpec
      2
      (GTransformerBlock
         (NamedModel
            (GSelfAttention
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     ('DataType 'Float)
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               (NamedModel
                  (GMultiHeadAttention
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     ('Dim ('Name &quot;*&quot;) ('Size 64))
                     ('Dim ('Name &quot;*&quot;) ('Size 512))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Dropout))
               Dropout
               ()))
         ()
         (NamedModel
            (GTransformerFeedForwardNetwork
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     ('DataType 'Float)
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               (NamedModel
                  (GLinear
                     (NamedModel
                        (Tensor
                           ('Gradient 'WithGradient)
                           ('Layout 'Dense)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape
                              '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel ())))
               Relu
               Dropout
               (NamedModel
                  (GLinear
                     (NamedModel
                        (Tensor
                           ('Gradient 'WithGradient)
                           ('Layout 'Dense)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape
                              '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                     (NamedModel ())))
               Dropout
               ()))))
 -&gt; NamedModel
      (GTransformerStack
         (VectorSpec
            2
            (GTransformerBlock
               (NamedModel
                  (GSelfAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               ()
               (NamedModel
                  (GTransformerFeedForwardNetwork
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Relu
                     Dropout
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                           (NamedModel ())))
                     Dropout
                     ()))))))
-&gt; GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ()))))
-&gt; NamedModel
     (GTransformerStack
        (VectorSpec
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ())))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
-&gt; SNat 2
-&gt; SGradient ('Gradient 'WithGradient)
-&gt; SDevice ('Device 'CPU)
-&gt; SDataType ('DataType 'Float)
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (EncoderBlockSelfAttentionF
                 'T5
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 ('DataType 'Float)
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 ('Dim ('Name &quot;*&quot;) ('Size 64))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ('Dim ('Name &quot;*&quot;) ('Size 512)))
              EncoderBlockCrossAttentionF
              (EncoderBlockFeedForwardNetworkF
                 'T5
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 ('DataType 'Float)
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ('Dim ('Name &quot;*&quot;) ('Size 2048))))))
forall (style :: TransformerStyle) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat)).
STransformerStyle style
-&gt; SNat numLayers
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerStack
        (Vector
           numLayers
           (GTransformerBlock
              (EncoderBlockSelfAttentionF
                 style
                 gradient
                 device
                 dataType
                 headDim
                 headEmbedDim
                 embedDim
                 queryEmbedDim)
              EncoderBlockCrossAttentionF
              (EncoderBlockFeedForwardNetworkF
                 style gradient device dataType queryEmbedDim ffnDim))))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#encoderStackSpec"><span class="hs-identifier hs-var">encoderStackSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownNat 2 =&gt; SNat 2
forall (n :: Nat). KnownNat n =&gt; SNat n
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNat</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679582243"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582240"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582237"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679582234"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679582231"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582230"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582229"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
</span><a href="#local-6989586621679582228"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582227"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582226"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679582222"><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582222"><span class="hs-identifier hs-var">encoderStack</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582221"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679582221"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
-&gt; Generator ('Device 'CPU)
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))),
      Generator ('Device 'CPU))
forall model (generatorDevice :: Device (DeviceType Nat)) output
       (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasInitialize model generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
ModelSpec model
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
NamedModel
  (GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582224"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679582225"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621679582220"><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582220"><span class="hs-identifier hs-var">encoderStack'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (NamedModel
      (GTransformerStack
         (Vector
            2
            (GTransformerBlock
               (NamedModel
                  (GSelfAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               ()
               (NamedModel
                  (GTransformerFeedForwardNetwork
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Relu
                     Dropout
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                           (NamedModel ())))
                     Dropout
                     ()))))))
 -&gt; StateDict
 -&gt; IO
      (NamedModel
         (GTransformerStack
            (Vector
               2
               (GTransformerBlock
                  (NamedModel
                     (GSelfAttention
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GMultiHeadAttention
                              ('Dim ('Name &quot;*&quot;) ('Size 8))
                              ('Dim ('Name &quot;*&quot;) ('Size 64))
                              ('Dim ('Name &quot;*&quot;) ('Size 512))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              Dropout))
                        Dropout
                        ()))
                  ()
                  (NamedModel
                     (GTransformerFeedForwardNetwork
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                          'Dim ('Name &quot;*&quot;) ('Size 512)])))
                              (NamedModel ())))
                        Relu
                        Dropout
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                          'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                              (NamedModel ())))
                        Dropout
                        ())))))))
-&gt; StateDict
-&gt; StateT
     StateDict
     IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT
  StateDict
  IO
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
-&gt; StateDict
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall (m :: Type -&gt; Type) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="annot"><span class="annottext">StateDict
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (NamedModel
      (GTransformerStack
         (Vector
            2
            (GTransformerBlock
               (NamedModel
                  (GSelfAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               ()
               (NamedModel
                  (GTransformerFeedForwardNetwork
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Relu
                     Dropout
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                           (NamedModel ())))
                     Dropout
                     ()))))))
 -&gt; IO
      (NamedModel
         (GTransformerStack
            (Vector
               2
               (GTransformerBlock
                  (NamedModel
                     (GSelfAttention
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GMultiHeadAttention
                              ('Dim ('Name &quot;*&quot;) ('Size 8))
                              ('Dim ('Name &quot;*&quot;) ('Size 64))
                              ('Dim ('Name &quot;*&quot;) ('Size 512))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              Dropout))
                        Dropout
                        ()))
                  ()
                  (NamedModel
                     (GTransformerFeedForwardNetwork
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                          'Dim ('Name &quot;*&quot;) ('Size 512)])))
                              (NamedModel ())))
                        Relu
                        Dropout
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                          'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                              (NamedModel ())))
                        Dropout
                        ())))))))
-&gt; StateT
     StateDict
     IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey
-&gt; NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ())))))
-&gt; StateT StateDict IO ()
forall model (m :: Type -&gt; Type).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582222"><span class="hs-identifier hs-var">encoderStack</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
-&gt; StateDictKey
-&gt; StateT
     StateDict
     IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 ()
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall model (m :: Type -&gt; Type).
(HasStateDict model, MonadIO m, MonadThrow m,
 MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              ()
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
NamedModel
  (GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582224"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582217"><span class="annot"><span class="annottext">batchDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582217"><span class="hs-identifier hs-var hs-var">batchDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 3) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 3 =&gt; SSize ('Size 3)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-356"></span><span>      </span><span id="local-6989586621679582216"><span class="annot"><span class="annottext">seqDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582216"><span class="hs-identifier hs-var hs-var">seqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 17) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 17 =&gt; SSize ('Size 17)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">17</span></span><span>
</span><span id="line-357"></span><span>      </span><span id="local-6989586621679582215"><span class="annot"><span class="annottext">sOnes' :: SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582215"><span class="hs-identifier hs-var hs-var">sOnes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TensorSpec
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  dataType
  shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
TensorSpec gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier hs-var">sOnes</span></a></span><span> </span><span class="annot"><span class="annottext">(TensorSpec
   ('Gradient 'WithoutGradient)
   ('Layout 'Dense)
   ('Device 'CPU)
   dataType
   shape
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      dataType
      shape)
-&gt; (SShape shape
    -&gt; TensorSpec
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         dataType
         shape)
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((SShape shape
  -&gt; TensorSpec
       ('Gradient 'WithoutGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       dataType
       shape)
 -&gt; SShape shape
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      dataType
      shape)
-&gt; (SDataType dataType
    -&gt; SShape shape
    -&gt; TensorSpec
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         dataType
         shape)
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithoutGradient)
-&gt; SLayout ('Layout 'Dense)
-&gt; SDevice ('Device 'CPU)
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; TensorSpec
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGradient gradient
-&gt; SLayout layout
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; TensorSpec gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#TensorSpec"><span class="hs-identifier hs-var">TensorSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
-&gt; SGradient ('Gradient 'WithoutGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithoutGradient"><span class="hs-identifier hs-var">SWithoutGradient</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SLayoutType 'Dense -&gt; SLayout ('Layout 'Dense)
forall (layoutType :: LayoutType).
SLayoutType layoutType -&gt; SLayout ('Layout layoutType)
</span><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier hs-var">SLayout</span></a></span><span> </span><span class="annot"><span class="annottext">SLayoutType 'Dense
</span><a href="Torch.GraduallyTyped.Layout.html#SDense"><span class="hs-identifier hs-var">SDense</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582240"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span id="local-6989586621679582213"><span class="annot"><span class="annottext">query :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582213"><span class="hs-identifier hs-var hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582215"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582237"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
     'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
      'Dim ('Name &quot;*&quot;) ('Size 512)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
            'Dim ('Name &quot;*&quot;) ('Size 512)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582217"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582216"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582229"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>      </span><span id="local-6989586621679582212"><span class="annot"><span class="annottext">attentionBias :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)])
</span><a href="#local-6989586621679582212"><span class="hs-identifier hs-var hs-var">attentionBias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582215"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582237"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
     'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
      'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582217"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582216"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582216"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679582211"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582211"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)]))
-&gt; Generator ('Device 'CPU)
-&gt; IO
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
              'Dim ('Name &quot;*&quot;) ('Size 512)]),
      Generator ('Device 'CPU))
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           ()
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582220"><span class="hs-identifier hs-var">encoderStack'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582213"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 17)])
</span><a href="#local-6989586621679582212"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679582221"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; IO
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
              'Dim ('Name &quot;*&quot;) ('Size 512)]))
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582211"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#testDecoderStack"><span class="hs-identifier hs-type">testDecoderStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-364"></span><span id="testDecoderStack"><span class="annot"><span class="annottext">testDecoderStack :: IO
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#testDecoderStack"><span class="hs-identifier hs-var hs-var">testDecoderStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582209"><span class="annot"><span class="annottext">gradient :: SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679582209"><span class="hs-identifier hs-var hs-var">gradient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
-&gt; SGradient ('Gradient 'WithGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithGradient"><span class="hs-identifier hs-var">SWithGradient</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span id="local-6989586621679582208"><span class="annot"><span class="annottext">device :: SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582208"><span class="hs-identifier hs-var hs-var">device</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span id="local-6989586621679582207"><span class="annot"><span class="annottext">dataType :: SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582207"><span class="hs-identifier hs-var hs-var">dataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDType 'Float -&gt; SDataType ('DataType 'Float)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Float
</span><a href="Torch.GraduallyTyped.DType.html#SFloat"><span class="hs-identifier hs-var">SFloat</span></a></span><span>
</span><span id="line-368"></span><span>      </span><span id="local-6989586621679582206"><span class="annot"><span class="annottext">headDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679582206"><span class="hs-identifier hs-var hs-var">headDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 8) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 8 =&gt; SSize ('Size 8)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-369"></span><span>      </span><span id="local-6989586621679582205"><span class="annot"><span class="annottext">headEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679582205"><span class="hs-identifier hs-var hs-var">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 64) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 64 =&gt; SSize ('Size 64)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-370"></span><span>      </span><span id="local-6989586621679582204"><span class="annot"><span class="annottext">embedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582204"><span class="hs-identifier hs-var hs-var">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-371"></span><span>      </span><span id="local-6989586621679582203"><span class="annot"><span class="annottext">queryEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582203"><span class="hs-identifier hs-var hs-var">queryEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-372"></span><span>      </span><span id="local-6989586621679582202"><span class="annot"><span class="annottext">keyEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582202"><span class="hs-identifier hs-var hs-var">keyEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582203"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span>
</span><span id="line-373"></span><span>      </span><span id="local-6989586621679582201"><span class="annot"><span class="annottext">ffnDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
</span><a href="#local-6989586621679582201"><span class="hs-identifier hs-var hs-var">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 2048) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 2048 =&gt; SSize ('Size 2048)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2048</span></span><span>
</span><span id="line-374"></span><span>      </span><span id="local-6989586621679582200"><span class="annot"><span class="annottext">dropoutP :: Double
</span><a href="#local-6989586621679582200"><span class="hs-identifier hs-var hs-var">dropoutP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span>
</span><span id="line-375"></span><span>      </span><span id="local-6989586621679582199"><span class="annot"><span class="annottext">eps :: Double
</span><a href="#local-6989586621679582199"><span class="hs-identifier hs-var hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-6</span></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582198"><span class="annot"><span class="annottext">g :: Generator ('Device 'CPU)
</span><a href="#local-6989586621679582198"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU) -&gt; Word64 -&gt; Generator ('Device 'CPU)
forall (device :: Device (DeviceType Nat)).
SDevice device -&gt; Word64 -&gt; Generator device
</span><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier hs-var">sMkGenerator</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582208"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-377"></span><span>      </span><span id="local-6989586621679582197"><span class="annot"><span class="annottext">spec :: NamedModel
  (GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582197"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateDictKey
-&gt; GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ()))))
-&gt; NamedModel
     (GTransformerStack
        (VectorSpec
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ())))))
forall model. StateDictKey -&gt; model -&gt; NamedModel model
</span><a href="Torch.GraduallyTyped.NN.Class.html#NamedModel"><span class="hs-identifier hs-var">NamedModel</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><span class="hs-string">&quot;stack.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(GTransformerStack
   (VectorSpec
      2
      (GTransformerBlock
         (NamedModel
            (GSelfAttention
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     ('DataType 'Float)
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               (NamedModel
                  (GMultiHeadAttention
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     ('Dim ('Name &quot;*&quot;) ('Size 64))
                     ('Dim ('Name &quot;*&quot;) ('Size 512))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Dropout))
               Dropout
               ()))
         (NamedModel
            (GCrossAttention
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     ('DataType 'Float)
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               (NamedModel
                  (GMultiHeadAttention
                     ('Dim ('Name &quot;*&quot;) ('Size 8))
                     ('Dim ('Name &quot;*&quot;) ('Size 64))
                     ('Dim ('Name &quot;*&quot;) ('Size 512))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Dropout))
               Dropout
               ()))
         (NamedModel
            (GTransformerFeedForwardNetwork
               (NamedModel
                  (LayerNorm
                     'WithoutBias
                     ('Gradient 'WithGradient)
                     ('Device 'CPU)
                     ('DataType 'Float)
                     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
               (NamedModel
                  (GLinear
                     (NamedModel
                        (Tensor
                           ('Gradient 'WithGradient)
                           ('Layout 'Dense)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape
                              '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel ())))
               Relu
               Dropout
               (NamedModel
                  (GLinear
                     (NamedModel
                        (Tensor
                           ('Gradient 'WithGradient)
                           ('Layout 'Dense)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape
                              '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                     (NamedModel ())))
               Dropout
               ()))))
 -&gt; NamedModel
      (GTransformerStack
         (VectorSpec
            2
            (GTransformerBlock
               (NamedModel
                  (GSelfAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               (NamedModel
                  (GCrossAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               (NamedModel
                  (GTransformerFeedForwardNetwork
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Relu
                     Dropout
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                           (NamedModel ())))
                     Dropout
                     ()))))))
-&gt; GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ()))))
-&gt; NamedModel
     (GTransformerStack
        (VectorSpec
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ())))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
-&gt; SNat 2
-&gt; SGradient ('Gradient 'WithGradient)
-&gt; SDevice ('Device 'CPU)
-&gt; SDataType ('DataType 'Float)
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (DecoderBlockSelfAttentionF
                 'T5
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 ('DataType 'Float)
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 ('Dim ('Name &quot;*&quot;) ('Size 64))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ('Dim ('Name &quot;*&quot;) ('Size 512)))
              (DecoderBlockCrossAttentionF
                 'T5
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 ('DataType 'Float)
                 ('Dim ('Name &quot;*&quot;) ('Size 8))
                 ('Dim ('Name &quot;*&quot;) ('Size 64))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ('Dim ('Name &quot;*&quot;) ('Size 512)))
              (DecoderBlockFeedForwardNetworkF
                 'T5
                 ('Gradient 'WithGradient)
                 ('Device 'CPU)
                 ('DataType 'Float)
                 ('Dim ('Name &quot;*&quot;) ('Size 512))
                 ('Dim ('Name &quot;*&quot;) ('Size 2048))))))
forall (style :: TransformerStyle) (numLayers :: Nat)
       (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat)) (dataType :: DataType DType)
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (queryEmbedDim :: Dim (Name Symbol) (Size Nat))
       (keyEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat)).
STransformerStyle style
-&gt; SNat numLayers
-&gt; SGradient gradient
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SDim headDim
-&gt; SDim headEmbedDim
-&gt; SDim embedDim
-&gt; SDim queryEmbedDim
-&gt; SDim keyEmbedDim
-&gt; SDim ffnDim
-&gt; Double
-&gt; Double
-&gt; ModelSpec
     (GTransformerStack
        (Vector
           numLayers
           (GTransformerBlock
              (DecoderBlockSelfAttentionF
                 style
                 gradient
                 device
                 dataType
                 headDim
                 headEmbedDim
                 embedDim
                 queryEmbedDim)
              (DecoderBlockCrossAttentionF
                 style
                 gradient
                 device
                 dataType
                 headDim
                 headEmbedDim
                 embedDim
                 queryEmbedDim
                 keyEmbedDim)
              (DecoderBlockFeedForwardNetworkF
                 style gradient device dataType queryEmbedDim ffnDim))))
</span><a href="Torch.GraduallyTyped.NN.Transformer.GStack.html#decoderStackSpec"><span class="hs-identifier hs-var">decoderStackSpec</span></a></span><span> </span><span class="annot"><span class="annottext">STransformerStyle 'T5
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ST5"><span class="hs-identifier hs-var">ST5</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownNat 2 =&gt; SNat 2
forall (n :: Nat). KnownNat n =&gt; SNat n
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNat</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679582209"><span class="hs-identifier hs-var">gradient</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582208"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582207"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679582206"><span class="hs-identifier hs-var">headDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679582205"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582204"><span class="hs-identifier hs-var">embedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582203"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582202"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
</span><a href="#local-6989586621679582201"><span class="hs-identifier hs-var">ffnDim</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582200"><span class="hs-identifier hs-var">dropoutP</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679582199"><span class="hs-identifier hs-var">eps</span></a></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679582196"><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582196"><span class="hs-identifier hs-var">decoderStack</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679582195"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679582195"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
-&gt; Generator ('Device 'CPU)
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))),
      Generator ('Device 'CPU))
forall model (generatorDevice :: Device (DeviceType Nat)) output
       (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasInitialize model generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
ModelSpec model
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
NamedModel
  (GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582197"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679582198"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621679582194"><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582194"><span class="hs-identifier hs-var">decoderStack'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (NamedModel
      (GTransformerStack
         (Vector
            2
            (GTransformerBlock
               (NamedModel
                  (GSelfAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               (NamedModel
                  (GCrossAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               (NamedModel
                  (GTransformerFeedForwardNetwork
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Relu
                     Dropout
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                           (NamedModel ())))
                     Dropout
                     ()))))))
 -&gt; StateDict
 -&gt; IO
      (NamedModel
         (GTransformerStack
            (Vector
               2
               (GTransformerBlock
                  (NamedModel
                     (GSelfAttention
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GMultiHeadAttention
                              ('Dim ('Name &quot;*&quot;) ('Size 8))
                              ('Dim ('Name &quot;*&quot;) ('Size 64))
                              ('Dim ('Name &quot;*&quot;) ('Size 512))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              Dropout))
                        Dropout
                        ()))
                  (NamedModel
                     (GCrossAttention
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GMultiHeadAttention
                              ('Dim ('Name &quot;*&quot;) ('Size 8))
                              ('Dim ('Name &quot;*&quot;) ('Size 64))
                              ('Dim ('Name &quot;*&quot;) ('Size 512))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              Dropout))
                        Dropout
                        ()))
                  (NamedModel
                     (GTransformerFeedForwardNetwork
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                          'Dim ('Name &quot;*&quot;) ('Size 512)])))
                              (NamedModel ())))
                        Relu
                        Dropout
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                          'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                              (NamedModel ())))
                        Dropout
                        ())))))))
-&gt; StateDict
-&gt; StateT
     StateDict
     IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT
  StateDict
  IO
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
-&gt; StateDict
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall (m :: Type -&gt; Type) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="annot"><span class="annottext">StateDict
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">(StateT
   StateDict
   IO
   (NamedModel
      (GTransformerStack
         (Vector
            2
            (GTransformerBlock
               (NamedModel
                  (GSelfAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               (NamedModel
                  (GCrossAttention
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GMultiHeadAttention
                           ('Dim ('Name &quot;*&quot;) ('Size 8))
                           ('Dim ('Name &quot;*&quot;) ('Size 64))
                           ('Dim ('Name &quot;*&quot;) ('Size 512))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           (NamedModel
                              (GLinear
                                 (NamedModel
                                    (Tensor
                                       ('Gradient 'WithGradient)
                                       ('Layout 'Dense)
                                       ('Device 'CPU)
                                       ('DataType 'Float)
                                       ('Shape
                                          '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                             'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                 (NamedModel ())))
                           Dropout))
                     Dropout
                     ()))
               (NamedModel
                  (GTransformerFeedForwardNetwork
                     (NamedModel
                        (LayerNorm
                           'WithoutBias
                           ('Gradient 'WithGradient)
                           ('Device 'CPU)
                           ('DataType 'Float)
                           ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                       'Dim ('Name &quot;*&quot;) ('Size 512)])))
                           (NamedModel ())))
                     Relu
                     Dropout
                     (NamedModel
                        (GLinear
                           (NamedModel
                              (Tensor
                                 ('Gradient 'WithGradient)
                                 ('Layout 'Dense)
                                 ('Device 'CPU)
                                 ('DataType 'Float)
                                 ('Shape
                                    '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                       'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                           (NamedModel ())))
                     Dropout
                     ()))))))
 -&gt; IO
      (NamedModel
         (GTransformerStack
            (Vector
               2
               (GTransformerBlock
                  (NamedModel
                     (GSelfAttention
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GMultiHeadAttention
                              ('Dim ('Name &quot;*&quot;) ('Size 8))
                              ('Dim ('Name &quot;*&quot;) ('Size 64))
                              ('Dim ('Name &quot;*&quot;) ('Size 512))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              Dropout))
                        Dropout
                        ()))
                  (NamedModel
                     (GCrossAttention
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GMultiHeadAttention
                              ('Dim ('Name &quot;*&quot;) ('Size 8))
                              ('Dim ('Name &quot;*&quot;) ('Size 64))
                              ('Dim ('Name &quot;*&quot;) ('Size 512))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              (NamedModel
                                 (GLinear
                                    (NamedModel
                                       (Tensor
                                          ('Gradient 'WithGradient)
                                          ('Layout 'Dense)
                                          ('Device 'CPU)
                                          ('DataType 'Float)
                                          ('Shape
                                             '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                                'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                    (NamedModel ())))
                              Dropout))
                        Dropout
                        ()))
                  (NamedModel
                     (GTransformerFeedForwardNetwork
                        (NamedModel
                           (LayerNorm
                              'WithoutBias
                              ('Gradient 'WithGradient)
                              ('Device 'CPU)
                              ('DataType 'Float)
                              ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                          'Dim ('Name &quot;*&quot;) ('Size 512)])))
                              (NamedModel ())))
                        Relu
                        Dropout
                        (NamedModel
                           (GLinear
                              (NamedModel
                                 (Tensor
                                    ('Gradient 'WithGradient)
                                    ('Layout 'Dense)
                                    ('Device 'CPU)
                                    ('DataType 'Float)
                                    ('Shape
                                       '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                          'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                              (NamedModel ())))
                        Dropout
                        ())))))))
-&gt; StateT
     StateDict
     IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
-&gt; IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey
-&gt; NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ())))))
-&gt; StateT StateDict IO ()
forall model (m :: Type -&gt; Type).
(HasStateDict model, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582196"><span class="hs-identifier hs-var">decoderStack</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
-&gt; StateDictKey
-&gt; StateT
     StateDict
     IO
     (NamedModel
        (GTransformerStack
           (Vector
              2
              (GTransformerBlock
                 (NamedModel
                    (GSelfAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GCrossAttention
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GMultiHeadAttention
                             ('Dim ('Name &quot;*&quot;) ('Size 8))
                             ('Dim ('Name &quot;*&quot;) ('Size 64))
                             ('Dim ('Name &quot;*&quot;) ('Size 512))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             (NamedModel
                                (GLinear
                                   (NamedModel
                                      (Tensor
                                         ('Gradient 'WithGradient)
                                         ('Layout 'Dense)
                                         ('Device 'CPU)
                                         ('DataType 'Float)
                                         ('Shape
                                            '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                               'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                   (NamedModel ())))
                             Dropout))
                       Dropout
                       ()))
                 (NamedModel
                    (GTransformerFeedForwardNetwork
                       (NamedModel
                          (LayerNorm
                             'WithoutBias
                             ('Gradient 'WithGradient)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Relu
                       Dropout
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                             (NamedModel ())))
                       Dropout
                       ()))))))
forall model (m :: Type -&gt; Type).
(HasStateDict model, MonadIO m, MonadThrow m,
 MonadState StateDict m) =&gt;
ModelSpec model -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">ModelSpec
  (NamedModel
     (GTransformerStack
        (Vector
           2
           (GTransformerBlock
              (NamedModel
                 (GSelfAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GCrossAttention
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GMultiHeadAttention
                          ('Dim ('Name &quot;*&quot;) ('Size 8))
                          ('Dim ('Name &quot;*&quot;) ('Size 64))
                          ('Dim ('Name &quot;*&quot;) ('Size 512))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          (NamedModel
                             (GLinear
                                (NamedModel
                                   (Tensor
                                      ('Gradient 'WithGradient)
                                      ('Layout 'Dense)
                                      ('Device 'CPU)
                                      ('DataType 'Float)
                                      ('Shape
                                         '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                            'Dim ('Name &quot;*&quot;) ('Size 512)])))
                                (NamedModel ())))
                          Dropout))
                    Dropout
                    ()))
              (NamedModel
                 (GTransformerFeedForwardNetwork
                    (NamedModel
                       (LayerNorm
                          'WithoutBias
                          ('Gradient 'WithGradient)
                          ('Device 'CPU)
                          ('DataType 'Float)
                          ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 2048),
                                      'Dim ('Name &quot;*&quot;) ('Size 512)])))
                          (NamedModel ())))
                    Relu
                    Dropout
                    (NamedModel
                       (GLinear
                          (NamedModel
                             (Tensor
                                ('Gradient 'WithGradient)
                                ('Layout 'Dense)
                                ('Device 'CPU)
                                ('DataType 'Float)
                                ('Shape
                                   '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                      'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                          (NamedModel ())))
                    Dropout
                    ()))))))
NamedModel
  (GTransformerStack
     (VectorSpec
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582197"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679582193"><span class="annot"><span class="annottext">batchDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582193"><span class="hs-identifier hs-var hs-var">batchDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 3) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 3 =&gt; SSize ('Size 3)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-383"></span><span>      </span><span id="local-6989586621679582192"><span class="annot"><span class="annottext">seqDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582192"><span class="hs-identifier hs-var hs-var">seqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 17) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 17 =&gt; SSize ('Size 17)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">17</span></span><span>
</span><span id="line-384"></span><span>      </span><span id="local-6989586621679582191"><span class="annot"><span class="annottext">decoderSeqDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679582191"><span class="hs-identifier hs-var hs-var">decoderSeqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 13) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 13 =&gt; SSize ('Size 13)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">13</span></span><span>
</span><span id="line-385"></span><span>      </span><span id="local-6989586621679582190"><span class="annot"><span class="annottext">sOnes' :: SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582190"><span class="hs-identifier hs-var hs-var">sOnes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TensorSpec
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  dataType
  shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
TensorSpec gradient layout device dataType shape
-&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier hs-var">sOnes</span></a></span><span> </span><span class="annot"><span class="annottext">(TensorSpec
   ('Gradient 'WithoutGradient)
   ('Layout 'Dense)
   ('Device 'CPU)
   dataType
   shape
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      dataType
      shape)
-&gt; (SShape shape
    -&gt; TensorSpec
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         dataType
         shape)
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((SShape shape
  -&gt; TensorSpec
       ('Gradient 'WithoutGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       dataType
       shape)
 -&gt; SShape shape
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      dataType
      shape)
-&gt; (SDataType dataType
    -&gt; SShape shape
    -&gt; TensorSpec
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         dataType
         shape)
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithoutGradient)
-&gt; SLayout ('Layout 'Dense)
-&gt; SDevice ('Device 'CPU)
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; TensorSpec
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGradient gradient
-&gt; SLayout layout
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; TensorSpec gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#TensorSpec"><span class="hs-identifier hs-var">TensorSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
-&gt; SGradient ('Gradient 'WithoutGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithoutGradient"><span class="hs-identifier hs-var">SWithoutGradient</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SLayoutType 'Dense -&gt; SLayout ('Layout 'Dense)
forall (layoutType :: LayoutType).
SLayoutType layoutType -&gt; SLayout ('Layout layoutType)
</span><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier hs-var">SLayout</span></a></span><span> </span><span class="annot"><span class="annottext">SLayoutType 'Dense
</span><a href="Torch.GraduallyTyped.Layout.html#SDense"><span class="hs-identifier hs-var">SDense</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679582208"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span id="local-6989586621679582189"><span class="annot"><span class="annottext">query :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582189"><span class="hs-identifier hs-var hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582190"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582207"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
     'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
      'Dim ('Name &quot;*&quot;) ('Size 512)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
            'Dim ('Name &quot;*&quot;) ('Size 512)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582193"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679582191"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582203"><span class="hs-identifier hs-var">queryEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>      </span><span id="local-6989586621679582188"><span class="annot"><span class="annottext">key :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582188"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582190"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582207"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
     'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
      'Dim ('Name &quot;*&quot;) ('Size 512)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
            'Dim ('Name &quot;*&quot;) ('Size 512)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
           'Dim ('Name &quot;*&quot;) ('Size 512)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582193"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582192"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 17), 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679582202"><span class="hs-identifier hs-var">keyEmbedDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 512)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>      </span><span id="local-6989586621679582187"><span class="annot"><span class="annottext">attentionBias :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679582187"><span class="hs-identifier hs-var hs-var">attentionBias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582190"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582207"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
     'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
      'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582193"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679582191"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679582191"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>      </span><span id="local-6989586621679582186"><span class="annot"><span class="annottext">crossAttentionBias :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)])
</span><a href="#local-6989586621679582186"><span class="hs-identifier hs-var hs-var">crossAttentionBias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Float)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679582190"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Float)
</span><a href="#local-6989586621679582207"><span class="hs-identifier hs-var">dataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
     'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
      'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679582193"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679582191"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 17)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
</span><a href="#local-6989586621679582192"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 17))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 17)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679582185"><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582185"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
            'Dim ('Name &quot;*&quot;) ('Size 512)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]),
    Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      ('Device 'CPU)
      ('DataType 'Float)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)]))
-&gt; Generator ('Device 'CPU)
-&gt; IO
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
              'Dim ('Name &quot;*&quot;) ('Size 512)]),
      Generator ('Device 'CPU))
forall model input (generatorDevice :: Device (DeviceType Nat))
       output (generatorOutputDevice :: Device (DeviceType Nat))
       (m :: Type -&gt; Type).
(HasForward
   model input generatorDevice output generatorOutputDevice,
 MonadThrow m) =&gt;
model
-&gt; input
-&gt; Generator generatorDevice
-&gt; m (output, Generator generatorOutputDevice)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">NamedModel
  (GTransformerStack
     (Vector
        2
        (GTransformerBlock
           (NamedModel
              (GSelfAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GCrossAttention
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GMultiHeadAttention
                       ('Dim ('Name &quot;*&quot;) ('Size 8))
                       ('Dim ('Name &quot;*&quot;) ('Size 64))
                       ('Dim ('Name &quot;*&quot;) ('Size 512))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       (NamedModel
                          (GLinear
                             (NamedModel
                                (Tensor
                                   ('Gradient 'WithGradient)
                                   ('Layout 'Dense)
                                   ('Device 'CPU)
                                   ('DataType 'Float)
                                   ('Shape
                                      '[ 'Dim ('Name &quot;*&quot;) ('Size 512),
                                         'Dim ('Name &quot;*&quot;) ('Size 512)])))
                             (NamedModel ())))
                       Dropout))
                 Dropout
                 ()))
           (NamedModel
              (GTransformerFeedForwardNetwork
                 (NamedModel
                    (LayerNorm
                       'WithoutBias
                       ('Gradient 'WithGradient)
                       ('Device 'CPU)
                       ('DataType 'Float)
                       ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 2048), 'Dim ('Name &quot;*&quot;) ('Size 512)])))
                       (NamedModel ())))
                 Relu
                 Dropout
                 (NamedModel
                    (GLinear
                       (NamedModel
                          (Tensor
                             ('Gradient 'WithGradient)
                             ('Layout 'Dense)
                             ('Device 'CPU)
                             ('DataType 'Float)
                             ('Shape
                                '[ 'Dim ('Name &quot;*&quot;) ('Size 512), 'Dim ('Name &quot;*&quot;) ('Size 2048)])))
                       (NamedModel ())))
                 Dropout
                 ())))))
</span><a href="#local-6989586621679582194"><span class="hs-identifier hs-var">decoderStack'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582189"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 17),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582188"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679582187"><span class="hs-identifier hs-var">attentionBias</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 17)])
</span><a href="#local-6989586621679582186"><span class="hs-identifier hs-var">crossAttentionBias</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679582195"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
-&gt; IO
     (Tensor
        ('Gradient 'WithGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Float)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
              'Dim ('Name &quot;*&quot;) ('Size 512)]))
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Float)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 512)])
</span><a href="#local-6989586621679582185"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-392"></span></pre></body></html>
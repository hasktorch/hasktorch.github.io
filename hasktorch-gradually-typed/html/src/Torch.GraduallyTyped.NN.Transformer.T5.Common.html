<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE StandaloneKindSignatures #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-23"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-24"></span><span class="hs-pragma">{-# OPTIONS_GHC -fplugin TypeLevel.Rewrite
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyRightAssociativeL
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL2
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL2C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL3
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL3C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL4
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL4C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL5
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL5C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL6
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL6C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL7
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL7C
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL8
                -fplugin-opt=TypeLevel.Rewrite:Torch.GraduallyTyped.Unify.UnifyIdempotenceL8C #-}</span><span>
</span><span id="line-40"></span><span class="hs-pragma">{-# OPTIONS_GHC -v2 -Wall #-}</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.T5.Common</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier">MonadThrow</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">Control.Monad.Indexed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier">ireturn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator">(&gt;&gt;&gt;=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">Control.Monad.Indexed.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier">IxState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SingI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SingKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">fromSing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">Data.Singletons.Prelude.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier">SList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Float</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">double2Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">Torch.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">DType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html"><span class="hs-identifier">Torch.GraduallyTyped.DType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier">DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDType"><span class="hs-identifier">SDType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier">SDataType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html"><span class="hs-identifier">Torch.GraduallyTyped.Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier">DeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier">SDevice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDeviceType"><span class="hs-identifier">SDeviceType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html"><span class="hs-identifier">Torch.GraduallyTyped.Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier">Layout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#LayoutType"><span class="hs-identifier">LayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier">SLayout</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#SLayoutType"><span class="hs-identifier">SLayoutType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasInitialize"><span class="hs-identifier">HasInitialize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier">HasStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.SequenceToSequence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerGenerationInput"><span class="hs-identifier">SequenceToSequenceTransformerGenerationInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier">SequenceToSequenceTransformerInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.NN.Transformer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerAttentionMaskC"><span class="hs-identifier">MkTransformerAttentionMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerCrossAttentionMaskC"><span class="hs-identifier">MkTransformerCrossAttentionMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerDecoderAttentionMaskC"><span class="hs-identifier">MkTransformerDecoderAttentionMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier">MkTransformerPaddingMaskC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier">ShiftRight</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier">TransformerHead</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier">TransformerStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier">ByT5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier">T5</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerAttentionMask"><span class="hs-identifier">mkTransformerAttentionMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerCrossAttentionMask"><span class="hs-identifier">mkTransformerCrossAttentionMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerDecoderAttentionMask"><span class="hs-identifier">mkTransformerDecoderAttentionMask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerInput"><span class="hs-identifier">mkTransformerInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerPaddingMask"><span class="hs-identifier">mkTransformerPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html"><span class="hs-identifier">Torch.GraduallyTyped.Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier">forgetIsChecked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Random.html"><span class="hs-identifier">Torch.GraduallyTyped.Random</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier">sMkGenerator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html"><span class="hs-identifier">Torch.GraduallyTyped.RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier">Gradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier">RequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier">SGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SRequiresGradient"><span class="hs-identifier">SRequiresGradient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier">sGetDim</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Shape.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#KnownDim"><span class="hs-identifier">KnownDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SBy"><span class="hs-identifier">SBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier">SDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier">SName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier">SSelectDim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier">SShape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier">SSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier">Shape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier">Size</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator">(:&amp;:)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator">(:|:)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Creation.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Creation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier">sOnes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html"><span class="hs-identifier">Torch.GraduallyTyped.Tensor.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetDevice"><span class="hs-identifier">SGetDevice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#sDevice"><span class="hs-identifier">sDevice</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier">SGetShape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier">Tensor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#UncheckedTensor"><span class="hs-identifier">UncheckedTensor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedDataType"><span class="hs-identifier">checkedDataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedGradient"><span class="hs-identifier">checkedGradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedLayout"><span class="hs-identifier">checkedLayout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#sCheckedDevice"><span class="hs-identifier">sCheckedDevice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#sCheckedShape"><span class="hs-identifier">sCheckedShape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier">sShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">Torch.Tensor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">Tensor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">Unsafe</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier">asTensor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-identifier">Type.Errors.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TypeError</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="../file:///nix/store/a8ll3m7yfhm0g8j77q9rvjhgdb07zpwk-type-errors-pretty-lib-type-errors-pretty-0.0.1.1-haddock-doc/share/doc/type-errors-pretty/html/src"><span class="hs-operator">(&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-comment">-- | T5 dType.</span><span>
</span><span id="line-72"></span><span class="hs-keyword">type</span><span> </span><span id="T5DType"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DType"><span class="hs-identifier hs-var">T5DType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">Float</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | T5 dType singleton.</span><span>
</span><span id="line-75"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DType"><span class="hs-identifier hs-type">t5DType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDType"><span class="hs-identifier hs-type">SDType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DType"><span class="hs-identifier hs-type">T5DType</span></a></span><span>
</span><span id="line-76"></span><span id="t5DType"><span class="annot"><span class="annottext">t5DType :: SDType T5DType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DType"><span class="hs-identifier hs-var hs-var">t5DType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI T5DType =&gt; Sing T5DType
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DType"><span class="hs-identifier hs-type">T5DType</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | T5 data type.</span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span id="T5DataType"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-var">T5DataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DType"><span class="hs-identifier hs-type">T5DType</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | T5 data type singleton.</span><span>
</span><span id="line-82"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-type">t5DataType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span>
</span><span id="line-83"></span><span id="t5DataType"><span class="annot"><span class="annottext">t5DataType :: SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var hs-var">t5DataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI T5DataType =&gt; Sing T5DataType
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- | T5 dropout probability type.</span><span>
</span><span id="line-86"></span><span class="hs-keyword">type</span><span> </span><span id="T5DropoutP"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DropoutP"><span class="hs-identifier hs-var">T5DropoutP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | T5 dropout rate.</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- 'dropout_rate = 0.1'</span><span>
</span><span id="line-90"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DropoutP"><span class="hs-identifier hs-type">t5DropoutP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DropoutP"><span class="hs-identifier hs-type">T5DropoutP</span></a></span><span>
</span><span id="line-91"></span><span id="t5DropoutP"><span class="annot"><span class="annottext">t5DropoutP :: T5DropoutP
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DropoutP"><span class="hs-identifier hs-var hs-var">t5DropoutP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">T5DropoutP
</span><span class="hs-number">0.1</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | T5 relative positional encoding bucket dimension.</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- 'relative_attention_num_buckets = 32'</span><span>
</span><span id="line-95"></span><span class="hs-keyword">type</span><span> </span><span id="T5RelPosEncBucketDim"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5RelPosEncBucketDim"><span class="hs-identifier hs-var">T5RelPosEncBucketDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | T5 relative positional encoding bucket dimension singleton.</span><span>
</span><span id="line-98"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5RelPosEncBucketDim"><span class="hs-identifier hs-type">t5RelPosEncBucketDim</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5RelPosEncBucketDim"><span class="hs-identifier hs-type">T5RelPosEncBucketDim</span></a></span><span>
</span><span id="line-99"></span><span id="t5RelPosEncBucketDim"><span class="annot"><span class="annottext">t5RelPosEncBucketDim :: SDim T5RelPosEncBucketDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5RelPosEncBucketDim"><span class="hs-identifier hs-var hs-var">t5RelPosEncBucketDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI T5RelPosEncBucketDim =&gt; Sing T5RelPosEncBucketDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5RelPosEncBucketDim"><span class="hs-identifier hs-type">T5RelPosEncBucketDim</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | T5 layer-norm epsilon.</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- 'layer_norm_epsilon = 1e-06'</span><span>
</span><span id="line-103"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5Eps"><span class="hs-identifier hs-type">t5Eps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-104"></span><span id="t5Eps"><span class="annot"><span class="annottext">t5Eps :: Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5Eps"><span class="hs-identifier hs-var hs-var">t5Eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-6</span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- | T5 maximum distance for relative positional encoding.</span><span>
</span><span id="line-107"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5MaxDistance"><span class="hs-identifier hs-type">t5MaxDistance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-108"></span><span id="t5MaxDistance"><span class="annot"><span class="annottext">t5MaxDistance :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5MaxDistance"><span class="hs-identifier hs-var hs-var">t5MaxDistance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">128</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | T5 padding token id.</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- 'pad_token_id = 0'</span><span>
</span><span id="line-112"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5PadTokenId"><span class="hs-identifier hs-type">t5PadTokenId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-113"></span><span id="t5PadTokenId"><span class="annot"><span class="annottext">t5PadTokenId :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5PadTokenId"><span class="hs-identifier hs-var hs-var">t5PadTokenId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | T5 begin-of-sentence token id.</span><span>
</span><span id="line-116"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5BOSTokenId"><span class="hs-identifier hs-type">t5BOSTokenId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-117"></span><span id="t5BOSTokenId"><span class="annot"><span class="annottext">t5BOSTokenId :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5BOSTokenId"><span class="hs-identifier hs-var hs-var">t5BOSTokenId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5PadTokenId"><span class="hs-identifier hs-var">t5PadTokenId</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | T5 end-of-sentence token id.</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- 'eos_token_id = 1'</span><span>
</span><span id="line-121"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5EOSTokenId"><span class="hs-identifier hs-type">t5EOSTokenId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-122"></span><span id="t5EOSTokenId"><span class="annot"><span class="annottext">t5EOSTokenId :: Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5EOSTokenId"><span class="hs-identifier hs-var hs-var">t5EOSTokenId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | T5 attention mask bias</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-type">t5AttentionMaskBias</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-126"></span><span id="t5AttentionMaskBias"><span class="annot"><span class="annottext">t5AttentionMaskBias :: Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-var hs-var">t5AttentionMaskBias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">data</span><span>
</span><span id="line-129"></span><span>  </span><span id="GT5Model"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-var">GT5Model</span></a></span></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761347"><span class="annot"><a href="#local-6989586621679761347"><span class="hs-identifier hs-type">t5Model</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>  </span><span id="GT5Model"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-var">GT5Model</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761842"><span class="annot"><a href="#local-6989586621679761842"><span class="hs-identifier hs-type">t5Model</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="t5Model"><span class="annot"><span class="annottext">GT5Model t5Model -&gt; t5Model
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5Model"><span class="hs-identifier hs-var hs-var">t5Model</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761842"><span class="hs-identifier hs-type">t5Model</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>      </span><span id="t5ShiftRightDecoderInput"><span class="annot"><span class="annottext">GT5Model t5Model -&gt; ShiftRight Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5ShiftRightDecoderInput"><span class="hs-identifier hs-var hs-var">t5ShiftRightDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>      </span><span id="t5ShiftRightPaddingMask"><span class="annot"><span class="annottext">GT5Model t5Model -&gt; ShiftRight Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5ShiftRightPaddingMask"><span class="hs-identifier hs-var hs-var">t5ShiftRightPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-type">GT5Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761842"><span class="hs-identifier hs-type">t5Model</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | T5 model.</span><span>
</span><span id="line-141"></span><span id="local-6989586621679761341"><span id="local-6989586621679761342"></span></span><span class="hs-keyword">data</span><span>
</span><span id="line-142"></span><span>  </span><span id="T5Model"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-var">T5Model</span></a></span></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761340"><span class="annot"><a href="#local-6989586621679761340"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761339"><span class="annot"><a href="#local-6989586621679761339"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier hs-type">TransformerHead</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761338"><span class="annot"><a href="#local-6989586621679761338"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761337"><span class="annot"><a href="#local-6989586621679761337"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761336"><span class="annot"><a href="#local-6989586621679761336"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761335"><span class="annot"><a href="#local-6989586621679761335"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761334"><span class="annot"><a href="#local-6989586621679761334"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761333"><span class="annot"><a href="#local-6989586621679761333"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761332"><span class="annot"><a href="#local-6989586621679761332"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761331"><span class="annot"><a href="#local-6989586621679761331"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761330"><span class="annot"><a href="#local-6989586621679761330"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679761329"><span class="annot"><a href="#local-6989586621679761329"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>  </span><span id="T5Model"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-var">T5Model</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761857"><span class="annot"><a href="#local-6989586621679761857"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679761856"><span class="annot"><a href="#local-6989586621679761856"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679761855"><span class="annot"><a href="#local-6989586621679761855"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span></span><span> </span><span id="local-6989586621679761854"><span class="annot"><a href="#local-6989586621679761854"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span></span><span> </span><span id="local-6989586621679761853"><span class="annot"><a href="#local-6989586621679761853"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761852"><span class="annot"><a href="#local-6989586621679761852"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761851"><span class="annot"><a href="#local-6989586621679761851"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679761850"><span class="annot"><a href="#local-6989586621679761850"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761849"><span class="annot"><a href="#local-6989586621679761849"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679761848"><span class="annot"><a href="#local-6989586621679761848"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761847"><span class="annot"><a href="#local-6989586621679761847"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679761846"><span class="annot"><a href="#local-6989586621679761846"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-type">GT5Model</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-type">T5ModelF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761857"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761856"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761855"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761854"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761853"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761852"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761851"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761850"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761849"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761848"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761847"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761846"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761857"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761856"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761855"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761854"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761853"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761852"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761851"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761850"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761849"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761848"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761847"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761846"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 T5Model
   style
   transformerHead
   numEncoderLayers
   numDecoderLayers
   gradient
   device
   headDim
   headEmbedDim
   embedDim
   inputEmbedDim
   ffnDim
   vocabDim
 -&gt; Rep
      (T5Model
         style
         transformerHead
         numEncoderLayers
         numDecoderLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim)
      x)
-&gt; (forall x.
    Rep
      (T5Model
         style
         transformerHead
         numEncoderLayers
         numDecoderLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim)
      x
    -&gt; T5Model
         style
         transformerHead
         numEncoderLayers
         numDecoderLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim)
-&gt; Generic
     (T5Model
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
forall x.
Rep
  (T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
  x
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
forall x.
T5Model
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; Rep
     (T5Model
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
     x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
Rep
  (T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
  x
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
T5Model
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; Rep
     (T5Model
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
     x
$cto :: forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
Rep
  (T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
  x
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
$cfrom :: forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)) x.
T5Model
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; Rep
     (T5Model
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
     x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-type">T5ModelF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerStyle"><span class="hs-identifier hs-type">TransformerStyle</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#TransformerHead"><span class="hs-identifier hs-type">TransformerHead</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#RequiresGradient"><span class="hs-identifier hs-type">RequiresGradient</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-165"></span><span>  </span><span id="T5ModelF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-var">T5ModelF</span></a></span></span><span> </span><span id="local-6989586621679761324"><span class="annot"><a href="#local-6989586621679761324"><span class="hs-identifier hs-type">style</span></a></span></span><span> </span><span id="local-6989586621679761323"><span class="annot"><a href="#local-6989586621679761323"><span class="hs-identifier hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679761322"><span class="annot"><a href="#local-6989586621679761322"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span></span><span> </span><span id="local-6989586621679761321"><span class="annot"><a href="#local-6989586621679761321"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span></span><span> </span><span id="local-6989586621679761320"><span class="annot"><a href="#local-6989586621679761320"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761319"><span class="annot"><a href="#local-6989586621679761319"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761318"><span class="annot"><a href="#local-6989586621679761318"><span class="hs-identifier hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679761317"><span class="annot"><a href="#local-6989586621679761317"><span class="hs-identifier hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761316"><span class="annot"><a href="#local-6989586621679761316"><span class="hs-identifier hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679761315"><span class="annot"><a href="#local-6989586621679761315"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761314"><span class="annot"><a href="#local-6989586621679761314"><span class="hs-identifier hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679761313"><span class="annot"><a href="#local-6989586621679761313"><span class="hs-identifier hs-type">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679761312"><span class="annot"><a href="#local-6989586621679761312"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621679761312"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679761324"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761323"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761322"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761321"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761320"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761319"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761318"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761317"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761316"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761315"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761314"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761313"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>  </span><span id="T5ModelF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-var">T5ModelF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span id="local-6989586621679761311"><span class="annot"><a href="#local-6989586621679761311"><span class="hs-identifier hs-type hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679761310"><span class="annot"><a href="#local-6989586621679761310"><span class="hs-identifier hs-type hs-type">numLayers</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679761310"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span id="local-6989586621679761309"><span class="annot"><a href="#local-6989586621679761309"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761308"><span class="annot"><a href="#local-6989586621679761308"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761307"><span class="annot"><a href="#local-6989586621679761307"><span class="hs-identifier hs-type hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679761306"><span class="annot"><a href="#local-6989586621679761306"><span class="hs-identifier hs-type hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761305"><span class="annot"><a href="#local-6989586621679761305"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679761304"><span class="annot"><a href="#local-6989586621679761304"><span class="hs-identifier hs-type hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761303"><span class="annot"><a href="#local-6989586621679761303"><span class="hs-identifier hs-type hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679761302"><span class="annot"><a href="#local-6989586621679761302"><span class="hs-identifier hs-type hs-type">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761311"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761310"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761310"><span class="hs-identifier hs-type">numLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761309"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761308"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761307"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761306"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761305"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761304"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761303"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5RelPosEncBucketDim"><span class="hs-identifier hs-type">T5RelPosEncBucketDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761302"><span class="hs-identifier hs-type">vocabDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DropoutP"><span class="hs-identifier hs-type">T5DropoutP</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span id="T5ModelF"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-var">T5ModelF</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier hs-type">ByT5</span></a></span><span> </span><span id="local-6989586621679761301"><span class="annot"><a href="#local-6989586621679761301"><span class="hs-identifier hs-type hs-type">transformerHead</span></a></span></span><span> </span><span id="local-6989586621679761300"><span class="annot"><a href="#local-6989586621679761300"><span class="hs-identifier hs-type hs-type">numEncoderLayers</span></a></span></span><span> </span><span id="local-6989586621679761299"><span class="annot"><a href="#local-6989586621679761299"><span class="hs-identifier hs-type hs-type">numDecoderLayers</span></a></span></span><span> </span><span id="local-6989586621679761298"><span class="annot"><a href="#local-6989586621679761298"><span class="hs-identifier hs-type hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761297"><span class="annot"><a href="#local-6989586621679761297"><span class="hs-identifier hs-type hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761296"><span class="annot"><a href="#local-6989586621679761296"><span class="hs-identifier hs-type hs-type">headDim</span></a></span></span><span> </span><span id="local-6989586621679761295"><span class="annot"><a href="#local-6989586621679761295"><span class="hs-identifier hs-type hs-type">headEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761294"><span class="annot"><a href="#local-6989586621679761294"><span class="hs-identifier hs-type hs-type">embedDim</span></a></span></span><span> </span><span id="local-6989586621679761293"><span class="annot"><a href="#local-6989586621679761293"><span class="hs-identifier hs-type hs-type">inputEmbedDim</span></a></span></span><span> </span><span id="local-6989586621679761292"><span class="annot"><a href="#local-6989586621679761292"><span class="hs-identifier hs-type hs-type">ffnDim</span></a></span></span><span> </span><span id="local-6989586621679761291"><span class="annot"><a href="#local-6989586621679761291"><span class="hs-identifier hs-type hs-type">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ByT5"><span class="hs-identifier hs-type">ByT5</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761301"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761300"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761299"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761298"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761297"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761296"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761295"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761294"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761293"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761292"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5RelPosEncBucketDim"><span class="hs-identifier hs-type">T5RelPosEncBucketDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761291"><span class="hs-identifier hs-type">vocabDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DropoutP"><span class="hs-identifier hs-type">T5DropoutP</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span id="local-6989586621679761279"><span id="local-6989586621679761280"><span id="local-6989586621679761281"><span id="local-6989586621679761282"><span id="local-6989586621679761283"><span id="local-6989586621679761284"><span id="local-6989586621679761285"><span id="local-6989586621679761286"><span id="local-6989586621679761287"><span id="local-6989586621679761288"><span id="local-6989586621679761289"><span id="local-6989586621679761290"><span class="hs-keyword">instance</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761290"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761289"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761288"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761287"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761286"><span class="hs-identifier hs-type">ffnDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-type">SingI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761285"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-type">T5ModelF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761284"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761283"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761282"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761281"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761280"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761279"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761290"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761289"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761288"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761287"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761286"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761285"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761280"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761279"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-type">SDataType</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761290"><span class="hs-identifier hs-type">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761289"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761288"><span class="hs-identifier hs-type">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761287"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761286"><span class="hs-identifier hs-type">ffnDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5RelPosEncBucketDim"><span class="hs-identifier hs-type">T5RelPosEncBucketDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761285"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DropoutP"><span class="hs-identifier hs-type">T5DropoutP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasStateDict"><span class="hs-identifier hs-type">HasStateDict</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761284"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761283"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761282"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761281"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761280"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761279"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761290"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761289"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761288"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761287"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761286"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761285"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-type">SGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761280"><span class="hs-identifier hs-type">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-type">SDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761279"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621679761275"><span class="annot"><span class="annottext">fromStateDict :: (SGradient gradient, SDevice device)
-&gt; StateDictKey
-&gt; m (T5Model
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromStateDict</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679761273"><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679761273"><span class="hs-identifier hs-var">gradient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679761272"><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679761272"><span class="hs-identifier hs-var">device</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679761271"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761271"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761270"><span class="annot"><span class="annottext">headDim :: Sing headDim
</span><a href="#local-6989586621679761270"><span class="hs-identifier hs-var hs-var">headDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI headDim =&gt; Sing headDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679761290"><span class="hs-identifier hs-type">headDim</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span id="local-6989586621679761269"><span class="annot"><span class="annottext">headEmbedDim :: Sing headEmbedDim
</span><a href="#local-6989586621679761269"><span class="hs-identifier hs-var hs-var">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI headEmbedDim =&gt; Sing headEmbedDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679761289"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span id="local-6989586621679761268"><span class="annot"><span class="annottext">embedDim :: Sing embedDim
</span><a href="#local-6989586621679761268"><span class="hs-identifier hs-var hs-var">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI embedDim =&gt; Sing embedDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679761288"><span class="hs-identifier hs-type">embedDim</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span id="local-6989586621679761267"><span class="annot"><span class="annottext">inputEmbedDim :: Sing inputEmbedDim
</span><a href="#local-6989586621679761267"><span class="hs-identifier hs-var hs-var">inputEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI inputEmbedDim =&gt; Sing inputEmbedDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679761287"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span id="local-6989586621679761266"><span class="annot"><span class="annottext">ffnDim :: Sing ffnDim
</span><a href="#local-6989586621679761266"><span class="hs-identifier hs-var hs-var">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI ffnDim =&gt; Sing ffnDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679761286"><span class="hs-identifier hs-type">ffnDim</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621679761265"><span class="annot"><span class="annottext">vocabDim :: Sing vocabDim
</span><a href="#local-6989586621679761265"><span class="hs-identifier hs-var hs-var">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingI vocabDim =&gt; Sing vocabDim
forall k (a :: k). SingI a =&gt; Sing a
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">sing</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679761285"><span class="hs-identifier hs-type">vocabDim</span></a></span><span>
</span><span id="line-195"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GT5Model
  (T5ModelF
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)).
GT5Model
  (T5ModelF
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-var">T5Model</span></a></span><span>
</span><span id="line-196"></span><span>          </span><span class="annot"><span class="annottext">(GT5Model
   (T5ModelF
      style
      transformerHead
      numEncoderLayers
      numDecoderLayers
      gradient
      device
      headDim
      headEmbedDim
      embedDim
      inputEmbedDim
      ffnDim
      vocabDim)
 -&gt; T5Model
      style
      transformerHead
      numEncoderLayers
      numDecoderLayers
      gradient
      device
      headDim
      headEmbedDim
      embedDim
      inputEmbedDim
      ffnDim
      vocabDim)
-&gt; m (GT5Model
        (T5ModelF
           style
           transformerHead
           numEncoderLayers
           numDecoderLayers
           gradient
           device
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           vocabDim))
-&gt; m (T5Model
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; ShiftRight Int
-&gt; ShiftRight Int
-&gt; GT5Model
     (T5ModelF
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
forall t5Model.
t5Model -&gt; ShiftRight Int -&gt; ShiftRight Int -&gt; GT5Model t5Model
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-var">GT5Model</span></a></span><span>
</span><span id="line-197"></span><span>                  </span><span class="annot"><span class="annottext">(T5ModelF
   style
   transformerHead
   numEncoderLayers
   numDecoderLayers
   gradient
   device
   headDim
   headEmbedDim
   embedDim
   inputEmbedDim
   ffnDim
   vocabDim
 -&gt; ShiftRight Int
 -&gt; ShiftRight Int
 -&gt; GT5Model
      (T5ModelF
         style
         transformerHead
         numEncoderLayers
         numDecoderLayers
         gradient
         device
         headDim
         headEmbedDim
         embedDim
         inputEmbedDim
         ffnDim
         vocabDim))
-&gt; m (T5ModelF
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
-&gt; m (ShiftRight Int
      -&gt; ShiftRight Int
      -&gt; GT5Model
           (T5ModelF
              style
              transformerHead
              numEncoderLayers
              numDecoderLayers
              gradient
              device
              headDim
              headEmbedDim
              embedDim
              inputEmbedDim
              ffnDim
              vocabDim))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(SGradient gradient, SDevice device, SDataType T5DataType,
 SDim headDim, SDim headEmbedDim, SDim embedDim, SDim inputEmbedDim,
 SDim ffnDim, SDim T5RelPosEncBucketDim, SDim vocabDim, T5DropoutP,
 Double)
-&gt; StateDictKey
-&gt; m (T5ModelF
        style
        transformerHead
        numEncoderLayers
        numDecoderLayers
        gradient
        device
        headDim
        headEmbedDim
        embedDim
        inputEmbedDim
        ffnDim
        vocabDim)
forall model input (m :: * -&gt; *).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient gradient
</span><a href="#local-6989586621679761273"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679761272"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sing headDim
SDim headDim
</span><a href="#local-6989586621679761270"><span class="hs-identifier hs-var">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sing headEmbedDim
SDim headEmbedDim
</span><a href="#local-6989586621679761269"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sing embedDim
SDim embedDim
</span><a href="#local-6989586621679761268"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sing inputEmbedDim
SDim inputEmbedDim
</span><a href="#local-6989586621679761267"><span class="hs-identifier hs-var">inputEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sing ffnDim
SDim ffnDim
</span><a href="#local-6989586621679761266"><span class="hs-identifier hs-var">ffnDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim T5RelPosEncBucketDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5RelPosEncBucketDim"><span class="hs-identifier hs-var">t5RelPosEncBucketDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Sing vocabDim
SDim vocabDim
</span><a href="#local-6989586621679761265"><span class="hs-identifier hs-var">vocabDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">T5DropoutP
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DropoutP"><span class="hs-identifier hs-var">t5DropoutP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5Eps"><span class="hs-identifier hs-var">t5Eps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761271"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-198"></span><span>                  </span><span class="annot"><span class="annottext">m (ShiftRight Int
   -&gt; ShiftRight Int
   -&gt; GT5Model
        (T5ModelF
           style
           transformerHead
           numEncoderLayers
           numDecoderLayers
           gradient
           device
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           vocabDim))
-&gt; m (ShiftRight Int)
-&gt; m (ShiftRight Int
      -&gt; GT5Model
           (T5ModelF
              style
              transformerHead
              numEncoderLayers
              numDecoderLayers
              gradient
              device
              headDim
              headEmbedDim
              embedDim
              inputEmbedDim
              ffnDim
              vocabDim))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; StateDictKey -&gt; m (ShiftRight Int)
forall model input (m :: * -&gt; *).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5BOSTokenId"><span class="hs-identifier hs-var">t5BOSTokenId</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761271"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-199"></span><span>                  </span><span class="annot"><span class="annottext">m (ShiftRight Int
   -&gt; GT5Model
        (T5ModelF
           style
           transformerHead
           numEncoderLayers
           numDecoderLayers
           gradient
           device
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           vocabDim))
-&gt; m (ShiftRight Int)
-&gt; m (GT5Model
        (T5ModelF
           style
           transformerHead
           numEncoderLayers
           numDecoderLayers
           gradient
           device
           headDim
           headEmbedDim
           embedDim
           inputEmbedDim
           ffnDim
           vocabDim))
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; StateDictKey -&gt; m (ShiftRight Int)
forall model input (m :: * -&gt; *).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
input -&gt; StateDictKey -&gt; m model
</span><a href="Torch.GraduallyTyped.NN.Class.html#fromStateDict"><span class="hs-identifier hs-var">fromStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761271"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-200"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621679761263"><span class="annot"><span class="annottext">toStateDict :: StateDictKey
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
-&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var hs-var hs-var hs-var">toStateDict</span></a></span></span><span> </span><span id="local-6989586621679761261"><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761261"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-type">GT5Model</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679761258"><span id="local-6989586621679761259"><span id="local-6989586621679761260"><span class="annot"><span class="annottext">ShiftRight Int
T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
t5ShiftRightPaddingMask :: ShiftRight Int
t5ShiftRightDecoderInput :: ShiftRight Int
t5Model :: T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
t5ShiftRightPaddingMask :: forall t5Model. GT5Model t5Model -&gt; ShiftRight Int
t5ShiftRightDecoderInput :: forall t5Model. GT5Model t5Model -&gt; ShiftRight Int
t5Model :: forall t5Model. GT5Model t5Model -&gt; t5Model
</span><a href="#local-6989586621679761258"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey
-&gt; T5ModelF
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
-&gt; m ()
forall model input (m :: * -&gt; *).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761261"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
</span><a href="#local-6989586621679761260"><span class="hs-identifier hs-var">t5Model</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey -&gt; ShiftRight Int -&gt; m ()
forall model input (m :: * -&gt; *).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761261"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679761259"><span class="hs-identifier hs-var">t5ShiftRightDecoderInput</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">StateDictKey -&gt; ShiftRight Int -&gt; m ()
forall model input (m :: * -&gt; *).
(HasStateDict model input, MonadThrow m, MonadState StateDict m) =&gt;
StateDictKey -&gt; model -&gt; m ()
</span><a href="Torch.GraduallyTyped.NN.Class.html#toStateDict"><span class="hs-identifier hs-var">toStateDict</span></a></span><span> </span><span class="annot"><span class="annottext">StateDictKey
</span><a href="#local-6989586621679761261"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679761258"><span class="hs-identifier hs-var">t5ShiftRightPaddingMask</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5Input"><span class="hs-identifier hs-type">mkT5Input</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761256"><span class="annot"><a href="#local-6989586621679761256"><span class="hs-identifier hs-type">batchDim</span></a></span></span><span> </span><span id="local-6989586621679761255"><span class="annot"><a href="#local-6989586621679761255"><span class="hs-identifier hs-type">seqDim</span></a></span></span><span> </span><span id="local-6989586621679761254"><span class="annot"><a href="#local-6989586621679761254"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679761253"><span class="annot"><a href="#local-6989586621679761253"><span class="hs-identifier hs-type">output</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761254"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#KnownDim"><span class="hs-identifier hs-type">KnownDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761256"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#KnownDim"><span class="hs-identifier hs-type">KnownDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761255"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="#local-6989586621679761253"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-212"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithoutGradient"><span class="hs-identifier hs-type">WithoutGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#Device"><span class="hs-identifier hs-type">Device</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Device.html#CPU"><span class="hs-identifier hs-type">CPU</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679761256"><span class="hs-identifier hs-type">batchDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679761255"><span class="hs-identifier hs-type">seqDim</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761256"><span class="hs-identifier hs-type">batchDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#SDim"><span class="hs-identifier hs-type">SDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761255"><span class="hs-identifier hs-type">seqDim</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><a href="#local-6989586621679761254"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761253"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-223"></span><span id="mkT5Input"><span class="annot"><span class="annottext">mkT5Input :: SDim batchDim -&gt; SDim seqDim -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5Input"><span class="hs-identifier hs-var hs-var">mkT5Input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDim batchDim -&gt; SDim seqDim -&gt; [[Int]] -&gt; m output
forall (batchDim :: Dim (Name Symbol) (Size Nat))
       (seqDim :: Dim (Name Symbol) (Size Nat)) (m :: * -&gt; *) output.
(MonadThrow m,
 output
 ~ Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape '[batchDim, seqDim])) =&gt;
Int -&gt; SDim batchDim -&gt; SDim seqDim -&gt; [[Int]] -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerInput"><span class="hs-identifier hs-var">mkTransformerInput</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5PadTokenId"><span class="hs-identifier hs-var">t5PadTokenId</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5PaddingMask"><span class="hs-identifier hs-type">mkT5PaddingMask</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761549"><span class="annot"><a href="#local-6989586621679761549"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761554"><span class="annot"><a href="#local-6989586621679761554"><span class="hs-identifier hs-type">layout</span></a></span></span><span> </span><span id="local-6989586621679761553"><span class="annot"><a href="#local-6989586621679761553"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761552"><span class="annot"><a href="#local-6989586621679761552"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679761551"><span class="annot"><a href="#local-6989586621679761551"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span id="local-6989586621679761550"><span class="annot"><a href="#local-6989586621679761550"><span class="hs-identifier hs-type">output</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761554"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761553"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761552"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761551"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761550"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761549"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761554"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761553"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761552"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761551"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="#local-6989586621679761550"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-230"></span><span id="mkT5PaddingMask"><span class="annot"><span class="annottext">mkT5PaddingMask :: Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5PaddingMask"><span class="hs-identifier hs-var hs-var">mkT5PaddingMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Tensor gradient layout device dataType shape -&gt; output
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Int -&gt; Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerPaddingMask"><span class="hs-identifier hs-var">mkTransformerPaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5PadTokenId"><span class="hs-identifier hs-var">t5PadTokenId</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- &gt;&gt;&gt; mkRelPos' 32 128 21 17</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- [[0,17,18,19,20,21,22,23,24,24,24,24,25,25,25,25,26],[1,0,17,18,19,20,21,22,23,24,24,24,24,25,25,25,25],[2,1,0,17,18,19,20,21,22,23,24,24,24,24,25,25,25],[3,2,1,0,17,18,19,20,21,22,23,24,24,24,24,25,25],[4,3,2,1,0,17,18,19,20,21,22,23,24,24,24,24,25],[5,4,3,2,1,0,17,18,19,20,21,22,23,24,24,24,24],[6,5,4,3,2,1,0,17,18,19,20,21,22,23,24,24,24],[7,6,5,4,3,2,1,0,17,18,19,20,21,22,23,24,24],[8,7,6,5,4,3,2,1,0,17,18,19,20,21,22,23,24],[8,8,7,6,5,4,3,2,1,0,17,18,19,20,21,22,23],[8,8,8,7,6,5,4,3,2,1,0,17,18,19,20,21,22],[8,8,8,8,7,6,5,4,3,2,1,0,17,18,19,20,21],[9,8,8,8,8,7,6,5,4,3,2,1,0,17,18,19,20],[9,9,8,8,8,8,7,6,5,4,3,2,1,0,17,18,19],[9,9,9,8,8,8,8,7,6,5,4,3,2,1,0,17,18],[9,9,9,9,8,8,8,8,7,6,5,4,3,2,1,0,17],[10,9,9,9,9,8,8,8,8,7,6,5,4,3,2,1,0],[10,10,9,9,9,9,8,8,8,8,7,6,5,4,3,2,1],[10,10,10,9,9,9,9,8,8,8,8,7,6,5,4,3,2],[10,10,10,10,9,9,9,9,8,8,8,8,7,6,5,4,3],[10,10,10,10,10,9,9,9,9,8,8,8,8,7,6,5,4]]</span><span>
</span><span id="line-234"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5RelPos%27"><span class="hs-identifier hs-type">mkT5RelPos'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-235"></span><span id="mkT5RelPos%27"><span class="annot"><span class="annottext">mkT5RelPos' :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; [[Int]]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5RelPos%27"><span class="hs-identifier hs-var hs-var">mkT5RelPos'</span></a></span></span><span> </span><span id="local-6989586621679761250"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761250"><span class="hs-identifier hs-var">numBuckets</span></a></span></span><span> </span><span id="local-6989586621679761249"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761249"><span class="hs-identifier hs-var">maxDistance</span></a></span></span><span> </span><span id="local-6989586621679761248"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761248"><span class="hs-identifier hs-var">querySize</span></a></span></span><span> </span><span id="local-6989586621679761247"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761247"><span class="hs-identifier hs-var">keySize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761246"><span class="annot"><span class="annottext">queryPos :: [Int]
</span><a href="#local-6989586621679761246"><span class="hs-identifier hs-var hs-var">queryPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761248"><span class="hs-identifier hs-var">querySize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span>      </span><span id="local-6989586621679761245"><span class="annot"><span class="annottext">keyPos :: [Int]
</span><a href="#local-6989586621679761245"><span class="hs-identifier hs-var hs-var">keyPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761247"><span class="hs-identifier hs-var">keySize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621679761244"><span class="annot"><span class="annottext">numBuckets' :: Int
</span><a href="#local-6989586621679761244"><span class="hs-identifier hs-var hs-var">numBuckets'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761250"><span class="hs-identifier hs-var">numBuckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-239"></span><span>      </span><span id="local-6989586621679761242"><span class="annot"><span class="annottext">maxExact :: Int
</span><a href="#local-6989586621679761242"><span class="hs-identifier hs-var hs-var">maxExact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761244"><span class="hs-identifier hs-var">numBuckets'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-240"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; [Int] -&gt; [[Int]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679761241"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761241"><span class="hs-identifier hs-var">qp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-242"></span><span>            </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; [Int] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-243"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679761240"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761240"><span class="hs-identifier hs-var">kp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-244"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761239"><span class="annot"><span class="annottext">rawRelPos :: Int
</span><a href="#local-6989586621679761239"><span class="hs-identifier hs-var hs-var">rawRelPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761240"><span class="hs-identifier hs-var">kp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761241"><span class="hs-identifier hs-var">qp</span></a></span><span>
</span><span id="line-245"></span><span>                      </span><span id="local-6989586621679761238"><span class="annot"><span class="annottext">absRelPos :: Int
</span><a href="#local-6989586621679761238"><span class="hs-identifier hs-var hs-var">absRelPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761239"><span class="hs-identifier hs-var">rawRelPos</span></a></span><span>
</span><span id="line-246"></span><span>                      </span><span id="local-6989586621679761236"><span class="annot"><span class="annottext">relBucket :: Int
</span><a href="#local-6989586621679761236"><span class="hs-identifier hs-var hs-var">relBucket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761239"><span class="hs-identifier hs-var">rawRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761244"><span class="hs-identifier hs-var">numBuckets'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-247"></span><span>                      </span><span id="local-6989586621679761234"><span class="annot"><span class="annottext">relBucket' :: Int
</span><a href="#local-6989586621679761234"><span class="hs-identifier hs-var hs-var">relBucket'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761233"><span class="annot"><span class="annottext">isSmall :: Bool
</span><a href="#local-6989586621679761233"><span class="hs-identifier hs-var hs-var">isSmall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761238"><span class="hs-identifier hs-var">absRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761242"><span class="hs-identifier hs-var">maxExact</span></a></span><span>
</span><span id="line-249"></span><span>                            </span><span id="local-6989586621679761231"><span class="annot"><span class="annottext">relPosIfLarge :: Int
</span><a href="#local-6989586621679761231"><span class="hs-identifier hs-var hs-var">relPosIfLarge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>                              </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761242"><span class="hs-identifier hs-var">maxExact</span></a></span><span>
</span><span id="line-251"></span><span>                                </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
</span><span class="hs-identifier hs-var">double2Int</span></span><span>
</span><span id="line-252"></span><span>                                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">logBase</span></span><span>
</span><span id="line-253"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761249"><span class="hs-identifier hs-var">maxDistance</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761242"><span class="hs-identifier hs-var">maxExact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761238"><span class="hs-identifier hs-var">absRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761242"><span class="hs-identifier hs-var">maxExact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>                                      </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761244"><span class="hs-identifier hs-var">numBuckets'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761242"><span class="hs-identifier hs-var">maxExact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                                  </span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>                            </span><span id="local-6989586621679761226"><span class="annot"><span class="annottext">relPosIfLarge' :: Int
</span><a href="#local-6989586621679761226"><span class="hs-identifier hs-var hs-var">relPosIfLarge'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761231"><span class="hs-identifier hs-var">relPosIfLarge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761244"><span class="hs-identifier hs-var">numBuckets'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679761233"><span class="hs-identifier hs-var">isSmall</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761238"><span class="hs-identifier hs-var">absRelPos</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761226"><span class="hs-identifier hs-var">relPosIfLarge'</span></a></span><span>
</span><span id="line-259"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761236"><span class="hs-identifier hs-var">relBucket</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761234"><span class="hs-identifier hs-var">relBucket'</span></a></span><span>
</span><span id="line-260"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>              </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679761245"><span class="hs-identifier hs-var">keyPos</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679761246"><span class="hs-identifier hs-var">queryPos</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-keyword">type</span><span> </span><span id="MkT5RelPosC"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#MkT5RelPosC"><span class="hs-identifier hs-var">MkT5RelPosC</span></a></span></span><span> </span><span id="local-6989586621679761224"><span class="annot"><a href="#local-6989586621679761224"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761223"><span class="annot"><a href="#local-6989586621679761223"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span id="local-6989586621679761222"><span class="annot"><a href="#local-6989586621679761222"><span class="hs-identifier hs-type">seqDim</span></a></span></span><span> </span><span id="local-6989586621679761221"><span class="annot"><a href="#local-6989586621679761221"><span class="hs-identifier hs-type">seqName</span></a></span></span><span> </span><span id="local-6989586621679761220"><span class="annot"><a href="#local-6989586621679761220"><span class="hs-identifier hs-type">seqSize</span></a></span></span><span> </span><span id="local-6989586621679761219"><span class="annot"><a href="#local-6989586621679761219"><span class="hs-identifier hs-type">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetDevice"><span class="hs-identifier hs-type">SGetDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761224"><span class="hs-identifier hs-type">device</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#SGetShape"><span class="hs-identifier hs-type">SGetShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761223"><span class="hs-identifier hs-type">shape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="#local-6989586621679761222"><span class="hs-identifier hs-type">seqDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679761223"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Class.html#%21"><span class="hs-glyph hs-type">!</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><a href="#local-6989586621679761222"><span class="hs-identifier hs-type">seqDim</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761221"><span class="hs-identifier hs-type">seqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761220"><span class="hs-identifier hs-type">seqSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="#local-6989586621679761219"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span>
</span><span id="line-272"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#Gradient"><span class="hs-identifier hs-type">Gradient</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.RequiresGradient.html#WithoutGradient"><span class="hs-identifier hs-type">WithoutGradient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Layout"><span class="hs-identifier hs-type">Layout</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Layout.html#Dense"><span class="hs-identifier hs-type">Dense</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><a href="#local-6989586621679761224"><span class="hs-identifier hs-type">device</span></a></span><span>
</span><span id="line-275"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.DType.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Size"><span class="hs-identifier hs-type">Size</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679761220"><span class="hs-identifier hs-type">seqSize</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Dim"><span class="hs-identifier hs-type">Dim</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.Shape.Type.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679761220"><span class="hs-identifier hs-type">seqSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5RelPos"><span class="hs-identifier hs-type">mkT5RelPos</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761534"><span class="annot"><a href="#local-6989586621679761534"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679761527"><span class="annot"><a href="#local-6989586621679761527"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761526"><span class="annot"><a href="#local-6989586621679761526"><span class="hs-identifier hs-type">layout</span></a></span></span><span> </span><span id="local-6989586621679761533"><span class="annot"><a href="#local-6989586621679761533"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761525"><span class="annot"><a href="#local-6989586621679761525"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679761532"><span class="annot"><a href="#local-6989586621679761532"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span id="local-6989586621679761531"><span class="annot"><a href="#local-6989586621679761531"><span class="hs-identifier hs-type">seqDim</span></a></span></span><span> </span><span id="local-6989586621679761530"><span class="annot"><a href="#local-6989586621679761530"><span class="hs-identifier hs-type">seqName</span></a></span></span><span> </span><span id="local-6989586621679761529"><span class="annot"><a href="#local-6989586621679761529"><span class="hs-identifier hs-type">seqSize</span></a></span></span><span> </span><span id="local-6989586621679761528"><span class="annot"><a href="#local-6989586621679761528"><span class="hs-identifier hs-type">output</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761534"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#MkT5RelPosC"><span class="hs-identifier hs-type">MkT5RelPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761533"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761532"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761531"><span class="hs-identifier hs-type">seqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761530"><span class="hs-identifier hs-type">seqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761529"><span class="hs-identifier hs-type">seqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761528"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-comment">-- | input tensor</span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761527"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761526"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761533"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761525"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761532"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-comment">-- | relative positions of the input tokens</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><a href="#local-6989586621679761534"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761528"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-288"></span><span id="mkT5RelPos"><span class="annot"><span class="annottext">mkT5RelPos :: Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5RelPos"><span class="hs-identifier hs-var hs-var">mkT5RelPos</span></a></span></span><span> </span><span id="local-6989586621679761217"><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679761217"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761216"><span class="annot"><span class="annottext">device :: SDevice device
</span><a href="#local-6989586621679761216"><span class="hs-identifier hs-var hs-var">device</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape -&gt; SDevice device
forall (device :: Device (DeviceType Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGetDevice device =&gt;
Tensor gradient layout device dataType shape -&gt; SDevice device
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sDevice"><span class="hs-identifier hs-var">sDevice</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679761217"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-290"></span><span>      </span><span id="local-6989586621679761215"><span class="annot"><span class="annottext">shape :: SShape shape
</span><a href="#local-6989586621679761215"><span class="hs-identifier hs-var hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape -&gt; SShape shape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679761217"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span id="local-6989586621679761214"><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761214"><span class="hs-identifier hs-var">seqDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 1))
-&gt; SShape shape -&gt; m (SDim ('Dim seqName seqSize))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: * -&gt; *).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1)))
-&gt; SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SBy ('ByIndex 1)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape shape
</span><a href="#local-6989586621679761215"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761211"><span class="annot"><span class="annottext">seqSize :: Int
</span><a href="#local-6989586621679761211"><span class="hs-identifier hs-var hs-var">seqSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int)
-&gt; (SSize seqSize -&gt; Integer) -&gt; SSize seqSize -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SSize seqSize -&gt; IsChecked Integer) -&gt; SSize seqSize -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SSize seqSize -&gt; IsChecked Integer
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SSize seqSize -&gt; Int) -&gt; SSize seqSize -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize) -&gt; SSize seqSize
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761214"><span class="hs-identifier hs-var">seqDim</span></a></span><span>
</span><span id="line-293"></span><span>      </span><span id="local-6989586621679761208"><span class="annot"><span class="annottext">relPosEncBucketSize :: Int
</span><a href="#local-6989586621679761208"><span class="hs-identifier hs-var hs-var">relPosEncBucketSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int)
-&gt; (SSize ('Size 32) -&gt; Integer) -&gt; SSize ('Size 32) -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SSize ('Size 32) -&gt; IsChecked Integer)
-&gt; SSize ('Size 32)
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SSize ('Size 32) -&gt; IsChecked Integer
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SSize ('Size 32) -&gt; Int) -&gt; SSize ('Size 32) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim T5RelPosEncBucketDim -&gt; SSize ('Size 32)
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim T5RelPosEncBucketDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5RelPosEncBucketDim"><span class="hs-identifier hs-var">t5RelPosEncBucketDim</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[[Int]]] -&gt; Tensor
forall a. TensorLike a =&gt; a -&gt; Tensor
</span><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-var">Torch.Tensor.asTensor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; [[Int]]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5RelPos%27"><span class="hs-identifier hs-var">mkT5RelPos'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761208"><span class="hs-identifier hs-var">relPosEncBucketSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5MaxDistance"><span class="hs-identifier hs-var">t5MaxDistance</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761211"><span class="hs-identifier hs-var">seqSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761211"><span class="hs-identifier hs-var">seqSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">Torch.Tensor.Unsafe</span></a></span><span> </span><span id="local-6989586621679761207"><span class="annot"><span class="annottext">ATenTensor
</span><a href="#local-6989586621679761207"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="annottext">UncheckedTensor -&gt; m UncheckedTensor
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ATenTensor -&gt; UncheckedTensor
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
ATenTensor -&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#UnsafeTensor"><span class="hs-identifier hs-var">UnsafeTensor</span></a></span><span> </span><span class="annot"><span class="annottext">ATenTensor
</span><a href="#local-6989586621679761207"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#UncheckedTensor"><span class="hs-identifier hs-type">UncheckedTensor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">m UncheckedTensor
-&gt; (UncheckedTensor
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            'UncheckedLayout
            'UncheckedDevice
            'UncheckedDataType
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        'UncheckedLayout
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UncheckedTensor
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        'UncheckedLayout
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (gradient' :: Gradient RequiresGradient) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SingI gradient', SGetGradient gradient, MonadThrow m) =&gt;
Tensor gradient layout device dataType shape
-&gt; m (Tensor
        (Seq (gradient &lt;+&gt; gradient') gradient')
        layout
        device
        dataType
        shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedGradient"><span class="hs-identifier hs-var">checkedGradient</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     'UncheckedLayout
     'UncheckedDevice
     'UncheckedDataType
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      'UncheckedLayout
      'UncheckedDevice
      'UncheckedDataType
      'UncheckedShape
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            'UncheckedDevice
            'UncheckedDataType
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  'UncheckedLayout
  'UncheckedDevice
  'UncheckedDataType
  'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (layout' :: Layout LayoutType) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SingI layout', SGetLayout layout, MonadThrow m) =&gt;
Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient (Seq (layout &lt;+&gt; layout') layout') device dataType shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedLayout"><span class="hs-identifier hs-var">checkedLayout</span></a></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     'UncheckedDevice
     'UncheckedDataType
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      'UncheckedDevice
      'UncheckedDataType
      'UncheckedShape
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            device
            'UncheckedDataType
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        'UncheckedDataType
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SDevice device
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     'UncheckedDevice
     'UncheckedDataType
     'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        (Seq ('UncheckedDevice &lt;+&gt; device) device)
        'UncheckedDataType
        'UncheckedShape)
forall (device' :: Device (DeviceType Nat)) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SGetDevice device, MonadThrow m) =&gt;
SDevice device'
-&gt; Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient layout (Seq (device &lt;+&gt; device') device') dataType shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sCheckedDevice"><span class="hs-identifier hs-var">sCheckedDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679761216"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     'UncheckedDataType
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      device
      'UncheckedDataType
      'UncheckedShape
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            device
            ('DataType 'Int64)
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        ('DataType 'Int64)
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  device
  'UncheckedDataType
  'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        ('DataType 'Int64)
        'UncheckedShape)
forall (dataType' :: DataType DType) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SingI dataType', SGetDataType dataType, MonadThrow m) =&gt;
Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient
        layout
        device
        (Seq (dataType &lt;+&gt; dataType') dataType')
        shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedDataType"><span class="hs-identifier hs-var">checkedDataType</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      device
      ('DataType 'Int64)
      'UncheckedShape
    -&gt; m output)
-&gt; m output
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SShape
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
        'Dim ('Name &quot;*&quot;) seqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        ('DataType 'Int64)
        (Seq
           ('UncheckedShape
            &lt;+&gt; 'Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
                     'Dim ('Name &quot;*&quot;) seqSize])
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
                 'Dim ('Name &quot;*&quot;) seqSize])))
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SGetShape shape, MonadThrow m) =&gt;
SShape shape'
-&gt; Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient layout device dataType (Seq (shape &lt;+&gt; shape') shape'))
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sCheckedShape"><span class="hs-identifier hs-var">sCheckedShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
     'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
           'Dim ('Name &quot;*&quot;) seqSize])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
      'Dim ('Name &quot;*&quot;) seqSize]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
            'Dim ('Name &quot;*&quot;) seqSize]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
        'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
           'Dim ('Name &quot;*&quot;) seqSize])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize, 'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
        'Dim ('Name &quot;*&quot;) seqSize]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize seqSize -&gt; SDim ('Dim ('Name &quot;*&quot;) seqSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize) -&gt; SSize seqSize
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761214"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) seqSize)
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize, 'Dim ('Name &quot;*&quot;) seqSize]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize seqSize -&gt; SDim ('Dim ('Name &quot;*&quot;) seqSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize) -&gt; SSize seqSize
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761214"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) seqSize)
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- &gt;&gt;&gt; mkDecoderRelPos' 32 128 21 17</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- [[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0],[6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0],[7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0],[8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0],[9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0],[10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0],[11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0],[12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0],[13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0],[14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0],[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0],[16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0],[16,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],[16,16,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2],[17,16,16,16,15,14,13,12,11,10,9,8,7,6,5,4,3],[17,17,16,16,16,15,14,13,12,11,10,9,8,7,6,5,4]]</span><span>
</span><span id="line-305"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos%27"><span class="hs-identifier hs-type">mkT5DecoderRelPos'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-306"></span><span id="mkT5DecoderRelPos%27"><span class="annot"><span class="annottext">mkT5DecoderRelPos' :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; [[Int]]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos%27"><span class="hs-identifier hs-var hs-var">mkT5DecoderRelPos'</span></a></span></span><span> </span><span id="local-6989586621679761200"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761200"><span class="hs-identifier hs-var">numBuckets</span></a></span></span><span> </span><span id="local-6989586621679761199"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761199"><span class="hs-identifier hs-var">maxDistance</span></a></span></span><span> </span><span id="local-6989586621679761198"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761198"><span class="hs-identifier hs-var">querySize</span></a></span></span><span> </span><span id="local-6989586621679761197"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761197"><span class="hs-identifier hs-var">keySize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761196"><span class="annot"><span class="annottext">queryPos :: [Int]
</span><a href="#local-6989586621679761196"><span class="hs-identifier hs-var hs-var">queryPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761198"><span class="hs-identifier hs-var">querySize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-308"></span><span>      </span><span id="local-6989586621679761195"><span class="annot"><span class="annottext">keyPos :: [Int]
</span><a href="#local-6989586621679761195"><span class="hs-identifier hs-var hs-var">keyPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761197"><span class="hs-identifier hs-var">keySize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621679761194"><span class="annot"><span class="annottext">maxExact :: Int
</span><a href="#local-6989586621679761194"><span class="hs-identifier hs-var hs-var">maxExact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761200"><span class="hs-identifier hs-var">numBuckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-310"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int]) -&gt; [Int] -&gt; [[Int]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679761193"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761193"><span class="hs-identifier hs-var">qp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-312"></span><span>            </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; [Int] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-313"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679761192"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761192"><span class="hs-identifier hs-var">kp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761191"><span class="annot"><span class="annottext">rawRelPos :: Int
</span><a href="#local-6989586621679761191"><span class="hs-identifier hs-var hs-var">rawRelPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761192"><span class="hs-identifier hs-var">kp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761193"><span class="hs-identifier hs-var">qp</span></a></span><span>
</span><span id="line-315"></span><span>                      </span><span id="local-6989586621679761190"><span class="annot"><span class="annottext">absRelPos :: Int
</span><a href="#local-6989586621679761190"><span class="hs-identifier hs-var hs-var">absRelPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761191"><span class="hs-identifier hs-var">rawRelPos</span></a></span><span>
</span><span id="line-316"></span><span>                      </span><span id="local-6989586621679761189"><span class="annot"><span class="annottext">relBucket' :: Int
</span><a href="#local-6989586621679761189"><span class="hs-identifier hs-var hs-var">relBucket'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-317"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761188"><span class="annot"><span class="annottext">isSmall :: Bool
</span><a href="#local-6989586621679761188"><span class="hs-identifier hs-var hs-var">isSmall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761190"><span class="hs-identifier hs-var">absRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761194"><span class="hs-identifier hs-var">maxExact</span></a></span><span>
</span><span id="line-318"></span><span>                            </span><span id="local-6989586621679761187"><span class="annot"><span class="annottext">relPosIfLarge :: Int
</span><a href="#local-6989586621679761187"><span class="hs-identifier hs-var hs-var">relPosIfLarge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>                              </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761194"><span class="hs-identifier hs-var">maxExact</span></a></span><span>
</span><span id="line-320"></span><span>                                </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int
</span><span class="hs-identifier hs-var">double2Int</span></span><span>
</span><span id="line-321"></span><span>                                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">logBase</span></span><span>
</span><span id="line-322"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761199"><span class="hs-identifier hs-var">maxDistance</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761194"><span class="hs-identifier hs-var">maxExact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761190"><span class="hs-identifier hs-var">absRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761194"><span class="hs-identifier hs-var">maxExact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                                      </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761200"><span class="hs-identifier hs-var">numBuckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761194"><span class="hs-identifier hs-var">maxExact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>                                  </span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>                            </span><span id="local-6989586621679761186"><span class="annot"><span class="annottext">relPosIfLarge' :: Int
</span><a href="#local-6989586621679761186"><span class="hs-identifier hs-var hs-var">relPosIfLarge'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761187"><span class="hs-identifier hs-var">relPosIfLarge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761200"><span class="hs-identifier hs-var">numBuckets</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679761188"><span class="hs-identifier hs-var">isSmall</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761190"><span class="hs-identifier hs-var">absRelPos</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761186"><span class="hs-identifier hs-var">relPosIfLarge'</span></a></span><span>
</span><span id="line-328"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761189"><span class="hs-identifier hs-var">relBucket'</span></a></span><span>
</span><span id="line-329"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>              </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679761195"><span class="hs-identifier hs-var">keyPos</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679761196"><span class="hs-identifier hs-var">queryPos</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos"><span class="hs-identifier hs-type">mkT5DecoderRelPos</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761184"><span class="annot"><a href="#local-6989586621679761184"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679761183"><span class="annot"><a href="#local-6989586621679761183"><span class="hs-identifier hs-type">gradient</span></a></span></span><span> </span><span id="local-6989586621679761182"><span class="annot"><a href="#local-6989586621679761182"><span class="hs-identifier hs-type">layout</span></a></span></span><span> </span><span id="local-6989586621679761181"><span class="annot"><a href="#local-6989586621679761181"><span class="hs-identifier hs-type">device</span></a></span></span><span> </span><span id="local-6989586621679761180"><span class="annot"><a href="#local-6989586621679761180"><span class="hs-identifier hs-type">dataType</span></a></span></span><span> </span><span id="local-6989586621679761179"><span class="annot"><a href="#local-6989586621679761179"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span id="local-6989586621679761178"><span class="annot"><a href="#local-6989586621679761178"><span class="hs-identifier hs-type">seqDim</span></a></span></span><span> </span><span id="local-6989586621679761177"><span class="annot"><a href="#local-6989586621679761177"><span class="hs-identifier hs-type">seqName</span></a></span></span><span> </span><span id="local-6989586621679761176"><span class="annot"><a href="#local-6989586621679761176"><span class="hs-identifier hs-type">seqSize</span></a></span></span><span> </span><span id="local-6989586621679761175"><span class="annot"><a href="#local-6989586621679761175"><span class="hs-identifier hs-type">output</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///nix/store/ifacyhfpnb9wrd20q18ymi87z39k1h67-exceptions-lib-exceptions-0.10.4-haddock-doc/share/doc/exceptions/html/src"><span class="hs-identifier hs-type">MonadThrow</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#MkT5RelPosC"><span class="hs-identifier hs-type">MkT5RelPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761181"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761179"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761178"><span class="hs-identifier hs-type">seqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761177"><span class="hs-identifier hs-type">seqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761176"><span class="hs-identifier hs-type">seqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761175"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-comment">-- | decoder input tensor</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761183"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761182"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761181"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761180"><span class="hs-identifier hs-type">dataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761179"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-comment">-- | relative positions of the input tokens</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><a href="#local-6989586621679761184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761175"><span class="hs-identifier hs-type">output</span></a></span><span>
</span><span id="line-343"></span><span id="mkT5DecoderRelPos"><span class="annot"><span class="annottext">mkT5DecoderRelPos :: Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos"><span class="hs-identifier hs-var hs-var">mkT5DecoderRelPos</span></a></span></span><span> </span><span id="local-6989586621679761174"><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679761174"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761173"><span class="annot"><span class="annottext">device :: SDevice device
</span><a href="#local-6989586621679761173"><span class="hs-identifier hs-var hs-var">device</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape -&gt; SDevice device
forall (device :: Device (DeviceType Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGetDevice device =&gt;
Tensor gradient layout device dataType shape -&gt; SDevice device
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sDevice"><span class="hs-identifier hs-var">sDevice</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679761174"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621679761172"><span class="annot"><span class="annottext">shape :: SShape shape
</span><a href="#local-6989586621679761172"><span class="hs-identifier hs-var hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape -&gt; SShape shape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor gradient layout device dataType shape
</span><a href="#local-6989586621679761174"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span id="local-6989586621679761171"><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761171"><span class="hs-identifier hs-var">seqDim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SSelectDim ('SelectDim ('ByIndex 1))
-&gt; SShape shape -&gt; m (SDim ('Dim seqName seqSize))
forall (selectDim :: SelectDim (By Symbol Nat))
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (dim :: Dim (Name Symbol) (Size Nat)) (m :: * -&gt; *).
(dim ~ GetDimF selectDim shape, MonadThrow m) =&gt;
SSelectDim selectDim -&gt; SShape shape -&gt; m (SDim dim)
</span><a href="Torch.GraduallyTyped.Shape.Class.html#sGetDim"><span class="hs-identifier hs-var">sGetDim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall (by :: By Symbol Nat). SBy by -&gt; SSelectDim ('SelectDim by)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSelectDim"><span class="hs-identifier hs-var">SSelectDim</span></a></span><span> </span><span class="annot"><span class="annottext">(SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1)))
-&gt; SBy ('ByIndex 1) -&gt; SSelectDim ('SelectDim ('ByIndex 1))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SBy ('ByIndex 1)
forall (index :: Nat). KnownNat index =&gt; SBy ('ByIndex index)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SByIndex"><span class="hs-identifier hs-var">SByIndex</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SShape shape
</span><a href="#local-6989586621679761172"><span class="hs-identifier hs-var">shape</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761170"><span class="annot"><span class="annottext">seqSize :: Int
</span><a href="#local-6989586621679761170"><span class="hs-identifier hs-var hs-var">seqSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int)
-&gt; (SSize seqSize -&gt; Integer) -&gt; SSize seqSize -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SSize seqSize -&gt; IsChecked Integer) -&gt; SSize seqSize -&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SSize seqSize -&gt; IsChecked Integer
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SSize seqSize -&gt; Int) -&gt; SSize seqSize -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize) -&gt; SSize seqSize
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761171"><span class="hs-identifier hs-var">seqDim</span></a></span><span>
</span><span id="line-348"></span><span>      </span><span id="local-6989586621679761169"><span class="annot"><span class="annottext">relPosEncBucketSize :: Int
</span><a href="#local-6989586621679761169"><span class="hs-identifier hs-var hs-var">relPosEncBucketSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Int)
-&gt; (SSize ('Size 32) -&gt; Integer) -&gt; SSize ('Size 32) -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IsChecked Integer -&gt; Integer
forall a. IsChecked a -&gt; a
</span><a href="Torch.GraduallyTyped.Prelude.html#forgetIsChecked"><span class="hs-identifier hs-var">forgetIsChecked</span></a></span><span> </span><span class="annot"><span class="annottext">(IsChecked Integer -&gt; Integer)
-&gt; (SSize ('Size 32) -&gt; IsChecked Integer)
-&gt; SSize ('Size 32)
-&gt; Integer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SSize ('Size 32) -&gt; IsChecked Integer
forall k (a :: k). SingKind k =&gt; Sing a -&gt; Demote k
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">fromSing</span></a></span><span> </span><span class="annot"><span class="annottext">(SSize ('Size 32) -&gt; Int) -&gt; SSize ('Size 32) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim T5RelPosEncBucketDim -&gt; SSize ('Size 32)
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim T5RelPosEncBucketDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5RelPosEncBucketDim"><span class="hs-identifier hs-var">t5RelPosEncBucketDim</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[[[Int]]] -&gt; Tensor
forall a. TensorLike a =&gt; a -&gt; Tensor
</span><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-var">Torch.Tensor.asTensor</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; [[Int]]
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos%27"><span class="hs-identifier hs-var">mkT5DecoderRelPos'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761169"><span class="hs-identifier hs-var">relPosEncBucketSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5MaxDistance"><span class="hs-identifier hs-var">t5MaxDistance</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761170"><span class="hs-identifier hs-var">seqSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679761170"><span class="hs-identifier hs-var">seqSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><a href="../../../../hasktorch/html/src"><span class="hs-identifier hs-type">Torch.Tensor.Unsafe</span></a></span><span> </span><span id="local-6989586621679761168"><span class="annot"><span class="annottext">ATenTensor
</span><a href="#local-6989586621679761168"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><span class="annottext">UncheckedTensor -&gt; m UncheckedTensor
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ATenTensor -&gt; UncheckedTensor
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
ATenTensor -&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#UnsafeTensor"><span class="hs-identifier hs-var">UnsafeTensor</span></a></span><span> </span><span class="annot"><span class="annottext">ATenTensor
</span><a href="#local-6989586621679761168"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#UncheckedTensor"><span class="hs-identifier hs-type">UncheckedTensor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><span class="annottext">m UncheckedTensor
-&gt; (UncheckedTensor
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            'UncheckedLayout
            'UncheckedDevice
            'UncheckedDataType
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        'UncheckedLayout
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UncheckedTensor
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        'UncheckedLayout
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (gradient' :: Gradient RequiresGradient) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SingI gradient', SGetGradient gradient, MonadThrow m) =&gt;
Tensor gradient layout device dataType shape
-&gt; m (Tensor
        (Seq (gradient &lt;+&gt; gradient') gradient')
        layout
        device
        dataType
        shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedGradient"><span class="hs-identifier hs-var">checkedGradient</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     'UncheckedLayout
     'UncheckedDevice
     'UncheckedDataType
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      'UncheckedLayout
      'UncheckedDevice
      'UncheckedDataType
      'UncheckedShape
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            'UncheckedDevice
            'UncheckedDataType
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  'UncheckedLayout
  'UncheckedDevice
  'UncheckedDataType
  'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        'UncheckedDevice
        'UncheckedDataType
        'UncheckedShape)
forall (layout' :: Layout LayoutType) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SingI layout', SGetLayout layout, MonadThrow m) =&gt;
Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient (Seq (layout &lt;+&gt; layout') layout') device dataType shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedLayout"><span class="hs-identifier hs-var">checkedLayout</span></a></span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     'UncheckedDevice
     'UncheckedDataType
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      'UncheckedDevice
      'UncheckedDataType
      'UncheckedShape
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            device
            'UncheckedDataType
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        'UncheckedDataType
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SDevice device
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     'UncheckedDevice
     'UncheckedDataType
     'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        (Seq ('UncheckedDevice &lt;+&gt; device) device)
        'UncheckedDataType
        'UncheckedShape)
forall (device' :: Device (DeviceType Nat)) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SGetDevice device, MonadThrow m) =&gt;
SDevice device'
-&gt; Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient layout (Seq (device &lt;+&gt; device') device') dataType shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sCheckedDevice"><span class="hs-identifier hs-var">sCheckedDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice device
</span><a href="#local-6989586621679761173"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-355"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     'UncheckedDataType
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      device
      'UncheckedDataType
      'UncheckedShape
    -&gt; m (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            device
            ('DataType 'Int64)
            'UncheckedShape))
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        ('DataType 'Int64)
        'UncheckedShape)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  device
  'UncheckedDataType
  'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        ('DataType 'Int64)
        'UncheckedShape)
forall (dataType' :: DataType DType) (m :: * -&gt; *)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SingI dataType', SGetDataType dataType, MonadThrow m) =&gt;
Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient
        layout
        device
        (Seq (dataType &lt;+&gt; dataType') dataType')
        shape)
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#checkedDataType"><span class="hs-identifier hs-var">checkedDataType</span></a></span><span>
</span><span id="line-356"></span><span>        </span><span class="annot"><span class="annottext">m (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     'UncheckedShape)
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      device
      ('DataType 'Int64)
      'UncheckedShape
    -&gt; m output)
-&gt; m output
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SShape
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
        'Dim ('Name &quot;*&quot;) seqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     device
     ('DataType 'Int64)
     'UncheckedShape
-&gt; m (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        device
        ('DataType 'Int64)
        (Seq
           ('UncheckedShape
            &lt;+&gt; 'Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
                     'Dim ('Name &quot;*&quot;) seqSize])
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
                 'Dim ('Name &quot;*&quot;) seqSize])))
forall (shape' :: Shape [Dim (Name Symbol) (Size Nat)])
       (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
(SGetShape shape, MonadThrow m) =&gt;
SShape shape'
-&gt; Tensor gradient layout device dataType shape
-&gt; m (Tensor
        gradient layout device dataType (Seq (shape &lt;+&gt; shape') shape'))
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sCheckedShape"><span class="hs-identifier hs-var">sCheckedShape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
     'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
           'Dim ('Name &quot;*&quot;) seqSize])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
      'Dim ('Name &quot;*&quot;) seqSize]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
            'Dim ('Name &quot;*&quot;) seqSize]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
        'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
           'Dim ('Name &quot;*&quot;) seqSize])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize, 'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) seqSize,
        'Dim ('Name &quot;*&quot;) seqSize]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize seqSize -&gt; SDim ('Dim ('Name &quot;*&quot;) seqSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize) -&gt; SSize seqSize
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761171"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) seqSize)
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize]
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize, 'Dim ('Name &quot;*&quot;) seqSize]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize seqSize -&gt; SDim ('Dim ('Name &quot;*&quot;) seqSize)
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize) -&gt; SSize seqSize
forall (name :: Name Symbol) (size :: Size Nat).
SDim ('Dim name size) -&gt; SSize size
</span><a href="Torch.GraduallyTyped.Shape.Type.html#sDimSize"><span class="hs-identifier hs-var hs-var">sDimSize</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim seqName seqSize)
</span><a href="#local-6989586621679761171"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) seqSize)
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) seqSize]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="hs-keyword">data</span><span> </span><span id="T5Input"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-var">T5Input</span></a></span></span><span> </span><span id="local-6989586621679761167"><span class="annot"><a href="#local-6989586621679761167"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679761166"><span class="annot"><a href="#local-6989586621679761166"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-359"></span><span>  </span><span id="T5Input"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-var">T5Input</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761556"><span class="annot"><a href="#local-6989586621679761556"><span class="hs-identifier hs-type">input</span></a></span></span><span> </span><span id="local-6989586621679761555"><span class="annot"><a href="#local-6989586621679761555"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="t5Input"><span class="annot"><span class="annottext">T5Input input decoderInput -&gt; input
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5Input"><span class="hs-identifier hs-var hs-var">t5Input</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761556"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-362"></span><span>      </span><span id="t5DecoderInput"><span class="annot"><span class="annottext">T5Input input decoderInput -&gt; decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DecoderInput"><span class="hs-identifier hs-var hs-var">t5DecoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761555"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-type">T5Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761556"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761555"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span id="local-6989586621679761155"><span id="local-6989586621679761157"><span id="local-6989586621679761159"><span id="local-6989586621679761161"><span id="local-6989586621679761162"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761162"><span class="hs-identifier hs-type">input</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761161"><span class="hs-identifier hs-type">decoderInput</span></a></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-type">T5Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761162"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761161"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-keyword">data</span><span> </span><span id="T5Output"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-var">T5Output</span></a></span></span><span> </span><span id="local-6989586621679761153"><span class="annot"><a href="#local-6989586621679761153"><span class="hs-identifier hs-type">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761152"><span class="annot"><a href="#local-6989586621679761152"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761151"><span class="annot"><a href="#local-6989586621679761151"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>  </span><span id="T5Output"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-var">T5Output</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761477"><span class="annot"><a href="#local-6989586621679761477"><span class="hs-identifier hs-type">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761476"><span class="annot"><a href="#local-6989586621679761476"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761475"><span class="annot"><a href="#local-6989586621679761475"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="t5DecoderOutput"><span class="annot"><span class="annottext">T5Output decoderOutput encoderOutput inputPaddingMask
-&gt; decoderOutput
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DecoderOutput"><span class="hs-identifier hs-var hs-var">t5DecoderOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761477"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-376"></span><span>      </span><span id="t5EncoderOutput"><span class="annot"><span class="annottext">T5Output decoderOutput encoderOutput inputPaddingMask
-&gt; encoderOutput
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5EncoderOutput"><span class="hs-identifier hs-var hs-var">t5EncoderOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761476"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-377"></span><span>      </span><span id="t5InputPaddingMask"><span class="annot"><span class="annottext">T5Output decoderOutput encoderOutput inputPaddingMask
-&gt; inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5InputPaddingMask"><span class="hs-identifier hs-var hs-var">t5InputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761475"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-type">T5Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761477"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761476"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761475"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span id="local-6989586621679761138"><span id="local-6989586621679761140"><span id="local-6989586621679761142"><span id="local-6989586621679761144"><span id="local-6989586621679761145"><span id="local-6989586621679761146"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761146"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761145"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761144"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-type">T5Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761146"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761145"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761144"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-keyword">data</span><span> </span><span id="T5GenerationInput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5GenerationInput"><span class="hs-identifier hs-var">T5GenerationInput</span></a></span></span><span> </span><span id="local-6989586621679761137"><span class="annot"><a href="#local-6989586621679761137"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span id="local-6989586621679761136"><span class="annot"><a href="#local-6989586621679761136"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761135"><span class="annot"><a href="#local-6989586621679761135"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>  </span><span id="T5GenerationInput"><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5GenerationInput"><span class="hs-identifier hs-var">T5GenerationInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679761396"><span class="annot"><a href="#local-6989586621679761396"><span class="hs-identifier hs-type">decoderInput</span></a></span></span><span> </span><span id="local-6989586621679761395"><span class="annot"><a href="#local-6989586621679761395"><span class="hs-identifier hs-type">encoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761394"><span class="annot"><a href="#local-6989586621679761394"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="t5GenerationDecoderInput"><span class="annot"><span class="annottext">T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5GenerationDecoderInput"><span class="hs-identifier hs-var hs-var">t5GenerationDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761396"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-392"></span><span>      </span><span id="t5GenerationEncoderOutput"><span class="annot"><span class="annottext">T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; encoderOutput
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5GenerationEncoderOutput"><span class="hs-identifier hs-var hs-var">t5GenerationEncoderOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761395"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-393"></span><span>      </span><span id="t5GenerationInputPaddingMask"><span class="annot"><span class="annottext">T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5GenerationInputPaddingMask"><span class="hs-identifier hs-var hs-var">t5GenerationInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679761394"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5GenerationInput"><span class="hs-identifier hs-type">T5GenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761396"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761395"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761394"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span id="local-6989586621679761122"><span id="local-6989586621679761124"><span id="local-6989586621679761126"><span id="local-6989586621679761128"><span id="local-6989586621679761129"><span id="local-6989586621679761130"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761130"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761129"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679761128"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-402"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5GenerationInput"><span class="hs-identifier hs-type">T5GenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761130"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761129"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761128"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-comment">-- | 'HasForward' instance for T5 models.</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- Note that this instance always shifts decoder inputs to the right</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- by adding a BOS token at the beginning.</span><span>
</span><span id="line-408"></span><span id="local-6989586621679761062"><span id="local-6989586621679761063"><span id="local-6989586621679761064"><span id="local-6989586621679761065"><span id="local-6989586621679761066"><span id="local-6989586621679761067"><span id="local-6989586621679761068"><span id="local-6989586621679761069"><span id="local-6989586621679761070"><span id="local-6989586621679761071"><span id="local-6989586621679761072"><span id="local-6989586621679761073"><span id="local-6989586621679761074"><span id="local-6989586621679761075"><span id="local-6989586621679761076"><span id="local-6989586621679761077"><span id="local-6989586621679761078"><span id="local-6989586621679761079"><span id="local-6989586621679761080"><span id="local-6989586621679761081"><span id="local-6989586621679761082"><span id="local-6989586621679761083"><span id="local-6989586621679761084"><span id="local-6989586621679761085"><span id="local-6989586621679761086"><span id="local-6989586621679761087"><span id="local-6989586621679761088"><span id="local-6989586621679761089"><span id="local-6989586621679761090"><span id="local-6989586621679761091"><span id="local-6989586621679761092"><span id="local-6989586621679761093"><span id="local-6989586621679761094"><span id="local-6989586621679761095"><span id="local-6989586621679761096"><span id="local-6989586621679761097"><span id="local-6989586621679761098"><span id="local-6989586621679761099"><span id="local-6989586621679761100"><span id="local-6989586621679761101"><span id="local-6989586621679761102"><span id="local-6989586621679761103"><span id="local-6989586621679761104"><span id="local-6989586621679761105"><span id="local-6989586621679761106"><span id="local-6989586621679761107"><span id="local-6989586621679761108"><span id="local-6989586621679761109"><span id="local-6989586621679761110"><span id="local-6989586621679761111"><span id="local-6989586621679761112"><span id="local-6989586621679761113"><span id="local-6989586621679761114"><span id="local-6989586621679761115"><span id="local-6989586621679761116"><span id="local-6989586621679761117"><span id="local-6989586621679761118"><span id="local-6989586621679761119"><span id="local-6989586621679761120"><span id="local-6989586621679761121"><span class="hs-keyword">instance</span><span>
</span><span id="line-409"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679761121"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761120"><span class="hs-identifier hs-type">inputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761119"><span class="hs-identifier hs-type">inputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761118"><span class="hs-identifier hs-type">inputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761117"><span class="hs-identifier hs-type">inputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761116"><span class="hs-identifier hs-type">inputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#MkT5RelPosC"><span class="hs-identifier hs-type">MkT5RelPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761118"><span class="hs-identifier hs-type">inputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761116"><span class="hs-identifier hs-type">inputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761115"><span class="hs-identifier hs-type">inputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761114"><span class="hs-identifier hs-type">inputSeqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761113"><span class="hs-identifier hs-type">inputSeqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761112"><span class="hs-identifier hs-type">pos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761119"><span class="hs-identifier hs-type">inputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761118"><span class="hs-identifier hs-type">inputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761117"><span class="hs-identifier hs-type">inputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761116"><span class="hs-identifier hs-type">inputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761111"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-412"></span><span>    </span><span class="annot"><a href="#local-6989586621679761111"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761110"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761109"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761108"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761107"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761106"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="#local-6989586621679761105"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761104"><span class="hs-identifier hs-type">decoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761103"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761102"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761101"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761100"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><a href="#local-6989586621679761099"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761098"><span class="hs-identifier hs-type">rightShiftedDecoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761097"><span class="hs-identifier hs-type">rightShiftedDecoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761096"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761095"><span class="hs-identifier hs-type">rightShiftedDecoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761094"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#MkT5RelPosC"><span class="hs-identifier hs-type">MkT5RelPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761096"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761094"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761093"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761092"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761091"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761090"><span class="hs-identifier hs-type">decoderPos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761103"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761102"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761101"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761100"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761089"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-417"></span><span>    </span><span class="annot"><a href="#local-6989586621679761088"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761087"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761086"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761085"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761084"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761083"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-418"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761110"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761109"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761108"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761107"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761106"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761082"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761081"><span class="hs-identifier hs-type">attentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-419"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerCrossAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerCrossAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761094"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761093"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761110"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761109"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761108"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761107"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761106"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761082"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761080"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerDecoderAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerDecoderAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761086"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761085"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761083"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761079"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761078"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679761105"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761077"><span class="hs-identifier hs-type">generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761099"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761077"><span class="hs-identifier hs-type">generator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679761089"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761077"><span class="hs-identifier hs-type">generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761088"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761077"><span class="hs-identifier hs-type">generator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-type">T5ModelF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761076"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761075"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761074"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761073"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761072"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761071"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761070"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761069"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761068"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761067"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761066"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761065"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761121"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761099"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761112"><span class="hs-identifier hs-type">pos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761090"><span class="hs-identifier hs-type">decoderPos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761081"><span class="hs-identifier hs-type">attentionMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761078"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761080"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>      </span><span class="annot"><a href="#local-6989586621679761077"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761064"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761063"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><a href="#local-6989586621679761062"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-430"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761076"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761075"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761074"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761073"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761072"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761071"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761070"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761069"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761068"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761067"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761066"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761065"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-type">T5Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761121"><span class="hs-identifier hs-type">input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761105"><span class="hs-identifier hs-type">decoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><a href="#local-6989586621679761077"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-type">T5Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761064"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761063"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679761111"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><a href="#local-6989586621679761062"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-437"></span><span>  </span><span id="local-6989586621679761059"><span class="annot"><span class="annottext">forward :: T5Model
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; T5Input input decoderInput
-&gt; generator
-&gt; (T5Output decoderOutput encoderOutput inputPaddingMask,
    generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-type">GT5Model</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679761055"><span id="local-6989586621679761056"><span id="local-6989586621679761057"><span class="annot"><span class="annottext">ShiftRight Int
T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
t5ShiftRightPaddingMask :: ShiftRight Int
t5ShiftRightDecoderInput :: ShiftRight Int
t5Model :: T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
t5ShiftRightPaddingMask :: forall t5Model. GT5Model t5Model -&gt; ShiftRight Int
t5ShiftRightDecoderInput :: forall t5Model. GT5Model t5Model -&gt; ShiftRight Int
t5Model :: forall t5Model. GT5Model t5Model -&gt; t5Model
</span><a href="#local-6989586621679761055"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-type">T5Input</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679761053"><span id="local-6989586621679761054"><span class="annot"><span class="annottext">input
decoderInput
t5DecoderInput :: decoderInput
t5Input :: input
t5DecoderInput :: forall input decoderInput.
T5Input input decoderInput -&gt; decoderInput
t5Input :: forall input decoderInput. T5Input input decoderInput -&gt; input
</span><a href="#local-6989586621679761053"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761052"><span class="annot"><span class="annottext">inputPaddingMask :: Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679761052"><span class="hs-identifier hs-var hs-var">inputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5PaddingMask"><span class="hs-identifier hs-var">mkT5PaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">input
Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
</span><a href="#local-6989586621679761054"><span class="hs-identifier hs-var">t5Input</span></a></span><span>
</span><span id="line-439"></span><span>        </span><span id="local-6989586621679761051"><span class="annot"><span class="annottext">attentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
  inputPaddingMaskDevice
  (Seq
     (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
     T5DataType)
  (BroadcastShapesF
     (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
           inputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679761051"><span class="hs-identifier hs-var hs-var">attentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim]))
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         T5DataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
               inputPaddingMaskSeqDim])))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         T5DataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
               inputPaddingMaskSeqDim])))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; Double
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerAttentionMaskC
   transformerDataType
   gradient
   layout
   device
   dataType
   shape
   seqDim
   output) =&gt;
SDataType transformerDataType
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerAttentionMask"><span class="hs-identifier hs-var">mkTransformerAttentionMask</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-var">t5AttentionMaskBias</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679761052"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span id="local-6989586621679761050"><span class="annot"><span class="annottext">relPos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  inputDevice
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
        'Dim ('Name &quot;*&quot;) inputSeqSize])
</span><a href="#local-6989586621679761050"><span class="hs-identifier hs-var hs-var">relPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
           'Dim ('Name &quot;*&quot;) inputSeqSize]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
           'Dim ('Name &quot;*&quot;) inputSeqSize])
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      inputDevice
      ('DataType 'Int64)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
            'Dim ('Name &quot;*&quot;) inputSeqSize]))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      inputDevice
      ('DataType 'Int64)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
            'Dim ('Name &quot;*&quot;) inputSeqSize]))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
              'Dim ('Name &quot;*&quot;) inputSeqSize]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
           'Dim ('Name &quot;*&quot;) inputSeqSize])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
              'Dim ('Name &quot;*&quot;) inputSeqSize]))
forall (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) (seqName :: Name Symbol)
       (seqSize :: Size Nat) output.
(MonadThrow m,
 MkT5RelPosC device shape seqDim seqName seqSize output) =&gt;
Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5RelPos"><span class="hs-identifier hs-var">mkT5RelPos</span></a></span><span> </span><span class="annot"><span class="annottext">input
Tensor
  inputGradient inputLayout inputDevice inputDataType inputShape
</span><a href="#local-6989586621679761054"><span class="hs-identifier hs-var">t5Input</span></a></span><span>
</span><span id="line-441"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IxState
  generator
  generatorOutput
  (T5Output
     decoderOutput
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        inputPaddingMaskLayout
        inputPaddingMaskDevice
        inputPaddingMaskDataType
        inputPaddingMaskShape))
-&gt; generator
-&gt; (T5Output
      decoderOutput
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         inputPaddingMaskLayout
         inputPaddingMaskDevice
         inputPaddingMaskDataType
         inputPaddingMaskShape),
    generatorOutput)
forall i j a. IxState i j a -&gt; i -&gt; (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxState</span></a></span><span> </span><span class="annot"><span class="annottext">(IxState
   generator
   generatorOutput
   (T5Output
      decoderOutput
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         inputPaddingMaskLayout
         inputPaddingMaskDevice
         inputPaddingMaskDataType
         inputPaddingMaskShape))
 -&gt; generator
 -&gt; (T5Output
       decoderOutput
       encoderOutput
       (Tensor
          ('Gradient 'WithoutGradient)
          inputPaddingMaskLayout
          inputPaddingMaskDevice
          inputPaddingMaskDataType
          inputPaddingMaskShape),
     generatorOutput))
-&gt; IxState
     generator
     generatorOutput
     (T5Output
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
-&gt; generator
-&gt; (T5Output
      decoderOutput
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         inputPaddingMaskLayout
         inputPaddingMaskDevice
         inputPaddingMaskDataType
         inputPaddingMaskShape),
    generatorOutput)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-442"></span><span>          </span><span class="annot"><span class="annottext">decoderInput -&gt; IxState generator generator decoderInput
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679761053"><span class="hs-identifier hs-var">t5DecoderInput</span></a></span><span>
</span><span id="line-443"></span><span>            </span><span class="annot"><span class="annottext">IxState generator generator decoderInput
-&gt; (decoderInput
    -&gt; IxState
         generator
         generator
         (Tensor
            rightShiftedDecoderInputGradient
            rightShiftedDecoderInputLayout
            rightShiftedDecoderInputDevice
            rightShiftedDecoderInputDataType
            rightShiftedDecoderInputShape))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (Tensor
       rightShiftedDecoderInputGradient
       rightShiftedDecoderInputLayout
       rightShiftedDecoderInputDevice
       rightShiftedDecoderInputDataType
       rightShiftedDecoderInputShape,
     generator))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape,
      generator))
 -&gt; IxState
      generator
      generator
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape))
-&gt; (decoderInput
    -&gt; generator
    -&gt; (Tensor
          rightShiftedDecoderInputGradient
          rightShiftedDecoderInputLayout
          rightShiftedDecoderInputDevice
          rightShiftedDecoderInputDataType
          rightShiftedDecoderInputShape,
        generator))
-&gt; decoderInput
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; decoderInput
-&gt; generator
-&gt; (Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape,
    generator)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679761056"><span class="hs-identifier hs-var">t5ShiftRightDecoderInput</span></a></span><span>
</span><span id="line-444"></span><span>            </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape)
-&gt; (Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape
    -&gt; IxState
         generator
         generatorOutput
         (T5Output
            decoderOutput
            encoderOutput
            (Tensor
               ('Gradient 'WithoutGradient)
               inputPaddingMaskLayout
               inputPaddingMaskDevice
               inputPaddingMaskDataType
               inputPaddingMaskShape)))
-&gt; IxState
     generator
     generatorOutput
     (T5Output
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679761047"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679761047"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761046"><span class="annot"><span class="annottext">decoderRelPos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  rightShiftedDecoderInputDevice
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
</span><a href="#local-6989586621679761046"><span class="hs-identifier hs-var hs-var">decoderRelPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) (seqName :: Name Symbol)
       (seqSize :: Size Nat) output.
(MonadThrow m,
 MkT5RelPosC device shape seqDim seqName seqSize output) =&gt;
Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos"><span class="hs-identifier hs-var">mkT5DecoderRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679761047"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span>
</span><span id="line-446"></span><span>                         </span><span id="local-6989586621679761045"><span class="annot"><span class="annottext">crossAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
  inputPaddingMaskDevice
  (Seq
     (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
     T5DataType)
  (BroadcastShapesF
     (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim
             rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
           inputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679761045"><span class="hs-identifier hs-var hs-var">crossAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>                           </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         T5DataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim])))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         T5DataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim])))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-448"></span><span>                             </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; SShape rightShiftedDecoderInputShape
-&gt; Double
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (decoderInputShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (decoderInputSeqDim :: Dim (Name Symbol) (Size Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerCrossAttentionMaskC
   transformerDataType
   decoderInputShape
   decoderInputSeqDim
   gradient
   layout
   device
   dataType
   shape
   seqDim
   output) =&gt;
SDataType transformerDataType
-&gt; SShape decoderInputShape
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerCrossAttentionMask"><span class="hs-identifier hs-var">mkTransformerCrossAttentionMask</span></a></span><span>
</span><span id="line-449"></span><span>                               </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span>
</span><span id="line-450"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; SShape rightShiftedDecoderInputShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679761047"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>                               </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-var">t5AttentionMaskBias</span></a></span><span>
</span><span id="line-452"></span><span>                               </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679761052"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span>
</span><span id="line-453"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
  (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
  (Seq
     (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
     ('DataType 'Bool))
  (BroadcastShapesF
     decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxState
     generator
     generator
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
        (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
        (Seq
           (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
           ('DataType 'Bool))
        (BroadcastShapesF
           decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5PaddingMask"><span class="hs-identifier hs-var">mkT5PaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
</span><a href="#local-6989586621679761053"><span class="hs-identifier hs-var">t5DecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>                           </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; IxState
         generator
         generator
         (Tensor
            rightShiftedDecoderInputPaddingMaskGradient
            rightShiftedDecoderInputPaddingMaskLayout
            rightShiftedDecoderInputPaddingMaskDevice
            rightShiftedDecoderInputPaddingMaskDataType
            rightShiftedDecoderInputPaddingMaskShape))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (Tensor
       rightShiftedDecoderInputPaddingMaskGradient
       rightShiftedDecoderInputPaddingMaskLayout
       rightShiftedDecoderInputPaddingMaskDevice
       rightShiftedDecoderInputPaddingMaskDataType
       rightShiftedDecoderInputPaddingMaskShape,
     generator))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape,
      generator))
 -&gt; IxState
      generator
      generator
      (Tensor
         rightShiftedDecoderInputPaddingMaskGradient
         rightShiftedDecoderInputPaddingMaskLayout
         rightShiftedDecoderInputPaddingMaskDevice
         rightShiftedDecoderInputPaddingMaskDataType
         rightShiftedDecoderInputPaddingMaskShape))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; generator
    -&gt; (Tensor
          rightShiftedDecoderInputPaddingMaskGradient
          rightShiftedDecoderInputPaddingMaskLayout
          rightShiftedDecoderInputPaddingMaskDevice
          rightShiftedDecoderInputPaddingMaskDataType
          rightShiftedDecoderInputPaddingMaskShape,
        generator))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; generator
-&gt; (Tensor
      rightShiftedDecoderInputPaddingMaskGradient
      rightShiftedDecoderInputPaddingMaskLayout
      rightShiftedDecoderInputPaddingMaskDevice
      rightShiftedDecoderInputPaddingMaskDataType
      rightShiftedDecoderInputPaddingMaskShape,
    generator)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679761055"><span class="hs-identifier hs-var">t5ShiftRightPaddingMask</span></a></span><span>
</span><span id="line-455"></span><span>                           </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape)
-&gt; (Tensor
      rightShiftedDecoderInputPaddingMaskGradient
      rightShiftedDecoderInputPaddingMaskLayout
      rightShiftedDecoderInputPaddingMaskDevice
      rightShiftedDecoderInputPaddingMaskDataType
      rightShiftedDecoderInputPaddingMaskShape
    -&gt; IxState
         generator
         generator
         (SequenceToSequenceTransformerInput
            input
            (Tensor
               rightShiftedDecoderInputGradient
               rightShiftedDecoderInputLayout
               rightShiftedDecoderInputDevice
               rightShiftedDecoderInputDataType
               rightShiftedDecoderInputShape)
            (Tensor
               ('Gradient 'WithoutGradient)
               ('Layout 'Dense)
               inputDevice
               ('DataType 'Int64)
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
                     'Dim ('Name &quot;*&quot;) inputSeqSize]))
            (Tensor
               ('Gradient 'WithoutGradient)
               ('Layout 'Dense)
               rightShiftedDecoderInputDevice
               ('DataType 'Int64)
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
                     'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
               inputPaddingMaskDevice
               (Seq
                  (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                  T5DataType)
               (BroadcastShapesF
                  (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                        inputPaddingMaskSeqDim])))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify
                  (Layout LayoutType)
                  rightShiftedDecoderInputPaddingMaskLayout
                  ('Layout 'Dense))
               rightShiftedDecoderInputPaddingMaskDevice
               T5DataType
               (BroadcastShapesF
                  (BroadcastShapesF
                     ('Shape
                        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                           rightShiftedDecoderInputPaddingMaskSeqDim,
                           rightShiftedDecoderInputPaddingMaskSeqDim])
                     (UnsqueezeF
                        ('SelectDim ('ByIndex 1))
                        rightShiftedDecoderInputPaddingMaskShape))
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        rightShiftedDecoderInputPaddingMaskSeqDim,
                        rightShiftedDecoderInputPaddingMaskSeqDim])))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
               inputPaddingMaskDevice
               (Seq
                  (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                  T5DataType)
               (BroadcastShapesF
                  (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        'Dim
                          rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                        inputPaddingMaskSeqDim])))))
-&gt; IxState
     generator
     generator
     (SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
                 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              T5DataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           T5DataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              T5DataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679761044"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679761044"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-456"></span><span>                                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761043"><span class="annot"><span class="annottext">decoderAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  (Unify
     (Layout LayoutType)
     rightShiftedDecoderInputPaddingMaskLayout
     ('Layout 'Dense))
  rightShiftedDecoderInputPaddingMaskDevice
  T5DataType
  (BroadcastShapesF
     (BroadcastShapesF
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])
        (UnsqueezeF
           ('SelectDim ('ByIndex 1))
           rightShiftedDecoderInputPaddingMaskShape))
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           rightShiftedDecoderInputPaddingMaskSeqDim,
           rightShiftedDecoderInputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679761043"><span class="hs-identifier hs-var hs-var">decoderAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>                                          </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      T5DataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim])))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      T5DataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-458"></span><span>                                            </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; Double
-&gt; Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerDecoderAttentionMaskC
   transformerDataType layout device shape seqDim output) =&gt;
SDataType transformerDataType
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerDecoderAttentionMask"><span class="hs-identifier hs-var">mkTransformerDecoderAttentionMask</span></a></span><span>
</span><span id="line-459"></span><span>                                              </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span>
</span><span id="line-460"></span><span>                                              </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-var">t5AttentionMaskBias</span></a></span><span>
</span><span id="line-461"></span><span>                                              </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679761044"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span><span>
</span><span id="line-462"></span><span>                                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformerInput
  input
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape)
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
           'Dim ('Name &quot;*&quot;) inputSeqSize]))
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim])))
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
-&gt; IxState
     generator
     generator
     (SequenceToSequenceTransformerInput
        input
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           inputDevice
           ('DataType 'Int64)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
                 'Dim ('Name &quot;*&quot;) inputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              T5DataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                    inputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           T5DataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              T5DataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">input
-&gt; Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     inputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
           'Dim ('Name &quot;*&quot;) inputSeqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
              inputPaddingMaskSeqDim]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
-&gt; SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
              'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall input decoderInput pos decoderPos attentionMask
       decoderAttentionMask crossAttentionMask.
input
-&gt; decoderInput
-&gt; pos
-&gt; decoderPos
-&gt; attentionMask
-&gt; decoderAttentionMask
-&gt; crossAttentionMask
-&gt; SequenceToSequenceTransformerInput
     input
     decoderInput
     pos
     decoderPos
     attentionMask
     decoderAttentionMask
     crossAttentionMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier hs-var">SequenceToSequenceTransformerInput</span></a></span><span> </span><span class="annot"><span class="annottext">input
</span><a href="#local-6989586621679761054"><span class="hs-identifier hs-var">t5Input</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679761047"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  inputDevice
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
        'Dim ('Name &quot;*&quot;) inputSeqSize])
</span><a href="#local-6989586621679761050"><span class="hs-identifier hs-var">relPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  rightShiftedDecoderInputDevice
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
</span><a href="#local-6989586621679761046"><span class="hs-identifier hs-var">decoderRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
  inputPaddingMaskDevice
  (Seq
     (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
     T5DataType)
  (BroadcastShapesF
     (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
           inputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679761051"><span class="hs-identifier hs-var">attentionMask</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify
     (Layout LayoutType)
     rightShiftedDecoderInputPaddingMaskLayout
     ('Layout 'Dense))
  rightShiftedDecoderInputPaddingMaskDevice
  T5DataType
  (BroadcastShapesF
     (BroadcastShapesF
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])
        (UnsqueezeF
           ('SelectDim ('ByIndex 1))
           rightShiftedDecoderInputPaddingMaskShape))
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           rightShiftedDecoderInputPaddingMaskSeqDim,
           rightShiftedDecoderInputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679761043"><span class="hs-identifier hs-var">decoderAttentionMask</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
  inputPaddingMaskDevice
  (Seq
     (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
     T5DataType)
  (BroadcastShapesF
     (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim
             rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
           inputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679761045"><span class="hs-identifier hs-var">crossAttentionMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>                           </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
              'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))))
-&gt; (SequenceToSequenceTransformerInput
      input
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         inputDevice
         ('DataType 'Int64)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
               'Dim ('Name &quot;*&quot;) inputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            T5DataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                  inputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         T5DataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            T5DataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; IxState
         generator
         generatorOutput
         (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; IxState
     generator
     generatorOutput
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (SequenceToSequenceTransformerOutput
       decoderOutput encoderOutput,
     generatorOutput))
-&gt; IxState
     generator
     generatorOutput
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (SequenceToSequenceTransformerOutput
        decoderOutput encoderOutput,
      generatorOutput))
 -&gt; IxState
      generator
      generatorOutput
      (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; (SequenceToSequenceTransformerInput
      input
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         inputDevice
         ('DataType 'Int64)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
               'Dim ('Name &quot;*&quot;) inputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            T5DataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                  inputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         T5DataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            T5DataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; generator
    -&gt; (SequenceToSequenceTransformerOutput
          decoderOutput encoderOutput,
        generatorOutput))
-&gt; SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
              'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxState
     generator
     generatorOutput
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; SequenceToSequenceTransformerInput
     input
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        inputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) inputSeqSize,
              'Dim ('Name &quot;*&quot;) inputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1), inputPaddingMaskSeqDim,
                 inputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; generator
-&gt; (SequenceToSequenceTransformerOutput
      decoderOutput encoderOutput,
    generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
</span><a href="#local-6989586621679761057"><span class="hs-identifier hs-var">t5Model</span></a></span><span>
</span><span id="line-465"></span><span>                           </span><span class="annot"><span class="annottext">IxState
  generator
  generatorOutput
  (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
-&gt; (SequenceToSequenceTransformerOutput decoderOutput encoderOutput
    -&gt; IxState
         generatorOutput
         generatorOutput
         (T5Output
            decoderOutput
            encoderOutput
            (Tensor
               ('Gradient 'WithoutGradient)
               inputPaddingMaskLayout
               inputPaddingMaskDevice
               inputPaddingMaskDataType
               inputPaddingMaskShape)))
-&gt; IxState
     generator
     generatorOutput
     (T5Output
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span id="local-6989586621679761040"><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679761040"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679761039"><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679761039"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-466"></span><span>                                    </span><span class="annot"><span class="annottext">T5Output
  decoderOutput
  encoderOutput
  (Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape)
-&gt; IxState
     generatorOutput
     generatorOutput
     (T5Output
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(T5Output
   decoderOutput
   encoderOutput
   (Tensor
      ('Gradient 'WithoutGradient)
      inputPaddingMaskLayout
      inputPaddingMaskDevice
      inputPaddingMaskDataType
      inputPaddingMaskShape)
 -&gt; IxState
      generatorOutput
      generatorOutput
      (T5Output
         decoderOutput
         encoderOutput
         (Tensor
            ('Gradient 'WithoutGradient)
            inputPaddingMaskLayout
            inputPaddingMaskDevice
            inputPaddingMaskDataType
            inputPaddingMaskShape)))
-&gt; T5Output
     decoderOutput
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        inputPaddingMaskLayout
        inputPaddingMaskDevice
        inputPaddingMaskDataType
        inputPaddingMaskShape)
-&gt; IxState
     generatorOutput
     generatorOutput
     (T5Output
        decoderOutput
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           inputPaddingMaskLayout
           inputPaddingMaskDevice
           inputPaddingMaskDataType
           inputPaddingMaskShape))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">decoderOutput
-&gt; encoderOutput
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; T5Output
     decoderOutput
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        inputPaddingMaskLayout
        inputPaddingMaskDevice
        inputPaddingMaskDataType
        inputPaddingMaskShape)
forall decoderOutput encoderOutput inputPaddingMask.
decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; T5Output decoderOutput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-var">T5Output</span></a></span><span> </span><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679761040"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679761039"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679761052"><span class="hs-identifier hs-var">inputPaddingMask</span></a></span><span>
</span><span id="line-467"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>                 </span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span id="testT5"><span class="annot"><span class="annottext">testT5 :: IO
  ((SequenceToSequenceTransformerOutput
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7),
               'Dim ('Name &quot;*&quot;) ('Size 512)]))
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
               'Dim ('Name &quot;*&quot;) ('Size 512)])),
    T5Output
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 8),
               'Dim ('Name &quot;*&quot;) ('Size 512)]))
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
               'Dim ('Name &quot;*&quot;) ('Size 512)]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         ('DataType 'Bool)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))),
   Generator ('Device 'CPU))
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#testT5"><span class="hs-identifier hs-var hs-var">testT5</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761037"><span class="annot"><span class="annottext">gradient :: SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679761037"><span class="hs-identifier hs-var hs-var">gradient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
-&gt; SGradient ('Gradient 'WithGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithGradient"><span class="hs-identifier hs-var">SWithGradient</span></a></span><span>
</span><span id="line-472"></span><span>      </span><span id="local-6989586621679761034"><span class="annot"><span class="annottext">device :: SDevice ('Device 'CPU)
</span><a href="#local-6989586621679761034"><span class="hs-identifier hs-var hs-var">device</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU -&gt; SDevice ('Device 'CPU)
forall (deviceType :: DeviceType Nat).
SDeviceType deviceType -&gt; SDevice ('Device deviceType)
</span><a href="Torch.GraduallyTyped.Device.html#SDevice"><span class="hs-identifier hs-var">SDevice</span></a></span><span> </span><span class="annot"><span class="annottext">SDeviceType 'CPU
</span><a href="Torch.GraduallyTyped.Device.html#SCPU"><span class="hs-identifier hs-var">SCPU</span></a></span><span>
</span><span id="line-473"></span><span>      </span><span id="local-6989586621679761031"><span class="annot"><span class="annottext">headDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679761031"><span class="hs-identifier hs-var hs-var">headDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 8) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 8 =&gt; SSize ('Size 8)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">8</span></span><span>
</span><span id="line-474"></span><span>      </span><span id="local-6989586621679761030"><span class="annot"><span class="annottext">headEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679761030"><span class="hs-identifier hs-var hs-var">headEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 64) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 64 =&gt; SSize ('Size 64)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-475"></span><span>      </span><span id="local-6989586621679761029"><span class="annot"><span class="annottext">embedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679761029"><span class="hs-identifier hs-var hs-var">embedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-476"></span><span>      </span><span id="local-6989586621679761028"><span class="annot"><span class="annottext">inputEmbedDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679761028"><span class="hs-identifier hs-var hs-var">inputEmbedDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 512) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 512 =&gt; SSize ('Size 512)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">512</span></span><span>
</span><span id="line-477"></span><span>      </span><span id="local-6989586621679761027"><span class="annot"><span class="annottext">ffnDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
</span><a href="#local-6989586621679761027"><span class="hs-identifier hs-var hs-var">ffnDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 2048) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 2048 =&gt; SSize ('Size 2048)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2048</span></span><span>
</span><span id="line-478"></span><span>      </span><span id="local-6989586621679761026"><span class="annot"><span class="annottext">vocabDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 32128))
</span><a href="#local-6989586621679761026"><span class="hs-identifier hs-var hs-var">vocabDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 32128) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 32128))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 32128 =&gt; SSize ('Size 32128)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">32128</span></span><span>
</span><span id="line-479"></span><span>  </span><span id="local-6989586621679761025"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679761025"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU) -&gt; Word64 -&gt; IO (Generator ('Device 'CPU))
forall (device :: Device (DeviceType Nat)).
SDevice device -&gt; Word64 -&gt; IO (Generator device)
</span><a href="Torch.GraduallyTyped.Random.html#sMkGenerator"><span class="hs-identifier hs-var">sMkGenerator</span></a></span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679761034"><span class="hs-identifier hs-var">device</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761024"><span class="annot"><span class="annottext">batchDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679761024"><span class="hs-identifier hs-var hs-var">batchDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 3) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 3 =&gt; SSize ('Size 3)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-481"></span><span>      </span><span id="local-6989586621679761023"><span class="annot"><span class="annottext">seqDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var hs-var">seqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 13) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 13 =&gt; SSize ('Size 13)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">13</span></span><span>
</span><span id="line-482"></span><span>      </span><span id="local-6989586621679761022"><span class="annot"><span class="annottext">decoderSeqDim :: SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var hs-var">decoderSeqDim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 7) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 7 =&gt; SSize ('Size 7)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">7</span></span><span>
</span><span id="line-483"></span><span>      </span><span id="local-6989586621679761021"><span class="annot"><span class="annottext">sOnes' :: SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var hs-var">sOnes'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithoutGradient)
-&gt; SLayout ('Layout 'Dense)
-&gt; SDevice ('Device 'CPU)
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SGradient gradient
-&gt; SLayout layout
-&gt; SDevice device
-&gt; SDataType dataType
-&gt; SShape shape
-&gt; Tensor gradient layout device dataType shape
</span><a href="Torch.GraduallyTyped.Tensor.Creation.html#sOnes"><span class="hs-identifier hs-var">sOnes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
-&gt; SGradient ('Gradient 'WithoutGradient)
forall (requiresGradient :: RequiresGradient).
SRequiresGradient requiresGradient
-&gt; SGradient ('Gradient requiresGradient)
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SGradient"><span class="hs-identifier hs-var">SGradient</span></a></span><span> </span><span class="annot"><span class="annottext">SRequiresGradient 'WithoutGradient
</span><a href="Torch.GraduallyTyped.RequiresGradient.html#SWithoutGradient"><span class="hs-identifier hs-var">SWithoutGradient</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SLayoutType 'Dense -&gt; SLayout ('Layout 'Dense)
forall (layoutType :: LayoutType).
SLayoutType layoutType -&gt; SLayout ('Layout layoutType)
</span><a href="Torch.GraduallyTyped.Layout.html#SLayout"><span class="hs-identifier hs-var">SLayout</span></a></span><span> </span><span class="annot"><span class="annottext">SLayoutType 'Dense
</span><a href="Torch.GraduallyTyped.Layout.html#SDense"><span class="hs-identifier hs-var">SDense</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679761034"><span class="hs-identifier hs-var">device</span></a></span><span>
</span><span id="line-484"></span><span>      </span><span id="local-6989586621679761017"><span class="annot"><span class="annottext">input :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679761017"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Int64)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDType 'Int64 -&gt; SDataType ('DataType 'Int64)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Int64
</span><a href="Torch.GraduallyTyped.DType.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679761024"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>      </span><span id="local-6989586621679761014"><span class="annot"><span class="annottext">attentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679761014"><span class="hs-identifier hs-var hs-var">attentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
     'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
      'Dim ('Name &quot;*&quot;) ('Size 13)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
            'Dim ('Name &quot;*&quot;) ('Size 13)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>      </span><span id="local-6989586621679761013"><span class="annot"><span class="annottext">decoderInput :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
</span><a href="#local-6989586621679761013"><span class="hs-identifier hs-var hs-var">decoderInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Int64)
-&gt; SShape
     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDType 'Int64 -&gt; SDataType ('DataType 'Int64)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Int64
</span><a href="Torch.GraduallyTyped.DType.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SShape
     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SShape
     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
</span><a href="#local-6989586621679761024"><span class="hs-identifier hs-var">batchDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 3))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>      </span><span id="local-6989586621679761012"><span class="annot"><span class="annottext">decoderAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
</span><a href="#local-6989586621679761012"><span class="hs-identifier hs-var hs-var">decoderAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
     'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
      'Dim ('Name &quot;*&quot;) ('Size 7)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
            'Dim ('Name &quot;*&quot;) ('Size 7)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7), 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7), 'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>      </span><span id="local-6989586621679761011"><span class="annot"><span class="annottext">crossAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679761011"><span class="hs-identifier hs-var hs-var">crossAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
     'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
      'Dim ('Name &quot;*&quot;) ('Size 13)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
            'Dim ('Name &quot;*&quot;) ('Size 13)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 7), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 7), 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679761010"><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  T5DataType
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  T5RelPosEncBucketDim
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
  T5DropoutP
</span><a href="#local-6989586621679761010"><span class="hs-identifier hs-var">t5Model</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679761009"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679761009"><span class="hs-identifier hs-var">g'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SGradient ('Gradient 'WithGradient), SDevice ('Device 'CPU),
 SDataType T5DataType, SDim ('Dim ('Name &quot;*&quot;) ('Size 8)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 64)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 512)),
 SDim ('Dim ('Name &quot;*&quot;) ('Size 2048)), SDim T5RelPosEncBucketDim,
 SDim ('Dim ('Name &quot;*&quot;) ('Size 32128)), T5DropoutP, Double)
-&gt; Generator ('Device 'CPU)
-&gt; (SequenceToSequenceTransformer
      'T5
      'WithLMHead
      4
      4
      ('Gradient 'WithGradient)
      ('Device 'CPU)
      T5DataType
      ('Dim ('Name &quot;*&quot;) ('Size 8))
      ('Dim ('Name &quot;*&quot;) ('Size 64))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 512))
      ('Dim ('Name &quot;*&quot;) ('Size 2048))
      T5RelPosEncBucketDim
      ('Dim ('Name &quot;*&quot;) ('Size 32128))
      T5DropoutP,
    Generator ('Device 'CPU))
forall model input generator generatorOutput.
HasInitialize model input generator generatorOutput =&gt;
input -&gt; generator -&gt; (model, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#initialize"><span class="hs-identifier hs-var">initialize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformer"><span class="hs-identifier hs-type">SequenceToSequenceTransformer</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#T5"><span class="hs-identifier hs-type">T5</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#WithLMHead"><span class="hs-identifier hs-type">WithLMHead</span></a></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SGradient ('Gradient 'WithGradient)
</span><a href="#local-6989586621679761037"><span class="hs-identifier hs-var">gradient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDevice ('Device 'CPU)
</span><a href="#local-6989586621679761034"><span class="hs-identifier hs-var">device</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 8))
</span><a href="#local-6989586621679761031"><span class="hs-identifier hs-var">headDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 64))
</span><a href="#local-6989586621679761030"><span class="hs-identifier hs-var">headEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679761029"><span class="hs-identifier hs-var">embedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 512))
</span><a href="#local-6989586621679761028"><span class="hs-identifier hs-var">inputEmbedDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 2048))
</span><a href="#local-6989586621679761027"><span class="hs-identifier hs-var">ffnDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim T5RelPosEncBucketDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5RelPosEncBucketDim"><span class="hs-identifier hs-var">t5RelPosEncBucketDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 32128))
</span><a href="#local-6989586621679761026"><span class="hs-identifier hs-var">vocabDim</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">T5DropoutP
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DropoutP"><span class="hs-identifier hs-var">t5DropoutP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5Eps"><span class="hs-identifier hs-var">t5Eps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679761025"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679761007"><span class="annot"><span class="annottext">SequenceToSequenceTransformerOutput
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
</span><a href="#local-6989586621679761007"><span class="hs-identifier hs-var">t5Output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679761006"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679761006"><span class="hs-identifier hs-var">g''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679761005"><span class="annot"><span class="annottext">pos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679761005"><span class="hs-identifier hs-var hs-var">pos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Int64)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDType 'Int64 -&gt; SDataType ('DataType 'Int64)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Int64
</span><a href="Torch.GraduallyTyped.DType.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
     'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
      'Dim ('Name &quot;*&quot;) ('Size 13)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
            'Dim ('Name &quot;*&quot;) ('Size 13)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 13)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 13), 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
</span><a href="#local-6989586621679761023"><span class="hs-identifier hs-var">seqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 13))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 13)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>            </span><span id="local-6989586621679761004"><span class="annot"><span class="annottext">decoderPos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
</span><a href="#local-6989586621679761004"><span class="hs-identifier hs-var hs-var">decoderPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDataType ('DataType 'Int64)
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
forall (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]).
SDataType dataType
-&gt; SShape shape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     dataType
     shape
</span><a href="#local-6989586621679761021"><span class="hs-identifier hs-var">sOnes'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDType 'Int64 -&gt; SDataType ('DataType 'Int64)
forall (dType :: DType).
SDType dType -&gt; SDataType ('DataType dType)
</span><a href="Torch.GraduallyTyped.DType.html#SDataType"><span class="hs-identifier hs-var">SDataType</span></a></span><span> </span><span class="annot"><span class="annottext">SDType 'Int64
</span><a href="Torch.GraduallyTyped.DType.html#SInt64"><span class="hs-identifier hs-var">SInt64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SList
  '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
     'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
forall (dims :: [Dim (Name Symbol) (Size Nat)]).
SList dims -&gt; SShape ('Shape dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SShape"><span class="hs-identifier hs-var">SShape</span></a></span><span> </span><span class="annot"><span class="annottext">(SList
   '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
      'Dim ('Name &quot;*&quot;) ('Size 7)]
 -&gt; SShape
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
            'Dim ('Name &quot;*&quot;) ('Size 7)]))
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SShape
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 7)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KnownSymbol &quot;*&quot; =&gt; SName ('Name &quot;*&quot;)
forall (name :: Symbol). KnownSymbol name =&gt; SName ('Name name)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SName"><span class="hs-identifier hs-var">SName</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">SName ('Name &quot;*&quot;)
-&gt; SSize ('Size 1) -&gt; SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
forall (name :: Name Symbol) (size :: Size Nat).
SName name -&gt; SSize size -&gt; SDim ('Dim name size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%26%3A"><span class="hs-operator hs-var">:&amp;:</span></a></span><span> </span><span class="annot"><span class="annottext">KnownNat 1 =&gt; SSize ('Size 1)
forall (size :: Nat). KnownNat size =&gt; SSize ('Size size)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#SSize"><span class="hs-identifier hs-var">SSize</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 1))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7), 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SList
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7)]
-&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7), 'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
</span><a href="#local-6989586621679761022"><span class="hs-identifier hs-var">decoderSeqDim</span></a></span><span> </span><span class="annot"><span class="annottext">SDim ('Dim ('Name &quot;*&quot;) ('Size 7))
-&gt; SList '[] -&gt; SList '[ 'Dim ('Name &quot;*&quot;) ('Size 7)]
forall (dim :: Dim (Name Symbol) (Size Nat))
       (dims :: [Dim (Name Symbol) (Size Nat)]).
SDim dim -&gt; SList dims -&gt; SList (dim : dims)
</span><a href="Torch.GraduallyTyped.Shape.Type.html#%3A%7C%3A"><span class="hs-operator hs-var">:|:</span></a></span><span> </span><span class="annot"><span class="annottext">SList '[]
forall a. SList '[]
</span><a href="../file:///nix/store/lnxln0gj8camy4zp976hwp5qw721jzi5-singletons-lib-singletons-2.7-haddock-doc/share/doc/singletons/html/src"><span class="hs-identifier hs-var">SNil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  T5DataType
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  T5RelPosEncBucketDim
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
  T5DropoutP
-&gt; SequenceToSequenceTransformerInput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
              'Dim ('Name &quot;*&quot;) ('Size 13)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
              'Dim ('Name &quot;*&quot;) ('Size 7)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
              'Dim ('Name &quot;*&quot;) ('Size 13)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
              'Dim ('Name &quot;*&quot;) ('Size 7)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        T5DataType
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
              'Dim ('Name &quot;*&quot;) ('Size 13)]))
-&gt; Generator ('Device 'CPU)
-&gt; (SequenceToSequenceTransformerOutput
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7),
               'Dim ('Name &quot;*&quot;) ('Size 512)]))
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
               'Dim ('Name &quot;*&quot;) ('Size 512)])),
    Generator ('Device 'CPU))
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformer
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  T5DataType
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  T5RelPosEncBucketDim
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
  T5DropoutP
</span><a href="#local-6989586621679761010"><span class="hs-identifier hs-var">t5Model</span></a></span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformerInput :: forall input decoderInput pos decoderPos attentionMask
       decoderAttentionMask crossAttentionMask.
input
-&gt; decoderInput
-&gt; pos
-&gt; decoderPos
-&gt; attentionMask
-&gt; decoderAttentionMask
-&gt; crossAttentionMask
-&gt; SequenceToSequenceTransformerInput
     input
     decoderInput
     pos
     decoderPos
     attentionMask
     decoderAttentionMask
     crossAttentionMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerInput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerInput</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
crossAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
decoderAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
attentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
decoderPos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
pos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
decoderInput :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
input :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
decoderPos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
pos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
crossAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
decoderAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 7),
        'Dim ('Name &quot;*&quot;) ('Size 7)])
decoderInput :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
attentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  T5DataType
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1), 'Dim ('Name &quot;*&quot;) ('Size 13),
        'Dim ('Name &quot;*&quot;) ('Size 13)])
input :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#crossAttentionMask"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679761009"><span class="hs-identifier hs-var">g'</span></a></span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679760996"><span class="annot"><span class="annottext">T5Output
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 8),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Bool)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
</span><a href="#local-6989586621679760996"><span class="hs-identifier hs-var">t5Output'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679760995"><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679760995"><span class="hs-identifier hs-var">g'''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679760994"><span class="annot"><span class="annottext">t5ShiftRightDecoderInput :: ShiftRight Int
</span><a href="#local-6989586621679760994"><span class="hs-identifier hs-var hs-var">t5ShiftRightDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShiftRight Int
forall fillValue. fillValue -&gt; ShiftRight fillValue
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-var">ShiftRight</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5BOSTokenId"><span class="hs-identifier hs-var">t5BOSTokenId</span></a></span><span>
</span><span id="line-496"></span><span>            </span><span id="local-6989586621679760992"><span class="annot"><span class="annottext">t5ShiftRightPaddingMask :: ShiftRight Int
</span><a href="#local-6989586621679760992"><span class="hs-identifier hs-var hs-var">t5ShiftRightPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShiftRight Int
forall fillValue. fillValue -&gt; ShiftRight fillValue
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-var">ShiftRight</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-497"></span><span>            </span><span id="local-6989586621679760991"><span class="annot"><span class="annottext">model :: T5Model
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
</span><a href="#local-6989586621679760991"><span class="hs-identifier hs-var hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GT5Model
  (T5ModelF
     'T5
     'WithLMHead
     4
     4
     ('Gradient 'WithGradient)
     ('Device 'CPU)
     ('Dim ('Name &quot;*&quot;) ('Size 8))
     ('Dim ('Name &quot;*&quot;) ('Size 64))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 2048))
     ('Dim ('Name &quot;*&quot;) ('Size 32128)))
-&gt; T5Model
     'T5
     'WithLMHead
     4
     4
     ('Gradient 'WithGradient)
     ('Device 'CPU)
     ('Dim ('Name &quot;*&quot;) ('Size 8))
     ('Dim ('Name &quot;*&quot;) ('Size 64))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 512))
     ('Dim ('Name &quot;*&quot;) ('Size 2048))
     ('Dim ('Name &quot;*&quot;) ('Size 32128))
forall (style :: TransformerStyle)
       (transformerHead :: TransformerHead) (numEncoderLayers :: Nat)
       (numDecoderLayers :: Nat) (gradient :: Gradient RequiresGradient)
       (device :: Device (DeviceType Nat))
       (headDim :: Dim (Name Symbol) (Size Nat))
       (headEmbedDim :: Dim (Name Symbol) (Size Nat))
       (embedDim :: Dim (Name Symbol) (Size Nat))
       (inputEmbedDim :: Dim (Name Symbol) (Size Nat))
       (ffnDim :: Dim (Name Symbol) (Size Nat))
       (vocabDim :: Dim (Name Symbol) (Size Nat)).
GT5Model
  (T5ModelF
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim)
-&gt; T5Model
     style
     transformerHead
     numEncoderLayers
     numDecoderLayers
     gradient
     device
     headDim
     headEmbedDim
     embedDim
     inputEmbedDim
     ffnDim
     vocabDim
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-var">T5Model</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GT5Model :: forall t5Model.
t5Model -&gt; ShiftRight Int -&gt; ShiftRight Int -&gt; GT5Model t5Model
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-type">GT5Model</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ShiftRight Int
SequenceToSequenceTransformer
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  T5DataType
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  T5RelPosEncBucketDim
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
  T5DropoutP
t5ShiftRightPaddingMask :: ShiftRight Int
t5ShiftRightDecoderInput :: ShiftRight Int
t5Model :: SequenceToSequenceTransformer
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  T5DataType
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  T5RelPosEncBucketDim
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
  T5DropoutP
t5ShiftRightPaddingMask :: ShiftRight Int
t5ShiftRightDecoderInput :: ShiftRight Int
t5Model :: SequenceToSequenceTransformer
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  T5DataType
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  T5RelPosEncBucketDim
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
  T5DropoutP
</span><a href="#local-6989586621679760992"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>            </span><span id="local-6989586621679760990"><span class="annot"><span class="annottext">inputs :: T5Input
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]))
</span><a href="#local-6989586621679760990"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
-&gt; T5Input
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]))
forall input decoderInput.
input -&gt; decoderInput -&gt; T5Input input decoderInput
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Input"><span class="hs-identifier hs-var">T5Input</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])
</span><a href="#local-6989586621679761017"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  ('Device 'CPU)
  ('DataType 'Int64)
  ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)])
</span><a href="#local-6989586621679761013"><span class="hs-identifier hs-var">decoderInput</span></a></span><span>
</span><span id="line-499"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">T5Model
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
-&gt; T5Input
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        ('Device 'CPU)
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]))
-&gt; Generator ('Device 'CPU)
-&gt; (T5Output
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 8),
               'Dim ('Name &quot;*&quot;) ('Size 512)]))
      (Tensor
         ('Gradient 'WithGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         T5DataType
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
               'Dim ('Name &quot;*&quot;) ('Size 512)]))
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         ('Device 'CPU)
         ('DataType 'Bool)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)])),
    Generator ('Device 'CPU))
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">T5Model
  'T5
  'WithLMHead
  4
  4
  ('Gradient 'WithGradient)
  ('Device 'CPU)
  ('Dim ('Name &quot;*&quot;) ('Size 8))
  ('Dim ('Name &quot;*&quot;) ('Size 64))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 512))
  ('Dim ('Name &quot;*&quot;) ('Size 2048))
  ('Dim ('Name &quot;*&quot;) ('Size 32128))
</span><a href="#local-6989586621679760991"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">T5Input
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7)]))
</span><a href="#local-6989586621679760990"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679761006"><span class="hs-identifier hs-var">g''</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><span class="annottext">((SequenceToSequenceTransformerOutput
    (Tensor
       ('Gradient 'WithGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       T5DataType
       ('Shape
          '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7),
             'Dim ('Name &quot;*&quot;) ('Size 512)]))
    (Tensor
       ('Gradient 'WithGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       T5DataType
       ('Shape
          '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
             'Dim ('Name &quot;*&quot;) ('Size 512)])),
  T5Output
    (Tensor
       ('Gradient 'WithGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       T5DataType
       ('Shape
          '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 8),
             'Dim ('Name &quot;*&quot;) ('Size 512)]))
    (Tensor
       ('Gradient 'WithGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       T5DataType
       ('Shape
          '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
             'Dim ('Name &quot;*&quot;) ('Size 512)]))
    (Tensor
       ('Gradient 'WithoutGradient)
       ('Layout 'Dense)
       ('Device 'CPU)
       ('DataType 'Bool)
       ('Shape
          '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))),
 Generator ('Device 'CPU))
-&gt; IO
     ((SequenceToSequenceTransformerOutput
         (Tensor
            ('Gradient 'WithGradient)
            ('Layout 'Dense)
            ('Device 'CPU)
            T5DataType
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7),
                  'Dim ('Name &quot;*&quot;) ('Size 512)]))
         (Tensor
            ('Gradient 'WithGradient)
            ('Layout 'Dense)
            ('Device 'CPU)
            T5DataType
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
                  'Dim ('Name &quot;*&quot;) ('Size 512)])),
       T5Output
         (Tensor
            ('Gradient 'WithGradient)
            ('Layout 'Dense)
            ('Device 'CPU)
            T5DataType
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 8),
                  'Dim ('Name &quot;*&quot;) ('Size 512)]))
         (Tensor
            ('Gradient 'WithGradient)
            ('Layout 'Dense)
            ('Device 'CPU)
            T5DataType
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
                  'Dim ('Name &quot;*&quot;) ('Size 512)]))
         (Tensor
            ('Gradient 'WithoutGradient)
            ('Layout 'Dense)
            ('Device 'CPU)
            ('DataType 'Bool)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))),
      Generator ('Device 'CPU))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SequenceToSequenceTransformerOutput
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 7),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
</span><a href="#local-6989586621679761007"><span class="hs-identifier hs-var">t5Output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">T5Output
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 8),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
  (Tensor
     ('Gradient 'WithGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     T5DataType
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13),
           'Dim ('Name &quot;*&quot;) ('Size 512)]))
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     ('Device 'CPU)
     ('DataType 'Bool)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 3), 'Dim ('Name &quot;*&quot;) ('Size 13)]))
</span><a href="#local-6989586621679760996"><span class="hs-identifier hs-var">t5Output'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Generator ('Device 'CPU)
</span><a href="#local-6989586621679760995"><span class="hs-identifier hs-var">g'''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="hs-comment">-- | 'HasForward' instance for T5 models.</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- Use this instance for sequence generation once the encoder's output is available.</span><span>
</span><span id="line-504"></span><span class="hs-comment">--</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- Note that this instance always shifts decoder inputs to the right</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- by adding a BOS token at the beginning.</span><span>
</span><span id="line-507"></span><span id="local-6989586621679760940"><span id="local-6989586621679760941"><span id="local-6989586621679760942"><span id="local-6989586621679760943"><span id="local-6989586621679760944"><span id="local-6989586621679760945"><span id="local-6989586621679760946"><span id="local-6989586621679760947"><span id="local-6989586621679760948"><span id="local-6989586621679760949"><span id="local-6989586621679760950"><span id="local-6989586621679760951"><span id="local-6989586621679760952"><span id="local-6989586621679760953"><span id="local-6989586621679760954"><span id="local-6989586621679760955"><span id="local-6989586621679760956"><span id="local-6989586621679760957"><span id="local-6989586621679760958"><span id="local-6989586621679760959"><span id="local-6989586621679760960"><span id="local-6989586621679760961"><span id="local-6989586621679760962"><span id="local-6989586621679760963"><span id="local-6989586621679760964"><span id="local-6989586621679760965"><span id="local-6989586621679760966"><span id="local-6989586621679760967"><span id="local-6989586621679760968"><span id="local-6989586621679760969"><span id="local-6989586621679760970"><span id="local-6989586621679760971"><span id="local-6989586621679760972"><span id="local-6989586621679760973"><span id="local-6989586621679760974"><span id="local-6989586621679760975"><span id="local-6989586621679760976"><span id="local-6989586621679760977"><span id="local-6989586621679760978"><span id="local-6989586621679760979"><span id="local-6989586621679760980"><span id="local-6989586621679760981"><span id="local-6989586621679760982"><span id="local-6989586621679760983"><span id="local-6989586621679760984"><span id="local-6989586621679760985"><span id="local-6989586621679760986"><span id="local-6989586621679760987"><span id="local-6989586621679760988"><span id="local-6989586621679760989"><span class="hs-keyword">instance</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621679760989"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760988"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760987"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760986"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760985"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760984"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><a href="#local-6989586621679760983"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760982"><span class="hs-identifier hs-type">decoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760981"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760980"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760979"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760978"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><a href="#local-6989586621679760977"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760976"><span class="hs-identifier hs-type">rightShiftedDecoderInputGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760975"><span class="hs-identifier hs-type">rightShiftedDecoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760974"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760973"><span class="hs-identifier hs-type">rightShiftedDecoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760972"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#MkT5RelPosC"><span class="hs-identifier hs-type">MkT5RelPosC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760974"><span class="hs-identifier hs-type">rightShiftedDecoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760972"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760971"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760970"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760969"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqSize</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760968"><span class="hs-identifier hs-type">decoderPos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerPaddingMaskC"><span class="hs-identifier hs-type">MkTransformerPaddingMaskC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760981"><span class="hs-identifier hs-type">decoderInputLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760980"><span class="hs-identifier hs-type">decoderInputDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760979"><span class="hs-identifier hs-type">decoderInputDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760978"><span class="hs-identifier hs-type">decoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760967"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><a href="#local-6989586621679760966"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.Tensor.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760965"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760964"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760963"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760962"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760961"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760988"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760987"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760986"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760985"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760984"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760960"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760959"><span class="hs-identifier hs-type">attentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerCrossAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerCrossAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760972"><span class="hs-identifier hs-type">rightShiftedDecoderInputShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760971"><span class="hs-identifier hs-type">rightShiftedDecoderInputSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760988"><span class="hs-identifier hs-type">inputPaddingMaskGradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760987"><span class="hs-identifier hs-type">inputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760986"><span class="hs-identifier hs-type">inputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760985"><span class="hs-identifier hs-type">inputPaddingMaskDataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760984"><span class="hs-identifier hs-type">inputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760960"><span class="hs-identifier hs-type">inputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760958"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#MkTransformerDecoderAttentionMaskC"><span class="hs-identifier hs-type">MkTransformerDecoderAttentionMaskC</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5DataType"><span class="hs-identifier hs-type">T5DataType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760964"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskLayout</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760963"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760961"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskShape</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760957"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMaskSeqDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760956"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679760983"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760955"><span class="hs-identifier hs-type">generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760977"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760955"><span class="hs-identifier hs-type">generator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#ShiftRight"><span class="hs-identifier hs-type">ShiftRight</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679760967"><span class="hs-identifier hs-type">decoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760955"><span class="hs-identifier hs-type">generator</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760966"><span class="hs-identifier hs-type">rightShiftedDecoderInputPaddingMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760955"><span class="hs-identifier hs-type">generator</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-519"></span><span>    </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5ModelF"><span class="hs-identifier hs-type">T5ModelF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760954"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760953"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760952"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760951"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760950"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760949"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760948"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760947"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760946"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760945"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760944"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760943"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerGenerationInput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerGenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760977"><span class="hs-identifier hs-type">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760942"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760968"><span class="hs-identifier hs-type">decoderPos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760956"><span class="hs-identifier hs-type">decoderAttentionMask</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760958"><span class="hs-identifier hs-type">crossAttentionMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>      </span><span class="annot"><a href="#local-6989586621679760955"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-523"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760941"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760942"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>      </span><span class="annot"><a href="#local-6989586621679760940"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-526"></span><span>  </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Class.html#HasForward"><span class="hs-identifier hs-type">HasForward</span></a></span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760954"><span class="hs-identifier hs-type">style</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760953"><span class="hs-identifier hs-type">transformerHead</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760952"><span class="hs-identifier hs-type">numEncoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760951"><span class="hs-identifier hs-type">numDecoderLayers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760950"><span class="hs-identifier hs-type">gradient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760949"><span class="hs-identifier hs-type">device</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760948"><span class="hs-identifier hs-type">headDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760947"><span class="hs-identifier hs-type">headEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760946"><span class="hs-identifier hs-type">embedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760945"><span class="hs-identifier hs-type">inputEmbedDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760944"><span class="hs-identifier hs-type">ffnDim</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760943"><span class="hs-identifier hs-type">vocabDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5GenerationInput"><span class="hs-identifier hs-type">T5GenerationInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760983"><span class="hs-identifier hs-type">decoderInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760942"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760989"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><a href="#local-6989586621679760955"><span class="hs-identifier hs-type">generator</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-type">T5Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760941"><span class="hs-identifier hs-type">decoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760942"><span class="hs-identifier hs-type">encoderOutput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679760989"><span class="hs-identifier hs-type">inputPaddingMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><a href="#local-6989586621679760940"><span class="hs-identifier hs-type">generatorOutput</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-533"></span><span>  </span><span id="local-6989586621679760938"><span class="annot"><span class="annottext">forward :: T5Model
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; generator
-&gt; (T5Output decoderOutput encoderOutput inputPaddingMask,
    generatorOutput)
</span><a href="#local-6989586621679760938"><span class="hs-identifier hs-var hs-var hs-var hs-var">forward</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Model"><span class="hs-identifier hs-type">T5Model</span></a></span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#GT5Model"><span class="hs-identifier hs-type">GT5Model</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679760935"><span id="local-6989586621679760936"><span id="local-6989586621679760937"><span class="annot"><span class="annottext">ShiftRight Int
T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
t5ShiftRightPaddingMask :: ShiftRight Int
t5ShiftRightDecoderInput :: ShiftRight Int
t5Model :: T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
t5ShiftRightPaddingMask :: forall t5Model. GT5Model t5Model -&gt; ShiftRight Int
t5ShiftRightDecoderInput :: forall t5Model. GT5Model t5Model -&gt; ShiftRight Int
t5Model :: forall t5Model. GT5Model t5Model -&gt; t5Model
</span><a href="#local-6989586621679760935"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5GenerationInput"><span class="hs-identifier hs-type">T5GenerationInput</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679760932"><span id="local-6989586621679760933"><span id="local-6989586621679760934"><span class="annot"><span class="annottext">inputPaddingMask
decoderInput
encoderOutput
t5GenerationInputPaddingMask :: inputPaddingMask
t5GenerationEncoderOutput :: encoderOutput
t5GenerationDecoderInput :: decoderInput
t5GenerationInputPaddingMask :: forall decoderInput encoderOutput inputPaddingMask.
T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; inputPaddingMask
t5GenerationEncoderOutput :: forall decoderInput encoderOutput inputPaddingMask.
T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; encoderOutput
t5GenerationDecoderInput :: forall decoderInput encoderOutput inputPaddingMask.
T5GenerationInput decoderInput encoderOutput inputPaddingMask
-&gt; decoderInput
</span><a href="#local-6989586621679760932"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="annottext">IxState
  generator
  generatorOutput
  (T5Output decoderOutput encoderOutput inputPaddingMask)
-&gt; generator
-&gt; (T5Output decoderOutput encoderOutput inputPaddingMask,
    generatorOutput)
forall i j a. IxState i j a -&gt; i -&gt; (a, j)
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var hs-var">runIxState</span></a></span><span> </span><span class="annot"><span class="annottext">(IxState
   generator
   generatorOutput
   (T5Output decoderOutput encoderOutput inputPaddingMask)
 -&gt; generator
 -&gt; (T5Output decoderOutput encoderOutput inputPaddingMask,
     generatorOutput))
-&gt; IxState
     generator
     generatorOutput
     (T5Output decoderOutput encoderOutput inputPaddingMask)
-&gt; generator
-&gt; (T5Output decoderOutput encoderOutput inputPaddingMask,
    generatorOutput)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-535"></span><span>      </span><span class="annot"><span class="annottext">decoderInput -&gt; IxState generator generator decoderInput
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
</span><a href="#local-6989586621679760934"><span class="hs-identifier hs-var">t5GenerationDecoderInput</span></a></span><span>
</span><span id="line-536"></span><span>        </span><span class="annot"><span class="annottext">IxState generator generator decoderInput
-&gt; (decoderInput
    -&gt; IxState
         generator
         generator
         (Tensor
            rightShiftedDecoderInputGradient
            rightShiftedDecoderInputLayout
            rightShiftedDecoderInputDevice
            rightShiftedDecoderInputDataType
            rightShiftedDecoderInputShape))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (Tensor
       rightShiftedDecoderInputGradient
       rightShiftedDecoderInputLayout
       rightShiftedDecoderInputDevice
       rightShiftedDecoderInputDataType
       rightShiftedDecoderInputShape,
     generator))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape,
      generator))
 -&gt; IxState
      generator
      generator
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape))
-&gt; (decoderInput
    -&gt; generator
    -&gt; (Tensor
          rightShiftedDecoderInputGradient
          rightShiftedDecoderInputLayout
          rightShiftedDecoderInputDevice
          rightShiftedDecoderInputDataType
          rightShiftedDecoderInputShape,
        generator))
-&gt; decoderInput
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; decoderInput
-&gt; generator
-&gt; (Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape,
    generator)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679760936"><span class="hs-identifier hs-var">t5ShiftRightDecoderInput</span></a></span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape)
-&gt; (Tensor
      rightShiftedDecoderInputGradient
      rightShiftedDecoderInputLayout
      rightShiftedDecoderInputDevice
      rightShiftedDecoderInputDataType
      rightShiftedDecoderInputShape
    -&gt; IxState
         generator
         generatorOutput
         (T5Output decoderOutput encoderOutput inputPaddingMask))
-&gt; IxState
     generator
     generatorOutput
     (T5Output decoderOutput encoderOutput inputPaddingMask)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679760931"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679760931"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-538"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679760930"><span class="annot"><span class="annottext">decoderRelPos :: Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  rightShiftedDecoderInputDevice
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
</span><a href="#local-6989586621679760930"><span class="hs-identifier hs-var hs-var">decoderRelPos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      ('Layout 'Dense)
      rightShiftedDecoderInputDevice
      ('DataType 'Int64)
      ('Shape
         '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
            'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
forall (m :: * -&gt; *) (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) (seqName :: Name Symbol)
       (seqSize :: Size Nat) output.
(MonadThrow m,
 MkT5RelPosC device shape seqDim seqName seqSize output) =&gt;
Tensor gradient layout device dataType shape -&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5DecoderRelPos"><span class="hs-identifier hs-var">mkT5DecoderRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679760931"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span>
</span><span id="line-539"></span><span>                     </span><span id="local-6989586621679760929"><span class="annot"><span class="annottext">crossAttentionMask :: Tensor
  (Seq
     (Unify
        (Gradient RequiresGradient)
        inputPaddingMaskGradient
        ('Gradient 'WithoutGradient))
     ('Gradient 'WithoutGradient))
  (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
  inputPaddingMaskDevice
  (Seq
     (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
     T5DataType)
  (BroadcastShapesF
     (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim
             rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
           inputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679760929"><span class="hs-identifier hs-var hs-var">crossAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-540"></span><span>                       </span><span class="annot"><span class="annottext">IO
  (Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
-&gt; Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      (Seq
         (Unify
            (Gradient RequiresGradient)
            inputPaddingMaskGradient
            ('Gradient 'WithoutGradient))
         ('Gradient 'WithoutGradient))
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         T5DataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim])))
 -&gt; Tensor
      (Seq
         (Unify
            (Gradient RequiresGradient)
            inputPaddingMaskGradient
            ('Gradient 'WithoutGradient))
         ('Gradient 'WithoutGradient))
      (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
      inputPaddingMaskDevice
      (Seq
         (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
         T5DataType)
      (BroadcastShapesF
         (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim
                 rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
               inputPaddingMaskSeqDim])))
-&gt; IO
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-541"></span><span>                         </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; SShape rightShiftedDecoderInputShape
-&gt; Double
-&gt; Tensor
     inputPaddingMaskGradient
     inputPaddingMaskLayout
     inputPaddingMaskDevice
     inputPaddingMaskDataType
     inputPaddingMaskShape
-&gt; IO
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (decoderInputShape :: Shape [Dim (Name Symbol) (Size Nat)])
       (decoderInputSeqDim :: Dim (Name Symbol) (Size Nat))
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerCrossAttentionMaskC
   transformerDataType
   decoderInputShape
   decoderInputSeqDim
   gradient
   layout
   device
   dataType
   shape
   seqDim
   output) =&gt;
SDataType transformerDataType
-&gt; SShape decoderInputShape
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerCrossAttentionMask"><span class="hs-identifier hs-var">mkTransformerCrossAttentionMask</span></a></span><span>
</span><span id="line-542"></span><span>                           </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span>
</span><span id="line-543"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; SShape rightShiftedDecoderInputShape
forall (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType).
SGetShape shape =&gt;
Tensor gradient layout device dataType shape -&gt; SShape shape
</span><a href="Torch.GraduallyTyped.Tensor.Type.html#sShape"><span class="hs-identifier hs-var">sShape</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679760931"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>                           </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-var">t5AttentionMaskBias</span></a></span><span>
</span><span id="line-545"></span><span>                           </span><span class="annot"><span class="annottext">inputPaddingMask
Tensor
  inputPaddingMaskGradient
  inputPaddingMaskLayout
  inputPaddingMaskDevice
  inputPaddingMaskDataType
  inputPaddingMaskShape
</span><a href="#local-6989586621679760932"><span class="hs-identifier hs-var">t5GenerationInputPaddingMask</span></a></span><span>
</span><span id="line-546"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
  (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
  (Seq
     (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
     ('DataType 'Bool))
  (BroadcastShapesF
     decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxState
     generator
     generator
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
        (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
        (Seq
           (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
           ('DataType 'Bool))
        (BroadcastShapesF
           decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
forall (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)]) output.
MkTransformerPaddingMaskC layout device dataType shape output =&gt;
Tensor gradient layout device dataType shape -&gt; output
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#mkT5PaddingMask"><span class="hs-identifier hs-var">mkT5PaddingMask</span></a></span><span> </span><span class="annot"><span class="annottext">decoderInput
Tensor
  decoderInputGradient
  decoderInputLayout
  decoderInputDevice
  decoderInputDataType
  decoderInputShape
</span><a href="#local-6989586621679760934"><span class="hs-identifier hs-var">t5GenerationDecoderInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>                       </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)])))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; IxState
         generator
         generator
         (Tensor
            rightShiftedDecoderInputPaddingMaskGradient
            rightShiftedDecoderInputPaddingMaskLayout
            rightShiftedDecoderInputPaddingMaskDevice
            rightShiftedDecoderInputPaddingMaskDataType
            rightShiftedDecoderInputPaddingMaskShape))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (Tensor
       rightShiftedDecoderInputPaddingMaskGradient
       rightShiftedDecoderInputPaddingMaskLayout
       rightShiftedDecoderInputPaddingMaskDevice
       rightShiftedDecoderInputPaddingMaskDataType
       rightShiftedDecoderInputPaddingMaskShape,
     generator))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape,
      generator))
 -&gt; IxState
      generator
      generator
      (Tensor
         rightShiftedDecoderInputPaddingMaskGradient
         rightShiftedDecoderInputPaddingMaskLayout
         rightShiftedDecoderInputPaddingMaskDevice
         rightShiftedDecoderInputPaddingMaskDataType
         rightShiftedDecoderInputPaddingMaskShape))
-&gt; (Tensor
      ('Gradient 'WithoutGradient)
      (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
      (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
      (Seq
         (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
         ('DataType 'Bool))
      (BroadcastShapesF
         decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
    -&gt; generator
    -&gt; (Tensor
          rightShiftedDecoderInputPaddingMaskGradient
          rightShiftedDecoderInputPaddingMaskLayout
          rightShiftedDecoderInputPaddingMaskDevice
          rightShiftedDecoderInputPaddingMaskDataType
          rightShiftedDecoderInputPaddingMaskShape,
        generator))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; IxState
     generator
     generator
     (Tensor
        rightShiftedDecoderInputPaddingMaskGradient
        rightShiftedDecoderInputPaddingMaskLayout
        rightShiftedDecoderInputPaddingMaskDevice
        rightShiftedDecoderInputPaddingMaskDataType
        rightShiftedDecoderInputPaddingMaskShape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify (Layout LayoutType) decoderInputLayout ('Layout 'Dense))
     (Unify (Device (DeviceType Nat)) decoderInputDevice ('Device 'CPU))
     (Seq
        (Unify (DataType DType) decoderInputDataType ('DataType 'Int64))
        ('DataType 'Bool))
     (BroadcastShapesF
        decoderInputShape ('Shape '[ 'Dim ('Name &quot;*&quot;) ('Size 1)]))
-&gt; generator
-&gt; (Tensor
      rightShiftedDecoderInputPaddingMaskGradient
      rightShiftedDecoderInputPaddingMaskLayout
      rightShiftedDecoderInputPaddingMaskDevice
      rightShiftedDecoderInputPaddingMaskDataType
      rightShiftedDecoderInputPaddingMaskShape,
    generator)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">ShiftRight Int
</span><a href="#local-6989586621679760935"><span class="hs-identifier hs-var">t5ShiftRightPaddingMask</span></a></span><span>
</span><span id="line-548"></span><span>                       </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape)
-&gt; (Tensor
      rightShiftedDecoderInputPaddingMaskGradient
      rightShiftedDecoderInputPaddingMaskLayout
      rightShiftedDecoderInputPaddingMaskDevice
      rightShiftedDecoderInputPaddingMaskDataType
      rightShiftedDecoderInputPaddingMaskShape
    -&gt; IxState
         generator
         generator
         (SequenceToSequenceTransformerGenerationInput
            (Tensor
               rightShiftedDecoderInputGradient
               rightShiftedDecoderInputLayout
               rightShiftedDecoderInputDevice
               rightShiftedDecoderInputDataType
               rightShiftedDecoderInputShape)
            encoderOutput
            (Tensor
               ('Gradient 'WithoutGradient)
               ('Layout 'Dense)
               rightShiftedDecoderInputDevice
               ('DataType 'Int64)
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
                     'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
            (Tensor
               ('Gradient 'WithoutGradient)
               (Unify
                  (Layout LayoutType)
                  rightShiftedDecoderInputPaddingMaskLayout
                  ('Layout 'Dense))
               rightShiftedDecoderInputPaddingMaskDevice
               T5DataType
               (BroadcastShapesF
                  (BroadcastShapesF
                     ('Shape
                        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                           rightShiftedDecoderInputPaddingMaskSeqDim,
                           rightShiftedDecoderInputPaddingMaskSeqDim])
                     (UnsqueezeF
                        ('SelectDim ('ByIndex 1))
                        rightShiftedDecoderInputPaddingMaskShape))
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        rightShiftedDecoderInputPaddingMaskSeqDim,
                        rightShiftedDecoderInputPaddingMaskSeqDim])))
            (Tensor
               (Seq
                  (Unify
                     (Gradient RequiresGradient)
                     inputPaddingMaskGradient
                     ('Gradient 'WithoutGradient))
                  ('Gradient 'WithoutGradient))
               (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
               inputPaddingMaskDevice
               (Seq
                  (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
                  T5DataType)
               (BroadcastShapesF
                  (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
                  ('Shape
                     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                        'Dim
                          rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                        inputPaddingMaskSeqDim])))))
-&gt; IxState
     generator
     generator
     (SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           T5DataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              T5DataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679760928"><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679760928"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-549"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679760927"><span class="annot"><span class="annottext">decoderAttentionMask :: Tensor
  ('Gradient 'WithoutGradient)
  (Unify
     (Layout LayoutType)
     rightShiftedDecoderInputPaddingMaskLayout
     ('Layout 'Dense))
  rightShiftedDecoderInputPaddingMaskDevice
  T5DataType
  (BroadcastShapesF
     (BroadcastShapesF
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])
        (UnsqueezeF
           ('SelectDim ('ByIndex 1))
           rightShiftedDecoderInputPaddingMaskShape))
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           rightShiftedDecoderInputPaddingMaskSeqDim,
           rightShiftedDecoderInputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679760927"><span class="hs-identifier hs-var hs-var">decoderAttentionMask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>                                      </span><span class="annot"><span class="annottext">IO
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      T5DataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim])))
 -&gt; Tensor
      ('Gradient 'WithoutGradient)
      (Unify
         (Layout LayoutType)
         rightShiftedDecoderInputPaddingMaskLayout
         ('Layout 'Dense))
      rightShiftedDecoderInputPaddingMaskDevice
      T5DataType
      (BroadcastShapesF
         (BroadcastShapesF
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])
            (UnsqueezeF
               ('SelectDim ('ByIndex 1))
               rightShiftedDecoderInputPaddingMaskShape))
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               rightShiftedDecoderInputPaddingMaskSeqDim,
               rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-551"></span><span>                                        </span><span class="annot"><span class="annottext">SDataType T5DataType
-&gt; Double
-&gt; Tensor
     rightShiftedDecoderInputPaddingMaskGradient
     rightShiftedDecoderInputPaddingMaskLayout
     rightShiftedDecoderInputPaddingMaskDevice
     rightShiftedDecoderInputPaddingMaskDataType
     rightShiftedDecoderInputPaddingMaskShape
-&gt; IO
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
forall (m :: * -&gt; *) (transformerDataType :: DataType DType)
       (gradient :: Gradient RequiresGradient)
       (layout :: Layout LayoutType) (device :: Device (DeviceType Nat))
       (dataType :: DataType DType)
       (shape :: Shape [Dim (Name Symbol) (Size Nat)])
       (seqDim :: Dim (Name Symbol) (Size Nat)) output.
(MonadThrow m,
 MkTransformerDecoderAttentionMaskC
   transformerDataType layout device shape seqDim output) =&gt;
SDataType transformerDataType
-&gt; Double
-&gt; Tensor gradient layout device dataType shape
-&gt; m output
</span><a href="Torch.GraduallyTyped.NN.Transformer.Type.html#mkTransformerDecoderAttentionMask"><span class="hs-identifier hs-var">mkTransformerDecoderAttentionMask</span></a></span><span>
</span><span id="line-552"></span><span>                                          </span><span class="annot"><span class="annottext">SDataType T5DataType
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5DataType"><span class="hs-identifier hs-var">t5DataType</span></a></span><span>
</span><span id="line-553"></span><span>                                          </span><span class="annot"><span class="annottext">Double
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#t5AttentionMaskBias"><span class="hs-identifier hs-var">t5AttentionMaskBias</span></a></span><span>
</span><span id="line-554"></span><span>                                          </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputPaddingMaskGradient
  rightShiftedDecoderInputPaddingMaskLayout
  rightShiftedDecoderInputPaddingMaskDevice
  rightShiftedDecoderInputPaddingMaskDataType
  rightShiftedDecoderInputPaddingMaskShape
</span><a href="#local-6989586621679760928"><span class="hs-identifier hs-var">rightShiftedDecoderInputPaddingMask</span></a></span><span>
</span><span id="line-555"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SequenceToSequenceTransformerGenerationInput
  (Tensor
     rightShiftedDecoderInputGradient
     rightShiftedDecoderInputLayout
     rightShiftedDecoderInputDevice
     rightShiftedDecoderInputDataType
     rightShiftedDecoderInputShape)
  encoderOutput
  (Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
  (Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])))
  (Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim])))
-&gt; IxState
     generator
     generator
     (SequenceToSequenceTransformerGenerationInput
        (Tensor
           rightShiftedDecoderInputGradient
           rightShiftedDecoderInputLayout
           rightShiftedDecoderInputDevice
           rightShiftedDecoderInputDataType
           rightShiftedDecoderInputShape)
        encoderOutput
        (Tensor
           ('Gradient 'WithoutGradient)
           ('Layout 'Dense)
           rightShiftedDecoderInputDevice
           ('DataType 'Int64)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
                 'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
        (Tensor
           ('Gradient 'WithoutGradient)
           (Unify
              (Layout LayoutType)
              rightShiftedDecoderInputPaddingMaskLayout
              ('Layout 'Dense))
           rightShiftedDecoderInputPaddingMaskDevice
           T5DataType
           (BroadcastShapesF
              (BroadcastShapesF
                 ('Shape
                    '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                       rightShiftedDecoderInputPaddingMaskSeqDim,
                       rightShiftedDecoderInputPaddingMaskSeqDim])
                 (UnsqueezeF
                    ('SelectDim ('ByIndex 1))
                    rightShiftedDecoderInputPaddingMaskShape))
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])))
        (Tensor
           (Seq
              (Unify
                 (Gradient RequiresGradient)
                 inputPaddingMaskGradient
                 ('Gradient 'WithoutGradient))
              ('Gradient 'WithoutGradient))
           (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
           inputPaddingMaskDevice
           (Seq
              (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
              T5DataType)
           (BroadcastShapesF
              (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    'Dim
                      rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                    inputPaddingMaskSeqDim]))))
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
-&gt; encoderOutput
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     ('Layout 'Dense)
     rightShiftedDecoderInputDevice
     ('DataType 'Int64)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
           'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
-&gt; Tensor
     ('Gradient 'WithoutGradient)
     (Unify
        (Layout LayoutType)
        rightShiftedDecoderInputPaddingMaskLayout
        ('Layout 'Dense))
     rightShiftedDecoderInputPaddingMaskDevice
     T5DataType
     (BroadcastShapesF
        (BroadcastShapesF
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])
           (UnsqueezeF
              ('SelectDim ('ByIndex 1))
              rightShiftedDecoderInputPaddingMaskShape))
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim]))
-&gt; Tensor
     (Seq
        (Unify
           (Gradient RequiresGradient)
           inputPaddingMaskGradient
           ('Gradient 'WithoutGradient))
        ('Gradient 'WithoutGradient))
     (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
     inputPaddingMaskDevice
     (Seq
        (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
        T5DataType)
     (BroadcastShapesF
        (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim
                rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
              inputPaddingMaskSeqDim]))
-&gt; SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
forall decoderInput encoderOutput decoderPos decoderAttentionMask
       crossAttentionMask.
decoderInput
-&gt; encoderOutput
-&gt; decoderPos
-&gt; decoderAttentionMask
-&gt; crossAttentionMask
-&gt; SequenceToSequenceTransformerGenerationInput
     decoderInput
     encoderOutput
     decoderPos
     decoderAttentionMask
     crossAttentionMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerGenerationInput"><span class="hs-identifier hs-var">SequenceToSequenceTransformerGenerationInput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  rightShiftedDecoderInputGradient
  rightShiftedDecoderInputLayout
  rightShiftedDecoderInputDevice
  rightShiftedDecoderInputDataType
  rightShiftedDecoderInputShape
</span><a href="#local-6989586621679760931"><span class="hs-identifier hs-var">rightShiftedDecoderInput</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679760933"><span class="hs-identifier hs-var">t5GenerationEncoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  ('Layout 'Dense)
  rightShiftedDecoderInputDevice
  ('DataType 'Int64)
  ('Shape
     '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
        'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize])
</span><a href="#local-6989586621679760930"><span class="hs-identifier hs-var">decoderRelPos</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  ('Gradient 'WithoutGradient)
  (Unify
     (Layout LayoutType)
     rightShiftedDecoderInputPaddingMaskLayout
     ('Layout 'Dense))
  rightShiftedDecoderInputPaddingMaskDevice
  T5DataType
  (BroadcastShapesF
     (BroadcastShapesF
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              rightShiftedDecoderInputPaddingMaskSeqDim,
              rightShiftedDecoderInputPaddingMaskSeqDim])
        (UnsqueezeF
           ('SelectDim ('ByIndex 1))
           rightShiftedDecoderInputPaddingMaskShape))
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           rightShiftedDecoderInputPaddingMaskSeqDim,
           rightShiftedDecoderInputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679760927"><span class="hs-identifier hs-var">decoderAttentionMask</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  (Seq
     (Unify
        (Gradient RequiresGradient)
        inputPaddingMaskGradient
        ('Gradient 'WithoutGradient))
     ('Gradient 'WithoutGradient))
  (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
  inputPaddingMaskDevice
  (Seq
     (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
     T5DataType)
  (BroadcastShapesF
     (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
     ('Shape
        '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
           'Dim
             rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
           inputPaddingMaskSeqDim]))
</span><a href="#local-6989586621679760929"><span class="hs-identifier hs-var">crossAttentionMask</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>                       </span><span class="annot"><span class="annottext">IxState
  generator
  generator
  (SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim]))))
-&gt; (SequenceToSequenceTransformerGenerationInput
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         T5DataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         (Seq
            (Unify
               (Gradient RequiresGradient)
               inputPaddingMaskGradient
               ('Gradient 'WithoutGradient))
            ('Gradient 'WithoutGradient))
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            T5DataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; IxState
         generator
         generatorOutput
         (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; IxState
     generator
     generatorOutput
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(generator
 -&gt; (SequenceToSequenceTransformerOutput
       decoderOutput encoderOutput,
     generatorOutput))
-&gt; IxState
     generator
     generatorOutput
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall i j a. (i -&gt; (a, j)) -&gt; IxState i j a
</span><a href="../file:///nix/store/8vjaffqxij7bih93d9mlzmc7ksanlw0i-indexed-extras-lib-indexed-extras-0.2-haddock-doc/share/doc/indexed-extras/html/src"><span class="hs-identifier hs-var">IxState</span></a></span><span> </span><span class="annot"><span class="annottext">((generator
  -&gt; (SequenceToSequenceTransformerOutput
        decoderOutput encoderOutput,
      generatorOutput))
 -&gt; IxState
      generator
      generatorOutput
      (SequenceToSequenceTransformerOutput decoderOutput encoderOutput))
-&gt; (SequenceToSequenceTransformerGenerationInput
      (Tensor
         rightShiftedDecoderInputGradient
         rightShiftedDecoderInputLayout
         rightShiftedDecoderInputDevice
         rightShiftedDecoderInputDataType
         rightShiftedDecoderInputShape)
      encoderOutput
      (Tensor
         ('Gradient 'WithoutGradient)
         ('Layout 'Dense)
         rightShiftedDecoderInputDevice
         ('DataType 'Int64)
         ('Shape
            '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
               'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
      (Tensor
         ('Gradient 'WithoutGradient)
         (Unify
            (Layout LayoutType)
            rightShiftedDecoderInputPaddingMaskLayout
            ('Layout 'Dense))
         rightShiftedDecoderInputPaddingMaskDevice
         T5DataType
         (BroadcastShapesF
            (BroadcastShapesF
               ('Shape
                  '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                     rightShiftedDecoderInputPaddingMaskSeqDim,
                     rightShiftedDecoderInputPaddingMaskSeqDim])
               (UnsqueezeF
                  ('SelectDim ('ByIndex 1))
                  rightShiftedDecoderInputPaddingMaskShape))
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  rightShiftedDecoderInputPaddingMaskSeqDim,
                  rightShiftedDecoderInputPaddingMaskSeqDim])))
      (Tensor
         (Seq
            (Unify
               (Gradient RequiresGradient)
               inputPaddingMaskGradient
               ('Gradient 'WithoutGradient))
            ('Gradient 'WithoutGradient))
         (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
         inputPaddingMaskDevice
         (Seq
            (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
            T5DataType)
         (BroadcastShapesF
            (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
            ('Shape
               '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                  'Dim
                    rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                  inputPaddingMaskSeqDim])))
    -&gt; generator
    -&gt; (SequenceToSequenceTransformerOutput
          decoderOutput encoderOutput,
        generatorOutput))
-&gt; SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; IxState
     generator
     generatorOutput
     (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
-&gt; SequenceToSequenceTransformerGenerationInput
     (Tensor
        rightShiftedDecoderInputGradient
        rightShiftedDecoderInputLayout
        rightShiftedDecoderInputDevice
        rightShiftedDecoderInputDataType
        rightShiftedDecoderInputShape)
     encoderOutput
     (Tensor
        ('Gradient 'WithoutGradient)
        ('Layout 'Dense)
        rightShiftedDecoderInputDevice
        ('DataType 'Int64)
        ('Shape
           '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize,
              'Dim ('Name &quot;*&quot;) rightShiftedDecoderInputSeqSize]))
     (Tensor
        ('Gradient 'WithoutGradient)
        (Unify
           (Layout LayoutType)
           rightShiftedDecoderInputPaddingMaskLayout
           ('Layout 'Dense))
        rightShiftedDecoderInputPaddingMaskDevice
        T5DataType
        (BroadcastShapesF
           (BroadcastShapesF
              ('Shape
                 '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                    rightShiftedDecoderInputPaddingMaskSeqDim,
                    rightShiftedDecoderInputPaddingMaskSeqDim])
              (UnsqueezeF
                 ('SelectDim ('ByIndex 1))
                 rightShiftedDecoderInputPaddingMaskShape))
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 rightShiftedDecoderInputPaddingMaskSeqDim,
                 rightShiftedDecoderInputPaddingMaskSeqDim])))
     (Tensor
        (Seq
           (Unify
              (Gradient RequiresGradient)
              inputPaddingMaskGradient
              ('Gradient 'WithoutGradient))
           ('Gradient 'WithoutGradient))
        (Unify (Layout LayoutType) inputPaddingMaskLayout ('Layout 'Dense))
        inputPaddingMaskDevice
        (Seq
           (Unify (DataType DType) inputPaddingMaskDataType ('DataType 'Bool))
           T5DataType)
        (BroadcastShapesF
           (UnsqueezeF ('SelectDim ('ByIndex 1)) inputPaddingMaskShape)
           ('Shape
              '[ 'Dim ('Name &quot;*&quot;) ('Size 1),
                 'Dim
                   rightShiftedDecoderInputSeqName rightShiftedDecoderInputSeqSize,
                 inputPaddingMaskSeqDim])))
-&gt; generator
-&gt; (SequenceToSequenceTransformerOutput
      decoderOutput encoderOutput,
    generatorOutput)
forall model input generator output generatorOutput.
HasForward model input generator output generatorOutput =&gt;
model -&gt; input -&gt; generator -&gt; (output, generatorOutput)
</span><a href="Torch.GraduallyTyped.NN.Class.html#forward"><span class="hs-identifier hs-var">forward</span></a></span><span> </span><span class="annot"><span class="annottext">T5ModelF
  style
  transformerHead
  numEncoderLayers
  numDecoderLayers
  gradient
  device
  headDim
  headEmbedDim
  embedDim
  inputEmbedDim
  ffnDim
  vocabDim
</span><a href="#local-6989586621679760937"><span class="hs-identifier hs-var">t5Model</span></a></span><span>
</span><span id="line-558"></span><span>                       </span><span class="annot"><span class="annottext">IxState
  generator
  generatorOutput
  (SequenceToSequenceTransformerOutput decoderOutput encoderOutput)
-&gt; (SequenceToSequenceTransformerOutput decoderOutput encoderOutput
    -&gt; IxState
         generatorOutput
         generatorOutput
         (T5Output decoderOutput encoderOutput inputPaddingMask))
-&gt; IxState
     generator
     generatorOutput
     (T5Output decoderOutput encoderOutput inputPaddingMask)
forall k1 (m :: k1 -&gt; k1 -&gt; * -&gt; *) (i :: k1) (j :: k1) a
       (k2 :: k1) b.
IxMonad m =&gt;
m i j a -&gt; (a -&gt; m j k2 b) -&gt; m i k2 b
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Torch.GraduallyTyped.NN.Transformer.SequenceToSequence.html#SequenceToSequenceTransformerOutput"><span class="hs-identifier hs-type">SequenceToSequenceTransformerOutput</span></a></span><span> </span><span id="local-6989586621679760925"><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679760925"><span class="hs-identifier hs-var">decoderOutput</span></a></span></span><span> </span><span id="local-6989586621679760924"><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679760924"><span class="hs-identifier hs-var">encoderOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-559"></span><span>                                </span><span class="annot"><span class="annottext">T5Output decoderOutput encoderOutput inputPaddingMask
-&gt; IxState
     generatorOutput
     generatorOutput
     (T5Output decoderOutput encoderOutput inputPaddingMask)
forall k (m :: k -&gt; k -&gt; * -&gt; *) a (i :: k).
IxPointed m =&gt;
a -&gt; m i i a
</span><a href="../file:///nix/store/y93sl1ahi24xw24f0y8xsbhzkmpzqzqh-indexed-lib-indexed-0.1.3-haddock-doc/share/doc/indexed/html/src"><span class="hs-identifier hs-var">ireturn</span></a></span><span> </span><span class="annot"><span class="annottext">(T5Output decoderOutput encoderOutput inputPaddingMask
 -&gt; IxState
      generatorOutput
      generatorOutput
      (T5Output decoderOutput encoderOutput inputPaddingMask))
-&gt; T5Output decoderOutput encoderOutput inputPaddingMask
-&gt; IxState
     generatorOutput
     generatorOutput
     (T5Output decoderOutput encoderOutput inputPaddingMask)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; T5Output decoderOutput encoderOutput inputPaddingMask
forall decoderOutput encoderOutput inputPaddingMask.
decoderOutput
-&gt; encoderOutput
-&gt; inputPaddingMask
-&gt; T5Output decoderOutput encoderOutput inputPaddingMask
</span><a href="Torch.GraduallyTyped.NN.Transformer.T5.Common.html#T5Output"><span class="hs-identifier hs-var">T5Output</span></a></span><span> </span><span class="annot"><span class="annottext">decoderOutput
</span><a href="#local-6989586621679760925"><span class="hs-identifier hs-var">decoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">encoderOutput
</span><a href="#local-6989586621679760924"><span class="hs-identifier hs-var">encoderOutput</span></a></span><span> </span><span class="annot"><span class="annottext">inputPaddingMask
</span><a href="#local-6989586621679760932"><span class="hs-identifier hs-var">t5GenerationInputPaddingMask</span></a></span><span>
</span><span id="line-560"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>             </span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-562"></span></pre></body></html>
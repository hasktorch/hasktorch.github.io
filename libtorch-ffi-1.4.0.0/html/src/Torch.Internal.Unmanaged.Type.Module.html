<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Torch.Internal.Unmanaged.Type.Module</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html"><span class="hs-identifier">Control.Exception.Safe</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///nix/store/hbz3x4zh91p6300gfxkxphy01qgqrqqz-inline-c-cpp-0.4.0.0-doc/share/doc/inline-c-cpp-0.4.0.0/html/src/Language.C.Inline.Cpp.html"><span class="hs-identifier">Language.C.Inline.Cpp</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///nix/store/hbz3x4zh91p6300gfxkxphy01qgqrqqz-inline-c-cpp-0.4.0.0-doc/share/doc/inline-c-cpp-0.4.0.0/html/src/Language.C.Inline.Cpp.Exceptions.html"><span class="hs-identifier">Language.C.Inline.Cpp.Exceptions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///nix/store/xfiiia37243w44xiydv8xa19dx1qb27k-inline-c-0.9.0.0-doc/share/doc/inline-c-0.9.0.0/html/src/Language.C.Inline.Context.html"><span class="hs-identifier">Language.C.Inline.Context</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///nix/store/xfiiia37243w44xiydv8xa19dx1qb27k-inline-c-0.9.0.0-doc/share/doc/inline-c-0.9.0.0/html/src/Language.C.Types.html"><span class="hs-identifier">Language.C.Types</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/containers-0.6.0.1/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.String.html"><span class="hs-identifier">Foreign.C.String</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html"><span class="hs-identifier">Foreign.C.Types</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.html"><span class="hs-identifier">Foreign</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.ForeignPtr.Imp.html#newForeignPtr"><span class="hs-identifier hs-var">newForeignPtr</span></a><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Concurrent.html"><span class="hs-identifier">Foreign.Concurrent</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Torch.Internal.Type.html"><span class="hs-identifier">Torch.Internal.Type</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html"><span class="hs-identifier">Torch.Internal.Unmanaged.Helper</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Torch.Internal.Class.html"><span class="hs-identifier">Torch.Internal.Class</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-identifier">C.context</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">C.cppCtx</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">mempty</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">C.ctxTypesTable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">typeTable</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;&lt;torch/script.h&gt;&quot;</span><span>
</span><a name="line-33"></a><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;&lt;torch/csrc/jit/export.h&gt;&quot;</span><span>
</span><a name="line-34"></a><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;&lt;vector&gt;&quot;</span><span>
</span><a name="line-35"></a><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;&lt;iostream&gt;&quot;</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- From libtorch/include/torch/csrc/jit/script/module.h</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-identifier">newModule</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span>
</span><a name="line-41"></a><a name="newModule"><a href="Torch.Internal.Unmanaged.Type.Module.html#newModule"><span class="hs-identifier">newModule</span></a></a><span> </span><a name="local-6989586621682829517"><a href="#local-6989586621682829517"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-42"></a><span>  </span><span class="">[C.throwBlock| torch::jit::script::Module* { return new torch::jit::script::Module(
     *$(std::string* name)
    );
  }|]</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-identifier">deleteModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><a name="deleteModule"><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteModule"><span class="hs-identifier">deleteModule</span></a></a><span> </span><a name="local-6989586621682829535"><a href="#local-6989586621682829535"><span class="hs-identifier">object</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void { delete $(torch::jit::script::Module* object);}|]</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">instance</span><span> </span><a href="Torch.Internal.Class.html#CppObject"><span class="hs-identifier hs-type">CppObject</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-51"></a><span>  </span><a name="local-8214565720323803910"><a href="Torch.Internal.Class.html#fromPtr"><span class="hs-identifier">fromPtr</span></a></a><span> </span><a name="local-6989586621682829515"><a href="#local-6989586621682829515"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Concurrent.html#newForeignPtr"><span class="hs-identifier hs-var">newForeignPtr</span></a><span> </span><a href="#local-6989586621682829515"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteModule"><span class="hs-identifier hs-var">deleteModule</span></a><span> </span><a href="#local-6989586621682829515"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-identifier">deleteJitGraph</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#SharedPtr"><span class="hs-identifier hs-type">SharedPtr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><a name="deleteJitGraph"><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteJitGraph"><span class="hs-identifier">deleteJitGraph</span></a></a><span> </span><a name="local-6989586621682829553"><a href="#local-6989586621682829553"><span class="hs-identifier">object</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void { delete $(std::shared_ptr&lt;torch::jit::Graph&gt;* object);}|]</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">instance</span><span> </span><a href="Torch.Internal.Class.html#CppObject"><span class="hs-identifier hs-type">CppObject</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#SharedPtr"><span class="hs-identifier hs-type">SharedPtr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>  </span><a name="local-8214565720323803910"><a href="Torch.Internal.Class.html#fromPtr"><span class="hs-identifier">fromPtr</span></a></a><span> </span><a name="local-6989586621682829514"><a href="#local-6989586621682829514"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Concurrent.html#newForeignPtr"><span class="hs-identifier hs-var">newForeignPtr</span></a><span> </span><a href="#local-6989586621682829514"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteJitGraph"><span class="hs-identifier hs-var">deleteJitGraph</span></a><span> </span><a href="#local-6989586621682829514"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-identifier">deleteJitNode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitNode"><span class="hs-identifier hs-type">JitNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><a name="deleteJitNode"><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteJitNode"><span class="hs-identifier">deleteJitNode</span></a></a><span> </span><a name="local-6989586621682829571"><a href="#local-6989586621682829571"><span class="hs-identifier">object</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void { delete $(torch::jit::Node* object);}|]</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">instance</span><span> </span><a href="Torch.Internal.Class.html#CppObject"><span class="hs-identifier hs-type">CppObject</span></a><span> </span><a href="Torch.Internal.Type.html#JitNode"><span class="hs-identifier hs-type">JitNode</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-63"></a><span>  </span><a name="local-8214565720323803910"><a href="Torch.Internal.Class.html#fromPtr"><span class="hs-identifier">fromPtr</span></a></a><span> </span><a name="local-6989586621682829513"><a href="#local-6989586621682829513"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Concurrent.html#newForeignPtr"><span class="hs-identifier hs-var">newForeignPtr</span></a><span> </span><a href="#local-6989586621682829513"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteJitNode"><span class="hs-identifier hs-var">deleteJitNode</span></a><span> </span><a href="#local-6989586621682829513"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-identifier">deleteJitValue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><a name="deleteJitValue"><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteJitValue"><span class="hs-identifier">deleteJitValue</span></a></a><span> </span><a name="local-6989586621682829589"><a href="#local-6989586621682829589"><span class="hs-identifier">object</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void { delete $(torch::jit::Value* object);}|]</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">instance</span><span> </span><a href="Torch.Internal.Class.html#CppObject"><span class="hs-identifier hs-type">CppObject</span></a><span> </span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>  </span><a name="local-8214565720323803910"><a href="Torch.Internal.Class.html#fromPtr"><span class="hs-identifier">fromPtr</span></a></a><span> </span><a name="local-6989586621682829512"><a href="#local-6989586621682829512"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Concurrent.html#newForeignPtr"><span class="hs-identifier hs-var">newForeignPtr</span></a><span> </span><a href="#local-6989586621682829512"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Unmanaged.Type.Module.html#deleteJitValue"><span class="hs-identifier hs-var">deleteJitValue</span></a><span> </span><a href="#local-6989586621682829512"><span class="hs-identifier hs-var">ptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-identifier">save</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><a name="save"><a href="Torch.Internal.Unmanaged.Type.Module.html#save"><span class="hs-identifier">save</span></a></a><span> </span><a name="local-6989586621682829607"><a href="#local-6989586621682829607"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829608"><a href="#local-6989586621682829608"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.String.html#withCString"><span class="hs-identifier hs-var">withCString</span></a><span> </span><a href="#local-6989586621682829608"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682829609"><a href="#local-6989586621682829609"><span class="hs-identifier">cfile</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="">[C.throwBlock| void {
    $(torch::jit::script::Module* obj)-&gt;save($(char* cfile));
  }|]</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-identifier">load</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span>
</span><a name="line-77"></a><a name="load"><a href="Torch.Internal.Unmanaged.Type.Module.html#load"><span class="hs-identifier">load</span></a></a><span> </span><a name="local-6989586621682829629"><a href="#local-6989586621682829629"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.String.html#withCString"><span class="hs-identifier hs-var">withCString</span></a><span> </span><a href="#local-6989586621682829629"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682829630"><a href="#local-6989586621682829630"><span class="hs-identifier">cfile</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="">[C.throwBlock| torch::jit::script::Module* {
    return new torch::jit::script::Module(torch::jit::load($(char* cfile)));
  }|]</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">forward</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#StdVector"><span class="hs-identifier hs-type">StdVector</span></a><span> </span><a href="Torch.Internal.Type.html#IValue"><span class="hs-identifier hs-type">IValue</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#IValue"><span class="hs-identifier hs-type">IValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><a name="forward"><a href="Torch.Internal.Unmanaged.Type.Module.html#forward"><span class="hs-identifier">forward</span></a></a><span> </span><a name="local-6989586621682829648"><a href="#local-6989586621682829648"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829649"><a href="#local-6989586621682829649"><span class="hs-identifier">inputs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| at::IValue* {
    return new at::IValue($(torch::jit::script::Module* obj)-&gt;forward(*$(std::vector&lt;at::IValue&gt;* inputs)));
  }|]</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-identifier">registerParameter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Tensor"><span class="hs-identifier hs-type">Tensor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><a name="registerParameter"><a href="Torch.Internal.Unmanaged.Type.Module.html#registerParameter"><span class="hs-identifier">registerParameter</span></a></a><span> </span><a name="local-6989586621682829669"><a href="#local-6989586621682829669"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829670"><a href="#local-6989586621682829670"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682829671"><a href="#local-6989586621682829671"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621682829672"><a href="#local-6989586621682829672"><span class="hs-identifier">is_buffer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void {
    $(torch::jit::script::Module* obj)-&gt;register_parameter(
      *$(std::string* name)
    , *$(at::Tensor* v)
    , $(bool is_buffer)
    );
  }|]</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">registerModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><a name="registerModule"><a href="Torch.Internal.Unmanaged.Type.Module.html#registerModule"><span class="hs-identifier">registerModule</span></a></a><span> </span><a name="local-6989586621682829696"><a href="#local-6989586621682829696"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829697"><a href="#local-6989586621682829697"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682829698"><a href="#local-6989586621682829698"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void {
    $(torch::jit::script::Module* obj)-&gt;register_module(
      *$(std::string* name)
    , *$(torch::jit::script::Module* v)
    );
  }|]</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-identifier">train</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><a name="train"><a href="Torch.Internal.Unmanaged.Type.Module.html#train"><span class="hs-identifier">train</span></a></a><span> </span><a name="local-6989586621682829720"><a href="#local-6989586621682829720"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829721"><a href="#local-6989586621682829721"><span class="hs-identifier">on</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void {
    $(torch::jit::script::Module* obj)-&gt;train(
      $(bool on)
    );
  }|]</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-identifier">runMethod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#C10List"><span class="hs-identifier hs-type">C10List</span></a><span> </span><a href="Torch.Internal.Type.html#IValue"><span class="hs-identifier hs-type">IValue</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#IValue"><span class="hs-identifier hs-type">IValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><a name="runMethod"><a href="Torch.Internal.Unmanaged.Type.Module.html#runMethod"><span class="hs-identifier">runMethod</span></a></a><span> </span><a name="local-6989586621682829741"><a href="#local-6989586621682829741"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829742"><a href="#local-6989586621682829742"><span class="hs-identifier">method_name</span></a></a><span> </span><a name="local-6989586621682829743"><a href="#local-6989586621682829743"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| at::IValue* {
    return new at::IValue($(torch::jit::script::Module* obj)-&gt;run_method(
      *$(std::string* method_name)
    , *$(c10::List&lt;at::IValue&gt;* args)
    ));
  }|]</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-identifier">runMethod1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#IValue"><span class="hs-identifier hs-type">IValue</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#IValue"><span class="hs-identifier hs-type">IValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><a name="runMethod1"><a href="Torch.Internal.Unmanaged.Type.Module.html#runMethod1"><span class="hs-identifier">runMethod1</span></a></a><span> </span><a name="local-6989586621682829765"><a href="#local-6989586621682829765"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829766"><a href="#local-6989586621682829766"><span class="hs-identifier">method_name</span></a></a><span> </span><a name="local-6989586621682829767"><a href="#local-6989586621682829767"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| at::IValue* {
    return new at::IValue($(torch::jit::script::Module* obj)-&gt;run_method(
      *$(std::string* method_name)
    , *$(at::IValue* args)
    ));
  }|]</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-identifier">getParameters</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span class="hs-special">)</span><span>
</span><a name="line-127"></a><a name="getParameters"><a href="Torch.Internal.Unmanaged.Type.Module.html#getParameters"><span class="hs-identifier">getParameters</span></a></a><span> </span><a name="local-6989586621682829789"><a href="#local-6989586621682829789"><span class="hs-identifier">obj</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| std::vector&lt;at::Tensor&gt;* {
    std::vector&lt;at::Tensor&gt;* vec_parameters = new std::vector&lt;at::Tensor&gt;();
    auto parameters = $(torch::jit::script::Module* obj)-&gt;parameters();
    for(auto p : parameters) {
      vec_parameters-&gt;push_back(p);
    }
    return vec_parameters;
  }|]</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-identifier">setParameters</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-137"></a><a name="setParameters"><a href="Torch.Internal.Unmanaged.Type.Module.html#setParameters"><span class="hs-identifier">setParameters</span></a></a><span> </span><a name="local-6989586621682829807"><a href="#local-6989586621682829807"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829808"><a href="#local-6989586621682829808"><span class="hs-identifier">params</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void {
    auto module = $(torch::jit::script::Module* obj);
    auto parameters = module-&gt;named_parameters();
    auto vec = $(std::vector&lt;at::Tensor&gt;* params);
    int i=0; 
    for(auto p : parameters) {
      module-&gt;register_parameter(p.name,(*vec)[i],false);
    }
  }|]</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-identifier">toDevice</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Torch.Internal.Type.html#DeviceType"><span class="hs-identifier hs-type">DeviceType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Int.html#Int16"><span class="hs-identifier hs-type">Int16</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><a name="toDevice"><a href="Torch.Internal.Unmanaged.Type.Module.html#toDevice"><span class="hs-identifier">toDevice</span></a></a><span> </span><a name="local-6989586621682829828"><a href="#local-6989586621682829828"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829829"><a href="#local-6989586621682829829"><span class="hs-identifier">device</span></a></a><span> </span><a name="local-6989586621682829830"><a href="#local-6989586621682829830"><span class="hs-identifier">device_index</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void {
    $(torch::jit::script::Module* obj)-&gt;to(torch::Device($(at::DeviceType device), $(int16_t device_index)));
  }|]</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">clone</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><a name="clone"><a href="Torch.Internal.Unmanaged.Type.Module.html#clone"><span class="hs-identifier">clone</span></a></a><span> </span><a name="local-6989586621682829852"><a href="#local-6989586621682829852"><span class="hs-identifier">obj</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| torch::jit::script::Module* {
    return new torch::jit::script::Module($(torch::jit::script::Module* obj)-&gt;clone());
  }|]</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-identifier">define</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><a name="define"><a href="Torch.Internal.Unmanaged.Type.Module.html#define"><span class="hs-identifier">define</span></a></a><span> </span><a name="local-6989586621682829870"><a href="#local-6989586621682829870"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682829871"><a href="#local-6989586621682829871"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">[C.throwBlock| void {
    $(torch::jit::script::Module* obj)-&gt;define(
      *$(std::string* src)
    );
  }|]</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-identifier">trace</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.String.html#CString"><span class="hs-identifier hs-type">CString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.String.html#CString"><span class="hs-identifier hs-type">CString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><a name="trace"><a href="Torch.Internal.Unmanaged.Type.Module.html#trace"><span class="hs-identifier">trace</span></a></a><span> </span><a name="local-6989586621682829891"><a href="#local-6989586621682829891"><span class="hs-identifier">moduleName</span></a></a><span> </span><a name="local-6989586621682829892"><a href="#local-6989586621682829892"><span class="hs-identifier">functionName</span></a></a><span> </span><a name="local-6989586621682829893"><a href="#local-6989586621682829893"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682829894"><a href="#local-6989586621682829894"><span class="hs-identifier">inputs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-166"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-167"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682829895"><a href="#local-6989586621682829895"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682829893"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682829895"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-169"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682829910"><a href="#local-6989586621682829910"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-170"></a><span>      </span><span class="">[C.throwBlock| torch::jit::script::Module* {
        torch::jit::script::Module self($(char* moduleName));
        auto vars_in = *$(std::vector&lt;at::Tensor&gt;* inputs);
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef std::vector&lt;at::Tensor&gt;* (*Func)(std::vector&lt;at::Tensor&gt;*);
        auto func = (Func)tfunc;
        auto graph = torch::jit::tracer::trace(
          c10::fmap&lt;c10::IValue&gt;(vars_in),
          [&amp;func](c10::Stack in) -&gt; c10::Stack {
            std::vector&lt;at::Tensor&gt;* ivalue_inps = new std::vector&lt;at::Tensor&gt;(c10::fmap(in, [](const c10::IValue&amp; v){
              return torch::autograd::Variable(v.toTensor());
            }));
            std::vector&lt;at::Tensor&gt; out = *(func(ivalue_inps));
            return c10::fmap&lt;c10::IValue&gt;(out);
          },
          [](const torch::autograd::Variable&amp; var) { return &quot;&quot;;}
        ).first-&gt;graph;
        auto v = graph-&gt;insertInput(0, &quot;self&quot;);
        v-&gt;setType(self._ivalue()-&gt;type());
        const auto name = c10::QualifiedName(*self.type()-&gt;name(), $(char* functionName));
        auto fn2 = self._ivalue()-&gt;compilation_unit()-&gt;create_function(name,graph);
        self.type()-&gt;addMethod(fn2);
        return new torch::jit::script::Module(self);
      }|]</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-identifier">traceAsGraph</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#TensorList"><span class="hs-identifier hs-type">TensorList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#SharedPtr"><span class="hs-identifier hs-type">SharedPtr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><a name="traceAsGraph"><a href="Torch.Internal.Unmanaged.Type.Module.html#traceAsGraph"><span class="hs-identifier">traceAsGraph</span></a></a><span> </span><a name="local-6989586621682829934"><a href="#local-6989586621682829934"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682829935"><a href="#local-6989586621682829935"><span class="hs-identifier">inputs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-198"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682829936"><a href="#local-6989586621682829936"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682829934"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682829936"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-200"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682829937"><a href="#local-6989586621682829937"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-201"></a><span>      </span><span class="">[C.throwBlock| std::shared_ptr&lt;torch::jit::Graph&gt;* {
        torch::jit::script::Module self(&quot;MyModule&quot;);
        auto vars_in = *$(std::vector&lt;at::Tensor&gt;* inputs);
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef std::vector&lt;at::Tensor&gt;* (*Func)(std::vector&lt;at::Tensor&gt;*);
        auto func = (Func)tfunc;
        auto graph = torch::jit::tracer::trace(
          c10::fmap&lt;c10::IValue&gt;(vars_in),
          [&amp;func](c10::Stack in) -&gt; c10::Stack {
            std::vector&lt;at::Tensor&gt;* ivalue_inps = new std::vector&lt;at::Tensor&gt;(c10::fmap(in, [](const c10::IValue&amp; v){
              return torch::autograd::Variable(v.toTensor());
            }));
            std::vector&lt;at::Tensor&gt; out = *(func(ivalue_inps));
            return c10::fmap&lt;c10::IValue&gt;(out);
          },
          [](const torch::autograd::Variable&amp; var) { return &quot;&quot;;}
        ).first-&gt;graph;
        return new std::shared_ptr&lt;torch::jit::Graph&gt;(graph);
      }|]</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-identifier">withJitGraph</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#SharedPtr"><span class="hs-identifier hs-type">SharedPtr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="#local-6989586621682829516"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="#local-6989586621682829516"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-222"></a><a name="withJitGraph"><a href="Torch.Internal.Unmanaged.Type.Module.html#withJitGraph"><span class="hs-identifier">withJitGraph</span></a></a><span> </span><a name="local-6989586621682829957"><a href="#local-6989586621682829957"><span class="hs-identifier">graph</span></a></a><span> </span><a name="local-6989586621682829958"><a href="#local-6989586621682829958"><span class="hs-identifier">callback</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-223"></a><span>  </span><a name="local-6989586621682829976"><a href="#local-6989586621682829976"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="">[C.throwBlock| torch::jit::Graph* {
         return (*$(std::shared_ptr&lt;torch::jit::Graph&gt;* graph)).get();
       }|]</span><span>
</span><a name="line-226"></a><span>  </span><a href="#local-6989586621682829958"><span class="hs-identifier hs-var">callback</span></a><span> </span><a href="#local-6989586621682829976"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-identifier">graphOutputs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-229"></a><a name="graphOutputs"><a href="Torch.Internal.Unmanaged.Type.Module.html#graphOutputs"><span class="hs-identifier">graphOutputs</span></a></a><span> </span><a name="local-6989586621682829977"><a href="#local-6989586621682829977"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-230"></a><span>  </span><a name="local-6989586621682830017"><a href="#local-6989586621682830017"><span class="hs-identifier">nodes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-231"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682830018"><a href="#local-6989586621682830018"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682830019"><a href="#local-6989586621682830019"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-232"></a><span>        </span><a name="local-6989586621682830020"><a href="#local-6989586621682830020"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830017"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-233"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621682830017"><span class="hs-identifier hs-var">nodes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682830019"><span class="hs-identifier hs-var">v</span></a><span class="hs-glyph">:</span><a href="#local-6989586621682830020"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621682830019"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-235"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-236"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830021"><a href="#local-6989586621682830021"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682830018"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682830021"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-238"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830022"><a href="#local-6989586621682830022"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-239"></a><span>      </span><span class="">[C.throwBlock| void {
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef torch::jit::Value* (*Func)(torch::jit::Value*);
        auto func = (Func)tfunc;
        for(auto i : (*$(torch::jit::Graph* graph)).outputs()){
          func(i);
        }
      }|]</span><span>
</span><a name="line-247"></a><span>  </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830017"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-identifier">graphInputs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-250"></a><a name="graphInputs"><a href="Torch.Internal.Unmanaged.Type.Module.html#graphInputs"><span class="hs-identifier">graphInputs</span></a></a><span> </span><a name="local-6989586621682830226"><a href="#local-6989586621682830226"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-251"></a><span>  </span><a name="local-6989586621682830227"><a href="#local-6989586621682830227"><span class="hs-identifier">nodes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-252"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682830228"><a href="#local-6989586621682830228"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682830229"><a href="#local-6989586621682830229"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-253"></a><span>        </span><a name="local-6989586621682830230"><a href="#local-6989586621682830230"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830227"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-254"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621682830227"><span class="hs-identifier hs-var">nodes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682830229"><span class="hs-identifier hs-var">v</span></a><span class="hs-glyph">:</span><a href="#local-6989586621682830230"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621682830229"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-256"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-257"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830231"><a href="#local-6989586621682830231"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682830228"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682830231"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-259"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830232"><a href="#local-6989586621682830232"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-260"></a><span>      </span><span class="">[C.throwBlock| void {
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef torch::jit::Value* (*Func)(torch::jit::Value*);
        auto func = (Func)tfunc;
        for(auto i : (*$(torch::jit::Graph* graph)).inputs()){
          func(i);
        }
      }|]</span><span>
</span><a name="line-268"></a><span>  </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830227"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-identifier">graphNodes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#JitNode"><span class="hs-identifier hs-type">JitNode</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-271"></a><a name="graphNodes"><a href="Torch.Internal.Unmanaged.Type.Module.html#graphNodes"><span class="hs-identifier">graphNodes</span></a></a><span> </span><a name="local-6989586621682830252"><a href="#local-6989586621682830252"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-272"></a><span>  </span><a name="local-6989586621682830253"><a href="#local-6989586621682830253"><span class="hs-identifier">nodes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-273"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682830254"><a href="#local-6989586621682830254"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682830255"><a href="#local-6989586621682830255"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-274"></a><span>        </span><a name="local-6989586621682830256"><a href="#local-6989586621682830256"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830253"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-275"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621682830253"><span class="hs-identifier hs-var">nodes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682830255"><span class="hs-identifier hs-var">v</span></a><span class="hs-glyph">:</span><a href="#local-6989586621682830256"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621682830255"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-277"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-278"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830257"><a href="#local-6989586621682830257"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682830254"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682830257"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-280"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830258"><a href="#local-6989586621682830258"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-281"></a><span>      </span><span class="">[C.throwBlock| void {
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef torch::jit::Node* (*Func)(torch::jit::Node*);
        auto func = (Func)tfunc;
        for(auto i : (*$(torch::jit::Graph* graph)).block()-&gt;nodes()){
          func(i);
        }
      }|]</span><span>
</span><a name="line-289"></a><span>  </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830253"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-identifier">nodeInputs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitNode"><span class="hs-identifier hs-type">JitNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-292"></a><a name="nodeInputs"><a href="Torch.Internal.Unmanaged.Type.Module.html#nodeInputs"><span class="hs-identifier">nodeInputs</span></a></a><span> </span><a name="local-6989586621682830278"><a href="#local-6989586621682830278"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-293"></a><span>  </span><a name="local-6989586621682830279"><a href="#local-6989586621682830279"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-294"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682830280"><a href="#local-6989586621682830280"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682830281"><a href="#local-6989586621682830281"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-295"></a><span>        </span><a name="local-6989586621682830282"><a href="#local-6989586621682830282"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830279"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-296"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621682830279"><span class="hs-identifier hs-var">values</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682830281"><span class="hs-identifier hs-var">v</span></a><span class="hs-glyph">:</span><a href="#local-6989586621682830282"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621682830281"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-298"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-299"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830283"><a href="#local-6989586621682830283"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682830280"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682830283"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-301"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830284"><a href="#local-6989586621682830284"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-302"></a><span>      </span><span class="">[C.throwBlock| void {
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef torch::jit::Value* (*Func)(torch::jit::Value*);
        auto func = (Func)tfunc;
        for(auto i : (*$(torch::jit::Node* node)).inputs()){
          func(i);
        }
      }|]</span><span>
</span><a name="line-310"></a><span>  </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830279"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-identifier">nodeOutputs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitNode"><span class="hs-identifier hs-type">JitNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">[</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-313"></a><a name="nodeOutputs"><a href="Torch.Internal.Unmanaged.Type.Module.html#nodeOutputs"><span class="hs-identifier">nodeOutputs</span></a></a><span> </span><a name="local-6989586621682830304"><a href="#local-6989586621682830304"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-314"></a><span>  </span><a name="local-6989586621682830305"><a href="#local-6989586621682830305"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-315"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682830306"><a href="#local-6989586621682830306"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621682830307"><a href="#local-6989586621682830307"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-316"></a><span>        </span><a name="local-6989586621682830308"><a href="#local-6989586621682830308"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830305"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-317"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a><span> </span><a href="#local-6989586621682830305"><span class="hs-identifier hs-var">values</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682830307"><span class="hs-identifier hs-var">v</span></a><span class="hs-glyph">:</span><a href="#local-6989586621682830308"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>        </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621682830307"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-319"></a><span>  </span><a href="file:///nix/store/qf3y0qy48fdf0r5d6qlz291242dl6g38-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src/Control.Exception.Safe.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-special">(</span><a href="file:///nix/store/qzmxv38jn6i0zykld6vl7w9cb2mqphls-libtorch-ffi-helper-1.4.0.0-doc/share/doc/libtorch-ffi-helper-1.4.0.0/html/src/Torch.Internal.Unmanaged.Helper.html#callbackHelper"><span class="hs-identifier hs-var">callbackHelper</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830309"><a href="#local-6989586621682830309"><span class="hs-identifier">inputs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="#local-6989586621682830306"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#castPtr"><span class="hs-identifier hs-var">castPtr</span></a><span> </span><a href="#local-6989586621682830309"><span class="hs-identifier hs-var">inputs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.Ptr.html#freeHaskellFunPtr"><span class="hs-identifier hs-var">freeHaskellFunPtr</span></a><span>
</span><a name="line-322"></a><span>    </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682830310"><a href="#local-6989586621682830310"><span class="hs-identifier">funcPtr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-323"></a><span>      </span><span class="">[C.throwBlock| void {
        auto tfunc = $(void* (*funcPtr)(void*));
        typedef torch::jit::Value* (*Func)(torch::jit::Value*);
        auto func = (Func)tfunc;
        for(auto i : (*$(torch::jit::Node* node)).outputs()){
          func(i);
        }
      }|]</span><span>
</span><a name="line-331"></a><span>  </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-6989586621682830305"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-identifier">nodeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitNode"><span class="hs-identifier hs-type">JitNode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><a name="nodeKind"><a href="Torch.Internal.Unmanaged.Type.Module.html#nodeKind"><span class="hs-identifier">nodeKind</span></a></a><span> </span><a name="local-6989586621682830330"><a href="#local-6989586621682830330"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-335"></a><span>  </span><span class="">[C.throwBlock| std::string* {
    return new std::string((*$(torch::jit::Node* node)).kind().toQualString());
  }|]</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-identifier">valueId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a><span>
</span><a name="line-340"></a><a name="valueId"><a href="Torch.Internal.Unmanaged.Type.Module.html#valueId"><span class="hs-identifier">valueId</span></a></a><span> </span><a name="local-6989586621682830348"><a href="#local-6989586621682830348"><span class="hs-identifier">value</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-341"></a><span>  </span><span class="">[C.throwBlock| int {
    return (*$(torch::jit::Value* value)).unique();
  }|]</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-identifier">valueType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#JitValue"><span class="hs-identifier hs-type">JitValue</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><a name="valueType"><a href="Torch.Internal.Unmanaged.Type.Module.html#valueType"><span class="hs-identifier">valueType</span></a></a><span> </span><a name="local-6989586621682830366"><a href="#local-6989586621682830366"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-347"></a><span>  </span><span class="">[C.throwBlock| std::string* {
    return new std::string((*$(torch::jit::Value* node)).type()-&gt;str());
  }|]</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-identifier">printGraph</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#SharedPtr"><span class="hs-identifier hs-type">SharedPtr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a><a name="printGraph"><a href="Torch.Internal.Unmanaged.Type.Module.html#printGraph"><span class="hs-identifier">printGraph</span></a></a><span> </span><a name="local-6989586621682830384"><a href="#local-6989586621682830384"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-354"></a><span>  </span><span class="">[C.throwBlock| std::string* {
    return new std::string((**$(std::shared_ptr&lt;torch::jit::Graph&gt;* graph)).toString());
  }|]</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-identifier">printOnnx</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><span class="hs-special">(</span><a href="Torch.Internal.Type.html#SharedPtr"><span class="hs-identifier hs-type">SharedPtr</span></a><span> </span><a href="Torch.Internal.Type.html#JitGraph"><span class="hs-identifier hs-type">JitGraph</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><a name="printOnnx"><a href="Torch.Internal.Unmanaged.Type.Module.html#printOnnx"><span class="hs-identifier">printOnnx</span></a></a><span> </span><a name="local-6989586621682830402"><a href="#local-6989586621682830402"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-360"></a><span>  </span><span class="">[C.throwBlock| std::string* {
    auto graph_str = torch::jit::pretty_print_onnx(
        *$(std::shared_ptr&lt;torch::jit::Graph&gt;* graph),
        std::map&lt;std::string, at::Tensor&gt;{},
        9,
        false);
    return new std::string(graph_str);
  }|]</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-identifier">dumpToStr</span><span>
</span><a name="line-370"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-371"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a><span>
</span><a name="line-372"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a><span>
</span><a name="line-373"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CBool"><span class="hs-identifier hs-type">CBool</span></a><span>
</span><a name="line-374"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/Foreign.C.Types.html#CInt"><span class="hs-identifier hs-type">CInt</span></a><span>
</span><a name="line-375"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/ghc-prim-0.5.3/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="file:///nix/store/wxc91qn3x7zvxz65925aq4zhn6vmjlr7-ghc-8.6.5-doc/share/doc/ghc/html/libraries/base-4.12.0.0/src/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span> </span><a href="Torch.Internal.Type.html#StdString"><span class="hs-identifier hs-type">StdString</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><a name="dumpToStr"><a href="Torch.Internal.Unmanaged.Type.Module.html#dumpToStr"><span class="hs-identifier">dumpToStr</span></a></a><span> </span><a name="local-6989586621682830420"><a href="#local-6989586621682830420"><span class="hs-identifier">obj</span></a></a><span> </span><a name="local-6989586621682830421"><a href="#local-6989586621682830421"><span class="hs-identifier">print_method_bodies</span></a></a><span> </span><a name="local-6989586621682830422"><a href="#local-6989586621682830422"><span class="hs-identifier">print_attr_values</span></a></a><span> </span><a name="local-6989586621682830423"><a href="#local-6989586621682830423"><span class="hs-identifier">print_param_values</span></a></a><span> </span><a name="local-6989586621682830424"><a href="#local-6989586621682830424"><span class="hs-identifier">level</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-377"></a><span>  </span><span class="">[C.throwBlock| std::string* {
    return new std::string($(torch::jit::script::Module* obj)-&gt;dump_to_str(
      $(bool print_method_bodies)
    , $(bool print_attr_values)
    , $(bool print_param_values)
    , $(int level)
    ));
  }|]</span><span>
</span><a name="line-385"></a></pre></body></html>